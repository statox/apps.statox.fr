import"../chunks/NZTpNUN0.js";import{a as pt}from"../chunks/CVDCh7bQ.js";import{p as lt,b as _,f,s as o,a as s,d as vt,e as M,r as N,g as r,h as b,i as a,c as V,t as Y,j as q}from"../chunks/OOCdeaM4.js";import{d as mt,s as z}from"../chunks/DBBHR-3t.js";import{i as v}from"../chunks/BMFH8sZT.js";import{r as _t}from"../chunks/C2XHBoXy.js";import{b as gt}from"../chunks/CCHh_OeQ.js";import{B as O,a as F}from"../chunks/H9lSQ-CD.js";import{P as ct}from"../chunks/CELBgAxi.js";import{g as dt}from"../chunks/BAyAqreb.js";import{c as ut}from"../chunks/DPSdUY9Q.js";import"../chunks/DRxGxY2p.js";import"../chunks/CxxcLhBh.js";import{p as ft}from"../chunks/CgiMXJad.js";/* empty css                */import"../chunks/bMdrnNxv.js";import{M as bt}from"../chunks/C8MJLfl1.js";var wt=_('<button>Start a new game</button> <br/> <input type="string"/> <button>Join Game</button>',1),yt=_("<p>Connecting to the server…</p>"),ht=_("<p>Waiting for an opponent to connect…</p>"),St=_("<p> </p> <!>",1),Pt=_("<p>Something went wrong. Board is not defined.</p>"),kt=_('<p>Game over</p> <button>Restart</button> <span style="font-weight: bold"><!></span> <!>',1),Ct=_("<p>Disconnected</p>"),Rt=_("<!> <h3>Online game <button>Back</button></h3> <!> <!> <!> <!> <!> <!>",1);function qt(H,K){lt(K,!0);const h={name:"Gravitrips",description:"4 in a row",iconPath:"/gravitrips.png"};ft.set(h);let n,x=b(null),g=b(null),c=b(null),S=b(null),p=b("initial"),P=b("");const Q=async()=>{const t=await ut.gravitrips.getNewGame();if(!t.gameId)throw new Error("Couldn't start the game");a(P,t.gameId,!0),B()},T=ct.replace(/^http?/,"ws");pt(()=>{n&&n.close()});const B=()=>{n=new WebSocket(T+"/gravitrips/ws?"+r(P)),a(p,"connecting"),a(g,null),a(c,null),a(S,null),n.onopen=()=>{a(p,"waiting_for_opponent")},n.onclose=t=>{console.log(t.reason),a(p,"disconnected")},n.onmessage=t=>{const e=JSON.parse(t.data);e.type==="game_ready"?(a(p,"playing"),a(x,e.youAre,!0),a(g,e.board,!0)):e.type==="update_board"?(a(g,e.board,!0),a(c,e.boardState,!0),a(S,e.winningCells,!0)):e.type==="waiting_for_opponent"?a(c,null):e.type==="game_over"&&a(p,"game_over")}},I=t=>{if(!n||n.readyState!==WebSocket.OPEN)return;const e=JSON.stringify({type:"move",column:t});n.send(e)},X=()=>{if(!n||n.readyState!==WebSocket.OPEN)return;const t=JSON.stringify({type:"restart"});n.send(t)};var E=Rt(),W=f(E);bt(W,{get title(){return h.name},get description(){return h.description},get iconPath(){return h.iconPath}});var C=o(W,2),Z=o(M(C));Z.__click=()=>dt("/gravitrips"),N(C);var J=o(C,2);{var $=t=>{var e=wt(),d=f(e);d.__click=Q;var m=o(d,4);_t(m);var w=o(m,2);w.__click=B,gt(m,()=>r(P),l=>a(P,l)),s(t,e)};v(J,t=>{["initial","waiting_for_opponent","game_over","disconnected"].includes(r(p))&&t($)})}var A=o(J,2);{var tt=t=>{var e=yt();s(t,e)};v(A,t=>{r(p)==="connecting"&&t(tt)})}var L=o(A,2);{var et=t=>{var e=ht();s(t,e)};v(L,t=>{r(p)==="waiting_for_opponent"&&t(et)})}var U=o(L,2);{var rt=t=>{var e=V(),d=f(e);{var m=l=>{var u=St(),y=f(u),R=M(y);N(y);var i=o(y,2);F(i,{nbColumns:7,nbRows:6,get board(){return r(g)},get winningCells(){return r(S)},onMove:I}),Y(()=>z(R,`You are Player ${r(x)??""}`)),s(l,u)},w=l=>{var u=Pt();s(l,u)};v(d,l=>{r(g)!==null?l(m):l(w,!1)})}s(t,e)};v(U,t=>{r(p)==="playing"&&t(rt)})}var D=o(U,2);{var at=t=>{var e=kt(),d=o(f(e),2);d.__click=X;var m=o(d,2),w=M(m);{var l=i=>{var k=q("Game Over");s(i,k)},u=i=>{var k=V(),it=f(k);{var st=G=>{var j=q();Y(()=>z(j,`Player ${r(c)??""} wins`)),s(G,j)};v(it,G=>{(r(c)===O.winPlayer1||r(c)===O.winPlayer2)&&G(st)},!0)}s(i,k)};v(w,i=>{r(c)===O.draw?i(l):i(u,!1)})}N(m);var y=o(m,2);{var R=i=>{F(i,{nbColumns:7,nbRows:6,get board(){return r(g)},get winningCells(){return r(S)},onMove:I})};v(y,i=>{r(g)!==null&&i(R)})}s(t,e)};v(D,t=>{r(p)==="game_over"&&t(at)})}var ot=o(D,2);{var nt=t=>{var e=Ct();s(t,e)};v(ot,t=>{r(p)==="disconnected"&&t(nt)})}s(H,E),vt()}mt(["click"]);export{qt as component};
