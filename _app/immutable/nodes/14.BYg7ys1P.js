import"../chunks/disclose-version.Bg9kRutz.js";import{p as W,aX as b,y as I,z as n,al as u,am as c,g as e,w as O,s as S,x as Y,aM as ne}from"../chunks/index-client.CflxByDC.js";import{s as H}from"../chunks/render.BKP2kCYY.js";import{a as le}from"../chunks/await.CbC4o2Nc.js";import{i as z}from"../chunks/if.DypW3AvO.js";import{n as Z,a as d,t as p,e as ce}from"../chunks/template.BNipMNgO.js";import{a as R}from"../chunks/props.B1tCRvRm.js";import{s as ae,a as te}from"../chunks/store.Bv-UhthR.js";import{m as me}from"../chunks/Modals.5B6rnlQ8.js";import{g as ve,u as re,U as de}from"../chunks/service.CBRyajoN.js";import{M as oe}from"../chunks/Main.DdoksM-n.js";import{M as fe}from"../chunks/Main.DhtiWXg0.js";import{P as B}from"../chunks/public.xpUinP6t.js";import{r as ue,A as pe}from"../chunks/index.CKvuQsiJ.js";import{s as _e}from"../chunks/client.BkaLWMTD.js";import{e as J,i as X}from"../chunks/each.Z673LCtr.js";import{r as K,s as N}from"../chunks/attributes.Cbh5jV0V.js";import{b as Q,a as ge}from"../chunks/input.BqKxAZW_.js";import{r as be}from"../chunks/legacy-client.BtMzTp2K.js";import{t as se}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.CmfGOx2M.js";import{b as he}from"../chunks/this.DVmHCfgD.js";import"../chunks/legacy.OjKiwS2-.js";import{p as ke}from"../chunks/Main.svelte_svelte_type_style_lang.BD4FPZbz.js";const ye=!1,va=Object.freeze(Object.defineProperty({__proto__:null,ssr:ye},Symbol.toStringTag,{value:"Module"})),ee=()=>ue({path:"/reactor/getEntriesForPublic"}),we=async f=>{const o=B+"/reactor/addEntry",_=await ve();typeof _=="string"&&await _e.post(o).auth(_,{type:"bearer"}).field("name",f.name).field("commaSeparatedTags",f.commaSeparatedTags).attach("file",f.file)};var xe=p('<span class="tag svelte-16m67n3"> </span>'),Se=(f,o,_)=>o(e(_)),Te=p('<video class="medium-margin svelte-16m67n3" style="max-width: 100%" controls></video>',2),Ue=p('<img class="medium-margin svelte-16m67n3">'),Le=p('<div><div><b> </b></div> <div class="svelte-16m67n3"></div> <div><button class="full-width svelte-16m67n3"><i class="fas fa-copy"></i> Copy link</button></div></div> <div><a rel="noopener noreferrer" target="blank"><!></a></div>',1),Me=(f,o)=>ne(o),Ce=p('<button class="full-width medium-margin svelte-16m67n3">More...</button>'),Ae=p('<input class="full-width medium-margin svelte-16m67n3" type="text" placeholder="Search by tags or name"> <div class="container svelte-16m67n3"></div> <!>',1);function Pe(f,o){W(o,!0);const _=10;let T=b(1),M=b(R([])),m=b("");const h=(a,t)=>{if(!t.length||a.name.toLowerCase().includes(t.toLowerCase()))return!0;for(const l of a.tags)if(l.toLowerCase().includes(t.toLowerCase()))return!0;return!1},k=a=>{navigator.clipboard.writeText(B+a.uri),se.push('<i class="fas fa-check"></i> Link copied to clipboard',{duration:1e3,theme:{"--toastBarHeight":0}})},y=a=>a.s3PresignedUrl.includes(".mp4");be(()=>{S(M,R(o.reactions.filter(a=>h(a,e(m))).sort((a,t)=>t.creationDateUnix-a.creationDateUnix).slice(0,e(m).length?void 0:e(T)*_)))});var g=Ae(),U=I(g);K(U);var w=n(U,2);J(w,21,()=>e(M),X,(a,t)=>{var v=Le(),l=I(v),x=u(l),F=u(x),j=u(F,!0);c(F),c(x);var L=n(x,2);J(L,21,()=>e(t).tags,X,(r,s)=>{var G=xe(),ie=u(G,!0);c(G),O(()=>H(ie,e(s))),d(r,G)}),c(L);var C=n(L,2),$=u(C);$.__click=[Se,k,t],c(C),c(l);var A=n(l,2),P=u(A),D=u(P);{var V=r=>{var s=Te();O(()=>N(s,"src",B+e(t).uri)),d(r,s)},q=r=>{var s=Ue();O(()=>{N(s,"src",B+e(t).uri),N(s,"alt",e(t).name)}),d(r,s)};z(D,r=>{y(e(t))?r(V):r(q,!1)})}c(P),c(A),O(()=>{H(j,e(t).name),N(P,"href",B+e(t).uri),N(P,"download",e(t).name)}),d(a,v)}),c(w);var E=n(w,2);{var i=a=>{var t=Ce();t.__click=[Me,T],d(a,t)};z(E,a=>{e(m).length===0&&e(T)*_<o.reactions.length&&a(i)})}Q(U,()=>e(m),a=>S(m,a)),d(f,g),Y()}Z(["click"]);var Re=(f,o)=>{e(o)!==void 0&&(e(o).value="")},Ee=p('<button class="form-action svelte-1f930i6">Submit</button>'),Fe=p('<span class="form-action svelte-1f930i6">Login to upload an entry</span>'),$e=p('<div role="dialog" class="modal svelte-1f930i6"><div class="contents svelte-1f930i6"><h4 class="title-bar svelte-1f930i6">Add a new file <button>Close</button></h4> <!> <form class="form-content svelte-1f930i6"><label for="name">Name</label> <input type="text"> <label for="content">Tags</label> <input type="textarea"> <label for="file">File</label> <span><input class="file-input svelte-1f930i6" type="file"> <button aria-label="delete file"><i class="fas fa-times-circle"></i></button></span> <br> <!></form></div></div>');function Ne(f,o){W(o,!0);const[_,T]=ae(),M=()=>te(re,"$user",_);let m=b(R([])),h=b(""),k=b(""),y=b(void 0),g=b(void 0);const U=async()=>{var t;S(m,R([])),(t=e(h))!=null&&t.length||e(m).push({level:"error",header:"name must be defined"});let a;if(e(g)&&e(g).length&&(a=e(g)[0]),a||e(m).push({level:"error",header:"a file must be uploaded"}),!(e(m).length||!a))try{await we({name:e(h),commaSeparatedTags:e(k),file:a}),o.onUpload(),o.close()}catch(v){let l=v.message;v instanceof pe&&v.code===401?l="Invalid logged in user":v instanceof de&&(l="User is logged out");const x=`<strong>Entry not created</strong><br/> ${l}`;se.push(x,{theme:{"--toastBarBackground":"#FF0000"}})}};var w=ce(),E=I(w);{var i=a=>{var t=$e(),v=u(t),l=u(v),x=n(u(l));x.__click=function(...r){var s;(s=o.close)==null||s.apply(this,r)},c(l);var F=n(l,2);J(F,17,()=>e(m),X,(r,s)=>{oe(r,{get item(){return e(s)}})});var j=n(F,2),L=n(u(j),2);K(L);var C=n(L,4);K(C);var $=n(C,4),A=u($);he(A,r=>S(y,r),()=>e(y));var P=n(A,2);P.__click=[Re,y],c($);var D=n($,4);{var V=r=>{var s=Ee();s.__click=U,d(r,s)},q=r=>{var s=Fe();d(r,s)};z(D,r=>{M()?r(V):r(q,!1)})}c(j),c(v),c(t),Q(L,()=>e(h),r=>S(h,r)),Q(C,()=>e(k),r=>S(k,r)),ge(A,()=>e(g),r=>S(g,r)),d(a,t)};z(E,a=>{o.isOpen&&a(i)})}d(f,w),Y(),T()}Z(["click"]);var Oe=(f,o)=>me.open(Ne,{onUpload:o}),Be=p("<button>Add an entry</button>"),Ie=p("<p>Something went wrong</p> <p> </p>",1),ze=p("<p>Loading data</p>"),je=p("<!> <h2>Upload</h2> <!> <h2>Content</h2> <!>",1);function da(f,o){W(o,!0);const[_,T]=ae(),M=()=>te(re,"$user",_);ke.set("Reactor");let m=b(R(ee()));const h=()=>S(m,R(ee()));var k=je(),y=I(k);fe(y,{title:"Reactor",description:"My collection of memes"});var g=n(y,4);{var U=i=>{var a=Be();a.__click=[Oe,h],d(i,a)},w=i=>{oe(i,{item:{level:"info",header:"Login to add an entry"}})};z(g,i=>{M()?i(U):i(w,!1)})}var E=n(g,4);le(E,()=>e(m),i=>{var a=ze();d(i,a)},(i,a)=>{Pe(i,{get reactions(){return e(a)}})},(i,a)=>{var t=Ie(),v=n(I(t),2),l=u(v,!0);O(()=>H(l,JSON.stringify(e(a)))),c(v),d(i,t)}),d(f,k),Y(),T()}Z(["click"]);export{da as component,va as universal};
