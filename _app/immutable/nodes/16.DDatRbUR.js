var U=Object.defineProperty;var G=(c,i,t)=>i in c?U(c,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[i]=t;var g=(c,i,t)=>G(c,typeof i!="symbol"?i+"":i,t);import"../chunks/CWj6FrbW.js";import{i as M}from"../chunks/BWrXOCgO.js";import{o as Y,a as W}from"../chunks/BsHVKKaD.js";import{p as P,k as q,n as V,o as b,B as v,ah as D,w as z,u as R,C as d,v as Z,aU as J,g as k,m as F,s as A,f as E,b5 as X}from"../chunks/B4E0qFrQ.js";import{e as w,d as $}from"../chunks/jcoRU5f5.js";import{f as S,a as _,e as L,c as tt}from"../chunks/TaMh_RKI.js";import{c as N,r as et,e as it,s as st}from"../chunks/XLhzAL0B.js";import{m as ot}from"../chunks/aq897_mn.js";import{s as at}from"../chunks/iPZhYhum.js";import{p as H}from"../chunks/BZUyvf6Q.js";import{i as O}from"../chunks/DihUjPeT.js";import{P as nt}from"../chunks/D_wKqE0n.js";import{T as rt}from"../chunks/vaCicukU.js";import{M as lt}from"../chunks/BIrotqCT.js";import{p as ut}from"../chunks/Bci3bk5X.js";class vt{constructor(i=80){g(this,"audioContext");g(this,"notesInQueue",[]);g(this,"currentBeatInBar");g(this,"beatsPerBar");g(this,"currentSubdivision");g(this,"subdivisionsInBeat");g(this,"tempo");g(this,"lookahead");g(this,"scheduleAheadTime");g(this,"nextNoteTime");g(this,"isRunning");g(this,"intervalID");g(this,"onBeatStart");g(this,"onBeatEnd");this.audioContext=null,this.notesInQueue=[],this.currentBeatInBar=0,this.currentSubdivision=0,this.subdivisionsInBeat=1,this.beatsPerBar=4,this.tempo=i,this.lookahead=25,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.isRunning=!1,this.intervalID=null}nextNote(){const i=60/this.subdivisionsInBeat/this.tempo;this.nextNoteTime+=i,this.currentSubdivision++,this.currentSubdivision>=this.subdivisionsInBeat&&(this.currentBeatInBar++,this.currentSubdivision=0),this.currentBeatInBar>=this.beatsPerBar&&(this.currentBeatInBar=0)}scheduleNote(i,t,o){if(!this.audioContext)return;this.notesInQueue.push({note:i,time:o});const s=this.audioContext.createOscillator(),a=this.audioContext.createGain(),r=1e3,m=400,h=200;t!==0?s.frequency.value=h:i%this.beatsPerBar===0?s.frequency.value=r:s.frequency.value=m,a.gain.value=1,a.gain.exponentialRampToValueAtTime(1,o+.001),a.gain.exponentialRampToValueAtTime(.001,o+.02),s.connect(a),a.connect(this.audioContext.destination);const l=this.audioContext.createConstantSource();l.onended=()=>{var n;(n=this.onBeatStart)==null||n.call(this,i,t),s.start(),s.stop(o+.03),s.onended=()=>{var u;(u=this.onBeatEnd)==null||u.call(this)}},l.start(o),l.stop(this.audioContext.currentTime+1e-4)}scheduler(){if(this.audioContext)for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;)this.scheduleNote(this.currentBeatInBar,this.currentSubdivision,this.nextNoteTime),this.nextNote()}start(){this.isRunning||(this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.isRunning=!0,this.currentBeatInBar=0,this.currentSubdivision=0,this.nextNoteTime=this.audioContext.currentTime+.05,this.intervalID=setInterval(()=>this.scheduler(),this.lookahead))}stop(){this.isRunning=!1,this.intervalID&&clearInterval(this.intervalID)}startStop(){this.isRunning?this.stop():this.start()}}var dt=S('<div class="controls-container svelte-14nipte"><div class="controls-sub-container svelte-14nipte"><label for="beatsInBar"><h4>Beats in bar</h4></label> <div class="subdivisions-container svelte-14nipte"><button>-1</button> <span style="font-size: large; margin-left: 1em; margin-right: 1em"> </span> <button>+1</button></div></div> <br/> <div class="controls-sub-container svelte-14nipte"><label for="subdivisionsInBeat"><h4>Subdivisions in beat</h4></label> <div class="subdivisions-container svelte-14nipte"><button aria-label="1 subdivision by beat"><svg width="15" height="15" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 15px; height: auto;"><path d="M 4.3 0 v 9.6 A 2.9 2.9 0 0 0 0 12.1 A 3 3 0 0 0 3 15 c 1.5 0 2.8 -1.3 2.8 -2.9 V 3 V 0 H 4.3 Z"></path></svg></button> <button aria-label="2 subdivision by beat"><svg width="15" height="15" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 15px; height: auto;"><path d="M4.3 0v9.6A2.9 2.9 0 0 0 0 12.1 3 3 0 0 0 3 15c1.5 0 2.8-1.3 2.8-2.9V3h7.7v6.6a2.9 2.9 0 0 0-4.3 2.5 2.9 2.9 0 0 0 5.8 0V0H4.3Z"></path></svg></button> <button aria-label="3 subdivision by beat"><svg width="24" height="21" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 24px; height: auto; top: -3px;"><path clip-rule="evenodd" d="M4.3 15.6V6H24v12.1a3 3 0 0 1-3 2.9 2.9 2.9 0 0 1-2.8-2.9 2.9 2.9 0 0 1 4.3-2.5V9H15v9.1a2.9 2.9 0 0 1-3 2.9 3 3 0 0 1-3-2.9 2.9 2.9 0 0 1 3-2.8c.5 0 1 0 1.3.3V9H5.8v9.1C5.8 19.7 4.5 21 3 21a3 3 0 0 1-3-2.9 2.9 2.9 0 0 1 4.3-2.5Z"></path><path d="M12.6 2.2 13.9.5V0h-3.1v.4h2.5l-1.4 1.7v.4h.4c.9 0 1.3.4 1.3 1s-.4 1-1.2 1c-.7 0-1.3-.3-1.6-.6l-.2.4c.4.4 1 .6 1.8.6 1.1 0 1.7-.6 1.7-1.4 0-.8-.5-1.3-1.5-1.4Z"></path></svg></button> <button aria-label="4 subdivision by beat"><svg width="27" height="13" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 27px; height: auto;"><path clip-rule="evenodd" d="M3.5 0v7.9a2 2 0 0 0-1.1-.3C1 7.6 0 8.6 0 9.9c0 1.3 1 2.4 2.4 2.4 1.3 0 2.3-1 2.3-2.4V3.4H11V8a2 2 0 0 0-1.1-.3 2.3 2.3 0 1 0 0 4.7c1.3 0 2.4-1 2.4-2.4V3.4h6.1V8a2.4 2.4 0 0 0-1-.3c-1.4 0-2.5 1-2.5 2.3 0 1.3 1.1 2.4 2.4 2.4 1.3 0 2.4-1 2.4-2.4V3.4h6.2V8l-1.2-.3c-1.3 0-2.3 1-2.3 2.3a2.3 2.3 0 1 0 4.7 0V0H3.5Zm7.4 2.7H4.7V1.5H11v1.2Zm7.4 0h-6.1V1.5h6.1v1.2Zm1.3 0h6.2V1.5h-6.2v1.2Z"></path></svg></button></div></div></div>');function ht(c,i){P(i,!1);let t=H(i,"metronome",12);M();var o=dt(),s=v(o),a=b(v(s),2),r=v(a),m=b(r,2),h=v(m,!0);d(m);var l=b(m,2);d(a),d(s);var n=b(s,4),u=b(v(n),2),x=v(u);let y;var e=b(x,2);let p;var f=b(e,2);let I;var T=b(f,2);let B;d(u),d(n),d(o),q((C,j,K,Q)=>{at(h,(z(t()),R(()=>t().beatsPerBar))),y=N(x,1,"svelte-14nipte",null,y,C),p=N(e,1,"svelte-14nipte",null,p,j),I=N(f,1,"svelte-14nipte",null,I,K),B=N(T,1,"svelte-14nipte",null,B,Q)},[()=>({selected:t().subdivisionsInBeat===1}),()=>({selected:t().subdivisionsInBeat===2}),()=>({selected:t().subdivisionsInBeat===3}),()=>({selected:t().subdivisionsInBeat===4})],D),w("click",r,()=>t(t().beatsPerBar=Math.max(t().beatsPerBar-1,1),!0)),w("click",l,()=>t(t().beatsPerBar=Math.min(t().beatsPerBar+1,10),!0)),w("click",x,()=>t(t().subdivisionsInBeat=1,!0)),w("click",e,()=>t(t().subdivisionsInBeat=2,!0)),w("click",f,()=>t(t().subdivisionsInBeat=3,!0)),w("click",T,()=>t(t().subdivisionsInBeat=4,!0)),_(c,o),V()}var ct=S('<div class="tempo-container svelte-oae4co"><div class="tempo-less svelte-oae4co"><button>-5</button> <button>-1</button></div> <div class="tempo-value svelte-oae4co" style="font-size: x-large"><input style="font-size: x-large; margin-right: 0.1em;" type="number" min="1" max="400"/> BPM</div> <div class="tempo-more svelte-oae4co"><button>+1</button> <button>+5</button></div></div>');function mt(c,i){P(i,!1);let t=H(i,"metronome",12);const o=y=>{if(!y||!y.target)return;const e=y.target,p=Number(e.value);!p||p<1||t(t().tempo=p,!0)};M();var s=ct(),a=v(s),r=v(a),m=b(r,2);d(a);var h=b(a,2),l=v(h);et(l),Z(),d(h);var n=b(h,2),u=v(n),x=b(u,2);d(n),d(s),q(()=>it(l,(z(t()),R(()=>t().tempo)))),w("click",r,()=>t(t().tempo=Number(t().tempo)-5,!0)),w("click",m,()=>t(t().tempo=Number(t().tempo)-1,!0)),w("change",l,o),w("click",u,()=>t(t().tempo=Number(t().tempo)+1,!0)),w("click",x,()=>t(t().tempo=Number(t().tempo)+5,!0)),_(c,s),V()}var bt=L('<svg width="20" height="20" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: auto;"><path d="M 0 0 V 20 L 6 20 L 6 0 L 0 0 M 9 0 V 20 H 15 V 0 H 9"></path></svg>'),pt=L('<svg width="20" height="20" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: auto;"><path d="M 0 0 V 20 L 17 10"></path></svg>'),ft=S('<div class="controls-container svelte-1jo8tk4"><button style="min-width: 300px"><!></button></div>');function gt(c,i){P(i,!1);let t=H(i,"metronome",12);const o=()=>{t().startStop(),t(t())},s=n=>{const u=" ";if([u].includes(n.key)&&(n.preventDefault(),n.key===u)){o();return}};M();var a=ft();w("keydown",J,s);var r=v(a),m=v(r);{var h=n=>{var u=bt();_(n,u)},l=n=>{var u=pt();_(n,u)};O(m,n=>{z(t()),R(()=>t().isRunning)?n(h):n(l,!1)})}d(r),d(a),w("click",r,o),_(c,a),V()}var wt=S('<div id="canvas-container" class="d-flex justify-content-center"><!></div>');function xt(c,i){P(i,!1);let t=H(i,"metronome",12),o=!1,s=0,a=0;const r=(e,p)=>{o=!0,s=e,a=p},m=()=>{o=!1};let h,l="white",n="white";const u=e=>{e.setup=()=>{h=e,e.createCanvas(600,300),e.textSize(40)},e.draw=()=>{const p=document.getElementById("canvas-container");if(p){const B=(p==null?void 0:p.clientWidth)||600;e.width!==B&&e.resizeCanvas(B,Math.max(B/3,100))}e.clear(),e.stroke(l);const f=Math.min(e.width/t().beatsPerBar,e.height),I=e.height/t().subdivisionsInBeat;for(let B=0;B<t().beatsPerBar;B++){B===s?e.strokeWeight(5):e.strokeWeight(1),e.noFill(),e.circle(B*f+f/2,e.height/2,f*.9),e.strokeWeight(1);for(let C=0;C<t().subdivisionsInBeat;C++)o&&B===s&&C===a?e.fill(l):e.noFill(),e.circle(B*f+f/2,C*I+I/2,f/t().subdivisionsInBeat*.9)}o?e.fill(n):e.fill(l),e.fill(l);const T=(s+1).toString();e.text(T,s*f+f/2-e.textWidth(T)/2,e.height/2+e.textSize()/2)}};Y(()=>{const e=getComputedStyle(document.body);l=e.getPropertyValue("--nc-tx-3"),n=e.getPropertyValue("--nc-tx-2"),t(t().onBeatStart=r,!0),t(t().onBeatEnd=m,!0)}),W(()=>{h==null||h.remove()}),M();var x=wt(),y=v(x);nt(y,{sketch:u}),d(x),_(c,x),V()}var Bt=S('<div class="controls-container svelte-1gwle9f"><button>Tap</button></div>');function yt(c,i){P(i,!1);let t=H(i,"onNewBPM",8),o=new rt,s=F(!1);const a=()=>{o.addBeat(),A(s,!0),setTimeout(()=>A(s,!1),100),o.bpm>0&&t()(Math.ceil(o.bpm))};M();var r=Bt(),m=v(r);let h;d(r),q(l=>h=N(m,1,"svelte-1gwle9f",null,h,l),[()=>({taped:k(s)})],D),w("click",m,a),_(c,r),V()}var _t=S(`<div role="dialog" class="modal svelte-5yv1o0"><div class="contents svelte-5yv1o0"><h4 class="title-bar svelte-5yv1o0">Metronome <button>Close</button></h4> <div>This is a simple metronome: <ul><li>Use the play/pause button or the space bar to start and stop the metronome</li> <li>You can change the tempo by:</li> <ul><li>Entering a number directly in the input</li> <li>Using the -5, -1, +1 and +5 buttons</li> <li>Taping a tempo on the tap button. When taping the tempo each tap counts
                            for a subdivision if subdivisions are enabled. Stop taping for approx. 3
                            seconds to restart the tap counter.</li></ul> <li>The "Beats in bar" setting change the number of beats counted by the
                        metronome. The first beat is accented with a higher frequency tone.</li> <li>The "Subdivisions in beat" setting allow to change how the beats are
                        divided. The subdivisions after the first one are played with a lower
                        frequency tone.</li> <li>The visualization at the bottom follow the beats and their subdivisions.</li></ul></div> <br/> <h5>Bugs</h5> <ul><li>While it goes against my opinion on what the web should look like, this page
                    works better with Chrome-based browsers.</li> <li>For some reason the display of the tempo settings is broken on Firefox, the
                    input doesn't resize properly.</li> <li>The sound doesn't work on Safari on iOS (and maybe on MacOS too).</li></ul></div></div>`);function kt(c,i){var t=tt(),o=E(t);{var s=a=>{var r=_t(),m=v(r),h=v(m),l=b(v(h));l.__click=function(...n){var u;(u=i.close)==null||u.apply(this,n)},d(h),Z(8),d(m),d(r),_(a,r)};O(o,a=>{i.isOpen&&a(s)})}_(c,t)}$(["click"]);var It=S('<!> <div class="main svelte-1kxlsex"><h3>Metronome <span><button aria-label="info"><i class="fa fa-info-circle" aria-hidden="true"></i></button></span></h3> <div><!></div> <div class="section svelte-1kxlsex"><!> <!></div> <div class="section svelte-1kxlsex"><!></div> <div class="section svelte-1kxlsex"><!></div></div>',1);function Et(c,i){P(i,!1),ut.set("Metronome");let t=F(new vt(80));W(()=>{k(t).stop()}),M();var o=It(),s=E(o);lt(s,{title:"Metronome",description:"Metronome"});var a=b(s,2),r=v(a),m=b(v(r)),h=v(m);st(h,"",{},{position:"relative"}),d(m),d(r);var l=b(r,2),n=v(l);gt(n,{get metronome(){return k(t)}}),d(l);var u=b(l,2),x=v(u);mt(x,{get metronome(){return k(t)}});var y=b(x,2);yt(y,{onNewBPM:T=>{X(t,k(t).tempo=T/k(t).subdivisionsInBeat),A(t,k(t))}}),d(u);var e=b(u,2),p=v(e);ht(p,{get metronome(){return k(t)}}),d(e);var f=b(e,2),I=v(f);xt(I,{get metronome(){return k(t)}}),d(f),d(a),w("click",h,()=>ot.open(kt)),_(c,o),V()}export{Et as component};
