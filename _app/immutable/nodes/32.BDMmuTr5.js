import{g as Bt,a as wt,b as Vt,c as Ut}from"../chunks/Dpf3hd-L.js";import"../chunks/DsnmJJEf.js";import{o as gt}from"../chunks/C5xzD1C9.js";import{p as z,a1 as Ct,g as t,b as S,t as I,a as _,d as G,i as A,h as M,f as O,s as g,e as f,r as i,aI as F,c as X,j as kt,C as ot}from"../chunks/C1Jxye1l.js";import{d as lt,w as yt,s as U,g as Mt}from"../chunks/B5mDzSg_.js";import{e as j,i as P}from"../chunks/1qSvZEoQ.js";import{c as It}from"../chunks/C-d4OVt_.js";import{s as vt,d as Lt,a as et,b as ft,r as pt}from"../chunks/Z-lh6Sw0.js";import{b as Ot,c as Ft}from"../chunks/DeqYhWtL.js";import{s as xt,d as St,a as mt}from"../chunks/BSoi5k31.js";import{m as jt}from"../chunks/JhUZHTPg.js";import{a as Dt}from"../chunks/CBOaXGNX.js";import{M as Et}from"../chunks/DoRwF3u2.js";import{M as Rt}from"../chunks/BLQblb1E.js";import{i as J}from"../chunks/BAKOb8xY.js";import{k as _t}from"../chunks/MUUMuS0A.js";import{p as dt}from"../chunks/CzBM3R0-.js";import{b as Nt,g as Pt}from"../chunks/BCGidQ8E.js";import{t as Ht}from"../chunks/Be3lftIb.js";import{A as Jt,a as zt}from"../chunks/Cyb1dSsQ.js";import"../chunks/QnWVP2T3.js";import{U as Gt}from"../chunks/BWptIUEw.js";import{b as Kt}from"../chunks/DJ3uJPbz.js";import{a as Wt}from"../chunks/DcdHlYY_.js";import"../chunks/Bdxdj0h6.js";import"../chunks/C_0PWwTw.js";import{p as Qt}from"../chunks/rc8jUsVI.js";const Xt=!1,Yt=async()=>({chords:await Bt()}),lr=Object.freeze(Object.defineProperty({__proto__:null,load:Yt,ssr:Xt},Symbol.toStringTag,{value:"Module"}));var Zt=S('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1vskasp"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1vskasp">Back to top</span></button>');function $t(C,s){z(s,!0);let u=M(0),m=M(!0),L;const D=n=>{n>0?A(m,!1):A(m,!0),L&&clearTimeout(L),L=setTimeout(()=>{A(m,!0)},3e3)},b=()=>{const n=document.documentElement.scrollTop||document.body.scrollTop;n>0&&(window.requestAnimationFrame(b),window.scrollTo(0,n-n/2))};Ct(()=>D(t(u)));var r=Zt();let e;r.__click=b,I(()=>e=vt(r,1,"top-link svelte-1vskasp",null,e,{hide:t(m)})),Dt("y",()=>t(u),n=>A(u,n,!0)),_(C,r),G()}lt(["click"]);const nt=yt();let Tt=[];const bt=localStorage.getItem("failedVisitCounts");if(bt!==null)try{Tt=JSON.parse(bt)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const ut=yt(Tt);ut.subscribe(C=>{localStorage.setItem("failedVisitCounts",JSON.stringify(C))});const At=C=>C==="doc"?"fas fa-file-word":C==="pdf"?"fas fa-file-pdf":C==="youtube"?"fa fa-youtube":"fas fa-link";var te=S('<span></span> <span><a target="_blank" rel="noopener noreferrer"> </a></span>',1);function it(C,s){z(s,!0);const u=()=>mt(ut,"$failedVisitCounts",m),[m,L]=xt();let D=dt(s,"showArtist",3,!1),b=M(void 0);nt.subscribe(a=>{if(a&&a.has(s.chord.url)){const d=a.get(s.chord.url),o=new Date(d.lastAccessDateUnix*1e3);A(b,`visits: ${d.count} - last: ${o.toLocaleDateString()}`)}});const r=F(()=>(D()?s.chord.artist+" - ":"")+s.chord.title),e=a=>a.type==="doc"?`${Nt}/docviewer/${a.url}`:a.url,n=async()=>{try{await wt({url:s.chord.url});const a=Mt(nt),d=a.get(s.chord.url)||{count:0,lastAccessDateUnix:0};d.count++,d.lastAccessDateUnix=Date.now()/1e3,a.set(s.chord.url,d),nt.set(a)}catch(a){let d=a.message;a instanceof Jt&&a.code===401?d="Invalid logged in user":a instanceof Gt&&(d="User is logged out"),St(ut,[...u(),s.chord.url]);const o=`<strong>Visit not counted</strong><br/> ${d}`;Ht.push(o,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};var v=te(),h=O(v),x=g(h,2),p=f(x);p.__click=n;var l=f(p,!0);i(p),i(x),I((a,d)=>{vt(h,1,a,"svelte-et925i"),et(p,"href",d),et(p,"title",t(b)),U(l,t(r))},[()=>Lt(At(s.chord.type)),()=>e(s.chord)]),_(C,v),G(),L()}lt(["click"]);var ee=S('<li class="ul2col-item"><!> <!></li>'),re=S('<ul class="ul2col-container"></ul>');function ae(C,s){z(s,!0);let u=dt(s,"chords",15),m=M(void 0);nt.subscribe(r=>{r&&(A(m,r,!0),u(u().sort((e,n)=>{const v=r.get(e.url),h=r.get(n.url);return v&&h?h.lastAccessDateUnix-v.lastAccessDateUnix:v?-1:h?1:e.artist!=n.artist?e.artist.toLowerCase()<n.artist.toLowerCase()?-1:1:e.title.toLowerCase()<n.title.toLowerCase()?-1:1})))});const L=(r,e,n)=>n[r.type]===!1?!1:e.length===0||r.artist.toLowerCase().match(e.toLowerCase())?!0:r.title.toLowerCase().match(e.toLowerCase());var D=X(),b=O(D);_t(b,u,r=>{var e=re();j(e,21,u,P,(n,v)=>{const h=F(()=>t(m)?.get(t(v).url));var x=X(),p=O(x);{var l=a=>{var d=ee(),o=f(d);{var c=k=>{var y=kt();I(()=>U(y,`(${t(h).count??""})`)),_(k,y)};J(o,k=>{t(h)&&k(c)})}var w=g(o,2);it(w,{get chord(){return t(v)},showArtist:!0}),i(d),_(a,d)};J(p,a=>{L(t(v),s.searchString,s.filters)&&a(l)})}_(n,x)}),i(e),_(r,e)}),_(C,D),G()}const se=(C,s)=>C<s?-1:C>s?1:0,ht=(C,s)=>{const u=C.toLowerCase(),m=s.toLowerCase();return se(u,m)};var oe=S('<li class="navigationBtn svelte-16xotip"><a class="navigationLink svelte-16xotip"> </a></li>'),ne=S('<li class="ul2col-item"><!></li>'),le=S('<ul class="ul2col-container"></ul>'),ie=S('<tr class="svelte-16xotip"><td class="svelte-16xotip"> <!></td></tr>'),ce=S('<ol id="indexList" class="navigationBar disable-scrollbars svelte-16xotip"></ol> <table id="artistTable"><tbody></tbody></table>',1);function ue(C,s){z(s,!0);let u=dt(s,"searchString",3,"");const m=F(()=>s.chords.reduce((o,c)=>{const w=c.artist;return o[w]||(o[w]=[]),o[w].push(c),o},{})),L=F(()=>Object.keys(t(m)).sort(ht).map((o,c,w)=>{if(c===0||o[0].toLowerCase()!=w[c-1][0].toLowerCase()){const k="anchor_letter_"+o[0];return{letter:o[0],tag:k}}}).filter(o=>o!==void 0)),D=F(()=>Object.keys(t(m)).sort(ht).map((o,c,w)=>{if(c===0||o[0].toLowerCase()!=w[c-1][0].toLowerCase()){const k="anchor_letter_"+o[0];return{name:o,tag:k}}return{name:o}}));let b=M(0),r=M(0),e=M(void 0);const n=o=>{if(t(e)){var c=t(e).getBoundingClientRect();if(c.top<20){A(r,20);return}A(r,c.top,!0)}};Ct(()=>n(t(b)));const v=(o,c,w)=>t(m)[o].sort((y,q)=>y.title<q.title?-1:1).filter(y=>{const q=y.type;return w[q]===!1?!1:c.length===0?!0:!!y.title.toLowerCase().match(c.toLowerCase())}),h=(o,c)=>!!o.toLowerCase().match(c.toLowerCase());var x=ce(),p=O(x);let l;j(p,21,()=>t(L),P,(o,c)=>{var w=oe(),k=f(w),y=f(k,!0);i(k),i(w),I(q=>{et(k,"href","#"+t(c).tag),U(y,q)},[()=>t(c).letter.toUpperCase()]),_(o,w)}),i(p);var a=g(p,2),d=f(a);j(d,21,()=>t(D),P,(o,c)=>{const w=F(()=>v(t(c).name,u(),s.filters)),k=F(()=>h(t(c).name,u()));var y=X(),q=O(y);{var E=K=>{const rt=F(()=>t(k)?t(m)[t(c).name]:t(w));var Y=ie(),W=f(Y),Z=f(W),$=g(Z);_t($,u,R=>{var H=le();j(H,21,()=>t(rt),P,(tt,at)=>{var Q=ne(),B=f(Q);it(B,{get chord(){return t(at)}}),i(Q),_(tt,Q)}),i(H),_(R,H)}),i(W),i(Y),I(()=>{et(W,"id",t(c).tag),U(Z,`${t(c).name??""} `)}),_(K,Y)};J(q,K=>{(t(k)||t(w).length>0)&&K(E)})}_(o,y)}),i(d),i(a),Kt(a,o=>A(e,o),()=>t(e)),I(()=>l=ft(p,"",l,{"--barTop":`${t(r)??""}px`})),Dt("y",()=>t(b),o=>A(b,o,!0)),_(C,x),G()}var ve=S('<li class="ul2col-item"><!></li>'),de=S('<div><span> </span> <ul class="ul2col-container"></ul></div>');function fe(C,s){z(s,!0);const u=b=>b.charAt(0).toUpperCase()+b.slice(1).toLowerCase(),m=F(()=>{const b={};for(const r of s.chords)r.tags.forEach(n=>{b[n]||(b[n]=[]),b[n].push(r)});return Object.keys(b).forEach(r=>{b[r].sort((e,n)=>{const v=e.artist.toLowerCase(),h=n.artist.toLowerCase(),x=e.title.toLowerCase(),p=n.title.toLowerCase();return v<h?-1:v>h?1:x<p?-1:1})}),b});var L=X(),D=O(L);j(D,17,()=>Object.keys(t(m)).sort(ht),P,(b,r)=>{var e=X(),n=O(e);{var v=h=>{var x=de(),p=f(x),l=f(p,!0);i(p);var a=g(p,2);j(a,21,()=>t(m)[t(r)],P,(d,o)=>{var c=X(),w=O(c);{var k=y=>{var q=ve(),E=f(q);it(E,{get chord(){return t(o)},showArtist:!0}),i(q),_(y,q)};J(w,y=>{s.filters[t(o).type]&&y(k)})}_(d,c)}),i(a),i(x),I(d=>U(l,d),[()=>u(t(r))]),_(h,x)};J(n,h=>{(s.searchString.length===0||t(r).toLowerCase().match(s.searchString.toLowerCase()))&&h(v)})}_(b,e)}),_(C,L),G()}var me=S('<li class="ul2col-item"><!> <!></li>'),he=S('<ul class="ul2col-container"></ul>');function ge(C,s){z(s,!0);let u=dt(s,"chords",15),m=M(void 0);nt.subscribe(r=>{r&&(A(m,r,!0),u(u().sort((e,n)=>{const v=r.get(e.url),h=r.get(n.url);return v&&h?v.count!==h.count?h.count-v.count:h.lastAccessDateUnix-v.lastAccessDateUnix:v?-1:h?1:e.artist!=n.artist?e.artist.toLowerCase()<n.artist.toLowerCase()?-1:1:e.title.toLowerCase()<n.title.toLowerCase()?-1:1})))});const L=(r,e,n)=>n[r.type]===!1?!1:e.length===0||r.artist.toLowerCase().match(e.toLowerCase())?!0:r.title.toLowerCase().match(e.toLowerCase());var D=X(),b=O(D);_t(b,u,r=>{var e=he();j(e,21,u,P,(n,v)=>{const h=F(()=>t(m)?.get(t(v).url));var x=X(),p=O(x);{var l=a=>{var d=me(),o=f(d);{var c=k=>{var y=kt();I(()=>U(y,`(${t(h).count??""})`)),_(k,y)};J(o,k=>{t(h)&&k(c)})}var w=g(o,2);it(w,{get chord(){return t(v)},showArtist:!0}),i(d),_(a,d)};J(p,a=>{L(t(v),s.searchString,s.filters)&&a(l)})}_(n,x)}),i(e),_(r,e)}),_(C,D),G()}var _e=S('<span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-161wm6q"> </span>',1),pe=S('<div class="rows svelte-161wm6q"><span class="col table-head svelte-161wm6q">Last Check</span> <span class="col table-head svelte-161wm6q">Checks</span> <span class="col table-head svelte-161wm6q">Skipped</span> <span class="col table-head svelte-161wm6q">Errors</span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span></div> <br/> <div class="rows svelte-161wm6q"><span class="col table-head svelte-161wm6q">Status</span> <span class="col table-head svelte-161wm6q">Ref</span> <span class="col table-head svelte-161wm6q">Host</span> <span class="col table-head svelte-161wm6q">Data</span> <!></div>',1),be=S('<p style="color: red"> </p>'),we=S("<p>Fetching results...</p>"),Ce=S('<div role="dialog" class="modal svelte-161wm6q"><div class="contents svelte-161wm6q"><h3 class="title-bar svelte-161wm6q">Urls checks <button>Close</button></h3> <!></div></div>');function ke(C,s){z(s,!0);const u=r=>{const e=new Date(r.timestamp);return e.toDateString()+" "+e.toTimeString()},m=r=>r.fails.sort((e,n)=>e.chord.url<n.chord.url?-1:1);var L=X(),D=O(L);{var b=r=>{var e=Ce(),n=f(e),v=f(n),h=g(f(v));h.__click=function(...p){s.close?.apply(this,p)},i(v);var x=g(v,2);Wt(x,Vt,p=>{var l=we();_(p,l)},(p,l)=>{const a=F(()=>u(t(l))),d=F(()=>m(t(l)));var o=pe(),c=O(o),w=g(f(c),8),k=f(w,!0);i(w);var y=g(w,2),q=f(y,!0);i(y);var E=g(y,2),K=f(E,!0);i(E);var rt=g(E,2),Y=f(rt,!0);i(rt),i(c);var W=g(c,4),Z=g(f(W),8);j(Z,17,()=>t(d),P,($,R)=>{var H=_e(),tt=O(H),at=f(tt,!0);i(tt);var Q=g(tt,2),B=f(Q);i(Q);var T=g(Q,2),V=f(T),N=f(V,!0);i(V),i(T);var st=g(T,2),ct=f(st,!0);i(st),I(qt=>{U(at,t(R).status),U(B,`${t(R).chord.artist??""} - ${t(R).chord.title??""}`),et(V,"href",t(R).chord.url),U(N,new URL(t(R).chord.url).hostname),U(ct,qt)},[()=>t(R).error?JSON.stringify(t(R).error):""]),_($,H)}),i(W),I(()=>{U(k,t(a)),U(q,t(l).nbChecks),U(K,t(l).nbSkipped),U(Y,t(l).nbFails)}),_(p,o)},(p,l)=>{var a=be(),d=f(a);i(a),I(()=>U(d,`Could not retrieve checks: ${t(l).message??""}`)),_(p,a)}),i(n),i(e),_(r,e)};J(D,r=>{s.isOpen&&r(b)})}_(C,L),G()}lt(["click"]);var ye=S('<li class="ul2col-separator"> </li>'),Le=S('<!> <li class="ul2col-item"><!></li>',1),xe=S('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function Se(C,s){z(s,!0);const u=Date.now(),m=1e3*3600*24*7,L=m*4,D=[{label:"last week",time:u-m},{label:"one month ago",time:u-L},{label:"two months ago",time:u-2*L},{label:"six months ago",time:u-6*L},{label:"one year ago",time:u-12*L}],b=F(()=>s.chords.filter(l=>l.creationDate).sort((l,a)=>a.creationDate-l.creationDate).map((l,a,d)=>{const o={...l};if(a>0){const c=d[a-1];for(const{time:w,label:k}of D)c.creationDate>w&&l.creationDate<w&&(o.dateTag=k)}return o}));let r=6,e=M(ot([]));const n=()=>{r+=4,A(e,t(b).slice(0,r),!0)};gt(()=>{n()});var v=xe(),h=f(v),x=g(f(h));x.__click=()=>n(),i(h);var p=g(h,2);j(p,21,()=>t(e),P,(l,a)=>{var d=Le(),o=O(d);{var c=y=>{var q=ye(),E=f(q,!0);i(q),I(()=>U(E,t(a).dateTag)),_(y,q)};J(o,y=>{t(a).dateTag&&y(c)})}var w=g(o,2),k=f(w);it(k,{get chord(){return t(a)}}),i(w),_(l,d)}),i(p),i(v),_(C,v),G()}lt(["click"]);var De=S("<button>&nbspâ†¶&nbsp</button>"),Te=S('<li class="ul2col-item"><!></li>'),Ae=S('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br/> <ul class="ul2col-container"></ul></div>');function qe(C,s){z(s,!0);const u=6;let m=M(ot([])),L=M(ot([]));const D=()=>{t(m).length>=s.chords.length-u&&A(m,[],!0);for(let l=0;l<u;l++){let a=-1;for(;a===-1||t(m).includes(a);)a=Math.floor(Math.random()*s.chords.length);t(m).push(a)}A(L,t(m).slice(t(m).length-u).map(l=>s.chords[l]),!0)},b=()=>{t(m).length<=u||(t(m).splice(t(m).length-u),A(L,t(m).slice(t(m).length-u).map(l=>s.chords[l]),!0))};gt(()=>{D()});var r=Ae(),e=f(r),n=g(f(e)),v=f(n);{var h=l=>{var a=De();a.__click=b,_(l,a)};J(v,l=>{t(m).length>u&&l(h)})}var x=g(v,2);x.__click=D,i(n),i(e);var p=g(e,4);j(p,21,()=>t(L),l=>l.url,(l,a)=>{var d=Te(),o=f(d);it(o,{get chord(){return t(a)},showArtist:!0}),i(d),_(l,d)}),i(p),i(r),_(C,r),G()}lt(["click"]);var Be=S('<button class="filter-control svelte-1k2cvi7"><input type="checkbox"/> <span></span></button>'),Ve=S("<button> </button>"),Ue=S('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"/> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1k2cvi7"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1k2cvi7"></div></div> <!>',1);function ir(C,s){z(s,!0);const u=()=>mt(ut,"$failedVisitCounts",L),m=()=>mt(zt,"$user",L),[L,D]=xt(),b={name:"Songbook",description:"My song book",iconPath:"/songbook.png",showAuthInHeader:!0};Qt.set(b);const r=F(()=>s.data.chords);let e=M(ot([]));const n=B=>{t(e).push(B),A(e,t(e),!0),setTimeout(()=>{t(e).shift(),A(e,t(e),!0)},5e3)};gt(async()=>{try{if(u().length&&m()){n({level:"info",header:"Trying to count missed visits while logged out"});for(const B of u())await wt({url:B});n({level:"success",header:`Counted ${u().length} missed visits`}),St(ut,[])}}catch{n({level:"error",header:"Couldnt upload failed visit counts"})}try{const T=(await Ut()).reduce((V,N)=>(V.set(N.url,{...N}),V),new Map);nt.set(T)}catch{n({level:"error",header:"Couldnt upload failed visit counts"})}});let v=M("");const h=[{label:"By artist",component:ue},{label:"By tags",component:fe},{label:"By frequency",component:ge},{label:"By access date",component:ae}];let x=M(ot(h[0]));const p={pdf:!0,doc:!0,youtube:!0,link:!0};let l=M(ot({...p}));const a=Object.keys(p);var d=Ue(),o=O(d);Et(o,{get title(){return b.name},get description(){return b.description},get iconPath(){return b.iconPath}});var c=g(o,2),w=f(c),k=f(w);k.__click=()=>jt.open(ke),ft(k,"",{},{position:"relative"});var y=g(k,2);y.__click=()=>Pt("/songbook/edit"),ft(y,"",{},{position:"relative"}),i(w),i(c);var q=g(c,2);j(q,17,()=>t(e),P,(B,T)=>{Rt(B,{get item(){return t(T)}})});var E=g(q,2);$t(E,{});var K=g(E,2),rt=f(K);i(K);var Y=g(K,2);Se(Y,{get chords(){return t(r)}});var W=g(Y,2);qe(W,{get chords(){return t(r)}});var Z=g(W,2),$=g(f(Z),2);pt($);var R=g($,2);R.__click=()=>A(v,"");var H=g(R,2),tt=g(f(H),2);j(tt,17,()=>a,P,(B,T)=>{var V=Be();V.__click=()=>{t(l)[t(T)]=!t(l)[t(T)],A(l,t(l),!0)};var N=f(V);pt(N);var st=g(N,2);i(V),I(ct=>{et(V,"aria-label",`filter for ${t(T)??""}`),et(N,"id",t(T)),vt(st,1,ct,"svelte-1k2cvi7")},[()=>Lt(At(t(T)))]),Ft(N,()=>t(l)[t(T)],ct=>t(l)[t(T)]=ct),_(B,V)}),i(H);var at=g(H,4);j(at,21,()=>h,P,(B,T)=>{var V=Ve();let N;V.__click=()=>A(x,t(T),!0);var st=f(V,!0);i(V),I(()=>{N=vt(V,1,"control svelte-1k2cvi7",null,N,{selected:t(x)===t(T)}),U(st,t(T).label)}),_(B,V)}),i(at),i(Z);var Q=g(Z,2);It(Q,()=>t(x).component,(B,T)=>{T(B,{get chords(){return t(r)},get searchString(){return t(v)},get filters(){return t(l)}})}),I(()=>U(rt,`This is a list of ${t(r).length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Ot($,()=>t(v),B=>A(v,B)),_(C,d),G(),D()}lt(["click"]);export{ir as component,lr as universal};
