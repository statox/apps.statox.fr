import"../chunks/disclose-version.Bg9kRutz.js";import{i as V}from"../chunks/legacy.Bspvssc3.js";import{k as B,v as w,n as H,ag as u,w as c,ah as f,g as e,s as L,ai as O,a7 as J,m as Z,o as ee}from"../chunks/index-client.CflbJY84.js";import{e as T,a as n,f as P,t as x}from"../chunks/template.BGksMNs9.js";import{i as F}from"../chunks/if.DLCvTpsY.js";import{s as z,a as G}from"../chunks/store.6NDgt3ZJ.js";import{c as K,o as te}from"../chunks/store.BObuO1UO.js";import{u as N,U as ae}from"../chunks/service.BtF5aEDd.js";import{M as W}from"../chunks/Main.CbaYBzTI.js";import{e as R,i as X}from"../chunks/each.CJUKzImm.js";import{r as re}from"../chunks/attributes.D4L4WMZE.js";import{b as oe}from"../chunks/input.BoLElzTc.js";import{p as S}from"../chunks/props.CpxbqgeU.js";import{r as se,a as ne,A as ie}from"../chunks/index.BX63RORe.js";import{t as ve}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.DLvG2AVB.js";import{D as Y}from"../chunks/datetime.CJSQP4eG.js";import{s as C}from"../chunks/render.D9j6VzsR.js";import{a as le}from"../chunks/await.CCcugD2l.js";const de=async m=>ne({path:"/personalTracker/upload",data:{event:m}}),Q=async()=>{const{events:m}=await se({path:"/personalTracker/getAll",authorize:!0});return m};var me=x('<button class="form-action svelte-1cixduj">Submit</button>'),ce=x('<span class="form-action svelte-1cixduj">Login to upload an entry</span>'),ue=x('<div role="dialog" class="modal svelte-1cixduj"><div class="contents svelte-1cixduj"><h4 class="title-bar svelte-1cixduj">Add a new event <button>Close</button></h4> <!> <form class="form-content svelte-1cixduj"><label for="weight">Weight</label> <input type="number" step="0.1"> <br> <!></form></div></div>');function fe(m,p){B(p,!1);const[M,U]=z(),A=()=>G(N,"$user",M);let g=S(p,"isOpen",8),$=S(p,"onUpload",8),i=O([]),o=O();const _=async()=>{if(L(i,[]),e(o)!==Number(e(o).toFixed(1))&&e(i).push({level:"error",header:"Value have at most 1 number after the comma"}),(e(o)<80||e(o)>110)&&e(i).push({level:"error",header:"Value must be in kg"}),e(i).length)return;const t=Y.now().toUTC().toUnixInteger();try{await de({timestampUTC:t,type:"weight",value:Math.floor(e(o)*100)}),$()(),K()}catch(a){let d=a.message;a instanceof ie&&a.code===401?d="Invalid logged in user":a instanceof ae&&(d="User is logged out");const b=`<strong>Entry not created</strong><br/> ${d}`;ve.push(b,{theme:{"--toastBarBackground":"#FF0000"}})}};V();var h=T(),v=w(h);{var l=t=>{var a=ue(),d=u(a),b=u(d),E=c(u(b));f(b);var k=c(b,2);R(k,1,()=>e(i),X,(r,s)=>{W(r,{get item(){return e(s)}})});var D=c(k,2),y=c(u(D),2);re(y);var I=c(y,4);{var j=r=>{var s=me();P("click",s,_),n(r,s)},q=r=>{var s=ce();n(r,s)};F(I,r=>{A()?r(j):r(q,!1)})}f(D),f(d),f(a),P("click",E,function(...r){var s;(s=K)==null||s.apply(this,r)}),oe(y,()=>e(o),r=>L(o,r)),n(t,a)};F(v,t=>{g()&&t(l)})}n(m,h),H(),U()}var pe=x('<div class="event svelte-1lfnev1"><div class="event-date"> </div> <div class="event-type"> </div> <div class="event-value"> </div></div>'),ge=x('<div class="event svelte-1lfnev1"><div>Date</div> <div>Type</div> <div>Value</div></div> <!>',1),_e=x("<p>Loading events</p>");function he(m,p){B(p,!1);const[M,U]=z(),A=()=>G(N,"$user",M);let g=S(p,"events",8);V();var $=T(),i=w($);{var o=_=>{var h=T(),v=w(h);le(v,g,l=>{var t=_e();n(l,t)},(l,t)=>{var a=ge(),d=c(w(a),2);R(d,1,()=>e(t),X,(b,E)=>{var k=pe();const D=J(()=>Y.fromSeconds(e(E).eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm"));var y=u(k),I=u(y,!0);f(y);var j=c(y,2),q=u(j,!0);f(j);var r=c(j,2),s=u(r,!0);f(r),f(k),Z(()=>{C(I,e(D)),C(q,e(E).type),C(s,e(E).value)}),n(b,k)}),n(l,a)},(l,t)=>{var a=J(()=>({level:"error",header:"Something went wrong getting events",message:e(t)}));W(l,{get item(){return e(a)}})}),n(_,h)};F(i,_=>{A()&&g()&&_(o)})}n(m,$),H(),U()}var be=x("<div><button>Add an entry</button></div> <!>",1);function Pe(m,p){B(p,!1);const[M,U]=z(),A=()=>G(N,"$user",M);let g=O();const $=()=>L(g,Q());ee(()=>L(g,Q())),V();var i=T(),o=w(i);{var _=v=>{var l=be(),t=w(l),a=u(t);f(t);var d=c(t,2);he(d,{get events(){return e(g)}}),P("click",a,()=>te(fe,{onUpload:$})),n(v,l)},h=v=>{W(v,{item:{level:"info",header:"Login to add an entry or see events"}})};F(o,v=>{A()?v(_):v(h,!1)})}n(m,i),H(),U()}export{Pe as component};
