import"../chunks/NZTpNUN0.js";import{p as pe,g as w,G as T,h as t,b as G,f as J,i as C,a as y,d as de,e as s,s as b,a$ as he,r as g,a_ as Q,t as E,F as fe,j as X,c as be}from"../chunks/tjCGPzdr.js";import{d as _e,e as ge,s as V}from"../chunks/DOKer7p_.js";import{i as D}from"../chunks/BsrVr-Z0.js";import{e as Y,i as Z}from"../chunks/An4e5j9g.js";import{b as ee,r as te}from"../chunks/DKsZ4ghV.js";import{b as re}from"../chunks/B25JaP4K.js";import{M as we}from"../chunks/CJFchB7S.js";import{m as S,g as O,c as N,b as B,B as f,a as ye,n as Me,d as q,i as Ce,e as xe}from"../chunks/BLGMfthj.js";const ke=r=>{const a=O(r),e=Math.floor(Math.random()*a.length);return a[e]},Be=(r,a)=>{const e=ke(r);return{board:S(r,a,e),move:e}},Se=(r,a,e)=>{const n=Re(r,a,e?.iterations,e?.c);return{board:S(r,a,n),move:n}};class ne{board;player;move;parent;children=[];visits=0;wins=0;constructor(a,e,n=null,m=null){this.board=a,this.player=e,this.move=n,this.parent=m}isFullyExpanded(){return this.children.length===O(this.board).length}isTerminal(){return B(this.board)!==f.notOver}}function ae(r,a,e,n=Math.sqrt(2)){return e===0?1/0:a/e+n*Math.sqrt(Math.log(r)/e)}function Pe(r,a){for(;!r.isTerminal();)if(r.isFullyExpanded())r=qe(r,a);else return Te(r);return r}function Te(r){const a=r.children.map(l=>l.move),n=O(r.board).filter(l=>!a.includes(l)),m=n[Math.floor(Math.random()*n.length)],i=N(r.board);S(i,r.player,m);const v=new ne(i,r.player===1?2:1,m,r);return r.children.push(v),v}function qe(r,a){return r.children.reduce((e,n)=>{const m=ae(r.visits,e.wins,e.visits,a);return ae(r.visits,n.wins,n.visits,a)>m?n:e})}function Ge(r){const a=N(r.board);let e=r.player;for(;;){const n=B(a);if(n!==f.notOver)return n;const m=O(a),i=m[Math.floor(Math.random()*m.length)];S(a,e,i),e=e===1?2:1}}function Oe(r,a){let e=r;for(;e!==null;)e.visits+=1,a===f.winPlayer1&&e.parent?.player===1||a===f.winPlayer2&&e.parent?.player===2?e.wins+=1:a===f.draw&&(e.wins+=.5),e=e.parent}function Re(r,a,e=1e3,n=Math.sqrt(2)){const m=new ne(N(r),a,null,null);for(let v=0;v<e;v++){const l=Pe(m,n),M=Ge(l);Oe(l,M)}return m.children.reduce((v,l)=>v.visits>l.visits?v:l).move}var Fe=G("<option> </option>"),Ie=(r,a,e,n)=>{t(a)&&(s(e,t(a).iterations,!0),s(n,t(a).c,!0))},Ae=G("<option> </option>"),Ee=(r,a)=>s(a,null),Ve=(r,a)=>s(a,null),De=G(`<div><h4>Monte Carlo Tree Search parameters</h4> <label for="mcts-preset">Preset difficulty</label> <select></select> <br/><br/> <label for="mcts-iterations">Iterations:</label> <input id="mcts-iterations" type="number" min="0"/> <small>Number of simulations MCTS will run before choosing a move. Higher values usually mean
            stronger play but slower decisions.</small> <br/><br/> <label for="mcts-c">C (exploration constant):</label> <input id="mcts-c" type="number" min="0" step="0.1"/> <small>Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
            favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2
            ≈ 1.41.</small></div>`),Ne=G('<!> <div class="main"><h3>Gravitrip</h3></div> <div>See <a href="https://www.quora.com/What-is-the-winning-strategy-for-the-first-player-in-Connect-Four-games">this quora thread</a> for some tips on the winning strategy</div> <div>Computer stategy: <select></select></div> <!> <span><button>Restart game</button> <span style="font-weight: bold"><!></span></span> <!>',1);function Qe(r,a){pe(a,!0);let e=w(T(Array.from({length:7},()=>[]))),n=Q(()=>B(t(e))),m=Q(()=>xe(t(e))),i=w(null);const v=[{name:"easy",iterations:200,c:2},{name:"medium",iterations:1e3,c:1.41},{name:"hard",iterations:5e3,c:.7}];let l=w(T(v[1])),M=w(T(t(l).iterations)),P=w(T(t(l).c)),x=w("mcts"),p=w(1);const W=()=>{s(e,Array.from({length:7},()=>[]),!0),s(p,1)},j=(o,c)=>{t(p)===1&&Ce(t(e),o)&&B(t(e))===f.notOver&&(s(e,S(t(e),c,o),!0),s(p,t(p)===1?2:1,!0),setTimeout(()=>oe(),200))},oe=()=>{if(t(p)!==2||B(t(e))!==f.notOver)return;let o;if(t(x)==="random")o=Be(t(e),t(p));else if(t(x)==="mcts")o=Se(t(e),t(p),{iterations:t(M),c:t(P)});else throw new Error("computer strategy not implemented");const{board:c,move:u}=o;s(e,c,!0),s(i,u,!0),s(p,1)},se=o=>{switch(o.keyCode){case 82:W();break;case 39:if(t(i)===null){s(i,Math.floor(q/2),!0);return}s(i,Math.min(t(i)+1,q-1),!0);break;case 37:if(t(i)===null){s(i,Math.floor(q/2),!0);return}s(i,Math.max(t(i)-1,0),!0);break;case 32:if(t(i)===null)return;j(t(i),t(p));break}};var H=Ne();ge("keydown",he,se);var K=J(H);we(K,{title:"Gravitrip",description:"Gravitrip"});var R=b(K,6),F=b(C(R));Y(F,20,()=>["mcts","random"],Z,(o,c)=>{var u=Fe(),_=C(u,!0);g(u);var d={};E(()=>{V(_,c),d!==(d=c)&&(u.value=(u.__value=c)??"")}),y(o,u)}),g(F),g(R);var L=b(R,2);{var ie=o=>{var c=De(),u=b(C(c),4);u.__change=[Ie,l,M,P],Y(u,21,()=>v,Z,(h,A)=>{var k=Ae(),ve=C(k,!0);g(k);var z={};E(()=>{V(ve,t(A).name),z!==(z=t(A))&&(k.value=(k.__value=t(A))??"")}),y(h,k)}),g(u);var _=b(u,7);te(_),_.__change=[Ee,l];var d=b(_,9);te(d),d.__change=[Ve,l],fe(2),g(c),ee(u,()=>t(l),h=>s(l,h)),re(_,()=>t(M),h=>s(M,h)),re(d,()=>t(P),h=>s(P,h)),y(o,c)};D(L,o=>{t(x)==="mcts"&&o(ie)})}var I=b(L,2),U=C(I);U.__click=W;var $=b(U,2),le=C($);{var ce=o=>{var c=X("Game Over");y(o,c)},ue=o=>{var c=be(),u=J(c);{var _=d=>{var h=X();E(()=>V(h,`Player ${t(n)??""} wins`)),y(d,h)};D(u,d=>{(t(n)===f.winPlayer1||t(n)===f.winPlayer2)&&d(_)},!0)}y(o,c)};D(le,o=>{t(n)===f.draw?o(ce):o(ue,!1)})}g($),g(I);var me=b(I,2);ye(me,{get nbColumns(){return q},get nbRows(){return Me},get board(){return t(e)},get winningCells(){return t(m)},onMove:o=>j(o,t(p))}),ee(F,()=>t(x),o=>s(x,o)),y(r,H),de()}_e(["change","click"]);export{Qe as component};
