import"../chunks/NZTpNUN0.js";import{a as it}from"../chunks/Dpa7cG8s.js";import{p as st,b as m,f as u,s as o,a as s,d as lt,e as N,r as O,g as a,h as b,i as r,c as D,t as j,j as V}from"../chunks/D1gec7hp.js";import{s as Y}from"../chunks/DqykZqCX.js";import{i as v}from"../chunks/BQPfd91e.js";import{r as pt}from"../chunks/CwBosGx5.js";import{d as vt}from"../chunks/DBXcV7xI.js";import{b as _t}from"../chunks/cDPM8xt1.js";import{B as x,a as q}from"../chunks/hBZXBj3o.js";import{P as mt}from"../chunks/CELBgAxi.js";import{g as gt}from"../chunks/B3VjAwLS.js";import{c as ct}from"../chunks/uzsX0xSz.js";var ft=m('<button>Start a new game</button> <br/> <input type="string"/> <button>Join Game</button>',1),dt=m("<p>Connecting to the server…</p>"),ut=m("<p>Waiting for an opponent to connect…</p>"),bt=m("<p> </p> <!>",1),wt=m("<p>Something went wrong. Board is not defined.</p>"),yt=m('<p>Game over</p> <button>Restart</button> <span style="font-weight: bold"><!></span> <!>',1),St=m("<p>Disconnected</p>"),ht=m("<h3>Online game <button>Back</button></h3> <!> <!> <!> <!> <!> <!>",1);function Jt(z,F){st(F,!0);let n,B=b(null),g=b(null),c=b(null),S=b(null),l=b("initial"),h=b("");const H=async()=>{const t=await ct.gravitrips.getNewGame();if(!t.gameId)throw new Error("Couldn't start the game");r(h,t.gameId,!0),G()},K=mt.replace(/^http?/,"ws");it(()=>{n&&n.close()});const G=()=>{n=new WebSocket(K+"/gravitrips/ws?"+a(h)),r(l,"connecting"),r(g,null),r(c,null),r(S,null),n.onopen=()=>{r(l,"waiting_for_opponent")},n.onclose=t=>{console.log(t.reason),r(l,"disconnected")},n.onmessage=t=>{const e=JSON.parse(t.data);e.type==="game_ready"?(r(l,"playing"),r(B,e.youAre,!0),r(g,e.board,!0)):e.type==="update_board"?(r(g,e.board,!0),r(c,e.boardState,!0),r(S,e.winningCells,!0)):e.type==="waiting_for_opponent"?r(c,null):e.type==="game_over"&&r(l,"game_over")}},I=t=>{if(!n||n.readyState!==WebSocket.OPEN)return;const e=JSON.stringify({type:"move",column:t});n.send(e)},Q=()=>{if(!n||n.readyState!==WebSocket.OPEN)return;const t=JSON.stringify({type:"restart"});n.send(t)};var E=ht(),C=u(E),T=o(N(C));T.__click=()=>gt("/gravitrips"),O(C);var W=o(C,2);{var X=t=>{var e=ft(),f=u(e);f.__click=H;var _=o(f,4);pt(_);var w=o(_,2);w.__click=G,_t(_,()=>a(h),p=>r(h,p)),s(t,e)};v(W,t=>{["initial","waiting_for_opponent","game_over","disconnected"].includes(a(l))&&t(X)})}var J=o(W,2);{var Z=t=>{var e=dt();s(t,e)};v(J,t=>{a(l)==="connecting"&&t(Z)})}var A=o(J,2);{var $=t=>{var e=ut();s(t,e)};v(A,t=>{a(l)==="waiting_for_opponent"&&t($)})}var L=o(A,2);{var tt=t=>{var e=D(),f=u(e);{var _=p=>{var d=bt(),y=u(d),P=N(y);O(y);var i=o(y,2);q(i,{nbColumns:7,nbRows:6,get board(){return a(g)},get winningCells(){return a(S)},onMove:I}),j(()=>Y(P,`You are Player ${a(B)??""}`)),s(p,d)},w=p=>{var d=wt();s(p,d)};v(f,p=>{a(g)!==null?p(_):p(w,!1)})}s(t,e)};v(L,t=>{a(l)==="playing"&&t(tt)})}var M=o(L,2);{var et=t=>{var e=yt(),f=o(u(e),2);f.__click=Q;var _=o(f,2),w=N(_);{var p=i=>{var k=V("Game Over");s(i,k)},d=i=>{var k=D(),ot=u(k);{var nt=R=>{var U=V();j(()=>Y(U,`Player ${a(c)??""} wins`)),s(R,U)};v(ot,R=>{(a(c)===x.winPlayer1||a(c)===x.winPlayer2)&&R(nt)},!0)}s(i,k)};v(w,i=>{a(c)===x.draw?i(p):i(d,!1)})}O(_);var y=o(_,2);{var P=i=>{q(i,{nbColumns:7,nbRows:6,get board(){return a(g)},get winningCells(){return a(S)},onMove:I})};v(y,i=>{a(g)!==null&&i(P)})}s(t,e)};v(M,t=>{a(l)==="game_over"&&t(et)})}var at=o(M,2);{var rt=t=>{var e=St();s(t,e)};v(at,t=>{a(l)==="disconnected"&&t(rt)})}s(z,E),lt()}vt(["click"]);export{Jt as component};
