import"../chunks/DsnmJJEf.js";import{p as z,c as ue,f as F,a as o,d as J,b as u,e as r,r as a,s as t,t as S,g as M,h as pe,C as fe,i as _e}from"../chunks/C1Jxye1l.js";import{s as H,d as ge}from"../chunks/B5mDzSg_.js";import{a as be}from"../chunks/DcdHlYY_.js";import{t as we,d as xe,g as ie}from"../chunks/Cd670Sty.js";import{e as De,i as ye}from"../chunks/1qSvZEoQ.js";import{i as B}from"../chunks/BAKOb8xY.js";import{r as h,e as m,a as ke}from"../chunks/Z-lh6Sw0.js";import{a as Ue,s as Se}from"../chunks/CPdkLtoY.js";import{M as Me}from"../chunks/BJLEIwQE.js";import{t as We}from"../chunks/Dr9dkngU.js";import{M as Ce}from"../chunks/BjiRhq3A.js";import{M as Le}from"../chunks/NkSNiPiY.js";import{a as Ee}from"../chunks/CYl4EDKT.js";import{a as Ae}from"../chunks/CkcISRbr.js";import"../chunks/Bdxdj0h6.js";import"../chunks/DJ90tpFZ.js";import{p as Ie}from"../chunks/rc8jUsVI.js";/* empty css                */import{M as le}from"../chunks/BkqP7uoK.js";import{g as Pe}from"../chunks/ydLoT6Dn.js";const Ne=!1,mt=Object.freeze(Object.defineProperty({__proto__:null,ssr:Ne},Symbol.toStringTag,{value:"Module"}));var Te=u('<p class="section-3-item svelte-1e53865"><label for="css-selector">CSS selector <!></label> <input disabled type="textarea" class="svelte-1e53865"/></p>'),Oe=u('<div class="section error-section svelte-1e53865"><p class="section-4-item svelte-1e53865"><label for="last-check">Last error</label> <input disabled type="textarea" class="svelte-1e53865"/></p> <p class="section-4-item svelte-1e53865"><label for="last-update">Last error message</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div>'),je=u('<div class="item svelte-1e53865"><h3 class="item-title svelte-1e53865"><div class="item-name svelte-1e53865"> </div> <div class="item-actions svelte-1e53865"><!> <!></div></h3> <div class="section svelte-1e53865"><p class="section-1-item svelte-1e53865"><label for="check-interval">Check interval</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <div class="section svelte-1e53865"><p class="section-2-item svelte-1e53865"><label for="notification-message">Notification message</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <div class="section svelte-1e53865"><p class="section-3-item svelte-1e53865"><label for="content">URL</label> <a target="_blank" rel="noopener noreferrer"> </a></p> <!></div> <div class="section svelte-1e53865"><p class="section-4-item svelte-1e53865"><label for="last-check">Last check</label> <input disabled type="textarea" class="svelte-1e53865"/></p> <p class="section-4-item svelte-1e53865"><label for="last-update">Last content change</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <!> <div class="section svelte-1e53865"><p class="section-3-item svelte-1e53865"><label for="last-update">Last content</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div></div>');function qe(w,e){z(e,!0);const b=()=>Ue(Ee,"$user",c),[c,i]=Se(),s=n=>{const d=new Date(n*1e3);return d.toLocaleDateString()+" "+d.toLocaleTimeString()},y=e.watcher.lastCheckDateUnix===0?"Never checked before":s(e.watcher.lastCheckDateUnix||0),k=e.watcher.lastUpdateDateUnix===0?"Never changed":s(e.watcher.lastUpdateDateUnix||0),W=Ae.fromMillis(e.watcher.checkIntervalSeconds*1e3).rescale().toHuman(),l=async()=>{if(!e.watcher.id){console.error("id must be defined");return}try{await xe({id:e.watcher.id}),e.onDelete()}catch(n){const d=`<strong>Watcher not deleted</strong><br/> ${n.message}`;We.push(d,{theme:{"--toastBarBackground":"#FF0000"}})}},v=async n=>{await we({watcherId:e.watcher.id,setToEnabled:n==="on"}),e.onUpdate()};let p=e.watcher.archivalDateUnix?"off":"on";var x=ue(),C=F(x);{var L=n=>{var d=je(),E=r(d),A=r(E),ne=r(A,!0);a(A);var R=t(A,2),V=r(R);Le(V,{get value(){return p},label:"Enabled",onchange:v,design:"slider"});var oe=t(V,2);Ce(oe,{deleteAction:l}),a(R),a(E);var I=t(E,2),G=r(I),K=t(r(G),2);h(K),a(G),a(I);var P=t(I,2),Q=r(P),X=t(r(Q),2);h(X),a(Q),a(P);var N=t(P,2),T=r(N),O=t(r(T),2),ce=r(O,!0);a(O),a(T);var ve=t(T,2);{var de=f=>{var _=Te(),g=r(_),U=t(r(g));Me(U,{get content(){return e.watcher.cssSelector}}),a(g);var D=t(g,2);h(D),a(_),S(()=>m(D,e.watcher.cssSelector)),o(f,_)};B(ve,f=>{e.watcher.cssSelector&&f(de)})}a(N);var j=t(N,2),q=r(j),Y=t(r(q),2);h(Y),a(q);var Z=t(q,2),$=t(r(Z),2);h($),a(Z),a(j);var ee=t(j,2);{var he=f=>{var _=Oe(),g=r(_),U=t(r(g),2);h(U),a(g);var D=t(g,2),se=t(r(D),2);h(se),a(D),a(_),S(me=>{m(U,me),m(se,e.watcher.lastErrorMessage)},[()=>s(e.watcher.lastErrorDateUnix)]),o(f,_)};B(ee,f=>{e.watcher.lastErrorDateUnix&&f(he)})}var te=t(ee,2),ae=r(te),re=t(r(ae),2);h(re),a(ae),a(te),a(d),S(()=>{H(ne,e.watcher.name),m(K,W),m(X,e.watcher.notificationMessage),ke(O,"href",e.watcher.url),H(ce,e.watcher.url),m(Y,y),m($,k),m(re,e.watcher.lastContent)}),o(n,d)};B(C,n=>{b()&&n(L)})}o(w,x),J(),i()}var Be=u('<div class="container svelte-ihkiaa"></div>');function Fe(w,e){z(e,!0);const b=(i,s)=>i.archivalDateUnix===null&&s.archivalDateUnix!==null?-1:i.archivalDateUnix!==null&&s.archivalDateUnix===null?1:s.id-i.id;var c=Be();De(c,21,()=>e.watchers.sort(b),ye,(i,s)=>{qe(i,{get watcher(){return M(s)},get onDelete(){return e.onDelete},get onUpdate(){return e.onUpdate}})}),a(c),o(w,c),J()}var He=u("<button>Add an entry</button>"),ze=u("<p>Something went wrong</p> <p> </p>",1),Je=u("<p>Loading data</p>"),Re=u("<h2>Create a new watcher</h2> <!> <h2>Watchers</h2> <!>",1);function ut(w,e){z(e,!0),Ie.set({name:"Web Watchers",showAuthInHeader:!0});let b=pe(fe(ie()));const c=()=>_e(b,ie(),!0);le(w,{message:"Login to list the watchers",requiredScope:"admin",children:(i,s)=>{var y=Re(),k=t(F(y),2);le(k,{message:"Login to add an entry",requiredScope:"admin",children:(l,v)=>{var p=He();p.__click=()=>Pe("/webwatcher/create"),o(l,p)},$$slots:{default:!0}});var W=t(k,4);be(W,()=>M(b),l=>{var v=Je();o(l,v)},(l,v)=>{Fe(l,{get watchers(){return M(v)},onDelete:c,onUpdate:c})},(l,v)=>{var p=ze(),x=t(F(p),2),C=r(x,!0);a(x),S(L=>H(C,L),[()=>JSON.stringify(M(v))]),o(l,p)}),o(i,y)},$$slots:{default:!0}}),J()}ge(["click"]);export{ut as component,mt as universal};
