import"../chunks/CWj6FrbW.js";import{p as ae,y as C,z as we,f as R,n as re,B as s,o as a,C as r,g as t,s as W,k as te}from"../chunks/D4gDm57G.js";import{s as ne}from"../chunks/s4055cqB.js";import{c as le,a as m,f as w}from"../chunks/Vh0HsYHt.js";import{a as De}from"../chunks/CykI4KT5.js";import{i as H}from"../chunks/McHEF-Jg.js";import{d as Se}from"../chunks/vhkTqBca.js";import{s as oe,a as ie}from"../chunks/BmusxFuE.js";import{m as Ae}from"../chunks/n10vgu6d.js";import{u as ce,U as Le}from"../chunks/CcVlM4qF.js";import{M as xe}from"../chunks/Dg9v8Btr.js";import{r as Ee,a as ve,A as Me}from"../chunks/BRnwoQCQ.js";import{e as je,i as ze}from"../chunks/BnSyOJPK.js";import{r as _,b as Ie,e as k,a as He}from"../chunks/Xqw48ZgO.js";import{b as ee}from"../chunks/9XGeKPA3.js";import{t as ke}from"../chunks/DD1O5wo4.js";import{M as Ne}from"../chunks/YBTe9adx.js";import{c as Ce}from"../chunks/BdBiDHY1.js";import{M as Pe}from"../chunks/PXkvV3nW.js";import{M as Be}from"../chunks/DGR1Uqw3.js";import{M as Fe}from"../chunks/B5NRp4Ug.js";import{a as Oe}from"../chunks/CW5DvOmo.js";import"../chunks/Bmw8lZQ2.js";import{p as Te}from"../chunks/U2TU-HKj.js";const Re=!1,Lt=Object.freeze(Object.defineProperty({__proto__:null,ssr:Re},Symbol.toStringTag,{value:"Module"})),be=async()=>Ee({path:"/webWatcher/getAllWatchers"}),ye=async v=>ve({path:"/webWatcher/createWatcher",data:v}),qe=async v=>ve({path:"/webWatcher/deleteWatcher",data:{id:v}}),Ge=async v=>ve({path:"/webWatcher/toggleWatcherEnabled",data:v}),Je=async(v,e,f,b,d,i,l,g,S)=>{var x;W(e,[],!0),(x=t(f))!=null&&x.length||t(e).push({level:"error",header:"name must be defined"}),t(b)||t(e).push({level:"error",header:"notification message must be defined"}),t(d)==="CSS"&&!t(i)&&t(e).push({level:"error",header:"A CSS watcher must have a css selector defined"}),t(l)<15*60&&t(e).push({level:"error",header:"Check interval too small. Must be >= 15mn"});try{new URL(t(g))}catch{t(e).push({level:"error",header:"The URL is invalid"})}if(!t(e).length)try{t(d)==="CSS"?await ye({name:t(f),notificationMessage:t(b),url:t(g),cssSelector:t(i),checkIntervalSeconds:t(l),watchType:t(d)}):t(d)==="HASH"&&await ye({name:t(f),notificationMessage:t(b),url:t(g),checkIntervalSeconds:t(l),watchType:t(d)}),S.onUpload(),S.close()}catch(p){let c=p.message;p instanceof Me&&p.code===401?c="Invalid logged in user":p instanceof Le&&(c="User is logged out");const z=`<strong>Entry not created</strong><br/> ${c}`;ke.push(z,{theme:{"--toastBarBackground":"#FF0000"}})}};var Ve=w('<label for="css-selector">CSS selector</label> <input type="textarea"/>',1),Ke=w('<button class="form-action svelte-1cixduj">Submit</button>'),Qe=w('<span class="form-action svelte-1cixduj">Login to upload an entry</span>'),Xe=w('<div role="dialog" class="modal svelte-1cixduj"><div class="contents svelte-1cixduj"><h3 class="title-bar svelte-1cixduj">Add a new watcher <button>Close</button></h3> <!> <form class="form-content svelte-1cixduj"><label for="name">Name</label> <input type="text"/> <label for="check-interval">Check interval</label> <!> <label for="notification-message">Notification message (the @mention is automatically added)</label> <input type="textarea"/> <label for="watch-type">Watcher type</label> <select id="watch-type"><option>CSS</option><option>HASH</option></select> <label for="content">URL</label> <input type="textarea"/> <!> <br/> <!></form></div></div>');function Ye(v,e){ae(e,!0);const[f,b]=oe(),d=()=>ie(ce,"$user",f);let i=C(we([])),l=C(""),g=C(""),S=C(""),x=C(""),p=C(0),c=C("CSS");var z=le(),U=R(z);{var q=y=>{var o=Xe(),u=s(o),j=s(u),D=a(s(j));D.__click=function(...n){var h;(h=e.close)==null||h.apply(this,n)},r(j);var N=a(j,2);je(N,17,()=>t(i),ze,(n,h)=>{xe(n,{get item(){return t(h)}})});var G=a(N,2),P=a(s(G),2);_(P);var Z=a(P,4);Ne(Z,{allowedUnits:["minutes","hours","days"],defaultDuration:{value:1,unit:"hours"},get valueInSeconds(){return t(p)},set valueInSeconds(n){W(p,n,!0)}});var A=a(Z,4);_(A);var L=a(A,4),B=s(L);B.value=B.__value="CSS";var F=a(B);F.value=F.__value="HASH",r(L);var O=a(L,4);_(O);var J=a(O,2);{var V=n=>{var h=Ve(),T=a(R(h),2);_(T),ee(T,()=>t(x),X=>W(x,X)),m(n,h)};H(J,n=>{t(c)==="CSS"&&n(V)})}var K=a(J,4);{var Q=n=>{var h=Ke();h.__click=[Je,i,l,g,c,x,p,S,e],m(n,h)},se=n=>{var h=Qe();m(n,h)};H(K,n=>{d()?n(Q):n(se,!1)})}r(G),r(u),r(o),ee(P,()=>t(l),n=>W(l,n)),ee(A,()=>t(g),n=>W(g,n)),Ie(L,()=>t(c),n=>W(c,n)),ee(O,()=>t(S),n=>W(S,n)),m(y,o)};H(U,y=>{e.isOpen&&y(q)})}m(v,z),re(),b()}Se(["click"]);var Ze=w('<p class="section-3-item svelte-1jnygz9"><label for="css-selector">CSS selector <!></label> <input disabled type="textarea" class="svelte-1jnygz9"/></p>'),$e=w('<div class="section error-section svelte-1jnygz9"><p class="section-4-item svelte-1jnygz9"><label for="last-check">Last error</label> <input disabled type="textarea" class="svelte-1jnygz9"/></p> <p class="section-4-item svelte-1jnygz9"><label for="last-update">Last error message</label> <input disabled type="textarea" class="svelte-1jnygz9"/></p></div>'),et=w('<div class="item svelte-1jnygz9"><h3 class="item-title svelte-1jnygz9"><div class="item-name svelte-1jnygz9"> </div> <div class="item-actions svelte-1jnygz9"><!> <!></div></h3> <div class="section svelte-1jnygz9"><p class="section-1-item svelte-1jnygz9"><label for="check-interval">Check interval</label> <input disabled type="textarea" class="svelte-1jnygz9"/></p></div> <div class="section svelte-1jnygz9"><p class="section-2-item svelte-1jnygz9"><label for="notification-message">Notification message</label> <input disabled type="textarea" class="svelte-1jnygz9"/></p></div> <div class="section svelte-1jnygz9"><p class="section-3-item svelte-1jnygz9"><label for="content">URL</label> <a target="_blank" rel="noopener noreferrer"> </a></p> <!></div> <div class="section svelte-1jnygz9"><p class="section-4-item svelte-1jnygz9"><label for="last-check">Last check</label> <input disabled type="textarea" class="svelte-1jnygz9"/></p> <p class="section-4-item svelte-1jnygz9"><label for="last-update">Last content change</label> <input disabled type="textarea" class="svelte-1jnygz9"/></p></div> <!> <div class="section svelte-1jnygz9"><p class="section-3-item svelte-1jnygz9"><label for="last-update">Last content</label> <input disabled type="textarea" class="svelte-1jnygz9"/></p></div></div>');function tt(v,e){ae(e,!0);const[f,b]=oe(),d=()=>ie(ce,"$user",f),i=Ce(),l=o=>{const u=new Date(o*1e3);return u.toLocaleDateString()+" "+u.toLocaleTimeString()},g=e.watcher.lastCheckDateUnix===0?"Never checked before":l(e.watcher.lastCheckDateUnix),S=e.watcher.lastUpdateDateUnix===0?"Never changed":l(e.watcher.lastUpdateDateUnix),x=Oe.fromMillis(e.watcher.checkIntervalSeconds*1e3).rescale().toHuman(),p=async()=>{if(!e.watcher.id){console.error("id must be defined");return}try{await qe(e.watcher.id),i("delete")}catch(o){const u=`<strong>Watcher not deleted</strong><br/> ${o.message}`;ke.push(u,{theme:{"--toastBarBackground":"#FF0000"}})}},c=async o=>{await Ge({watcherId:e.watcher.id,setToEnabled:o.detail==="on"}),i("update")};let z=e.watcher.archivalDateUnix?"off":"on";var U=le(),q=R(U);{var y=o=>{var u=et(),j=s(u),D=s(j),N=s(D,!0);r(D);var G=a(D,2),P=s(G);Fe(P,{get value(){return z},label:"Enabled",design:"slider",$$events:{change:c}});var Z=a(P,2);Be(Z,{deleteAction:p}),r(G),r(j);var A=a(j,2),L=s(A),B=a(s(L),2);_(B),r(L),r(A);var F=a(A,2),O=s(F),J=a(s(O),2);_(J),r(O),r(F);var V=a(F,2),K=s(V),Q=a(s(K),2),se=s(Q,!0);r(Q),r(K);var n=a(K,2);{var h=E=>{var M=Ze(),I=s(M),$=a(s(I));Pe($,{get content(){return e.watcher.cssSelector}}),r(I);var Y=a(I,2);_(Y),r(M),te(()=>k(Y,e.watcher.cssSelector)),m(E,M)};H(n,E=>{e.watcher.watchType==="CSS"&&E(h)})}r(V);var T=a(V,2),X=s(T),de=a(s(X),2);_(de),r(X);var ue=a(X,2),he=a(s(ue),2);_(he),r(ue),r(T);var me=a(T,2);{var We=E=>{var M=$e(),I=s(M),$=a(s(I),2);_($),r(I);var Y=a(I,2),_e=a(s(Y),2);_(_e),r(Y),r(M),te(Ue=>{k($,Ue),k(_e,e.watcher.lastErrorMessage)},[()=>l(e.watcher.lastErrorDateUnix)]),m(E,M)};H(me,E=>{e.watcher.lastErrorDateUnix&&E(We)})}var pe=a(me,2),fe=s(pe),ge=a(s(fe),2);_(ge),r(fe),r(pe),r(u),te(()=>{ne(N,e.watcher.name),k(B,x),k(J,e.watcher.notificationMessage),He(Q,"href",e.watcher.url),ne(se,e.watcher.url),k(de,g),k(he,S),k(ge,e.watcher.lastContent)}),m(o,u)};H(q,o=>{d()&&o(y)})}m(v,U),re(),b()}var at=w('<div class="container svelte-c8nodu"></div>');function rt(v,e){ae(e,!0);const f=Ce(),b=(i,l)=>i.archivalDateUnix===null&&l.archivalDateUnix!==null?-1:i.archivalDateUnix!==null&&l.archivalDateUnix===null?1:l.id-i.id;var d=at();je(d,21,()=>e.watchers.sort(b),ze,(i,l)=>{tt(i,{get watcher(){return t(l)},$$events:{delete:()=>f("delete"),update:()=>f("update")}})}),r(d),m(v,d),re()}var st=(v,e)=>Ae.open(Ye,{onUpload:e}),nt=w("<p>Something went wrong</p> <p> </p>",1),lt=w("<p>Loading data</p>"),ot=w("<h2>Create a new watcher</h2> <button>Add an entry</button> <h2>Watchers</h2> <!>",1);function Et(v,e){ae(e,!0);const[f,b]=oe(),d=()=>ie(ce,"$user",f);Te.set("Web Watchers");let i=C(we(be()));const l=()=>W(i,be(),!0);var g=le(),S=R(g);{var x=c=>{var z=ot(),U=a(R(z),2);U.__click=[st,l];var q=a(U,4);De(q,()=>t(i),y=>{var o=lt();m(y,o)},(y,o)=>{rt(y,{get watchers(){return t(o)},$$events:{delete:l,update:l}})},(y,o)=>{var u=nt(),j=a(R(u),2),D=s(j,!0);r(j),te(N=>ne(D,N),[()=>JSON.stringify(t(o))]),m(y,u)}),m(c,z)},p=c=>{xe(c,{item:{level:"info",header:"Login to list the watchers"}})};H(S,c=>{d()?c(x):c(p,!1)})}m(v,g),re(),b()}Se(["click"]);export{Et as component,Lt as universal};
