import"../chunks/NZTpNUN0.js";import{o as re}from"../chunks/ano4uZzk.js";import{p as oe,b as m,s,f as u,a as i,d as ne,g as a,e as b,h as r,c as U,i as D,r as j,t as q,j as V}from"../chunks/CbdQCwiJ.js";import{d as se,s as Y}from"../chunks/C_JLaYK3.js";import{i as v}from"../chunks/Cwax3Gcm.js";import{r as ie}from"../chunks/De0WW0FM.js";import{b as le}from"../chunks/BG7yEM_d.js";import{B as N,a as z}from"../chunks/a91bN_-B.js";import{P as pe}from"../chunks/CpX8xF_L.js";import{r as ve}from"../chunks/BCWhFa20.js";const _e=async(x,C,o)=>{const S=await ve({path:"/gravitrips/getNewGame"});r(C,S.gameId,!0),o()};var me=m('<button>Start a new game</button> <br/> <input type="string"/> <button>Join Game</button>',1),ce=m("<p>Connecting to the server…</p>"),ge=m("<p>Waiting for an opponent to connect…</p>"),de=m("<p> </p> <!>",1),fe=m("<p>Something went wrong. Board is not defined.</p>"),ue=m('<p>Game over</p> <button>Restart</button> <span style="font-weight: bold"><!></span> <!>',1),be=m("<p>Disconnected</p>"),ye=m("<h3>Simple WebSocket Client</h3> <!> <!> <!> <!> <!> <!>",1);function Ie(x,C){oe(C,!0);let o,S=b(null),c=b(null),g=b(null),h=b(null),l=b("initial"),k=b("");const F=pe.replace(/^http?/,"ws");re(()=>{o&&o.close()});const I=()=>{o=new WebSocket(F+"/gravitrips/ws?"+a(k)),r(l,"connecting"),r(c,null),r(g,null),r(h,null),o.onopen=()=>{r(l,"waiting_for_opponent")},o.onclose=e=>{console.log(e.reason),r(l,"disconnected")},o.onmessage=e=>{const t=JSON.parse(e.data);t.type==="game_ready"?(r(l,"playing"),r(S,t.youAre,!0),r(c,t.board,!0)):t.type==="update_board"?(r(c,t.board,!0),r(g,t.boardState,!0),r(h,t.winningCells,!0)):t.type==="waiting_for_opponent"?r(g,null):t.type==="game_over"&&r(l,"game_over")}},O=e=>{if(!o||o.readyState!==WebSocket.OPEN)return;const t=JSON.stringify({type:"move",column:e});o.send(t)},H=()=>{if(!o||o.readyState!==WebSocket.OPEN)return;const e=JSON.stringify({type:"restart"});o.send(e)};var W=ye(),B=s(u(W),2);{var K=e=>{var t=me(),d=u(t);d.__click=[_e,k,I];var _=s(d,4);ie(_);var y=s(_,2);y.__click=I,le(_,()=>a(k),p=>r(k,p)),i(e,t)};v(B,e=>{["initial","waiting_for_opponent","game_over","disconnected"].includes(a(l))&&e(K)})}var A=s(B,2);{var Q=e=>{var t=ce();i(e,t)};v(A,e=>{a(l)==="connecting"&&e(Q)})}var E=s(A,2);{var T=e=>{var t=ge();i(e,t)};v(E,e=>{a(l)==="waiting_for_opponent"&&e(T)})}var J=s(E,2);{var X=e=>{var t=U(),d=u(t);{var _=p=>{var f=de(),w=u(f),R=D(w);j(w);var n=s(w,2);z(n,{nbColumns:7,nbRows:6,get board(){return a(c)},get winningCells(){return a(h)},onMove:O}),q(()=>Y(R,`You are Player ${a(S)??""}`)),i(p,f)},y=p=>{var f=fe();i(p,f)};v(d,p=>{a(c)!==null?p(_):p(y,!1)})}i(e,t)};v(J,e=>{a(l)==="playing"&&e(X)})}var L=s(J,2);{var Z=e=>{var t=ue(),d=s(u(t),2);d.__click=H;var _=s(d,2),y=D(_);{var p=n=>{var P=V("Game Over");i(n,P)},f=n=>{var P=U(),te=u(P);{var ae=G=>{var M=V();q(()=>Y(M,`Player ${a(g)??""} wins`)),i(G,M)};v(te,G=>{(a(g)===N.winPlayer1||a(g)===N.winPlayer2)&&G(ae)},!0)}i(n,P)};v(y,n=>{a(g)===N.draw?n(p):n(f,!1)})}j(_);var w=s(_,2);{var R=n=>{z(n,{nbColumns:7,nbRows:6,get board(){return a(c)},get winningCells(){return a(h)},onMove:O})};v(w,n=>{a(c)!==null&&n(R)})}i(e,t)};v(L,e=>{a(l)==="game_over"&&e(Z)})}var $=s(L,2);{var ee=e=>{var t=be();i(e,t)};v($,e=>{a(l)==="disconnected"&&e(ee)})}i(x,W),ne()}se(["click"]);export{Ie as component};
