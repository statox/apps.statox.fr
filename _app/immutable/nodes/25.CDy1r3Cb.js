import{g as qt,u as pt,a as Vt,b as Ut}from"../chunks/BvU0UyTT.js";import"../chunks/NZTpNUN0.js";import{o as mt}from"../chunks/SweRCpJo.js";import{z as P,C as bt,g as t,p as S,x as M,a as b,E as G,s as A,A as F,f as O,v as p,F as v,G as l,c as H,aZ as tt,a_ as wt,B as et}from"../chunks/Br9SMxIB.js";import{d as ot,w as kt,s as U,g as Ft}from"../chunks/BBzb7ThI.js";import{e as I,i as R}from"../chunks/D1-nhZYT.js";import{c as Mt}from"../chunks/B6uhnS2H.js";import{c as ut,d as Ct,s as rt,a as dt,r as _t}from"../chunks/DWdbj9D8.js";import{b as Ot,c as Et}from"../chunks/C6S4cPPP.js";import{a as ft,s as yt,b as Lt}from"../chunks/Bpxd_8Tl.js";import{m as Nt}from"../chunks/B81YP0Pw.js";import{a as xt}from"../chunks/D9n79Di3.js";import{M as jt}from"../chunks/DKmGubEx.js";import{M as It}from"../chunks/BhRFzXHd.js";import{i as J}from"../chunks/CvXxFVm9.js";import{k as ht}from"../chunks/runBWP2p.js";import{p as vt}from"../chunks/BFcFh6QN.js";import{b as Rt,g as zt}from"../chunks/B68cWVv3.js";import{t as Jt}from"../chunks/D-rGHmBV.js";import{A as Pt}from"../chunks/6gmiY960.js";import{U as Gt,u as Ht}from"../chunks/Bj_DGLxi.js";import{b as Kt}from"../chunks/BXX3-uSK.js";import{a as Wt}from"../chunks/WbxJrN1C.js";import"../chunks/BUWzxVIb.js";import{p as Zt}from"../chunks/BlwCpJbF.js";const Qt=!1,Xt=async()=>({chords:await qt()}),fr=Object.freeze(Object.defineProperty({__proto__:null,load:Xt,ssr:Qt},Symbol.toStringTag,{value:"Module"}));var Yt=S('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1vskasp"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1vskasp">Back to top</span></button>');function $t(_,e){P(e,!0);let n=F(0),s=F(!0),f;const D=o=>{o>0?A(s,!1):A(s,!0),f&&clearTimeout(f),f=setTimeout(()=>{A(s,!0)},3e3)},w=()=>{const o=document.documentElement.scrollTop||document.body.scrollTop;o>0&&(window.requestAnimationFrame(w),window.scrollTo(0,o-o/2))};bt(()=>D(t(n)));var a=Yt();let r;a.__click=w,M(o=>r=ut(a,1,"top-link svelte-1vskasp",null,r,o),[()=>({hide:t(s)})]),xt("y",()=>t(n),o=>A(n,o,!0)),b(_,a),G()}ot(["click"]);const st=kt();let St=[];const gt=localStorage.getItem("failedVisitCounts");if(gt!==null)try{St=JSON.parse(gt)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const ct=kt(St);ct.subscribe(_=>{localStorage.setItem("failedVisitCounts",JSON.stringify(_))});const Dt=_=>_==="doc"?"fas fa-file-word":_==="pdf"?"fas fa-file-pdf":_==="youtube"?"fa fa-youtube":"fas fa-link",te=async(_,e,n)=>{try{await pt(e.chord.url);const s=Ft(st),f=s.get(e.chord.url)||{count:0,lastAccessDateUnix:0};f.count++,f.lastAccessDateUnix=Date.now()/1e3,s.set(e.chord.url,f),st.set(s)}catch(s){let f=s.message;s instanceof Pt&&s.code===401?f="Invalid logged in user":s instanceof Gt&&(f="User is logged out"),Lt(ct,[...n(),e.chord.url]);const D=`<strong>Visit not counted</strong><br/> ${f}`;Jt.push(D,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};var ee=S('<span></span> <span><a target="_blank" rel="noopener noreferrer"> </a></span>',1);function nt(_,e){P(e,!0);const n=()=>ft(ct,"$failedVisitCounts",s),[s,f]=yt();let D=vt(e,"showArtist",3,!1),w=F(void 0);st.subscribe(i=>{if(i&&i.has(e.chord.url)){const d=i.get(e.chord.url),y=new Date(d.lastAccessDateUnix*1e3);A(w,`visits: ${d.count} - last: ${y.toLocaleDateString()}`)}});const a=(D()?e.chord.artist+" - ":"")+e.chord.title,r=i=>i.type==="doc"?`${Rt}/docviewer/${i.url}`:i.url;var o=ee(),m=O(o),g=p(m,2),C=v(g);C.__click=[te,e,n];var u=v(C,!0);l(C),l(g),M((i,d)=>{ut(m,1,i,"svelte-et925i"),rt(C,"href",d),rt(C,"title",t(w)),U(u,a)},[()=>Ct(Dt(e.chord.type)),()=>r(e.chord)]),b(_,o),G(),f()}ot(["click"]);var re=S('<li class="ul2col-item"><!> <!></li>'),ae=S('<ul class="ul2col-container"></ul>');function se(_,e){P(e,!0);let n=vt(e,"chords",15),s=F(void 0);st.subscribe(a=>{a&&(A(s,a,!0),n(n().sort((r,o)=>{const m=a.get(r.url),g=a.get(o.url);return m&&g?g.lastAccessDateUnix-m.lastAccessDateUnix:m?-1:g?1:r.artist!=o.artist?r.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:r.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(a,r,o)=>o[a.type]===!1?!1:r.length===0||a.artist.toLowerCase().match(r.toLowerCase())?!0:a.title.toLowerCase().match(r.toLowerCase());var D=H(),w=O(D);ht(w,n,a=>{var r=ae();I(r,21,n,R,(o,m)=>{const g=tt(()=>t(s)?.get(t(m).url));var C=H(),u=O(C);{var i=d=>{var y=re(),c=v(y);{var h=x=>{var L=wt();M(()=>U(L,`(${t(g).count??""})`)),b(x,L)};J(c,x=>{t(g)&&x(h)})}var k=p(c,2);nt(k,{get chord(){return t(m)},showArtist:!0}),l(y),b(d,y)};J(u,d=>{f(t(m),e.searchString,e.filters)&&d(i)})}b(o,C)}),l(r),b(a,r)}),b(_,D),G()}const oe=(_,e)=>_<e?-1:_>e?1:0,Tt=(_,e)=>{const n=_.toLowerCase(),s=e.toLowerCase();return oe(n,s)};var ne=S('<li class="navigationBtn svelte-16xotip"><a class="navigationLink svelte-16xotip"> </a></li>'),le=S('<li class="ul2col-item"><!></li>'),ie=S('<ul class="ul2col-container"></ul>'),ce=S('<tr class="svelte-16xotip"><td class="svelte-16xotip"> <!></td></tr>'),ue=S('<ol id="indexList" class="navigationBar disable-scrollbars svelte-16xotip"></ol> <table id="artistTable"><tbody></tbody></table>',1);function ve(_,e){P(e,!0);let n=vt(e,"searchString",3,"");const s=e.chords.reduce((c,h)=>{const k=h.artist;return c[k]||(c[k]=[]),c[k].push(h),c},{}),f=[],D=Object.keys(s).sort(Tt).map((c,h,k)=>{if(h===0||c[0].toLowerCase()!=k[h-1][0].toLowerCase()){const x="anchor_letter_"+c[0];return f.push({letter:c[0],tag:x}),{name:c,tag:x}}return{name:c}});let w=F(0),a=F(0),r=F(void 0);const o=c=>{if(t(r)){var h=t(r).getBoundingClientRect();if(h.top<20){A(a,20);return}A(a,h.top,!0)}};bt(()=>o(t(w)));const m=(c,h,k)=>s[c].sort((L,B)=>L.title<B.title?-1:1).filter(L=>{const B=L.type;return k[B]===!1?!1:h.length===0?!0:!!L.title.toLowerCase().match(h.toLowerCase())}),g=(c,h)=>!!c.toLowerCase().match(h.toLowerCase());var C=ue(),u=O(C);let i;I(u,21,()=>f,R,(c,h)=>{var k=ne(),x=v(k),L=v(x,!0);l(x),l(k),M(B=>{rt(x,"href","#"+t(h).tag),U(L,B)},[()=>t(h).letter.toUpperCase()]),b(c,k)}),l(u);var d=p(u,2),y=v(d);I(y,21,()=>D,R,(c,h)=>{const k=tt(()=>m(t(h).name,n(),e.filters)),x=tt(()=>g(t(h).name,n()));var L=H(),B=O(L);{var N=Y=>{const $=tt(()=>t(x)?s[t(h).name]:t(k));var K=ce(),z=v(K),W=v(z),at=p(W);ht(at,n,j=>{var Z=ie();I(Z,21,()=>t($),R,(Q,lt)=>{var T=le(),q=v(T);nt(q,{get chord(){return t(lt)}}),l(T),b(Q,T)}),l(Z),b(j,Z)}),l(z),l(K),M(()=>{rt(z,"id",t(h).tag),U(W,`${t(h).name??""} `)}),b(Y,K)};J(B,Y=>{(t(x)||t(k).length>0)&&Y(N)})}b(c,L)}),l(y),l(d),Kt(d,c=>A(r,c),()=>t(r)),M(c=>i=dt(u,"",i,c),[()=>({"--barTop":`${t(a)??""}px`})]),xt("y",()=>t(w),c=>A(w,c,!0)),b(_,C),G()}var de=S('<li class="ul2col-item"><!></li>'),fe=S('<div><span> </span> <ul class="ul2col-container"></ul></div>');function me(_,e){P(e,!0);const n=w=>w.charAt(0).toUpperCase()+w.slice(1).toLowerCase(),s=et({});for(const w of e.chords)w.tags.forEach(r=>{s[r]||(s[r]=[]),s[r].push(w)});Object.keys(s).forEach(w=>{s[w].sort((a,r)=>{const o=a.artist.toLowerCase(),m=r.artist.toLowerCase(),g=a.title.toLowerCase(),C=r.title.toLowerCase();return o<m?-1:o>m?1:g<C?-1:1})});var f=H(),D=O(f);I(D,17,()=>Object.keys(s).sort(Tt),R,(w,a)=>{var r=H(),o=O(r);{var m=g=>{var C=fe(),u=v(C),i=v(u,!0);l(u);var d=p(u,2);I(d,21,()=>s[t(a)],R,(y,c)=>{var h=H(),k=O(h);{var x=L=>{var B=de(),N=v(B);nt(N,{get chord(){return t(c)},showArtist:!0}),l(B),b(L,B)};J(k,L=>{e.filters[t(c).type]&&L(x)})}b(y,h)}),l(d),l(C),M(y=>U(i,y),[()=>n(t(a))]),b(g,C)};J(o,g=>{(e.searchString.length===0||t(a).toLowerCase().match(e.searchString.toLowerCase()))&&g(m)})}b(w,r)}),b(_,f),G()}var he=S('<li class="ul2col-item"><!> <!></li>'),_e=S('<ul class="ul2col-container"></ul>');function ge(_,e){P(e,!0);let n=vt(e,"chords",15),s=F(void 0);st.subscribe(a=>{a&&(A(s,a,!0),n(n().sort((r,o)=>{const m=a.get(r.url),g=a.get(o.url);return m&&g?m.count!==g.count?g.count-m.count:g.lastAccessDateUnix-m.lastAccessDateUnix:m?-1:g?1:r.artist!=o.artist?r.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:r.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(a,r,o)=>o[a.type]===!1?!1:r.length===0||a.artist.toLowerCase().match(r.toLowerCase())?!0:a.title.toLowerCase().match(r.toLowerCase());var D=H(),w=O(D);ht(w,n,a=>{var r=_e();I(r,21,n,R,(o,m)=>{const g=tt(()=>t(s)?.get(t(m).url));var C=H(),u=O(C);{var i=d=>{var y=he(),c=v(y);{var h=x=>{var L=wt();M(()=>U(L,`(${t(g).count??""})`)),b(x,L)};J(c,x=>{t(g)&&x(h)})}var k=p(c,2);nt(k,{get chord(){return t(m)},showArtist:!0}),l(y),b(d,y)};J(u,d=>{f(t(m),e.searchString,e.filters)&&d(i)})}b(o,C)}),l(r),b(a,r)}),b(_,D),G()}var pe=S('<span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-161wm6q"> </span>',1),be=S('<div class="rows svelte-161wm6q"><span class="col table-head svelte-161wm6q">Last Check</span> <span class="col table-head svelte-161wm6q">Checks</span> <span class="col table-head svelte-161wm6q">Skipped</span> <span class="col table-head svelte-161wm6q">Errors</span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span></div> <br/> <div class="rows svelte-161wm6q"><span class="col table-head svelte-161wm6q">Status</span> <span class="col table-head svelte-161wm6q">Ref</span> <span class="col table-head svelte-161wm6q">Host</span> <span class="col table-head svelte-161wm6q">Data</span> <!></div>',1),we=S('<p style="color: red"> </p>'),ke=S("<p>Fetching results...</p>"),Ce=S('<div role="dialog" class="modal svelte-161wm6q"><div class="contents svelte-161wm6q"><h3 class="title-bar svelte-161wm6q">Urls checks <button>Close</button></h3> <!></div></div>');function ye(_,e){P(e,!0);const n=a=>{const r=new Date(a.timestamp);return r.toDateString()+" "+r.toTimeString()},s=a=>a.fails.sort((r,o)=>r.chord.url<o.chord.url?-1:1);var f=H(),D=O(f);{var w=a=>{var r=Ce(),o=v(r),m=v(o),g=p(v(m));g.__click=function(...u){e.close?.apply(this,u)},l(m);var C=p(m,2);Wt(C,Vt,u=>{var i=ke();b(u,i)},(u,i)=>{const d=tt(()=>n(t(i))),y=tt(()=>s(t(i)));var c=be(),h=O(c),k=p(v(h),8),x=v(k,!0);l(k);var L=p(k,2),B=v(L,!0);l(L);var N=p(L,2),Y=v(N,!0);l(N);var $=p(N,2),K=v($,!0);l($),l(h);var z=p(h,4),W=p(v(z),8);I(W,17,()=>t(y),R,(at,j)=>{var Z=pe(),Q=O(Z),lt=v(Q,!0);l(Q);var T=p(Q,2),q=v(T);l(T);var V=p(T,2),E=v(V),it=v(E,!0);l(E),l(V);var X=p(V,2),At=v(X,!0);l(X),M(Bt=>{U(lt,t(j).status),U(q,`${t(j).chord.artist??""} - ${t(j).chord.title??""}`),rt(E,"href",t(j).chord.url),U(it,new URL(t(j).chord.url).hostname),U(At,Bt)},[()=>t(j).error?JSON.stringify(t(j).error):""]),b(at,Z)}),l(z),M(()=>{U(x,t(d)),U(B,t(i).nbChecks),U(Y,t(i).nbSkipped),U(K,t(i).nbFails)}),b(u,c)},(u,i)=>{var d=we(),y=v(d);l(d),M(()=>U(y,`Could not retrieve checks: ${t(i).message??""}`)),b(u,d)}),l(o),l(r),b(a,r)};J(D,a=>{e.isOpen&&a(w)})}b(_,f),G()}ot(["click"]);var Le=(_,e)=>e(),xe=S('<li class="ul2col-separator"> </li>'),Se=S('<!> <li class="ul2col-item"><!></li>',1),De=S('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function Te(_,e){P(e,!0);const n=Date.now(),s=1e3*3600*24*7,f=s*4,D=[{label:"last week",time:n-s},{label:"one month ago",time:n-f},{label:"two months ago",time:n-2*f},{label:"six months ago",time:n-6*f},{label:"one year ago",time:n-12*f}],w=e.chords.filter(i=>i.creationDate).sort((i,d)=>d.creationDate-i.creationDate).map((i,d,y)=>{const c={...i};if(d>0){const h=y[d-1];for(const{time:k,label:x}of D)h.creationDate>k&&i.creationDate<k&&(c.dateTag=x)}return c});let a=6,r=F(et([]));const o=()=>{a+=4,A(r,w.slice(0,a),!0)};mt(()=>{o()});var m=De(),g=v(m),C=p(v(g));C.__click=[Le,o],l(g);var u=p(g,2);I(u,21,()=>t(r),R,(i,d)=>{var y=Se(),c=O(y);{var h=L=>{var B=xe(),N=v(B,!0);l(B),M(()=>U(N,t(d).dateTag)),b(L,B)};J(c,L=>{t(d).dateTag&&L(h)})}var k=p(c,2),x=v(k);nt(x,{get chord(){return t(d)}}),l(k),b(i,y)}),l(u),l(m),b(_,m),G()}ot(["click"]);const Ae=(_,e,n,s,f)=>{t(e).length<=n||(t(e).splice(t(e).length-n),A(s,t(e).slice(t(e).length-n).map(D=>f.chords[D]),!0))};var Be=S("<button>&nbsp↶&nbsp</button>"),qe=S('<li class="ul2col-item"><!></li>'),Ve=S('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br/> <ul class="ul2col-container"></ul></div>');function Ue(_,e){P(e,!0);const n=6;let s=F(et([])),f=F(et([]));const D=()=>{t(s).length>=e.chords.length-n&&A(s,[],!0);for(let u=0;u<n;u++){let i=-1;for(;i===-1||t(s).includes(i);)i=Math.floor(Math.random()*e.chords.length);t(s).push(i)}A(f,t(s).slice(t(s).length-n).map(u=>e.chords[u]),!0)};mt(()=>{D()});var w=Ve(),a=v(w),r=p(v(a)),o=v(r);{var m=u=>{var i=Be();i.__click=[Ae,s,n,f,e],b(u,i)};J(o,u=>{t(s).length>n&&u(m)})}var g=p(o,2);g.__click=D,l(r),l(a);var C=p(a,4);I(C,21,()=>t(f),u=>u.url,(u,i)=>{var d=qe(),y=v(d);nt(y,{get chord(){return t(i)},showArtist:!0}),l(d),b(u,d)}),l(C),l(w),b(_,w),G()}ot(["click"]);var Fe=()=>Nt.open(ye),Me=()=>zt("/songbook/edit"),Oe=(_,e)=>A(e,""),Ee=(_,e,n)=>{t(e)[t(n)]=!t(e)[t(n)],A(e,t(e),!0)},Ne=S('<button class="filter-control svelte-1k2cvi7"><input type="checkbox"/> <span></span></button>'),je=(_,e,n)=>A(e,t(n),!0),Ie=S("<button> </button>"),Re=S('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"/> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1k2cvi7"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1k2cvi7"></div></div> <!>',1);function mr(_,e){P(e,!0);const n=()=>ft(ct,"$failedVisitCounts",f),s=()=>ft(Ht,"$user",f),[f,D]=yt();Zt.set("Songbook");const{chords:w}=e.data;let a=F(et([]));const r=T=>{t(a).push(T),A(a,t(a),!0),setTimeout(()=>{t(a).shift(),A(a,t(a),!0)},5e3)};mt(async()=>{try{if(n().length&&s()){r({level:"info",header:"Trying to count missed visits while logged out"});for(const T of n())await pt(T);r({level:"success",header:`Counted ${n().length} missed visits`}),Lt(ct,[])}}catch{r({level:"error",header:"Couldnt upload failed visit counts"})}try{const q=(await Ut()).reduce((V,E)=>(V.set(E.url,{...E}),V),new Map);st.set(q)}catch{r({level:"error",header:"Couldnt upload failed visit counts"})}});let o=F("");const m=[{label:"By artist",component:ve},{label:"By tags",component:me},{label:"By frequency",component:ge},{label:"By access date",component:se}];let g=F(et(m[0]));const C={pdf:!0,doc:!0,youtube:!0,link:!0};let u=F(et({...C}));const i=Object.keys(C);var d=Re(),y=O(d);jt(y,{title:"Song Book",description:"My song book",iconPath:"/songbook.png"});var c=p(y,2),h=v(c),k=v(h);k.__click=[Fe],dt(k,"",{},{position:"relative"});var x=p(k,2);x.__click=[Me],dt(x,"",{},{position:"relative"}),l(h),l(c);var L=p(c,2);I(L,17,()=>t(a),R,(T,q)=>{It(T,{get item(){return t(q)}})});var B=p(L,2);$t(B,{});var N=p(B,2),Y=v(N);l(N);var $=p(N,2);Te($,{get chords(){return w}});var K=p($,2);Ue(K,{get chords(){return w}});var z=p(K,2),W=p(v(z),2);_t(W);var at=p(W,2);at.__click=[Oe,o];var j=p(at,2),Z=p(v(j),2);I(Z,17,()=>i,R,(T,q)=>{var V=Ne();V.__click=[Ee,u,q];var E=v(V);_t(E);var it=p(E,2);l(V),M(X=>{rt(V,"aria-label",`filter for ${t(q)??""}`),rt(E,"id",t(q)),ut(it,1,X,"svelte-1k2cvi7")},[()=>Ct(Dt(t(q)))]),Et(E,()=>t(u)[t(q)],X=>t(u)[t(q)]=X),b(T,V)}),l(j);var Q=p(j,4);I(Q,21,()=>m,R,(T,q)=>{var V=Ie();let E;V.__click=[je,g,q];var it=v(V,!0);l(V),M(X=>{E=ut(V,1,"control svelte-1k2cvi7",null,E,X),U(it,t(q).label)},[()=>({selected:t(g)===t(q)})]),b(T,V)}),l(Q),l(z);var lt=p(z,2);Mt(lt,()=>t(g).component,(T,q)=>{q(T,{get chords(){return w},get searchString(){return t(o)},get filters(){return t(u)}})}),M(()=>U(Y,`This is a list of ${w.length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Ot(W,()=>t(o),T=>A(o,T)),b(_,d),G(),D()}ot(["click"]);export{mr as component,fr as universal};
