import"../chunks/CWj6FrbW.js";import{p as re,aF as O,v as q,n as se,aD as s,w as a,aE as r,g as t,s as M,j as ve,o as Me,k as R}from"../chunks/CSfV3ymj.js";import{s as Q}from"../chunks/Blh9JMjm.js";import{a as Ie}from"../chunks/BdtEDPPN.js";import{i as T}from"../chunks/D15zkCSQ.js";import{f as de,e as oe,a as p,t as j}from"../chunks/GoYwHD_y.js";import{p as Z}from"../chunks/CAcrlYWE.js";import{s as ue,a as he}from"../chunks/8LNB3_vc.js";import{m as He}from"../chunks/BaBMjS3D.js";import{u as pe,U as Ne}from"../chunks/CO0PQ356.js";import{M as De}from"../chunks/BK2INKUU.js";import{r as Fe,a as fe,A as Pe}from"../chunks/CtkGXI36.js";import{e as me,i as _e}from"../chunks/Dq9I4nEb.js";import{r as W,a as L,s as ze,d as B}from"../chunks/BAG4154U.js";import{b as le,c as Oe}from"../chunks/DcAcb_yH.js";import{b as Te}from"../chunks/B1jQKio9.js";import{t as Ae}from"../chunks/C8s4sAzx.js";import{M as Be,a as Re}from"../chunks/BnXNnw9r.js";import{M as qe}from"../chunks/DVWEvLCP.js";import{p as ie}from"../chunks/BM2c9rLY.js";import{D as Ge}from"../chunks/DT4lGENY.js";import"../chunks/SAwLXgtn.js";import{p as Je}from"../chunks/BbIam-rf.js";const Ve=!1,Ot=Object.freeze(Object.defineProperty({__proto__:null,ssr:Ve},Symbol.toStringTag,{value:"Module"})),Ce=async()=>Fe({path:"/webWatcher/getAllWatchers"}),We=async u=>fe({path:"/webWatcher/createWatcher",data:u}),Ke=async u=>fe({path:"/webWatcher/deleteWatcher",data:{id:u}}),Qe=async u=>fe({path:"/webWatcher/toggleWatcherEnabled",data:u}),Xe=async(u,e,_,y,c,o,n,f,d)=>{var z;M(e,Z([])),(z=t(_))!=null&&z.length||t(e).push({level:"error",header:"name must be defined"}),t(y)||t(e).push({level:"error",header:"notification message must be defined"}),t(c)==="CSS"&&!t(o)&&t(e).push({level:"error",header:"A CSS watcher must have a css selector defined"}),t(n)<15*60&&t(e).push({level:"error",header:"Check interval too small. Must be >= 15mn"});try{new URL(t(f))}catch{t(e).push({level:"error",header:"The URL is invalid"})}if(!t(e).length)try{t(c)==="CSS"?await We({name:t(_),notificationMessage:t(y),url:t(f),cssSelector:t(o),checkIntervalSeconds:t(n),watchType:t(c)}):t(c)==="HASH"&&await We({name:t(_),notificationMessage:t(y),url:t(f),checkIntervalSeconds:t(n),watchType:t(c)}),d.onUpload(),d.close()}catch(w){let h=w.message;w instanceof Pe&&w.code===401?h="Invalid logged in user":w instanceof Ne&&(h="User is logged out");const E=`<strong>Entry not created</strong><br/> ${h}`;Ae.push(E,{theme:{"--toastBarBackground":"#FF0000"}})}};var Ye=j('<label for="css-selector">CSS selector</label> <input type="textarea">',1),Ze=j('<button class="form-action svelte-1cixduj">Submit</button>'),$e=j('<span class="form-action svelte-1cixduj">Login to upload an entry</span>'),et=j('<div role="dialog" class="modal svelte-1cixduj"><div class="contents svelte-1cixduj"><h3 class="title-bar svelte-1cixduj">Add a new clipboard entry <button>Close</button></h3> <!> <form class="form-content svelte-1cixduj"><label for="name">Name</label> <input type="text"> <label for="check-interval">Check interval</label> <!> <label for="notification-message">Notification message (the @mention is automatically added)</label> <input type="textarea"> <label for="watch-type">Watcher type</label> <select id="watch-type"><option>CSS</option><option>HASH</option></select> <label for="content">URL</label> <input type="textarea"> <!> <br> <!></form></div></div>');function tt(u,e){re(e,!0);const[_,y]=ue(),c=()=>he(pe,"$user",_);let o=O(Z([])),n=O(""),f=O(""),d=O(""),z=O(""),w=O(0),h=O("CSS");var E=oe(),I=q(E);{var U=b=>{var l=et(),m=s(l),v=s(m),x=a(s(v));x.__click=function(...i){var k;(k=e.close)==null||k.apply(this,i)},r(v);var g=a(v,2);me(g,17,()=>t(o),_e,(i,k)=>{De(i,{get item(){return t(k)}})});var D=a(g,2),A=a(s(D),2);W(A);var X=a(A,4);Be(X,{allowedUnits:["minutes","hours","days"],defaultDuration:{value:1,unit:"hours"},get valueInSeconds(){return t(w)},set valueInSeconds(i){M(w,Z(i))}});var H=a(X,4);W(H);var S=a(H,4),N=s(S);N.value=(N.__value="CSS")==null?"":"CSS";var C=a(N);C.value=(C.__value="HASH")==null?"":"HASH",r(S);var F=a(S,4);W(F);var P=a(F,2);{var G=i=>{var k=Ye(),Y=a(q(k),2);W(Y),le(Y,()=>t(z),te=>M(z,te)),p(i,k)};T(P,i=>{t(h)==="CSS"&&i(G)})}var $=a(P,4);{var ee=i=>{var k=Ze();k.__click=[Xe,o,n,f,h,z,w,d,e],p(i,k)},ce=i=>{var k=$e();p(i,k)};T($,i=>{c()?i(ee):i(ce,!1)})}r(D),r(m),r(l),le(A,()=>t(n),i=>M(n,i)),le(H,()=>t(f),i=>M(f,i)),Te(S,()=>t(h),i=>M(h,i)),le(F,()=>t(d),i=>M(d,i)),p(b,l)};T(I,b=>{e.isOpen&&b(U)})}p(u,E),se(),y()}de(["click"]);function Ue(u,e,_,y){const c=u.target,o=c==null?void 0:c.getAttribute("aria-checked");M(e,Z(o!=="true")),_(t(e)===!0?"on":"off"),y("change",_())}var at=j('<div class="s s--inner svelte-1n7axnp"><span> </span> <button role="switch" class="svelte-1n7axnp"><span class="svelte-1n7axnp">on</span> <span class="svelte-1n7axnp">off</span></button></div>'),rt=j('<div class="s s--slider svelte-1n7axnp"><span> </span> <button role="switch" class="svelte-1n7axnp"></button></div>'),st=j('<input type="radio" class="svelte-1n7axnp"> <label class="svelte-1n7axnp"> </label>',1),nt=j('<div class="s s--multi svelte-1n7axnp"><div role="radiogroup" class="group-container svelte-1n7axnp"><div class="legend"> </div> <!></div></div>');function lt(u,e){re(e,!0);const _=[];let y=ie(e,"design",3,"inner label"),c=ie(e,"options",19,()=>[]),o=ie(e,"fontSize",3,16),n=ie(e,"value",15,"on"),f=O(!0);const d=Math.floor(Math.random()*100),z=ve();Me(()=>{M(f,n()==="on")});var w=oe(),h=q(w);{var E=U=>{var b=at(),l=s(b);L(l,"id",`switch-${d}`);var m=s(l,!0);r(l);var v=a(l,2);L(v,"aria-labelledby",`switch-${d}`),v.__click=[Ue,f,n,z],r(b),R(()=>{Q(m,e.label),L(v,"aria-checked",t(f))}),p(U,b)},I=(U,b)=>{{var l=v=>{var x=rt(),g=s(x);L(g,"id",`switch-${d}`);var D=s(g,!0);r(g);var A=a(g,2);L(A,"aria-labelledby",`switch-${d}`),A.__click=[Ue,f,n,z],r(x),R(()=>{ze(x,`font-size:${o()??""}px`),Q(D,e.label),L(A,"aria-checked",t(f))}),p(v,x)},m=v=>{var x=nt(),g=s(x);L(g,"aria-labelledby",`label-${d}`),L(g,"id",`group-${d}`);var D=s(g);L(D,"id",`label-${d}`);var A=s(D,!0);r(D);var X=a(D,2);me(X,17,c,_e,(H,S)=>{var N=st(),C=q(N);W(C);var F,P=a(C,2),G=s(P,!0);r(P),R(()=>{L(C,"id",`${t(S)}-${d}`),F!==(F=t(S))&&(C.value=(C.__value=t(S))==null?"":t(S)),L(P,"for",`${t(S)}-${d}`),Q(G,t(S))}),Oe(_,[],C,()=>(t(S),n()),n),p(H,N)}),r(g),r(x),R(()=>{ze(g,`font-size:${o()??""}px`),Q(A,e.label)}),p(v,x)};T(U,v=>{y()=="slider"?v(l):v(m,!1)},b)}};T(h,U=>{y()=="inner"?U(E):U(I,!1)})}p(u,w),se()}de(["click"]);var it=j('<p class="section-3-item svelte-1jnygz9"><label for="css-selector">CSS selector <!></label> <input disabled type="textarea" class="svelte-1jnygz9"></p>'),ot=j('<div class="section error-section svelte-1jnygz9"><p class="section-4-item svelte-1jnygz9"><label for="last-check">Last error</label> <input disabled type="textarea" class="svelte-1jnygz9"></p> <p class="section-4-item svelte-1jnygz9"><label for="last-update">Last error message</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div>'),ct=j('<div class="item svelte-1jnygz9"><h3 class="item-title svelte-1jnygz9"><div class="item-name svelte-1jnygz9"> </div> <div class="item-actions svelte-1jnygz9"><!> <!></div></h3> <div class="section svelte-1jnygz9"><p class="section-1-item svelte-1jnygz9"><label for="check-interval">Check interval</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div> <div class="section svelte-1jnygz9"><p class="section-2-item svelte-1jnygz9"><label for="notification-message">Notification message</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div> <div class="section svelte-1jnygz9"><p class="section-3-item svelte-1jnygz9"><label for="content">URL</label> <a target="_blank" rel="noopener noreferrer"> </a></p> <!></div> <div class="section svelte-1jnygz9"><p class="section-4-item svelte-1jnygz9"><label for="last-check">Last check</label> <input disabled type="textarea" class="svelte-1jnygz9"></p> <p class="section-4-item svelte-1jnygz9"><label for="last-update">Last content change</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div> <!> <div class="section svelte-1jnygz9"><p class="section-3-item svelte-1jnygz9"><label for="last-update">Last content</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div></div>');function vt(u,e){re(e,!0);const[_,y]=ue(),c=()=>he(pe,"$user",_),o=ve(),n=l=>{const m=new Date(l*1e3);return m.toLocaleDateString()+" "+m.toLocaleTimeString()},f=e.watcher.lastCheckDateUnix===0?"Never checked before":n(e.watcher.lastCheckDateUnix),d=e.watcher.lastUpdateDateUnix===0?"Never changed":n(e.watcher.lastUpdateDateUnix),z=Ge.fromMillis(e.watcher.checkIntervalSeconds*1e3).rescale().toHuman(),w=async()=>{if(!e.watcher.id){console.error("id must be defined");return}try{await Ke(e.watcher.id),o("delete")}catch(l){const m=`<strong>Watcher not deleted</strong><br/> ${l.message}`;Ae.push(m,{theme:{"--toastBarBackground":"#FF0000"}})}},h=async l=>{await Qe({watcherId:e.watcher.id,setToEnabled:l.detail==="on"}),o("update")};let E=e.watcher.archivalDateUnix?"off":"on";var I=oe(),U=q(I);{var b=l=>{var m=ct(),v=s(m),x=s(v),g=s(x,!0);r(x);var D=a(x,2),A=s(D);lt(A,{value:E,label:"Enabled",design:"slider",$$events:{change:h}});var X=a(A,2);qe(X,{deleteAction:w}),r(D),r(v);var H=a(v,2),S=s(H),N=a(s(S),2);W(N),B(N,z),r(S),r(H);var C=a(H,2),F=s(C),P=a(s(F),2);W(P),r(F),r(C);var G=a(C,2),$=s(G),ee=a(s($),2),ce=s(ee,!0);r(ee),r($);var i=a($,2);{var k=J=>{var V=it(),K=s(V),ne=a(s(K));Re(ne,{get content(){return e.watcher.cssSelector}}),r(K);var ae=a(K,2);W(ae),r(V),R(()=>B(ae,e.watcher.cssSelector)),p(J,V)};T(i,J=>{e.watcher.watchType==="CSS"&&J(k)})}r(G);var Y=a(G,2),te=s(Y),be=a(s(te),2);W(be),B(be,f),r(te);var ge=a(te,2),ye=a(s(ge),2);W(ye),B(ye,d),r(ge),r(Y);var we=a(Y,2);{var Le=J=>{var V=ot(),K=s(V),ne=a(s(K),2);W(ne),r(K);var ae=a(K,2),ke=a(s(ae),2);W(ke),r(ae),r(V),R(Ee=>{B(ne,Ee),B(ke,e.watcher.lastErrorMessage)},[()=>n(e.watcher.lastErrorDateUnix)]),p(J,V)};T(we,J=>{e.watcher.lastErrorDateUnix&&J(Le)})}var xe=a(we,2),Se=s(xe),je=a(s(Se),2);W(je),r(Se),r(xe),r(m),R(()=>{Q(g,e.watcher.name),B(P,e.watcher.notificationMessage),L(ee,"href",e.watcher.url),Q(ce,e.watcher.url),B(je,e.watcher.lastContent)}),p(l,m)};T(U,l=>{c()&&l(b)})}p(u,I),se(),y()}var dt=j('<div class="container svelte-c8nodu"></div>');function ut(u,e){re(e,!0);const _=ve(),y=(o,n)=>o.archivalDateUnix===null&&n.archivalDateUnix!==null?-1:o.archivalDateUnix!==null&&n.archivalDateUnix===null?1:n.id-o.id;var c=dt();me(c,21,()=>e.watchers.sort(y),_e,(o,n)=>{vt(o,{get watcher(){return t(n)},$$events:{delete:()=>_("delete"),update:()=>_("update")}})}),r(c),p(u,c),se()}var ht=(u,e)=>He.open(tt,{onUpload:e}),pt=j("<p>Something went wrong</p> <p> </p>",1),ft=j("<p>Loading data</p>"),mt=j("<h2>Create a new watcher</h2> <button>Add an entry</button> <h2>Watchers</h2> <!>",1);function Tt(u,e){re(e,!0);const[_,y]=ue(),c=()=>he(pe,"$user",_);Je.set("Web Watchers");let o=O(Z(Ce()));const n=()=>M(o,Z(Ce()));var f=oe(),d=q(f);{var z=h=>{var E=mt(),I=a(q(E),2);I.__click=[ht,n];var U=a(I,4);Ie(U,()=>t(o),b=>{var l=ft();p(b,l)},(b,l)=>{ut(b,{get watchers(){return t(l)},$$events:{delete:n,update:n}})},(b,l)=>{var m=pt(),v=a(q(m),2),x=s(v,!0);r(v),R(g=>Q(x,g),[()=>JSON.stringify(t(l))]),p(b,m)}),p(h,E)},w=h=>{De(h,{item:{level:"info",header:"Login to list the watchers"}})};T(d,h=>{c()?h(z):h(w,!1)})}p(u,f),se(),y()}de(["click"]);export{Tt as component,Ot as universal};
