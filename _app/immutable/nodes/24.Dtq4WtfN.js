import{g as Vt,u as pt,a as Ut,b as qt}from"../chunks/B0wlUiUs.js";import"../chunks/NZTpNUN0.js";import{o as ht}from"../chunks/eHPvmyNl.js";import{x as P,A as bt,g as t,o as S,w as O,a as b,B as H,s as A,y as M,f as F,p,C as v,E as n,c as G,aW as $,aX as kt,z as tt}from"../chunks/CF3vMb2z.js";import{d as ot,s as q}from"../chunks/CVy4YE01.js";import{e as I,i as R}from"../chunks/zmj_gju8.js";import{c as Mt}from"../chunks/CP7f2Aqy.js";import{c as ut,d as wt,s as et,a as dt,r as _t}from"../chunks/BTYzRZWn.js";import{b as Ot,d as Ft}from"../chunks/BPdl2Dks.js";import{a as ft,s as Ct,b as yt}from"../chunks/B-vvFuWm.js";import{m as Et}from"../chunks/C36ayn6L.js";import{a as Lt}from"../chunks/CB_CnMi_.js";import{M as Nt}from"../chunks/MS_AvHm0.js";import{M as jt}from"../chunks/Yx3lJTvO.js";import{i as J}from"../chunks/DhdTNEOV.js";import{k as gt}from"../chunks/B7xIeVVZ.js";import{p as vt}from"../chunks/C5O5w8Lb.js";import{w as xt,g as It}from"../chunks/DzCuAGvq.js";import{b as Rt,g as zt}from"../chunks/C4qw-gsI.js";import{t as Jt}from"../chunks/ChAGbsig.js";import{A as Pt}from"../chunks/CVuKE_CN.js";import{U as Ht,u as Wt}from"../chunks/BH4CXN07.js";import{b as Gt}from"../chunks/Dks8XsyU.js";import{a as Kt}from"../chunks/CQaHvcsC.js";import"../chunks/BE8VNsya.js";import{p as Xt}from"../chunks/CW4eMJ4z.js";const Qt=!1,Yt=async()=>({chords:await Vt()}),hr=Object.freeze(Object.defineProperty({__proto__:null,load:Yt,ssr:Qt},Symbol.toStringTag,{value:"Module"}));var Zt=S('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1kbb9q3"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1kbb9q3">Back to top</span></button>');function $t(_,e){P(e,!0);let l=M(0),s=M(!0),f;const D=o=>{o>0?A(s,!1):A(s,!0),f&&clearTimeout(f),f=setTimeout(()=>{A(s,!0)},3e3)},k=()=>{const o=document.documentElement.scrollTop||document.body.scrollTop;o>0&&(window.requestAnimationFrame(k),window.scrollTo(0,o-o/2))};bt(()=>D(t(l)));var a=Zt();let r;a.__click=k,O(o=>r=ut(a,1,"top-link svelte-1kbb9q3",null,r,o),[()=>({hide:t(s)})]),Lt("y",()=>t(l),o=>A(l,o,!0)),b(_,a),H()}ot(["click"]);const st=xt();let St=[];const mt=localStorage.getItem("failedVisitCounts");if(mt!==null)try{St=JSON.parse(mt)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const ct=xt(St);ct.subscribe(_=>{localStorage.setItem("failedVisitCounts",JSON.stringify(_))});const Dt=_=>_==="doc"?"fas fa-file-word":_==="pdf"?"fas fa-file-pdf":_==="youtube"?"fa fa-youtube":"fas fa-link",te=async(_,e,l)=>{try{await pt(e.chord.url);const s=It(st),f=s.get(e.chord.url)||{count:0,lastAccessDateUnix:0};f.count++,f.lastAccessDateUnix=Date.now()/1e3,s.set(e.chord.url,f),st.set(s)}catch(s){let f=s.message;s instanceof Pt&&s.code===401?f="Invalid logged in user":s instanceof Ht&&(f="User is logged out"),yt(ct,[...l(),e.chord.url]);const D=`<strong>Visit not counted</strong><br/> ${f}`;Jt.push(D,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};var ee=S('<span></span> <span><a target="_blank" rel="noopener noreferrer"> </a></span>',1);function nt(_,e){P(e,!0);const[l,s]=Ct(),f=()=>ft(ct,"$failedVisitCounts",l);let D=vt(e,"showArtist",3,!1),k=M(void 0);st.subscribe(i=>{if(i&&i.has(e.chord.url)){const d=i.get(e.chord.url),y=new Date(d.lastAccessDateUnix*1e3);A(k,`visits: ${d.count} - last: ${y.toLocaleDateString()}`)}});const a=(D()?e.chord.artist+" - ":"")+e.chord.title,r=i=>i.type==="doc"?`${Rt}/docviewer/${i.url}`:i.url;var o=ee(),h=F(o),m=p(h,2),C=v(m);C.__click=[te,e,f];var u=v(C,!0);n(C),n(m),O((i,d)=>{ut(h,1,i,"svelte-1yqqigs"),et(C,"href",d),et(C,"title",t(k)),q(u,a)},[()=>wt(Dt(e.chord.type)),()=>r(e.chord)]),b(_,o),H(),s()}ot(["click"]);var re=S('<li class="ul2col-item"><!> <!></li>'),ae=S('<ul class="ul2col-container"></ul>');function se(_,e){P(e,!0);let l=vt(e,"chords",15),s=M(void 0);st.subscribe(a=>{a&&(A(s,a,!0),l(l().sort((r,o)=>{const h=a.get(r.url),m=a.get(o.url);return h&&m?m.lastAccessDateUnix-h.lastAccessDateUnix:h?-1:m?1:r.artist!=o.artist?r.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:r.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(a,r,o)=>o[a.type]===!1?!1:r.length===0||a.artist.toLowerCase().match(r.toLowerCase())?!0:a.title.toLowerCase().match(r.toLowerCase());var D=G(),k=F(D);gt(k,l,a=>{var r=ae();I(r,21,l,R,(o,h)=>{var m=G();const C=$(()=>t(s)?.get(t(h).url));var u=F(m);{var i=d=>{var y=re(),c=v(y);{var g=x=>{var L=kt();O(()=>q(L,`(${t(C).count??""})`)),b(x,L)};J(c,x=>{t(C)&&x(g)})}var w=p(c,2);nt(w,{get chord(){return t(h)},showArtist:!0}),n(y),b(d,y)};J(u,d=>{f(t(h),e.searchString,e.filters)&&d(i)})}b(o,m)}),n(r),b(a,r)}),b(_,D),H()}const oe=(_,e)=>_<e?-1:_>e?1:0,Tt=(_,e)=>{const l=_.toLowerCase(),s=e.toLowerCase();return oe(l,s)};var ne=S('<li class="navigationBtn svelte-1deg5s8"><a class="navigationLink svelte-1deg5s8"> </a></li>'),le=S('<li class="ul2col-item"><!></li>'),ie=S('<ul class="ul2col-container"></ul>'),ce=S('<tr class="svelte-1deg5s8"><td class="svelte-1deg5s8"> <!></td></tr>'),ue=S('<ol id="indexList" class="navigationBar disable-scrollbars svelte-1deg5s8"></ol> <table id="artistTable"><tbody></tbody></table>',1);function ve(_,e){P(e,!0);let l=vt(e,"searchString",3,"");const s=e.chords.reduce((c,g)=>{const w=g.artist;return c[w]||(c[w]=[]),c[w].push(g),c},{}),f=[],D=Object.keys(s).sort(Tt).map((c,g,w)=>{if(g===0||c[0].toLowerCase()!=w[g-1][0].toLowerCase()){const x="anchor_letter_"+c[0];return f.push({letter:c[0],tag:x}),{name:c,tag:x}}return{name:c}});let k=M(0),a=M(0),r=M(void 0);const o=c=>{if(t(r)){var g=t(r).getBoundingClientRect();if(g.top<20){A(a,20);return}A(a,g.top,!0)}};bt(()=>o(t(k)));const h=(c,g,w)=>s[c].sort((L,B)=>L.title<B.title?-1:1).filter(L=>{const B=L.type;return w[B]===!1?!1:g.length===0?!0:!!L.title.toLowerCase().match(g.toLowerCase())}),m=(c,g)=>!!c.toLowerCase().match(g.toLowerCase());var C=ue(),u=F(C);let i;I(u,21,()=>f,R,(c,g)=>{var w=ne(),x=v(w),L=v(x,!0);n(x),n(w),O(B=>{et(x,"href","#"+t(g).tag),q(L,B)},[()=>t(g).letter.toUpperCase()]),b(c,w)}),n(u);var d=p(u,2),y=v(d);I(y,21,()=>D,R,(c,g)=>{var w=G();const x=$(()=>h(t(g).name,l(),e.filters)),L=$(()=>m(t(g).name,l()));var B=F(w);{var N=Z=>{var W=ce();const rt=$(()=>t(L)?s[t(g).name]:t(x));var z=v(W),K=v(z),at=p(K);gt(at,l,j=>{var X=ie();I(X,21,()=>t(rt),R,(Q,lt)=>{var T=le(),V=v(T);nt(V,{get chord(){return t(lt)}}),n(T),b(Q,T)}),n(X),b(j,X)}),n(z),n(W),O(()=>{et(z,"id",t(g).tag),q(K,`${t(g).name??""} `)}),b(Z,W)};J(B,Z=>{(t(L)||t(x).length>0)&&Z(N)})}b(c,w)}),n(y),n(d),Gt(d,c=>A(r,c),()=>t(r)),O(c=>i=dt(u,"",i,c),[()=>({"--barTop":`${t(a)??""}px`})]),Lt("y",()=>t(k),c=>A(k,c,!0)),b(_,C),H()}var de=S('<li class="ul2col-item"><!></li>'),fe=S('<div><span> </span> <ul class="ul2col-container"></ul></div>');function he(_,e){P(e,!0);const l=k=>k.charAt(0).toUpperCase()+k.slice(1).toLowerCase(),s=tt({});for(const k of e.chords)k.tags.forEach(r=>{s[r]||(s[r]=[]),s[r].push(k)});Object.keys(s).forEach(k=>{s[k].sort((a,r)=>{const o=a.artist.toLowerCase(),h=r.artist.toLowerCase(),m=a.title.toLowerCase(),C=r.title.toLowerCase();return o<h?-1:o>h?1:m<C?-1:1})});var f=G(),D=F(f);I(D,17,()=>Object.keys(s).sort(Tt),R,(k,a)=>{var r=G(),o=F(r);{var h=m=>{var C=fe(),u=v(C),i=v(u,!0);n(u);var d=p(u,2);I(d,21,()=>s[t(a)],R,(y,c)=>{var g=G(),w=F(g);{var x=L=>{var B=de(),N=v(B);nt(N,{get chord(){return t(c)},showArtist:!0}),n(B),b(L,B)};J(w,L=>{e.filters[t(c).type]&&L(x)})}b(y,g)}),n(d),n(C),O(y=>q(i,y),[()=>l(t(a))]),b(m,C)};J(o,m=>{(e.searchString.length===0||t(a).toLowerCase().match(e.searchString.toLowerCase()))&&m(h)})}b(k,r)}),b(_,f),H()}var ge=S('<li class="ul2col-item"><!> <!></li>'),_e=S('<ul class="ul2col-container"></ul>');function me(_,e){P(e,!0);let l=vt(e,"chords",15),s=M(void 0);st.subscribe(a=>{a&&(A(s,a,!0),l(l().sort((r,o)=>{const h=a.get(r.url),m=a.get(o.url);return h&&m?h.count!==m.count?m.count-h.count:m.lastAccessDateUnix-h.lastAccessDateUnix:h?-1:m?1:r.artist!=o.artist?r.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:r.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(a,r,o)=>o[a.type]===!1?!1:r.length===0||a.artist.toLowerCase().match(r.toLowerCase())?!0:a.title.toLowerCase().match(r.toLowerCase());var D=G(),k=F(D);gt(k,l,a=>{var r=_e();I(r,21,l,R,(o,h)=>{var m=G();const C=$(()=>t(s)?.get(t(h).url));var u=F(m);{var i=d=>{var y=ge(),c=v(y);{var g=x=>{var L=kt();O(()=>q(L,`(${t(C).count??""})`)),b(x,L)};J(c,x=>{t(C)&&x(g)})}var w=p(c,2);nt(w,{get chord(){return t(h)},showArtist:!0}),n(y),b(d,y)};J(u,d=>{f(t(h),e.searchString,e.filters)&&d(i)})}b(o,m)}),n(r),b(a,r)}),b(_,D),H()}var pe=S('<span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-5k8p3l"> </span>',1),be=S('<div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Last Check</span> <span class="col table-head svelte-5k8p3l">Checks</span> <span class="col table-head svelte-5k8p3l">Skipped</span> <span class="col table-head svelte-5k8p3l">Errors</span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span></div> <br/> <div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Status</span> <span class="col table-head svelte-5k8p3l">Ref</span> <span class="col table-head svelte-5k8p3l">Host</span> <span class="col table-head svelte-5k8p3l">Data</span> <!></div>',1),ke=S('<p style="color: red"> </p>'),we=S("<p>Fetching results...</p>"),Ce=S('<div role="dialog" class="modal svelte-5k8p3l"><div class="contents svelte-5k8p3l"><h3 class="title-bar svelte-5k8p3l">Urls checks <button>Close</button></h3> <!></div></div>');function ye(_,e){P(e,!0);const l=a=>{const r=new Date(a.timestamp);return r.toDateString()+" "+r.toTimeString()},s=a=>a.fails.sort((r,o)=>r.chord.url<o.chord.url?-1:1);var f=G(),D=F(f);{var k=a=>{var r=Ce(),o=v(r),h=v(o),m=p(v(h));m.__click=function(...u){e.close?.apply(this,u)},n(h);var C=p(h,2);Kt(C,Ut,u=>{var i=we();b(u,i)},(u,i)=>{var d=be();const y=$(()=>l(t(i))),c=$(()=>s(t(i)));var g=F(d),w=p(v(g),8),x=v(w,!0);n(w);var L=p(w,2),B=v(L,!0);n(L);var N=p(L,2),Z=v(N,!0);n(N);var W=p(N,2),rt=v(W,!0);n(W),n(g);var z=p(g,4),K=p(v(z),8);I(K,17,()=>t(c),R,(at,j)=>{var X=pe(),Q=F(X),lt=v(Q,!0);n(Q);var T=p(Q,2),V=v(T);n(T);var U=p(T,2),E=v(U),it=v(E,!0);n(E),n(U);var Y=p(U,2),At=v(Y,!0);n(Y),O(Bt=>{q(lt,t(j).status),q(V,`${t(j).chord.artist??""} - ${t(j).chord.title??""}`),et(E,"href",t(j).chord.url),q(it,new URL(t(j).chord.url).hostname),q(At,Bt)},[()=>t(j).error?JSON.stringify(t(j).error):""]),b(at,X)}),n(z),O(()=>{q(x,t(y)),q(B,t(i).nbChecks),q(Z,t(i).nbSkipped),q(rt,t(i).nbFails)}),b(u,d)},(u,i)=>{var d=ke(),y=v(d);n(d),O(()=>q(y,`Could not retrieve checks: ${t(i).message??""}`)),b(u,d)}),n(o),n(r),b(a,r)};J(D,a=>{e.isOpen&&a(k)})}b(_,f),H()}ot(["click"]);var Le=(_,e)=>e(),xe=S('<li class="ul2col-separator"> </li>'),Se=S('<!> <li class="ul2col-item"><!></li>',1),De=S('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function Te(_,e){P(e,!0);const l=Date.now(),s=1e3*3600*24*7,f=s*4,D=[{label:"last week",time:l-s},{label:"one month ago",time:l-f},{label:"two months ago",time:l-2*f},{label:"six months ago",time:l-6*f},{label:"one year ago",time:l-12*f}],k=e.chords.filter(i=>i.creationDate).sort((i,d)=>d.creationDate-i.creationDate).map((i,d,y)=>{const c={...i};if(d>0){const g=y[d-1];for(const{time:w,label:x}of D)g.creationDate>w&&i.creationDate<w&&(c.dateTag=x)}return c});let a=6,r=M(tt([]));const o=()=>{a+=4,A(r,k.slice(0,a),!0)};ht(()=>{o()});var h=De(),m=v(h),C=p(v(m));C.__click=[Le,o],n(m);var u=p(m,2);I(u,21,()=>t(r),R,(i,d)=>{var y=Se(),c=F(y);{var g=L=>{var B=xe(),N=v(B,!0);n(B),O(()=>q(N,t(d).dateTag)),b(L,B)};J(c,L=>{t(d).dateTag&&L(g)})}var w=p(c,2),x=v(w);nt(x,{get chord(){return t(d)}}),n(w),b(i,y)}),n(u),n(h),b(_,h),H()}ot(["click"]);const Ae=(_,e,l,s,f)=>{t(e).length<=l||(t(e).splice(t(e).length-l),A(s,t(e).slice(t(e).length-l).map(D=>f.chords[D]),!0))};var Be=S("<button>&nbspâ†¶&nbsp</button>"),Ve=S('<li class="ul2col-item"><!></li>'),Ue=S('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br/> <ul class="ul2col-container"></ul></div>');function qe(_,e){P(e,!0);const l=6;let s=M(tt([])),f=M(tt([]));const D=()=>{t(s).length>=e.chords.length-l&&A(s,[],!0);for(let u=0;u<l;u++){let i=-1;for(;i===-1||t(s).includes(i);)i=Math.floor(Math.random()*e.chords.length);t(s).push(i)}A(f,t(s).slice(t(s).length-l).map(u=>e.chords[u]),!0)};ht(()=>{D()});var k=Ue(),a=v(k),r=p(v(a)),o=v(r);{var h=u=>{var i=Be();i.__click=[Ae,s,l,f,e],b(u,i)};J(o,u=>{t(s).length>l&&u(h)})}var m=p(o,2);m.__click=D,n(r),n(a);var C=p(a,4);I(C,21,()=>t(f),u=>u.url,(u,i)=>{var d=Ve(),y=v(d);nt(y,{get chord(){return t(i)},showArtist:!0}),n(d),b(u,d)}),n(C),n(k),b(_,k),H()}ot(["click"]);var Me=()=>Et.open(ye),Oe=()=>zt("/songbook/edit"),Fe=(_,e)=>A(e,""),Ee=(_,e,l)=>{t(e)[t(l)]=!t(e)[t(l)],A(e,t(e),!0)},Ne=S('<button class="filter-control svelte-1gfqv35"><input type="checkbox"/> <span></span></button>'),je=(_,e,l)=>A(e,t(l),!0),Ie=S("<button> </button>"),Re=S('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"/> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1gfqv35"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1gfqv35"></div></div> <!>',1);function gr(_,e){P(e,!0);const[l,s]=Ct(),f=()=>ft(ct,"$failedVisitCounts",l),D=()=>ft(Wt,"$user",l);Xt.set("Songbook");const{chords:k}=e.data;let a=M(tt([]));const r=T=>{t(a).push(T),A(a,t(a),!0),setTimeout(()=>{t(a).shift(),A(a,t(a),!0)},5e3)};ht(async()=>{try{if(f().length&&D()){r({level:"info",header:"Trying to count missed visits while logged out"});for(const T of f())await pt(T);r({level:"success",header:`Counted ${f().length} missed visits`}),yt(ct,[])}}catch{r({level:"error",header:"Couldnt upload failed visit counts"})}try{const V=(await qt()).reduce((U,E)=>(U.set(E.url,{...E}),U),new Map);st.set(V)}catch{r({level:"error",header:"Couldnt upload failed visit counts"})}});let o=M("");const h=[{label:"By artist",component:ve},{label:"By tags",component:he},{label:"By frequency",component:me},{label:"By access date",component:se}];let m=M(tt(h[0]));const C={pdf:!0,doc:!0,youtube:!0,link:!0};let u=M(tt({...C}));const i=Object.keys(C);var d=Re(),y=F(d);Nt(y,{title:"Song Book",description:"My song book",iconPath:"/songbook.png"});var c=p(y,2),g=v(c),w=v(g);w.__click=[Me],dt(w,"",{},{position:"relative"});var x=p(w,2);x.__click=[Oe],dt(x,"",{},{position:"relative"}),n(g),n(c);var L=p(c,2);I(L,17,()=>t(a),R,(T,V)=>{jt(T,{get item(){return t(V)}})});var B=p(L,2);$t(B,{});var N=p(B,2),Z=v(N);n(N);var W=p(N,2);Te(W,{get chords(){return k}});var rt=p(W,2);qe(rt,{get chords(){return k}});var z=p(rt,2),K=p(v(z),2);_t(K);var at=p(K,2);at.__click=[Fe,o];var j=p(at,2),X=p(v(j),2);I(X,17,()=>i,R,(T,V)=>{var U=Ne();U.__click=[Ee,u,V];var E=v(U);_t(E);var it=p(E,2);n(U),O(Y=>{et(U,"aria-label",`filter for ${t(V)??""}`),et(E,"id",t(V)),ut(it,1,Y,"svelte-1gfqv35")},[()=>wt(Dt(t(V)))]),Ft(E,()=>t(u)[t(V)],Y=>t(u)[t(V)]=Y),b(T,U)}),n(j);var Q=p(j,4);I(Q,21,()=>h,R,(T,V)=>{var U=Ie();let E;U.__click=[je,m,V];var it=v(U,!0);n(U),O(Y=>{E=ut(U,1,"control svelte-1gfqv35",null,E,Y),q(it,t(V).label)},[()=>({selected:t(m)===t(V)})]),b(T,U)}),n(Q),n(z);var lt=p(z,2);Mt(lt,()=>t(m).component,(T,V)=>{V(T,{get chords(){return k},get searchString(){return t(o)},get filters(){return t(u)}})}),O(()=>q(Z,`This is a list of ${k.length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Ot(K,()=>t(o),T=>A(o,T)),b(_,d),H(),s()}ot(["click"]);export{gr as component,hr as universal};
