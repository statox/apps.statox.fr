import"../chunks/NZTpNUN0.js";import{p as ae,h as U,a5 as Se,c as ie,f as P,a as d,d as re,b as p,e as s,s as t,r,g as e,i as C,t as te}from"../chunks/OOCdeaM4.js";import{d as ye,s as oe}from"../chunks/DBBHR-3t.js";import{a as Ae}from"../chunks/Bfiui_HV.js";import{i as T}from"../chunks/BMFH8sZT.js";import{s as ce,a as ve}from"../chunks/BY6cWyRb.js";import{m as Le}from"../chunks/Dg7M2ZgA.js";import{u as de}from"../chunks/bMdrnNxv.js";import{M as xe}from"../chunks/DKcpRBkl.js";import{c as se}from"../chunks/DPSdUY9Q.js";import{e as ke,i as We}from"../chunks/80iJqotc.js";import{r as u,a as W,s as Ee}from"../chunks/C2XHBoXy.js";import{b as ee}from"../chunks/CCHh_OeQ.js";import{b as Ie}from"../chunks/nZKWwJkn.js";import{A as He,U as Te}from"../chunks/BI4tYcJk.js";import{t as Ue}from"../chunks/Du_j8uFv.js";import{M as qe}from"../chunks/Y_imNMTD.js";import{c as Ce}from"../chunks/CVDCh7bQ.js";import{M as Ne}from"../chunks/Cb-yu7at.js";import{M as Fe}from"../chunks/jhqxLNfw.js";import{M as Oe}from"../chunks/CsU6PsM9.js";import{a as Be}from"../chunks/DTyfSRsR.js";import"../chunks/DRxGxY2p.js";import"../chunks/CD3l_Y3b.js";import{p as Re}from"../chunks/CgiMXJad.js";const Pe=!1,At=Object.freeze(Object.defineProperty({__proto__:null,ssr:Pe},Symbol.toStringTag,{value:"Module"})),ge=se.webWatcher.getAllWatchers,we=se.webWatcher.createWatcher,je=se.webWatcher.deleteWatcher,ze=se.webWatcher.toggleWatcherEnabled;var Je=p('<label for="css-selector">CSS selector</label> <input type="textarea"/>',1),Ve=p('<button class="form-action svelte-8qhbr8">Submit</button>'),Ge=p('<span class="form-action svelte-8qhbr8">Login to upload an entry</span>'),Ke=p('<div role="dialog" class="modal svelte-8qhbr8"><div class="contents svelte-8qhbr8"><h3 class="title-bar svelte-8qhbr8">Add a new watcher <button>Close</button></h3> <!> <form class="form-content svelte-8qhbr8"><label for="name">Name</label> <input type="text"/> <label for="check-interval">Check interval</label> <!> <label for="notification-message">Notification message (the @mention is automatically added)</label> <input type="textarea"/> <label for="watch-type">Watcher type</label> <select id="watch-type"><option>CSS</option><option>HASH</option></select> <label for="content">URL</label> <input type="textarea"/> <!> <br/> <!></form></div></div>');function Qe(M,a){ae(a,!0);const y=()=>ve(de,"$user",D),[D,b]=ce();let o=U(Se([])),i=U(""),f=U(""),_=U(""),x=U(""),g=U(0),v=U("CSS");const q=async()=>{C(o,[],!0),e(i)?.length||e(o).push({level:"error",header:"name must be defined"}),e(f)||e(o).push({level:"error",header:"notification message must be defined"}),e(v)==="CSS"&&!e(x)&&e(o).push({level:"error",header:"A CSS watcher must have a css selector defined"}),e(g)<15*60&&e(o).push({level:"error",header:"Check interval too small. Must be >= 15mn"});try{new URL(e(_))}catch{e(o).push({level:"error",header:"The URL is invalid"})}if(!e(o).length)try{e(v)==="CSS"?await we({name:e(i),notificationMessage:e(f),url:e(_),cssSelector:e(x),checkIntervalSeconds:e(g),watchType:e(v)}):e(v)==="HASH"&&await we({name:e(i),notificationMessage:e(f),url:e(_),checkIntervalSeconds:e(g),watchType:e(v)}),a.onUpload(),a.close()}catch(n){let c=n.message;n instanceof He&&n.code===401?c="Invalid logged in user":n instanceof Te&&(c="User is logged out");const m=`<strong>Entry not created</strong><br/> ${c}`;Ue.push(m,{theme:{"--toastBarBackground":"#FF0000"}})}};var k=ie(),j=P(k);{var w=n=>{var c=Ke(),m=s(c),S=s(m),z=t(s(S));z.__click=function(...l){a.close?.apply(this,l)},r(S);var J=t(S,2);ke(J,17,()=>e(o),We,(l,h)=>{xe(l,{get item(){return e(h)}})});var V=t(J,2),G=t(s(V),2);u(G);var N=t(G,4);qe(N,{allowedUnits:["minutes","hours","days"],defaultDuration:{value:1,unit:"hours"},get valueInSeconds(){return e(g)},set valueInSeconds(l){C(g,l,!0)}});var F=t(N,4);u(F);var A=t(F,4),L=s(A);L.value=L.__value="CSS";var K=t(L);K.value=K.__value="HASH",r(A);var O=t(A,4);u(O);var B=t(O,2);{var Q=l=>{var h=Je(),R=t(P(h),2);u(R),ee(R,()=>e(x),Z=>C(x,Z)),d(l,h)};T(B,l=>{e(v)==="CSS"&&l(Q)})}var X=t(B,4);{var le=l=>{var h=Ve();h.__click=q,d(l,h)},ne=l=>{var h=Ge();d(l,h)};T(X,l=>{y()?l(le):l(ne,!1)})}r(V),r(m),r(c),ee(G,()=>e(i),l=>C(i,l)),ee(F,()=>e(f),l=>C(f,l)),Ie(A,()=>e(v),l=>C(v,l)),ee(O,()=>e(_),l=>C(_,l)),d(n,c)};T(j,n=>{a.isOpen&&n(w)})}d(M,k),re(),b()}ye(["click"]);var Xe=p('<p class="section-3-item svelte-1e53865"><label for="css-selector">CSS selector <!></label> <input disabled type="textarea" class="svelte-1e53865"/></p>'),Ye=p('<div class="section error-section svelte-1e53865"><p class="section-4-item svelte-1e53865"><label for="last-check">Last error</label> <input disabled type="textarea" class="svelte-1e53865"/></p> <p class="section-4-item svelte-1e53865"><label for="last-update">Last error message</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div>'),Ze=p('<div class="item svelte-1e53865"><h3 class="item-title svelte-1e53865"><div class="item-name svelte-1e53865"> </div> <div class="item-actions svelte-1e53865"><!> <!></div></h3> <div class="section svelte-1e53865"><p class="section-1-item svelte-1e53865"><label for="check-interval">Check interval</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <div class="section svelte-1e53865"><p class="section-2-item svelte-1e53865"><label for="notification-message">Notification message</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <div class="section svelte-1e53865"><p class="section-3-item svelte-1e53865"><label for="content">URL</label> <a target="_blank" rel="noopener noreferrer"> </a></p> <!></div> <div class="section svelte-1e53865"><p class="section-4-item svelte-1e53865"><label for="last-check">Last check</label> <input disabled type="textarea" class="svelte-1e53865"/></p> <p class="section-4-item svelte-1e53865"><label for="last-update">Last content change</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <!> <div class="section svelte-1e53865"><p class="section-3-item svelte-1e53865"><label for="last-update">Last content</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div></div>');function $e(M,a){ae(a,!0);const y=()=>ve(de,"$user",D),[D,b]=ce(),o=Ce(),i=n=>{const c=new Date(n*1e3);return c.toLocaleDateString()+" "+c.toLocaleTimeString()},f=a.watcher.lastCheckDateUnix===0?"Never checked before":i(a.watcher.lastCheckDateUnix||0),_=a.watcher.lastUpdateDateUnix===0?"Never changed":i(a.watcher.lastUpdateDateUnix||0),x=Be.fromMillis(a.watcher.checkIntervalSeconds*1e3).rescale().toHuman(),g=async()=>{if(!a.watcher.id){console.error("id must be defined");return}try{await je({id:a.watcher.id}),o("delete")}catch(n){const c=`<strong>Watcher not deleted</strong><br/> ${n.message}`;Ue.push(c,{theme:{"--toastBarBackground":"#FF0000"}})}},v=async n=>{await ze({watcherId:a.watcher.id,setToEnabled:n.detail==="on"}),o("update")};let q=a.watcher.archivalDateUnix?"off":"on";var k=ie(),j=P(k);{var w=n=>{var c=Ze(),m=s(c),S=s(m),z=s(S,!0);r(S);var J=t(S,2),V=s(J);Oe(V,{get value(){return q},label:"Enabled",design:"slider",$$events:{change:v}});var G=t(V,2);Fe(G,{deleteAction:g}),r(J),r(m);var N=t(m,2),F=s(N),A=t(s(F),2);u(A),r(F),r(N);var L=t(N,2),K=s(L),O=t(s(K),2);u(O),r(K),r(L);var B=t(L,2),Q=s(B),X=t(s(Q),2),le=s(X,!0);r(X),r(Q);var ne=t(Q,2);{var l=E=>{var I=Xe(),H=s(I),$=t(s(H));Ne($,{get content(){return a.watcher.cssSelector}}),r(H);var Y=t(H,2);u(Y),r(I),te(()=>W(Y,a.watcher.cssSelector)),d(E,I)};T(ne,E=>{a.watcher.cssSelector&&E(l)})}r(B);var h=t(B,2),R=s(h),Z=t(s(R),2);u(Z),r(R);var he=t(R,2),ue=t(s(he),2);u(ue),r(he),r(h);var me=t(h,2);{var Me=E=>{var I=Ye(),H=s(I),$=t(s(H),2);u($),r(H);var Y=t(H,2),_e=t(s(Y),2);u(_e),r(Y),r(I),te(De=>{W($,De),W(_e,a.watcher.lastErrorMessage)},[()=>i(a.watcher.lastErrorDateUnix)]),d(E,I)};T(me,E=>{a.watcher.lastErrorDateUnix&&E(Me)})}var pe=t(me,2),fe=s(pe),be=t(s(fe),2);u(be),r(fe),r(pe),r(c),te(()=>{oe(z,a.watcher.name),W(A,x),W(O,a.watcher.notificationMessage),Ee(X,"href",a.watcher.url),oe(le,a.watcher.url),W(Z,f),W(ue,_),W(be,a.watcher.lastContent)}),d(n,c)};T(j,n=>{y()&&n(w)})}d(M,k),re(),b()}var et=p('<div class="container svelte-ihkiaa"></div>');function tt(M,a){ae(a,!0);const y=Ce(),D=(o,i)=>o.archivalDateUnix===null&&i.archivalDateUnix!==null?-1:o.archivalDateUnix!==null&&i.archivalDateUnix===null?1:i.id-o.id;var b=et();ke(b,21,()=>a.watchers.sort(D),We,(o,i)=>{$e(o,{get watcher(){return e(i)},$$events:{delete:()=>y("delete"),update:()=>y("update")}})}),r(b),d(M,b),re()}var at=p("<p>Something went wrong</p> <p> </p>",1),rt=p("<p>Loading data</p>"),st=p("<h2>Create a new watcher</h2> <button>Add an entry</button> <h2>Watchers</h2> <!>",1);function Lt(M,a){ae(a,!0);const y=()=>ve(de,"$user",D),[D,b]=ce();Re.set({name:"Web Watchers",showAuthInHeader:!0});let o=U(Se(ge()));const i=()=>C(o,ge(),!0);var f=ie(),_=P(f);{var x=v=>{var q=st(),k=t(P(q),2);k.__click=()=>Le.open(Qe,{onUpload:i});var j=t(k,4);Ae(j,()=>e(o),w=>{var n=rt();d(w,n)},(w,n)=>{tt(w,{get watchers(){return e(n)},$$events:{delete:i,update:i}})},(w,n)=>{var c=at(),m=t(P(c),2),S=s(m,!0);r(m),te(z=>oe(S,z),[()=>JSON.stringify(e(n))]),d(w,c)}),d(v,q)},g=v=>{xe(v,{item:{level:"info",header:"Login to list the watchers"}})};T(_,v=>{y()?v(x):v(g,!1)})}d(M,f),re(),b()}ye(["click"]);export{Lt as component,At as universal};
