var E=Object.defineProperty;var O=(c,i,t)=>i in c?E(c,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[i]=t;var w=(c,i,t)=>O(c,typeof i!="symbol"?i+"":i,t);import"../chunks/disclose-version.Bg9kRutz.js";import{i as T}from"../chunks/legacy.EqIdVoM0.js";import{m as M,w as z,x as S,z as b,ae as u,af as v,A as W,aW as L,v as j,aV as R,s as H,g as I,ag as q,y as D,a_ as K}from"../chunks/index-client.S3REcJgE.js";import{e as g,a as _,t as k,u as Z,c as Q}from"../chunks/template.B5pchg3w.js";import{s as U}from"../chunks/style.PwPRnE0L.js";import{c as G,o as Y}from"../chunks/store.DF07ihmy.js";import{s as J}from"../chunks/render.CF6uZz0T.js";import{t as V}from"../chunks/class.co_UInUL.js";import{p as C}from"../chunks/props.C2aoZBXh.js";import{r as X,a as $}from"../chunks/attributes.BZLGEmLx.js";import{i as F}from"../chunks/if.BYsj_AMu.js";import{P as tt}from"../chunks/P5.CIpUrZEU.js";import{T as et}from"../chunks/TapTempo.vaCicukU.js";import{M as it}from"../chunks/Main.C8YeEQ_R.js";import"../chunks/entry.WFWrpjgv.js";import{p as ot}from"../chunks/Main.svelte_svelte_type_style_lang.CsTDB6ng.js";import"../chunks/auth0-spa-js.production.esm.Dzqc2IBy.js";class st{constructor(i=80){w(this,"audioContext");w(this,"notesInQueue",[]);w(this,"currentBeatInBar");w(this,"beatsPerBar");w(this,"currentSubdivision");w(this,"subdivisionsInBeat");w(this,"tempo");w(this,"lookahead");w(this,"scheduleAheadTime");w(this,"nextNoteTime");w(this,"isRunning");w(this,"intervalID");w(this,"onBeatStart");w(this,"onBeatEnd");this.audioContext=null,this.notesInQueue=[],this.currentBeatInBar=0,this.currentSubdivision=0,this.subdivisionsInBeat=1,this.beatsPerBar=4,this.tempo=i,this.lookahead=25,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.isRunning=!1,this.intervalID=null}nextNote(){const i=60/this.subdivisionsInBeat/this.tempo;this.nextNoteTime+=i,this.currentSubdivision++,this.currentSubdivision>=this.subdivisionsInBeat&&(this.currentBeatInBar++,this.currentSubdivision=0),this.currentBeatInBar>=this.beatsPerBar&&(this.currentBeatInBar=0)}scheduleNote(i,t,s){if(!this.audioContext)return;this.notesInQueue.push({note:i,time:s});const o=this.audioContext.createOscillator(),n=this.audioContext.createGain(),r=1e3,h=400,m=200;t!==0?o.frequency.value=m:i%this.beatsPerBar===0?o.frequency.value=r:o.frequency.value=h,n.gain.value=1,n.gain.exponentialRampToValueAtTime(1,s+.001),n.gain.exponentialRampToValueAtTime(.001,s+.02),o.connect(n),n.connect(this.audioContext.destination);const l=this.audioContext.createConstantSource();l.onended=()=>{var a;(a=this.onBeatStart)==null||a.call(this,i,t),o.start(),o.stop(s+.03),o.onended=()=>{var d;(d=this.onBeatEnd)==null||d.call(this)}},l.start(s),l.stop(this.audioContext.currentTime+1e-4)}scheduler(){if(this.audioContext)for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;)this.scheduleNote(this.currentBeatInBar,this.currentSubdivision,this.nextNoteTime),this.nextNote()}start(){this.isRunning||(this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.isRunning=!0,this.currentBeatInBar=0,this.currentSubdivision=0,this.nextNoteTime=this.audioContext.currentTime+.05,this.intervalID=setInterval(()=>this.scheduler(),this.lookahead))}stop(){this.isRunning=!1,this.intervalID&&clearInterval(this.intervalID)}startStop(){this.isRunning?this.stop():this.start()}}var nt=k('<div class="controls-container svelte-14nipte"><div class="controls-sub-container svelte-14nipte"><label for="beatsInBar"><h4>Beats in bar</h4></label> <div class="subdivisions-container svelte-14nipte"><button>-1</button> <span style="font-size: large; margin-left: 1em; margin-right: 1em"> </span> <button>+1</button></div></div> <br> <div class="controls-sub-container svelte-14nipte"><label for="subdivisionsInBeat"><h4>Subdivisions in beat</h4></label> <div class="subdivisions-container svelte-14nipte"><button class="svelte-14nipte"><svg width="15" height="15" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 15px; height: auto;"><path d="M 4.3 0 v 9.6 A 2.9 2.9 0 0 0 0 12.1 A 3 3 0 0 0 3 15 c 1.5 0 2.8 -1.3 2.8 -2.9 V 3 V 0 H 4.3 Z"></path></svg></button> <button class="svelte-14nipte"><svg width="15" height="15" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 15px; height: auto;"><path d="M4.3 0v9.6A2.9 2.9 0 0 0 0 12.1 3 3 0 0 0 3 15c1.5 0 2.8-1.3 2.8-2.9V3h7.7v6.6a2.9 2.9 0 0 0-4.3 2.5 2.9 2.9 0 0 0 5.8 0V0H4.3Z"></path></svg></button> <button class="svelte-14nipte"><svg width="24" height="21" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 24px; height: auto; top: -3px;"><path clip-rule="evenodd" d="M4.3 15.6V6H24v12.1a3 3 0 0 1-3 2.9 2.9 2.9 0 0 1-2.8-2.9 2.9 2.9 0 0 1 4.3-2.5V9H15v9.1a2.9 2.9 0 0 1-3 2.9 3 3 0 0 1-3-2.9 2.9 2.9 0 0 1 3-2.8c.5 0 1 0 1.3.3V9H5.8v9.1C5.8 19.7 4.5 21 3 21a3 3 0 0 1-3-2.9 2.9 2.9 0 0 1 4.3-2.5Z"></path><path d="M12.6 2.2 13.9.5V0h-3.1v.4h2.5l-1.4 1.7v.4h.4c.9 0 1.3.4 1.3 1s-.4 1-1.2 1c-.7 0-1.3-.3-1.6-.6l-.2.4c.4.4 1 .6 1.8.6 1.1 0 1.7-.6 1.7-1.4 0-.8-.5-1.3-1.5-1.4Z"></path></svg></button> <button class="svelte-14nipte"><svg width="27" height="13" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 27px; height: auto;"><path clip-rule="evenodd" d="M3.5 0v7.9a2 2 0 0 0-1.1-.3C1 7.6 0 8.6 0 9.9c0 1.3 1 2.4 2.4 2.4 1.3 0 2.3-1 2.3-2.4V3.4H11V8a2 2 0 0 0-1.1-.3 2.3 2.3 0 1 0 0 4.7c1.3 0 2.4-1 2.4-2.4V3.4h6.1V8a2.4 2.4 0 0 0-1-.3c-1.4 0-2.5 1-2.5 2.3 0 1.3 1.1 2.4 2.4 2.4 1.3 0 2.4-1 2.4-2.4V3.4h6.2V8l-1.2-.3c-1.3 0-2.3 1-2.3 2.3a2.3 2.3 0 1 0 4.7 0V0H3.5Zm7.4 2.7H4.7V1.5H11v1.2Zm7.4 0h-6.1V1.5h6.1v1.2Zm1.3 0h6.2V1.5h-6.2v1.2Z"></path></svg></button></div></div></div>');function at(c,i){M(i,!1);let t=C(i,"metronome",12);T();var s=nt(),o=u(s),n=b(u(o),2),r=u(n),h=b(r,2),m=u(h,!0);v(h);var l=b(h,2);v(n),v(o);var a=b(o,4),d=b(u(a),2),p=u(d),x=b(p,2),e=b(x,2),f=b(e,2);v(d),v(a),v(s),z(()=>{J(m,t().beatsPerBar),V(p,"selected",t().subdivisionsInBeat===1),V(x,"selected",t().subdivisionsInBeat===2),V(e,"selected",t().subdivisionsInBeat===3),V(f,"selected",t().subdivisionsInBeat===4)}),g("click",r,()=>t(t().beatsPerBar=Math.max(t().beatsPerBar-1,1),!0)),g("click",l,()=>t(t().beatsPerBar=Math.min(t().beatsPerBar+1,10),!0)),g("click",p,()=>t(t().subdivisionsInBeat=1,!0)),g("click",x,()=>t(t().subdivisionsInBeat=2,!0)),g("click",e,()=>t(t().subdivisionsInBeat=3,!0)),g("click",f,()=>t(t().subdivisionsInBeat=4,!0)),_(c,s),S()}var rt=k('<div class="tempo-container svelte-oae4co"><div class="tempo-less svelte-oae4co"><button>-5</button> <button>-1</button></div> <div class="tempo-value svelte-oae4co" style="font-size: x-large"><input style="font-size: x-large; margin-right: 0.1em;" type="number" min="1" max="400"> BPM</div> <div class="tempo-more svelte-oae4co"><button>+1</button> <button>+5</button></div></div>');function lt(c,i){M(i,!1);let t=C(i,"metronome",12);const s=x=>{if(!x||!x.target)return;const e=x.target,f=Number(e.value);!f||f<1||t(t().tempo=f,!0)};T();var o=rt(),n=u(o),r=u(n),h=b(r,2);v(n);var m=b(n,2),l=u(m);X(l),W(),v(m);var a=b(m,2),d=u(a),p=b(d,2);v(a),v(o),z(()=>$(l,t().tempo)),g("click",r,()=>t(t().tempo=Number(t().tempo)-5,!0)),g("click",h,()=>t(t().tempo=Number(t().tempo)-1,!0)),g("change",l,s),g("click",d,()=>t(t().tempo=Number(t().tempo)+1,!0)),g("click",p,()=>t(t().tempo=Number(t().tempo)+5,!0)),_(c,o),S()}var ut=Z('<svg width="20" height="20" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: auto;"><path d="M 0 0 V 20 L 6 20 L 6 0 L 0 0 M 9 0 V 20 H 15 V 0 H 9"></path></svg>'),vt=Z('<svg width="20" height="20" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: auto;"><path d="M 0 0 V 20 L 17 10"></path></svg>'),dt=k('<div class="controls-container svelte-1jo8tk4"><button style="min-width: 300px"><!></button></div>');function ht(c,i){M(i,!1);let t=C(i,"metronome",12);const s=()=>{t().startStop(),t(t())},o=a=>{const d=" ";if([d].includes(a.key)&&(a.preventDefault(),a.key===d)){s();return}};T();var n=dt();g("keydown",L,o);var r=u(n),h=u(r);{var m=a=>{var d=ut();_(a,d)},l=a=>{var d=vt();_(a,d)};F(h,a=>{t().isRunning?a(m):a(l,!1)})}v(r),v(n),g("click",r,s),_(c,n),S()}var ct=k('<div id="canvas-container" class="d-flex justify-content-center"><!></div>');function mt(c,i){M(i,!1);let t=C(i,"metronome",12),s=!1,o=0,n=0;const r=(e,f)=>{s=!0,o=e,n=f},h=()=>{s=!1};let m,l="white",a="white";const d=e=>{e.setup=()=>{m=e,e.createCanvas(600,300),e.textSize(40)},e.draw=()=>{const f=document.getElementById("canvas-container");if(f){const y=(f==null?void 0:f.clientWidth)||600;e.width!==y&&e.resizeCanvas(y,Math.max(y/3,100))}e.clear(),e.stroke(l);const B=Math.min(e.width/t().beatsPerBar,e.height),P=e.height/t().subdivisionsInBeat;for(let y=0;y<t().beatsPerBar;y++){y===o?e.strokeWeight(5):e.strokeWeight(1),e.noFill(),e.circle(y*B+B/2,e.height/2,B*.9),e.strokeWeight(1);for(let A=0;A<t().subdivisionsInBeat;A++)s&&y===o&&A===n?e.fill(l):e.noFill(),e.circle(y*B+B/2,A*P+P/2,B/t().subdivisionsInBeat*.9)}s?e.fill(a):e.fill(l),e.fill(l);const N=(o+1).toString();e.text(N,o*B+B/2-e.textWidth(N)/2,e.height/2+e.textSize()/2)}};j(()=>{const e=getComputedStyle(document.body);l=e.getPropertyValue("--nc-tx-3"),a=e.getPropertyValue("--nc-tx-2"),t(t().onBeatStart=r,!0),t(t().onBeatEnd=h,!0)}),R(()=>{m==null||m.remove()}),T();var p=ct(),x=u(p);tt(x,{sketch:d}),v(p),_(c,p),S()}var bt=k('<div class="controls-container svelte-1gwle9f"><button class="svelte-1gwle9f">Tap</button></div>');function pt(c,i){M(i,!1);let t=C(i,"onNewBPM",8),s=new et,o=q(!1);const n=()=>{s.addBeat(),H(o,!0),setTimeout(()=>H(o,!1),100),s.bpm>0&&t()(Math.ceil(s.bpm))};T();var r=bt(),h=u(r);v(r),z(()=>V(h,"taped",I(o))),g("click",h,n),_(c,r),S()}var gt=k(`<div role="dialog" class="modal svelte-5yv1o0"><div class="contents svelte-5yv1o0"><h4 class="title-bar svelte-5yv1o0">Metronome <button>Close</button></h4> <div>This is a simple metronome: <ul><li>Use the play/pause button or the space bar to start and stop the metronome</li> <li>You can change the tempo by:</li> <ul><li>Entering a number directly in the input</li> <li>Using the -5, -1, +1 and +5 buttons</li> <li>Taping a tempo on the tap button. When taping the tempo each tap counts
                            for a subdivision if subdivisions are enabled. Stop taping for approx. 3
                            seconds to restart the tap counter.</li></ul> <li>The "Beats in bar" setting change the number of beats counted by the
                        metronome. The first beat is accented with a higher frequency tone.</li> <li>The "Subdivisions in beat" setting allow to change how the beats are
                        divided. The subdivisions after the first one are played with a lower
                        frequency tone.</li> <li>The visualization at the bottom follow the beats and their subdivisions.</li></ul></div> <br> <h5>Bugs</h5> <ul><li>While it goes against my opinion on what the web should look like, this page
                    works better with Chrome-based browsers.</li> <li>For some reason the display of the tempo settings is broken on Firefox, the
                    input doesn't resize properly.</li> <li>The sound doesn't work on Safari on iOS (and maybe on MacOS too).</li></ul></div></div>`);function ft(c,i){let t=C(i,"isOpen",8);var s=Q(),o=D(s);{var n=r=>{var h=gt(),m=u(h),l=u(m),a=b(u(l));v(l),W(8),v(m),v(h),g("click",a,function(...d){var p;(p=G)==null||p.apply(this,d)}),_(r,h)};F(o,r=>{t()&&r(n)})}_(c,s)}var wt=k('<!> <div class="main svelte-1kxlsex"><h3>Metronome <span><button><i class="fa fa-info-circle" aria-hidden="true"></i></button></span></h3> <div><!></div> <div class="section svelte-1kxlsex"><!> <!></div> <div class="section svelte-1kxlsex"><!></div> <div class="section svelte-1kxlsex"><!></div></div>',1);function qt(c,i){M(i,!1),ot.set("Metronome");let t=q(new st(80));R(()=>{I(t).stop()}),T();var s=wt(),o=D(s);it(o,{title:"Metronome",description:"Metronome"});var n=b(o,2),r=u(n),h=b(u(r)),m=u(h);U(m,"position","relative"),v(h),v(r);var l=b(r,2),a=u(l);ht(a,{get metronome(){return I(t)}}),v(l);var d=b(l,2),p=u(d);lt(p,{get metronome(){return I(t)}});var x=b(p,2);pt(x,{onNewBPM:N=>{K(t,I(t).tempo=N/I(t).subdivisionsInBeat),H(t,I(t))}}),v(d);var e=b(d,2),f=u(e);at(f,{get metronome(){return I(t)}}),v(e);var B=b(e,2),P=u(B);mt(P,{get metronome(){return I(t)}}),v(B),v(n),g("click",m,()=>Y(ft)),_(c,s),S()}export{qt as component};
