import"../chunks/NZTpNUN0.js";import{o as K}from"../chunks/SweRCpJo.js";import{z as C,A as B,B as Q,c as L,f as A,a as d,E as P,p as y,F as u,v as c,G as f,g as e,s as T,aZ as H,x as R}from"../chunks/Br9SMxIB.js";import{d as N,s as I}from"../chunks/BBzb7ThI.js";import{i as $}from"../chunks/CvXxFVm9.js";import{s as S,a as V}from"../chunks/Bpxd_8Tl.js";import{m as X}from"../chunks/B81YP0Pw.js";import{u as q,U as Y}from"../chunks/DVsMBKDa.js";import{M as z}from"../chunks/BhRFzXHd.js";import{e as W,i as Z}from"../chunks/D1-nhZYT.js";import{r as ee}from"../chunks/DWdbj9D8.js";import{b as te}from"../chunks/C6S4cPPP.js";import{r as re,a as ae,A as oe}from"../chunks/u8dOzccW.js";import{t as se}from"../chunks/D-rGHmBV.js";import{D as j}from"../chunks/DTyfSRsR.js";import{a as ne}from"../chunks/WbxJrN1C.js";const ie=async n=>ae({path:"/personalTracker/upload",data:{event:n}}),O=async()=>{const{events:n}=await re({path:"/personalTracker/getAll",authorize:!0});return n},ve=async(n,t,i,p)=>{if(T(t,[],!0),e(i)!==Number(e(i).toFixed(1))&&e(t).push({level:"error",header:"Value have at most 1 number after the comma"}),(e(i)<80||e(i)>110)&&e(t).push({level:"error",header:"Value must be in kg"}),e(t).length)return;const g=j.now().toUTC().toUnixInteger();try{await ie({timestampUTC:g,type:"weight",value:Math.floor(e(i)*100)}),p.onUpload(),p.close()}catch(o){let v=o.message;o instanceof oe&&o.code===401?v="Invalid logged in user":o instanceof Y&&(v="User is logged out");const m=`<strong>Entry not created</strong><br/> ${v}`;se.push(m,{theme:{"--toastBarBackground":"#FF0000"}})}};var le=y('<button class="form-action svelte-3t0xi3">Submit</button>'),de=y('<span class="form-action svelte-3t0xi3">Login to upload an entry</span>'),me=y('<div role="dialog" class="modal svelte-3t0xi3"><div class="contents svelte-3t0xi3"><h4 class="title-bar svelte-3t0xi3">Add a new event <button>Close</button></h4> <!> <form class="form-content svelte-3t0xi3"><label for="weight">Weight</label> <input type="number" step="0.1"/> <br/> <!></form></div></div>');function ce(n,t){C(t,!0);const i=()=>V(q,"$user",p),[p,g]=S();let o=B(Q([])),v=B(0);var m=L(),h=A(m);{var x=b=>{var r=me(),l=u(r),s=u(l),U=c(u(s));U.__click=function(...a){t.close?.apply(this,a)},f(s);var k=c(s,2);W(k,17,()=>e(o),Z,(a,_)=>{z(a,{get item(){return e(_)}})});var w=c(k,2),E=c(u(w),2);ee(E);var D=c(E,4);{var F=a=>{var _=le();_.__click=[ve,o,v,t],d(a,_)},M=a=>{var _=de();d(a,_)};$(D,a=>{i()?a(F):a(M,!1)})}f(w),f(l),f(r),te(E,()=>e(v),a=>T(v,a)),d(b,r)};$(h,b=>{t.isOpen&&b(x)})}d(n,m),P(),g()}N(["click"]);var ue=y('<div class="event svelte-cyscl8"><div class="event-date"> </div> <div class="event-type"> </div> <div class="event-value"> </div></div>'),fe=y('<div class="event svelte-cyscl8"><div>Date</div> <div>Type</div> <div>Value</div></div> <!>',1),pe=y("<p>Loading events</p>");function _e(n,t){C(t,!0);const i=()=>V(q,"$user",p),[p,g]=S();var o=L(),v=A(o);{var m=h=>{var x=L(),b=A(x);ne(b,()=>t.events,r=>{var l=pe();d(r,l)},(r,l)=>{var s=fe(),U=c(A(s),2);W(U,17,()=>e(l),Z,(k,w)=>{const E=H(()=>j.fromSeconds(e(w).eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm"));var D=ue(),F=u(D),M=u(F,!0);f(F);var a=c(F,2),_=u(a,!0);f(a);var G=c(a,2),J=u(G,!0);f(G),f(D),R(()=>{I(M,e(E)),I(_,e(w).type),I(J,e(w).value)}),d(k,D)}),d(r,s)},(r,l)=>{{let s=H(()=>({level:"error",header:"Something went wrong getting events",message:e(l)}));z(r,{get item(){return e(s)}})}}),d(h,x)};$(v,h=>{i()&&t.events&&h(m)})}d(n,o),P(),g()}var ge=(n,t)=>X.open(ce,{onUpload:t}),he=y("<div><button>Add an entry</button></div> <!>",1);function Ce(n,t){C(t,!0);const i=()=>V(q,"$user",p),[p,g]=S();let o=B(void 0);const v=()=>T(o,O(),!0);K(()=>T(o,O(),!0));var m=L(),h=A(m);{var x=r=>{var l=he(),s=A(l),U=u(s);U.__click=[ge,v],f(s);var k=c(s,2);_e(k,{get events(){return e(o)}}),d(r,l)},b=r=>{z(r,{item:{level:"info",header:"Login to add an entry or see events"}})};$(h,r=>{i()?r(x):r(b,!1)})}d(n,m),P(),g()}N(["click"]);export{Ce as component};
