import"../chunks/NZTpNUN0.js";import{a as it}from"../chunks/DnIoD-SE.js";import{p as st,f as d,s as o,a as lt,d as G,r as N,g as a,b,c as r,t as D}from"../chunks/BTM_f0C0.js";import{s as q}from"../chunks/DjCmUVr5.js";import{i as v}from"../chunks/D_G27x0v.js";import{f as m,a as s,c as V,t as Y}from"../chunks/g3ICtxBO.js";import{r as pt}from"../chunks/DbSpTE_I.js";import{d as vt}from"../chunks/fpD4cHwH.js";import{b as _t}from"../chunks/BekeXsjs.js";import{B as O,a as j}from"../chunks/bay67SBi.js";import{P as mt}from"../chunks/CpX8xF_L.js";import{r as gt}from"../chunks/BQcXWaIU.js";import{g as ct}from"../chunks/BUlStzOB.js";var ft=m('<button>Start a new game</button> <br/> <input type="string"/> <button>Join Game</button>',1),ut=m("<p>Connecting to the server…</p>"),dt=m("<p>Waiting for an opponent to connect…</p>"),bt=m("<p> </p> <!>",1),yt=m("<p>Something went wrong. Board is not defined.</p>"),wt=m('<p>Game over</p> <button>Restart</button> <span style="font-weight: bold"><!></span> <!>',1),St=m("<p>Disconnected</p>"),ht=m("<h3>Online game <button>Back</button></h3> <!> <!> <!> <!> <!> <!>",1);function Jt(z,F){st(F,!0);let n,x=b(null),g=b(null),c=b(null),S=b(null),l=b("initial"),h=b("");const H=async()=>{const t=await gt({path:"/gravitrips/getNewGame"});r(h,t.gameId,!0),B()},K=mt.replace(/^http?/,"ws");it(()=>{n&&n.close()});const B=()=>{n=new WebSocket(K+"/gravitrips/ws?"+a(h)),r(l,"connecting"),r(g,null),r(c,null),r(S,null),n.onopen=()=>{r(l,"waiting_for_opponent")},n.onclose=t=>{console.log(t.reason),r(l,"disconnected")},n.onmessage=t=>{const e=JSON.parse(t.data);e.type==="game_ready"?(r(l,"playing"),r(x,e.youAre,!0),r(g,e.board,!0)):e.type==="update_board"?(r(g,e.board,!0),r(c,e.boardState,!0),r(S,e.winningCells,!0)):e.type==="waiting_for_opponent"?r(c,null):e.type==="game_over"&&r(l,"game_over")}},I=t=>{if(!n||n.readyState!==WebSocket.OPEN)return;const e=JSON.stringify({type:"move",column:t});n.send(e)},Q=()=>{if(!n||n.readyState!==WebSocket.OPEN)return;const t=JSON.stringify({type:"restart"});n.send(t)};var W=ht(),P=d(W),T=o(G(P));T.__click=()=>ct("/gravitrips"),N(P);var A=o(P,2);{var X=t=>{var e=ft(),f=d(e);f.__click=H;var _=o(f,4);pt(_);var y=o(_,2);y.__click=B,_t(_,()=>a(h),p=>r(h,p)),s(t,e)};v(A,t=>{["initial","waiting_for_opponent","game_over","disconnected"].includes(a(l))&&t(X)})}var E=o(A,2);{var Z=t=>{var e=ut();s(t,e)};v(E,t=>{a(l)==="connecting"&&t(Z)})}var J=o(E,2);{var $=t=>{var e=dt();s(t,e)};v(J,t=>{a(l)==="waiting_for_opponent"&&t($)})}var L=o(J,2);{var tt=t=>{var e=V(),f=d(e);{var _=p=>{var u=bt(),w=d(u),C=G(w);N(w);var i=o(w,2);j(i,{nbColumns:7,nbRows:6,get board(){return a(g)},get winningCells(){return a(S)},onMove:I}),D(()=>q(C,`You are Player ${a(x)??""}`)),s(p,u)},y=p=>{var u=yt();s(p,u)};v(f,p=>{a(g)!==null?p(_):p(y,!1)})}s(t,e)};v(L,t=>{a(l)==="playing"&&t(tt)})}var M=o(L,2);{var et=t=>{var e=wt(),f=o(d(e),2);f.__click=Q;var _=o(f,2),y=G(_);{var p=i=>{var k=Y("Game Over");s(i,k)},u=i=>{var k=V(),ot=d(k);{var nt=R=>{var U=Y();D(()=>q(U,`Player ${a(c)??""} wins`)),s(R,U)};v(ot,R=>{(a(c)===O.winPlayer1||a(c)===O.winPlayer2)&&R(nt)},!0)}s(i,k)};v(y,i=>{a(c)===O.draw?i(p):i(u,!1)})}N(_);var w=o(_,2);{var C=i=>{j(i,{nbColumns:7,nbRows:6,get board(){return a(g)},get winningCells(){return a(S)},onMove:I})};v(w,i=>{a(g)!==null&&i(C)})}s(t,e)};v(M,t=>{a(l)==="game_over"&&t(et)})}var at=o(M,2);{var rt=t=>{var e=St();s(t,e)};v(at,t=>{a(l)==="disconnected"&&t(rt)})}s(z,W),lt()}vt(["click"]);export{Jt as component};
