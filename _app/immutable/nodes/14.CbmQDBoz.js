import"../chunks/disclose-version.Bg9kRutz.js";import{i as Z}from"../chunks/legacy.EqIdVoM0.js";import{m as ee,ah as me,ai as fe,y as j,z as s,ae as m,af as i,g as e,w as N,s as M,x as ae,ag as U,B as ve,aI as pe,a_ as de}from"../chunks/index-client.S3REcJgE.js";import{s as J}from"../chunks/render.CF6uZz0T.js";import{a as ue}from"../chunks/await.BGm15oIX.js";import{i as D}from"../chunks/if.BYsj_AMu.js";import{a as n,e as I,t as f,c as ge}from"../chunks/template.B5pchg3w.js";import{s as oe,a as se}from"../chunks/store.BAWuPd1l.js";import{c as te,o as _e}from"../chunks/store.DF07ihmy.js";import{g as be,M as ie,u as ne,U as he}from"../chunks/Main.Bhdrm3q8.js";import{M as ye}from"../chunks/Main.C8YeEQ_R.js";import{P as z}from"../chunks/public.xpUinP6t.js";import{r as we,A as ke}from"../chunks/index.D6U8kpiJ.js";import{s as xe}from"../chunks/client.C7CA8vGh.js";import{e as K,i as Q}from"../chunks/each.Nz7c8l4p.js";import{r as W,s as B}from"../chunks/attributes.BZLGEmLx.js";import{b as X,a as Ue}from"../chunks/input.DW_zkP8F.js";import{p as Y}from"../chunks/props.C2aoZBXh.js";import{t as le}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.NDn5vnUv.js";import{b as Se}from"../chunks/this.BRzA9BlG.js";import"../chunks/entry.WFWrpjgv.js";import{p as Te}from"../chunks/Main.svelte_svelte_type_style_lang.CsTDB6ng.js";const Le=!1,va=Object.freeze(Object.defineProperty({__proto__:null,ssr:Le},Symbol.toStringTag,{value:"Module"})),re=()=>we({path:"/reactor/getEntriesForPublic"}),Me=async w=>{const g=z+"/reactor/addEntry",_=await be();typeof _=="string"&&await xe.post(g).auth(_,{type:"bearer"}).field("name",w.name).field("commaSeparatedTags",w.commaSeparatedTags).attach("file",w.file)};var $e=f('<span class="tag svelte-16m67n3"> </span>'),Ce=f('<video class="medium-margin svelte-16m67n3" style="max-width: 100%" controls></video>',2),Ae=f('<img class="medium-margin svelte-16m67n3">'),Pe=f('<div><div><b> </b></div> <div class="svelte-16m67n3"></div> <div><button class="full-width svelte-16m67n3"><i class="fas fa-copy"></i> Copy link</button></div></div> <div><a rel="noopener noreferrer" target="blank"><!></a></div>',1),Re=f('<button class="full-width medium-margin svelte-16m67n3">More...</button>'),Ee=f('<input class="full-width medium-margin svelte-16m67n3" type="text" placeholder="Search by tags or name"> <div class="container svelte-16m67n3"></div> <!>',1);function Fe(w,g){ee(g,!1);let _=Y(g,"reactions",8);const A=10;let S=U(1),$=U([]),b=U("");const h=(r,a)=>{if(!a.length||r.name.toLowerCase().includes(a.toLowerCase()))return!0;for(const l of r.tags)if(l.toLowerCase().includes(a.toLowerCase()))return!0;return!1},k=r=>{navigator.clipboard.writeText(z+r.uri),le.push('<i class="fas fa-check"></i> Link copied to clipboard',{duration:1e3,theme:{"--toastBarHeight":0}})},T=r=>r.s3PresignedUrl.includes(".mp4");me(()=>(ve(_()),e(b),e(S)),()=>{M($,_().filter(r=>h(r,e(b))).sort((r,a)=>a.creationDateUnix-r.creationDateUnix).slice(0,e(b).length?void 0:e(S)*A))}),fe(),Z();var x=Ee(),u=j(x);W(u);var C=s(u,2);K(C,5,()=>e($),Q,(r,a)=>{var p=Pe(),l=j(p),d=m(l),P=m(d),V=m(P,!0);i(P),i(d);var R=s(d,2);K(R,5,()=>e(a).tags,Q,(y,t)=>{var c=$e(),ce=m(c,!0);i(c),N(()=>J(ce,e(t))),n(y,c)}),i(R);var E=s(R,2),O=m(E);i(E),i(l);var F=s(l,2),L=m(F),q=m(L);{var G=y=>{var t=Ce();N(()=>B(t,"src",z+e(a).uri)),n(y,t)},H=y=>{var t=Ae();N(()=>{B(t,"src",z+e(a).uri),B(t,"alt",e(a).name)}),n(y,t)};D(q,y=>{T(e(a))?y(G):y(H,!1)})}i(L),i(F),N(()=>{J(V,e(a).name),B(L,"href",z+e(a).uri),B(L,"download",e(a).name)}),I("click",O,()=>k(e(a))),n(r,p)}),i(C);var o=s(C,2);{var v=r=>{var a=Re();I("click",a,()=>pe(S)),n(r,a)};D(o,r=>{e(b).length===0&&e(S)*A<_().length&&r(v)})}X(u,()=>e(b),r=>M(b,r)),n(w,x),ae()}var Ie=f('<button class="form-action svelte-1f930i6">Submit</button>'),Oe=f('<span class="form-action svelte-1f930i6">Login to upload an entry</span>'),Be=f('<div role="dialog" class="modal svelte-1f930i6"><div class="contents svelte-1f930i6"><h4 class="title-bar svelte-1f930i6">Add a new file <button>Close</button></h4> <!> <form class="form-content svelte-1f930i6"><label for="name">Name</label> <input type="text"> <label for="content">Tags</label> <input type="textarea"> <label for="file">File</label> <span><input class="file-input svelte-1f930i6" type="file"> <button><i class="fas fa-times-circle"></i></button></span> <br> <!></form></div></div>');function Ne(w,g){ee(g,!1);const[_,A]=oe(),S=()=>se(ne,"$user",_);let $=Y(g,"isOpen",8),b=Y(g,"onUpload",8),h=U([]),k=U(),T=U(""),x=U(),u=U();const C=async()=>{var p;M(h,[]),(p=e(k))!=null&&p.length||e(h).push({level:"error",header:"name must be defined"});let a;if(e(u)&&e(u).length&&(a=e(u)[0]),a||e(h).push({level:"error",header:"a file must be uploaded"}),!(e(h).length||!a))try{await Me({name:e(k),commaSeparatedTags:e(T),file:a}),b()(),te()}catch(l){let d=l.message;l instanceof ke&&l.code===401?d="Invalid logged in user":l instanceof he&&(d="User is logged out");const P=`<strong>Entry not created</strong><br/> ${d}`;le.push(P,{theme:{"--toastBarBackground":"#FF0000"}})}};Z();var o=ge(),v=j(o);{var r=a=>{var p=Be(),l=m(p),d=m(l),P=s(m(d));i(d);var V=s(d,2);K(V,1,()=>e(h),Q,(t,c)=>{ie(t,{get item(){return e(c)}})});var R=s(V,2),E=s(m(R),2);W(E);var O=s(E,4);W(O);var F=s(O,4),L=m(F);Se(L,t=>M(x,t),()=>e(x));var q=s(L,2);i(F);var G=s(F,4);{var H=t=>{var c=Ie();I("click",c,C),n(t,c)},y=t=>{var c=Oe();n(t,c)};D(G,t=>{S()?t(H):t(y,!1)})}i(R),i(l),i(p),I("click",P,function(...t){var c;(c=te)==null||c.apply(this,t)}),X(E,()=>e(k),t=>M(k,t)),X(O,()=>e(T),t=>M(T,t)),Ue(L,()=>e(u),t=>M(u,t)),I("click",q,()=>{de(x,e(x).value="")}),n(a,p)};D(v,a=>{$()&&a(r)})}n(w,o),ae(),A()}var ze=f("<button>Add an entry</button>"),je=f("<p>Something went wrong</p> <p> </p>",1),De=f("<p>Loading data</p>"),Ve=f("<!> <h2>Upload</h2> <!> <h2>Content</h2> <!>",1);function pa(w,g){ee(g,!1);const[_,A]=oe(),S=()=>se(ne,"$user",_);Te.set("Reactor");let $=U(re());const b=()=>M($,re());Z();var h=Ve(),k=j(h);ye(k,{title:"Reactor",description:"My collection of memes"});var T=s(k,4);{var x=o=>{var v=ze();I("click",v,()=>_e(Ne,{onUpload:b})),n(o,v)},u=o=>{ie(o,{item:{level:"info",header:"Login to add an entry"}})};D(T,o=>{S()?o(x):o(u,!1)})}var C=s(T,4);ue(C,()=>e($),o=>{var v=De();n(o,v)},(o,v)=>{Fe(o,{get reactions(){return e(v)}})},(o,v)=>{var r=je(),a=s(j(r),2),p=m(a,!0);N(()=>J(p,JSON.stringify(e(v)))),i(a),n(o,r)}),n(w,h),ae(),A()}export{pa as component,va as universal};
