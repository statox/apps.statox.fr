import"../chunks/NZTpNUN0.js";import{o as Q}from"../chunks/C8sgD566.js";import{p as S,e as P,a8 as R,c as T,f as x,a as v,d as V,b as _,i as u,s as m,r as f,g as e,h as $,j,t as X}from"../chunks/BjuhH6lp.js";import{d as N,s as I}from"../chunks/BHQPUIUI.js";import{i as F}from"../chunks/Cw8fytvj.js";import{a as q,s as B}from"../chunks/u5ZAmcyg.js";import{m as Y}from"../chunks/BqWwabYr.js";import{u as H}from"../chunks/mcDMfexu.js";import{M as O}from"../chunks/DaF2b9q9.js";import{e as W,i as z}from"../chunks/CLKJSt8A.js";import{r as Z}from"../chunks/DEs50KOR.js";import{b as ee}from"../chunks/BszEGJcu.js";import{r as te,a as ae,A as re,U as se}from"../chunks/Cp0cevRc.js";import{t as oe}from"../chunks/Djhp2DQ4.js";import{D as J}from"../chunks/DTyfSRsR.js";import{a as ne}from"../chunks/m6IlzdLY.js";const ie=async l=>ae({path:"/personalTracker/upload",data:{event:l},isUnauthenticatedCall:!0}),G=async()=>{const{events:l}=await te({path:"/personalTracker/getAll"});return l};var ve=_('<button class="form-action svelte-3t0xi3">Submit</button>'),le=_('<span class="form-action svelte-3t0xi3">Login to upload an entry</span>'),de=_('<div role="dialog" class="modal svelte-3t0xi3"><div class="contents svelte-3t0xi3"><h4 class="title-bar svelte-3t0xi3">Add a new event <button>Close</button></h4> <!> <form class="form-content svelte-3t0xi3"><label for="weight">Weight</label> <input type="number" step="0.1"/> <br/> <!></form></div></div>');function ce(l,n){S(n,!0);const k=()=>B(H,"$user",U),[U,w]=q();let o=P(R([])),i=P(0);const h=async()=>{if($(o,[],!0),e(i)!==Number(e(i).toFixed(1))&&e(o).push({level:"error",header:"Value have at most 1 number after the comma"}),(e(i)<80||e(i)>110)&&e(o).push({level:"error",header:"Value must be in kg"}),e(o).length)return;const t=J.now().toUTC().toUnixInteger();try{await ie({timestampUTC:t,type:"weight",value:Math.floor(e(i)*100)}),n.onUpload(),n.close()}catch(a){let r=a.message;a instanceof re&&a.code===401?r="Invalid logged in user":a instanceof se&&(r="User is logged out");const d=`<strong>Entry not created</strong><br/> ${r}`;oe.push(d,{theme:{"--toastBarBackground":"#FF0000"}})}};var p=T(),b=x(p);{var A=t=>{var a=de(),r=u(a),d=u(r),M=m(u(d));M.__click=function(...s){n.close?.apply(this,s)},f(d);var y=m(d,2);W(y,17,()=>e(o),z,(s,c)=>{O(s,{get item(){return e(c)}})});var L=m(y,2),g=m(u(L),2);Z(g);var E=m(g,4);{var C=s=>{var c=ve();c.__click=h,v(s,c)},D=s=>{var c=le();v(s,c)};F(E,s=>{k()?s(C):s(D,!1)})}f(L),f(r),f(a),ee(g,()=>e(i),s=>$(i,s)),v(t,a)};F(b,t=>{n.isOpen&&t(A)})}v(l,p),V(),w()}N(["click"]);var me=_('<div class="event svelte-cyscl8"><div class="event-date"> </div> <div class="event-type"> </div> <div class="event-value"> </div></div>'),ue=_('<div class="event svelte-cyscl8"><div>Date</div> <div>Type</div> <div>Value</div></div> <!>',1),fe=_("<p>Loading events</p>");function pe(l,n){S(n,!0);const k=()=>B(H,"$user",U),[U,w]=q();var o=T(),i=x(o);{var h=p=>{var b=T(),A=x(b);ne(A,()=>n.events,t=>{var a=fe();v(t,a)},(t,a)=>{var r=ue(),d=m(x(r),2);W(d,17,()=>e(a),z,(M,y)=>{const L=j(()=>J.fromSeconds(e(y).eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm"));var g=me(),E=u(g),C=u(E,!0);f(E);var D=m(E,2),s=u(D,!0);f(D);var c=m(D,2),K=u(c,!0);f(c),f(g),X(()=>{I(C,e(L)),I(s,e(y).type),I(K,e(y).value)}),v(M,g)}),v(t,r)},(t,a)=>{{let r=j(()=>({level:"error",header:"Something went wrong getting events",message:e(a)}));O(t,{get item(){return e(r)}})}}),v(p,b)};F(i,p=>{k()&&n.events&&p(h)})}v(l,o),V(),w()}var ge=_("<div><button>Add an entry</button></div> <!>",1);function Ce(l,n){S(n,!0);const k=()=>B(H,"$user",U),[U,w]=q();let o=P(void 0);const i=()=>$(o,G(),!0);Q(()=>$(o,G(),!0));var h=T(),p=x(h);{var b=t=>{var a=ge(),r=x(a),d=u(r);d.__click=()=>Y.open(ce,{onUpload:i}),f(r);var M=m(r,2);pe(M,{get events(){return e(o)}}),v(t,a)},A=t=>{O(t,{item:{level:"info",header:"Login to add an entry or see events"}})};F(p,t=>{k()?t(b):t(A,!1)})}v(l,h),V(),w()}N(["click"]);export{Ce as component};
