import{g as Vt,u as pt,a as Ut,b as qt}from"../chunks/Bra48v64.js";import"../chunks/CWj6FrbW.js";import{o as ht}from"../chunks/BdBiDHY1.js";import{p as P,A as bt,k as O,g as t,n as H,y as M,s as A,f as F,o as p,B as d,C as l,aE as $,z as tt}from"../chunks/D4gDm57G.js";import{s as q}from"../chunks/s4055cqB.js";import{e as I,i as R}from"../chunks/BnSyOJPK.js";import{f as S,a as b,c as K,t as kt}from"../chunks/Vh0HsYHt.js";import{c as Mt}from"../chunks/CnGdFIDm.js";import{c as ut,d as wt,a as et,s as dt,r as mt}from"../chunks/Xqw48ZgO.js";import{d as ot}from"../chunks/vhkTqBca.js";import{b as Ot,d as Ft}from"../chunks/9XGeKPA3.js";import{a as ft,s as Ct,b as yt}from"../chunks/BmusxFuE.js";import{m as Et}from"../chunks/n10vgu6d.js";import{a as Lt}from"../chunks/DELwamq_.js";import{M as Nt}from"../chunks/BFODdGrM.js";import{M as jt}from"../chunks/Dg9v8Btr.js";import{i as J}from"../chunks/McHEF-Jg.js";import{k as gt}from"../chunks/6ejfBIWC.js";import{p as vt}from"../chunks/GL3I3yNm.js";import{w as xt,g as It}from"../chunks/Z4Lav-Sa.js";import{b as Rt,g as zt}from"../chunks/Cb3IlvvS.js";import{t as Jt}from"../chunks/DD1O5wo4.js";import{A as Pt}from"../chunks/BRnwoQCQ.js";import{U as Ht,u as Gt}from"../chunks/CcVlM4qF.js";import{b as Kt}from"../chunks/BRRsJXzH.js";import{a as Wt}from"../chunks/CykI4KT5.js";import"../chunks/Bmw8lZQ2.js";import{p as Qt}from"../chunks/U2TU-HKj.js";const Xt=!1,Yt=async()=>({chords:await Vt()}),mr=Object.freeze(Object.defineProperty({__proto__:null,load:Yt,ssr:Xt},Symbol.toStringTag,{value:"Module"}));var Zt=S('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1kbb9q3"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1kbb9q3">Back to top</span></button>');function $t(m,e){P(e,!0);let i=M(0),s=M(!0),f;const D=o=>{o>0?A(s,!1):A(s,!0),f&&clearTimeout(f),f=setTimeout(()=>{A(s,!0)},3e3)},k=()=>{const o=document.documentElement.scrollTop||document.body.scrollTop;o>0&&(window.requestAnimationFrame(k),window.scrollTo(0,o-o/2))};bt(()=>D(t(i)));var a=Zt();let r;a.__click=k,O(o=>r=ut(a,1,"top-link svelte-1kbb9q3",null,r,o),[()=>({hide:t(s)})]),Lt("y",()=>t(i),o=>A(i,o,!0)),b(m,a),H()}ot(["click"]);const st=xt();let St=[];const _t=localStorage.getItem("failedVisitCounts");if(_t!==null)try{St=JSON.parse(_t)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const ct=xt(St);ct.subscribe(m=>{localStorage.setItem("failedVisitCounts",JSON.stringify(m))});const Dt=m=>m==="doc"?"fas fa-file-word":m==="pdf"?"fas fa-file-pdf":m==="youtube"?"fa fa-youtube":"fas fa-link",te=async(m,e,i)=>{try{await pt(e.chord.url);const s=It(st),f=s.get(e.chord.url)||{count:0,lastAccessDateUnix:0};f.count++,f.lastAccessDateUnix=Date.now()/1e3,s.set(e.chord.url,f),st.set(s)}catch(s){let f=s.message;s instanceof Pt&&s.code===401?f="Invalid logged in user":s instanceof Ht&&(f="User is logged out"),yt(ct,[...i(),e.chord.url]);const D=`<strong>Visit not counted</strong><br/> ${f}`;Jt.push(D,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};var ee=S('<span></span> <span><a target="_blank" rel="noopener noreferrer"> </a></span>',1);function nt(m,e){P(e,!0);const[i,s]=Ct(),f=()=>ft(ct,"$failedVisitCounts",i);let D=vt(e,"showArtist",3,!1),k=M(void 0);st.subscribe(n=>{if(n&&n.has(e.chord.url)){const c=n.get(e.chord.url),y=new Date(c.lastAccessDateUnix*1e3);A(k,`visits: ${c.count} - last: ${y.toLocaleDateString()}`)}});const a=(D()?e.chord.artist+" - ":"")+e.chord.title,r=n=>n.type==="doc"?`${Rt}/docviewer/${n.url}`:n.url;var o=ee(),h=F(o),_=p(h,2),C=d(_);C.__click=[te,e,f];var v=d(C,!0);l(C),l(_),O((n,c)=>{ut(h,1,n,"svelte-1yqqigs"),et(C,"href",c),et(C,"title",t(k)),q(v,a)},[()=>wt(Dt(e.chord.type)),()=>r(e.chord)]),b(m,o),H(),s()}ot(["click"]);var re=S('<li class="ul2col-item"><!> <!></li>'),ae=S('<ul class="ul2col-container"></ul>');function se(m,e){P(e,!0);let i=vt(e,"chords",15),s=M(void 0);st.subscribe(a=>{a&&(A(s,a,!0),i(i().sort((r,o)=>{const h=a.get(r.url),_=a.get(o.url);return h&&_?_.lastAccessDateUnix-h.lastAccessDateUnix:h?-1:_?1:r.artist!=o.artist?r.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:r.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(a,r,o)=>o[a.type]===!1?!1:r.length===0||a.artist.toLowerCase().match(r.toLowerCase())?!0:a.title.toLowerCase().match(r.toLowerCase());var D=K(),k=F(D);gt(k,i,a=>{var r=ae();I(r,21,i,R,(o,h)=>{var _=K();const C=$(()=>{var c;return(c=t(s))==null?void 0:c.get(t(h).url)});var v=F(_);{var n=c=>{var y=re(),u=d(y);{var g=x=>{var L=kt();O(()=>q(L,`(${t(C).count??""})`)),b(x,L)};J(u,x=>{t(C)&&x(g)})}var w=p(u,2);nt(w,{get chord(){return t(h)},showArtist:!0}),l(y),b(c,y)};J(v,c=>{f(t(h),e.searchString,e.filters)&&c(n)})}b(o,_)}),l(r),b(a,r)}),b(m,D),H()}const oe=(m,e)=>m<e?-1:m>e?1:0,Tt=(m,e)=>{const i=m.toLowerCase(),s=e.toLowerCase();return oe(i,s)};var ne=S('<li class="navigationBtn svelte-1deg5s8"><a class="navigationLink svelte-1deg5s8"> </a></li>'),le=S('<li class="ul2col-item"><!></li>'),ie=S('<ul class="ul2col-container"></ul>'),ce=S('<tr class="svelte-1deg5s8"><td class="svelte-1deg5s8"> <!></td></tr>'),ue=S('<ol id="indexList" class="navigationBar disable-scrollbars svelte-1deg5s8"></ol> <table id="artistTable"><tbody></tbody></table>',1);function ve(m,e){P(e,!0);let i=vt(e,"searchString",3,"");const s=e.chords.reduce((u,g)=>{const w=g.artist;return u[w]||(u[w]=[]),u[w].push(g),u},{}),f=[],D=Object.keys(s).sort(Tt).map((u,g,w)=>{if(g===0||u[0].toLowerCase()!=w[g-1][0].toLowerCase()){const x="anchor_letter_"+u[0];return f.push({letter:u[0],tag:x}),{name:u,tag:x}}return{name:u}});let k=M(0),a=M(0),r=M(void 0);const o=u=>{if(t(r)){var g=t(r).getBoundingClientRect();if(g.top<20){A(a,20);return}A(a,g.top,!0)}};bt(()=>o(t(k)));const h=(u,g,w)=>s[u].sort((L,B)=>L.title<B.title?-1:1).filter(L=>{const B=L.type;return w[B]===!1?!1:g.length===0?!0:!!L.title.toLowerCase().match(g.toLowerCase())}),_=(u,g)=>!!u.toLowerCase().match(g.toLowerCase());var C=ue(),v=F(C);let n;I(v,21,()=>f,R,(u,g)=>{var w=ne(),x=d(w),L=d(x,!0);l(x),l(w),O(B=>{et(x,"href","#"+t(g).tag),q(L,B)},[()=>t(g).letter.toUpperCase()]),b(u,w)}),l(v);var c=p(v,2),y=d(c);I(y,21,()=>D,R,(u,g)=>{var w=K();const x=$(()=>h(t(g).name,i(),e.filters)),L=$(()=>_(t(g).name,i()));var B=F(w);{var N=Z=>{var G=ce();const rt=$(()=>t(L)?s[t(g).name]:t(x));var z=d(G),W=d(z),at=p(W);gt(at,i,j=>{var Q=ie();I(Q,21,()=>t(rt),R,(X,lt)=>{var T=le(),V=d(T);nt(V,{get chord(){return t(lt)}}),l(T),b(X,T)}),l(Q),b(j,Q)}),l(z),l(G),O(()=>{et(z,"id",t(g).tag),q(W,`${t(g).name??""} `)}),b(Z,G)};J(B,Z=>{(t(L)||t(x).length>0)&&Z(N)})}b(u,w)}),l(y),l(c),Kt(c,u=>A(r,u),()=>t(r)),O(()=>n=dt(v,"",n,{"--barTop":`${t(a)??""}px`})),Lt("y",()=>t(k),u=>A(k,u,!0)),b(m,C),H()}var de=S('<li class="ul2col-item"><!></li>'),fe=S('<div><span> </span> <ul class="ul2col-container"></ul></div>');function he(m,e){P(e,!0);const i=k=>k.charAt(0).toUpperCase()+k.slice(1).toLowerCase(),s=tt({});for(const k of e.chords)k.tags.forEach(r=>{s[r]||(s[r]=[]),s[r].push(k)});Object.keys(s).forEach(k=>{s[k].sort((a,r)=>{const o=a.artist.toLowerCase(),h=r.artist.toLowerCase(),_=a.title.toLowerCase(),C=r.title.toLowerCase();return o<h?-1:o>h?1:_<C?-1:1})});var f=K(),D=F(f);I(D,17,()=>Object.keys(s).sort(Tt),R,(k,a)=>{var r=K(),o=F(r);{var h=_=>{var C=fe(),v=d(C),n=d(v,!0);l(v);var c=p(v,2);I(c,21,()=>s[t(a)],R,(y,u)=>{var g=K(),w=F(g);{var x=L=>{var B=de(),N=d(B);nt(N,{get chord(){return t(u)},showArtist:!0}),l(B),b(L,B)};J(w,L=>{e.filters[t(u).type]&&L(x)})}b(y,g)}),l(c),l(C),O(y=>q(n,y),[()=>i(t(a))]),b(_,C)};J(o,_=>{(e.searchString.length===0||t(a).toLowerCase().match(e.searchString.toLowerCase()))&&_(h)})}b(k,r)}),b(m,f),H()}var ge=S('<li class="ul2col-item"><!> <!></li>'),me=S('<ul class="ul2col-container"></ul>');function _e(m,e){P(e,!0);let i=vt(e,"chords",15),s=M(void 0);st.subscribe(a=>{a&&(A(s,a,!0),i(i().sort((r,o)=>{const h=a.get(r.url),_=a.get(o.url);return h&&_?h.count!==_.count?_.count-h.count:_.lastAccessDateUnix-h.lastAccessDateUnix:h?-1:_?1:r.artist!=o.artist?r.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:r.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(a,r,o)=>o[a.type]===!1?!1:r.length===0||a.artist.toLowerCase().match(r.toLowerCase())?!0:a.title.toLowerCase().match(r.toLowerCase());var D=K(),k=F(D);gt(k,i,a=>{var r=me();I(r,21,i,R,(o,h)=>{var _=K();const C=$(()=>{var c;return(c=t(s))==null?void 0:c.get(t(h).url)});var v=F(_);{var n=c=>{var y=ge(),u=d(y);{var g=x=>{var L=kt();O(()=>q(L,`(${t(C).count??""})`)),b(x,L)};J(u,x=>{t(C)&&x(g)})}var w=p(u,2);nt(w,{get chord(){return t(h)},showArtist:!0}),l(y),b(c,y)};J(v,c=>{f(t(h),e.searchString,e.filters)&&c(n)})}b(o,_)}),l(r),b(a,r)}),b(m,D),H()}var pe=S('<span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-5k8p3l"> </span>',1),be=S('<div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Last Check</span> <span class="col table-head svelte-5k8p3l">Checks</span> <span class="col table-head svelte-5k8p3l">Skipped</span> <span class="col table-head svelte-5k8p3l">Errors</span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span></div> <br/> <div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Status</span> <span class="col table-head svelte-5k8p3l">Ref</span> <span class="col table-head svelte-5k8p3l">Host</span> <span class="col table-head svelte-5k8p3l">Data</span> <!></div>',1),ke=S('<p style="color: red"> </p>'),we=S("<p>Fetching results...</p>"),Ce=S('<div role="dialog" class="modal svelte-5k8p3l"><div class="contents svelte-5k8p3l"><h3 class="title-bar svelte-5k8p3l">Urls checks <button>Close</button></h3> <!></div></div>');function ye(m,e){P(e,!0);const i=a=>{const r=new Date(a.timestamp);return r.toDateString()+" "+r.toTimeString()},s=a=>a.fails.sort((r,o)=>r.chord.url<o.chord.url?-1:1);var f=K(),D=F(f);{var k=a=>{var r=Ce(),o=d(r),h=d(o),_=p(d(h));_.__click=function(...v){var n;(n=e.close)==null||n.apply(this,v)},l(h);var C=p(h,2);Wt(C,Ut,v=>{var n=we();b(v,n)},(v,n)=>{var c=be();const y=$(()=>i(t(n))),u=$(()=>s(t(n)));var g=F(c),w=p(d(g),8),x=d(w,!0);l(w);var L=p(w,2),B=d(L,!0);l(L);var N=p(L,2),Z=d(N,!0);l(N);var G=p(N,2),rt=d(G,!0);l(G),l(g);var z=p(g,4),W=p(d(z),8);I(W,17,()=>t(u),R,(at,j)=>{var Q=pe(),X=F(Q),lt=d(X,!0);l(X);var T=p(X,2),V=d(T);l(T);var U=p(T,2),E=d(U),it=d(E,!0);l(E),l(U);var Y=p(U,2),At=d(Y,!0);l(Y),O(Bt=>{q(lt,t(j).status),q(V,`${t(j).chord.artist??""} - ${t(j).chord.title??""}`),et(E,"href",t(j).chord.url),q(it,new URL(t(j).chord.url).hostname),q(At,Bt)},[()=>t(j).error?JSON.stringify(t(j).error):""]),b(at,Q)}),l(z),O(()=>{q(x,t(y)),q(B,t(n).nbChecks),q(Z,t(n).nbSkipped),q(rt,t(n).nbFails)}),b(v,c)},(v,n)=>{var c=ke(),y=d(c);l(c),O(()=>q(y,`Could not retrieve checks: ${t(n).message??""}`)),b(v,c)}),l(o),l(r),b(a,r)};J(D,a=>{e.isOpen&&a(k)})}b(m,f),H()}ot(["click"]);var Le=(m,e)=>e(),xe=S('<li class="ul2col-separator"> </li>'),Se=S('<!> <li class="ul2col-item"><!></li>',1),De=S('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function Te(m,e){P(e,!0);const i=Date.now(),s=1e3*3600*24*7,f=s*4,D=[{label:"last week",time:i-s},{label:"one month ago",time:i-f},{label:"two months ago",time:i-2*f},{label:"six months ago",time:i-6*f},{label:"one year ago",time:i-12*f}],k=e.chords.filter(n=>n.creationDate).sort((n,c)=>c.creationDate-n.creationDate).map((n,c,y)=>{const u={...n};if(c>0){const g=y[c-1];for(const{time:w,label:x}of D)g.creationDate>w&&n.creationDate<w&&(u.dateTag=x)}return u});let a=6,r=M(tt([]));const o=()=>{a+=4,A(r,k.slice(0,a),!0)};ht(()=>{o()});var h=De(),_=d(h),C=p(d(_));C.__click=[Le,o],l(_);var v=p(_,2);I(v,21,()=>t(r),R,(n,c)=>{var y=Se(),u=F(y);{var g=L=>{var B=xe(),N=d(B,!0);l(B),O(()=>q(N,t(c).dateTag)),b(L,B)};J(u,L=>{t(c).dateTag&&L(g)})}var w=p(u,2),x=d(w);nt(x,{get chord(){return t(c)}}),l(w),b(n,y)}),l(v),l(h),b(m,h),H()}ot(["click"]);const Ae=(m,e,i,s,f)=>{t(e).length<=i||(t(e).splice(t(e).length-i),A(s,t(e).slice(t(e).length-i).map(D=>f.chords[D]),!0))};var Be=S("<button>&nbsp↶&nbsp</button>"),Ve=S('<li class="ul2col-item"><!></li>'),Ue=S('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br/> <ul class="ul2col-container"></ul></div>');function qe(m,e){P(e,!0);const i=6;let s=M(tt([])),f=M(tt([]));const D=()=>{t(s).length>=e.chords.length-i&&A(s,[],!0);for(let v=0;v<i;v++){let n=-1;for(;n===-1||t(s).includes(n);)n=Math.floor(Math.random()*e.chords.length);t(s).push(n)}A(f,t(s).slice(t(s).length-i).map(v=>e.chords[v]),!0)};ht(()=>{D()});var k=Ue(),a=d(k),r=p(d(a)),o=d(r);{var h=v=>{var n=Be();n.__click=[Ae,s,i,f,e],b(v,n)};J(o,v=>{t(s).length>i&&v(h)})}var _=p(o,2);_.__click=D,l(r),l(a);var C=p(a,4);I(C,21,()=>t(f),v=>v.url,(v,n)=>{var c=Ve(),y=d(c);nt(y,{get chord(){return t(n)},showArtist:!0}),l(c),b(v,c)}),l(C),l(k),b(m,k),H()}ot(["click"]);var Me=()=>Et.open(ye),Oe=()=>zt("/songbook/edit"),Fe=(m,e)=>A(e,""),Ee=(m,e,i)=>{t(e)[t(i)]=!t(e)[t(i)],A(e,t(e),!0)},Ne=S('<button class="filter-control svelte-1gfqv35"><input type="checkbox"/> <span></span></button>'),je=(m,e,i)=>A(e,t(i),!0),Ie=S("<button> </button>"),Re=S('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"/> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1gfqv35"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1gfqv35"></div></div> <!>',1);function _r(m,e){P(e,!0);const[i,s]=Ct(),f=()=>ft(ct,"$failedVisitCounts",i),D=()=>ft(Gt,"$user",i);Qt.set("Songbook");const{chords:k}=e.data;let a=M(tt([]));const r=T=>{t(a).push(T),A(a,t(a),!0),setTimeout(()=>{t(a).shift(),A(a,t(a),!0)},5e3)};ht(async()=>{try{if(f().length&&D()){r({level:"info",header:"Trying to count missed visits while logged out"});for(const T of f())await pt(T);r({level:"success",header:`Counted ${f().length} missed visits`}),yt(ct,[])}}catch{r({level:"error",header:"Couldnt upload failed visit counts"})}try{const V=(await qt()).reduce((U,E)=>(U.set(E.url,{...E}),U),new Map);st.set(V)}catch{r({level:"error",header:"Couldnt upload failed visit counts"})}});let o=M("");const h=[{label:"By artist",component:ve},{label:"By tags",component:he},{label:"By frequency",component:_e},{label:"By access date",component:se}];let _=M(tt(h[0]));const C={pdf:!0,doc:!0,youtube:!0,link:!0};let v=M(tt({...C}));const n=Object.keys(C);var c=Re(),y=F(c);Nt(y,{title:"Song Book",description:"My song book",iconPath:"/songbook.png"});var u=p(y,2),g=d(u),w=d(g);w.__click=[Me],dt(w,"",{},{position:"relative"});var x=p(w,2);x.__click=[Oe],dt(x,"",{},{position:"relative"}),l(g),l(u);var L=p(u,2);I(L,17,()=>t(a),R,(T,V)=>{jt(T,{get item(){return t(V)}})});var B=p(L,2);$t(B,{});var N=p(B,2),Z=d(N);l(N);var G=p(N,2);Te(G,{get chords(){return k}});var rt=p(G,2);qe(rt,{get chords(){return k}});var z=p(rt,2),W=p(d(z),2);mt(W);var at=p(W,2);at.__click=[Fe,o];var j=p(at,2),Q=p(d(j),2);I(Q,17,()=>n,R,(T,V)=>{var U=Ne();U.__click=[Ee,v,V];var E=d(U);mt(E);var it=p(E,2);l(U),O(Y=>{et(U,"aria-label",`filter for ${t(V)??""}`),et(E,"id",t(V)),ut(it,1,Y,"svelte-1gfqv35")},[()=>wt(Dt(t(V)))]),Ft(E,()=>t(v)[t(V)],Y=>t(v)[t(V)]=Y),b(T,U)}),l(j);var X=p(j,4);I(X,21,()=>h,R,(T,V)=>{var U=Ie();let E;U.__click=[je,_,V];var it=d(U,!0);l(U),O(Y=>{E=ut(U,1,"control svelte-1gfqv35",null,E,Y),q(it,t(V).label)},[()=>({selected:t(_)===t(V)})]),b(T,U)}),l(X),l(z);var lt=p(z,2);Mt(lt,()=>t(_).component,(T,V)=>{V(T,{get chords(){return k},get searchString(){return t(o)},get filters(){return t(v)}})}),O(()=>q(Z,`This is a list of ${k.length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Ot(W,()=>t(o),T=>A(o,T)),b(m,c),H(),s()}ot(["click"]);export{_r as component,mr as universal};
