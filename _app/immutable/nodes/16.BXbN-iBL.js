import"../chunks/disclose-version.Bg9kRutz.js";import{p as Z,aH as y,v as q,w as l,aF as f,aG as n,g as e,k as O,s as k,n as ee,ad as ve}from"../chunks/index-client.JlBVMNcv.js";import{s as K}from"../chunks/render.D0Buk_M8.js";import{a as de}from"../chunks/await.avllYRrB.js";import{i as $}from"../chunks/if.5fMxmT3W.js";import{f as ae,a as m,t as _,e as fe,q as ue}from"../chunks/template.BbMWxsdt.js";import{p as B}from"../chunks/proxy.DxHtXs8G.js";import{s as re,a as oe}from"../chunks/store.DiRphTH0.js";import{m as pe}from"../chunks/Modals.DMm-y1C7.js";import{g as _e,u as se,U as ge}from"../chunks/service.DCBg5Ntt.js";import{M as ie}from"../chunks/Main.BseVPM-l.js";import{M as be}from"../chunks/Main.DBI_oAMC.js";import{P as j}from"../chunks/public.xpUinP6t.js";import{r as he,A as ke}from"../chunks/index.1NTOs35q.js";import{s as we}from"../chunks/client.CPNsEPr9.js";import{e as Q,i as W}from"../chunks/each.Ew_1-Ryx.js";import{r as X,s as z}from"../chunks/attributes.CAZcdgun.js";import{b as Y,a as ye}from"../chunks/input.DB6o_K7f.js";import{r as xe}from"../chunks/legacy-client.IsNAZnLb.js";import{t as ne}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.CM38xAIo.js";import{b as Se}from"../chunks/this.CIWri6Gg.js";import{M as Te}from"../chunks/Main.kCPzTV0s.js";import"../chunks/legacy.B7sduY7i.js";import{p as Ue}from"../chunks/Main.svelte_svelte_type_style_lang.BLmcNCB_.js";const Le=!1,ba=Object.freeze(Object.defineProperty({__proto__:null,ssr:Le},Symbol.toStringTag,{value:"Module"})),te=()=>he({path:"/reactor/getEntriesForPublic"}),Me=async u=>{const o=j+"/reactor/addEntry",g=await _e();typeof g=="string"&&await we.post(o).auth(g,{type:"bearer"}).field("name",u.name).field("commaSeparatedTags",u.commaSeparatedTags).attach("file",u.file)};var Ce=_('<span class="tag svelte-16m67n3"> </span>'),Ae=(u,o,g)=>o(e(g)),Pe=_('<video class="medium-margin svelte-16m67n3" style="max-width: 100%" controls></video>',2),Re=_('<img class="medium-margin svelte-16m67n3">'),Ee=_('<div><div><b> </b></div> <div class="svelte-16m67n3"></div> <div><button class="full-width svelte-16m67n3"><i class="fas fa-copy"></i> Copy link</button></div></div> <div><a rel="noopener noreferrer" target="blank"><!></a></div>',1),Fe=(u,o)=>ve(o),Ne=_('<button class="full-width medium-margin svelte-16m67n3">More...</button>'),Oe=_('<input class="full-width medium-margin svelte-16m67n3" type="text" placeholder="Search by tags or name"> <div class="container svelte-16m67n3"></div> <!>',1);function $e(u,o){Z(o,!0);const g=10;let L=y(1),C=y(B([])),v=y("");const x=(t,a)=>{if(!a.length||t.name.toLowerCase().includes(a.toLowerCase()))return!0;for(const c of t.tags)if(c.toLowerCase().includes(a.toLowerCase()))return!0;return!1},S=t=>{navigator.clipboard.writeText(j+t.uri),ne.push('<i class="fas fa-check"></i> Link copied to clipboard',{duration:1e3,theme:{"--toastBarHeight":0}})},T=t=>t.s3PresignedUrl.includes(".mp4");xe(()=>{k(C,B(o.reactions.filter(t=>x(t,e(v))).sort((t,a)=>a.creationDateUnix-t.creationDateUnix).slice(0,e(v).length?void 0:e(L)*g)))});var b=Oe(),h=q(b);X(h);var M=l(h,2);Q(M,21,()=>e(C),W,(t,a)=>{var p=Ee(),c=q(p),d=f(c),P=f(d),D=f(P,!0);n(P),n(d);var R=l(d,2);Q(R,21,()=>e(a).tags,W,(w,r)=>{var i=Ce(),J=f(i,!0);n(i),O(()=>K(J,e(r))),m(w,i)}),n(R);var E=l(R,2),I=f(E);I.__click=[Ae,S,a],n(E),n(c);var F=l(c,2),U=f(F),G=f(U);{var H=w=>{var r=Pe();O(()=>z(r,"src",j+e(a).uri)),m(w,r)},V=w=>{var r=Re();O(()=>{z(r,"src",j+e(a).uri),z(r,"alt",e(a).name)}),m(w,r)};$(G,w=>{T(e(a))?w(H):w(V,!1)})}n(U),n(F),O(()=>{K(D,e(a).name),z(U,"href",j+e(a).uri),z(U,"download",e(a).name)}),m(t,p)}),n(M);var A=l(M,2);{var s=t=>{var a=Ne();a.__click=[Fe,L],m(t,a)};$(A,t=>{e(v).length===0&&e(L)*g<o.reactions.length&&t(s)})}Y(h,()=>e(v),t=>k(v,t)),m(u,b),ee()}ae(["click"]);var Be=(u,o)=>{e(o)!==void 0&&(e(o).value="")},Ie=_('<button class="form-action svelte-1f930i6"><!></button>'),ze=_('<span class="form-action svelte-1f930i6">Login to upload an entry</span>'),je=_('<div role="dialog" class="modal svelte-1f930i6"><div class="contents svelte-1f930i6"><h4 class="title-bar svelte-1f930i6">Add a new file <button>Close</button></h4> <!> <form class="form-content svelte-1f930i6"><label for="name">Name</label> <input type="text"> <label for="content">Tags</label> <input type="textarea"> <label for="file">File</label> <span><input class="file-input svelte-1f930i6" type="file"> <button aria-label="delete file"><i class="fas fa-times-circle"></i></button></span> <br> <!></form></div></div>');function qe(u,o){Z(o,!0);const[g,L]=re(),C=()=>oe(se,"$user",g);let v=y(B([])),x=y(""),S=y(""),T=y(void 0),b=y(void 0),h=y(!1);const M=async()=>{var p;k(v,B([])),(p=e(x))!=null&&p.length||e(v).push({level:"error",header:"name must be defined"});let a;if(e(b)&&e(b).length&&(a=e(b)[0]),a||e(v).push({level:"error",header:"a file must be uploaded"}),!(e(v).length||!a))try{k(h,!0),await Me({name:e(x),commaSeparatedTags:e(S),file:a}),k(h,!1),o.onUpload(),o.close()}catch(c){k(h,!1);let d=c.message;c instanceof ke&&c.code===401?d="Invalid logged in user":c instanceof ge&&(d="User is logged out");const P=`<strong>Entry not created</strong><br/> ${d}`;ne.push(P,{theme:{"--toastBarBackground":"#FF0000"}})}};var A=fe(),s=q(A);{var t=a=>{var p=je(),c=f(p),d=f(c),P=l(f(d));P.__click=function(...r){var i;(i=o.close)==null||i.apply(this,r)},n(d);var D=l(d,2);Q(D,17,()=>e(v),W,(r,i)=>{ie(r,{get item(){return e(i)}})});var R=l(D,2),E=l(f(R),2);X(E);var I=l(E,4);X(I);var F=l(I,4),U=f(F);Se(U,r=>k(T,r),()=>e(T));var G=l(U,2);G.__click=[Be,T],n(F);var H=l(F,4);{var V=r=>{var i=Ie();i.__click=M;var J=f(i);{var le=N=>{Te(N,{size:.5,unit:"em",durationSeconds:.5})},ce=N=>{var me=ue("Submit");m(N,me)};$(J,N=>{e(h)?N(le):N(ce,!1)})}n(i),O(()=>i.disabled=e(h)),m(r,i)},w=r=>{var i=ze();m(r,i)};$(H,r=>{C()?r(V):r(w,!1)})}n(R),n(c),n(p),Y(E,()=>e(x),r=>k(x,r)),Y(I,()=>e(S),r=>k(S,r)),ye(U,()=>e(b),r=>k(b,r)),m(a,p)};$(s,a=>{o.isOpen&&a(t)})}m(u,A),ee(),L()}ae(["click"]);var De=(u,o)=>pe.open(qe,{onUpload:o}),Ge=_("<button>Add an entry</button>"),He=_("<p>Something went wrong</p> <p> </p>",1),Ve=_("<p>Loading data</p>"),Je=_("<!> <h2>Upload</h2> <!> <h2>Content</h2> <!>",1);function ha(u,o){Z(o,!0);const[g,L]=re(),C=()=>oe(se,"$user",g);Ue.set("Reactor");let v=y(B(te()));const x=()=>k(v,B(te()));var S=Je(),T=q(S);be(T,{title:"Reactor",description:"My collection of memes"});var b=l(T,4);{var h=s=>{var t=Ge();t.__click=[De,x],m(s,t)},M=s=>{ie(s,{item:{level:"info",header:"Login to add an entry"}})};$(b,s=>{C()?s(h):s(M,!1)})}var A=l(b,4);de(A,()=>e(v),s=>{var t=Ve();m(s,t)},(s,t)=>{$e(s,{get reactions(){return e(t)}})},(s,t)=>{var a=He(),p=l(q(a),2),c=f(p,!0);n(p),O(d=>K(c,d),[()=>JSON.stringify(e(t))]),m(s,a)}),m(u,S),ee(),L()}ae(["click"]);export{ha as component,ba as universal};
