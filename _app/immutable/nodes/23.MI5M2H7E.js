import{g as Vt,u as pt,a as Ut,b as qt}from"../chunks/0pROseod.js";import"../chunks/CWj6FrbW.js";import{o as ht}from"../chunks/CDX-sL3O.js";import{p as P,A as bt,k as M,g as t,n as H,y as F,s as A,f as O,o as p,B as d,C as i,aF as $,z as tt}from"../chunks/Cv-zmWGa.js";import{s as q}from"../chunks/DXxIQEZs.js";import{e as I,i as R}from"../chunks/C3DfYh4M.js";import{f as S,a as b,c as K,t as kt}from"../chunks/BkdBIW1u.js";import{c as Ft}from"../chunks/CBiZ8whF.js";import{b as ut,c as wt,a as et,s as dt,r as mt}from"../chunks/BJbKFSGg.js";import{d as ot}from"../chunks/BQtkqI2r.js";import{b as Mt,d as Ot}from"../chunks/D0SmWeCk.js";import{a as ft,s as Ct,b as yt}from"../chunks/DDEIsCTc.js";import{m as Et}from"../chunks/DKb7ftO2.js";import{a as Lt}from"../chunks/xvX4ab9y.js";import{M as Nt}from"../chunks/5d7MSMLD.js";import{M as jt}from"../chunks/CqV0nrHm.js";import{i as J}from"../chunks/CyUgAfMk.js";import{k as gt}from"../chunks/Cb-xDwa4.js";import{p as vt}from"../chunks/Ct9gYnRm.js";import{w as xt,g as It}from"../chunks/CpW65D4M.js";import{b as Rt,g as zt}from"../chunks/vJYzJQhG.js";import{t as Jt}from"../chunks/OnRlDVDx.js";import{A as Pt}from"../chunks/CPudKDqT.js";import{U as Ht,u as Gt}from"../chunks/RbvtgwLs.js";import{b as Kt}from"../chunks/LqmtLzKb.js";import{a as Wt}from"../chunks/BW5A2Es4.js";import"../chunks/CQPOWANv.js";import{p as Qt}from"../chunks/CN7LDHjJ.js";const Xt=!1,Yt=async()=>({chords:await Vt()}),mr=Object.freeze(Object.defineProperty({__proto__:null,load:Yt,ssr:Xt},Symbol.toStringTag,{value:"Module"}));var Zt=S('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1kbb9q3"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1kbb9q3">Back to top</span></button>');function $t(m,e){P(e,!0);let n=F(0),s=F(!0),f;const D=o=>{o>0?A(s,!1):A(s,!0),f&&clearTimeout(f),f=setTimeout(()=>{A(s,!0)},3e3)},k=()=>{const o=document.documentElement.scrollTop||document.body.scrollTop;o>0&&(window.requestAnimationFrame(k),window.scrollTo(0,o-o/2))};bt(()=>D(t(n)));var a=Zt();let r;a.__click=k,M(o=>r=ut(a,1,"top-link svelte-1kbb9q3",null,r,o),[()=>({hide:t(s)})]),Lt("y",()=>t(n),o=>A(n,o,!0)),b(m,a),H()}ot(["click"]);const st=xt();let St=[];const _t=localStorage.getItem("failedVisitCounts");if(_t!==null)try{St=JSON.parse(_t)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const ct=xt(St);ct.subscribe(m=>{localStorage.setItem("failedVisitCounts",JSON.stringify(m))});const Dt=m=>m==="doc"?"fas fa-file-word":m==="pdf"?"fas fa-file-pdf":m==="youtube"?"fa fa-youtube":"fas fa-link",te=async(m,e,n)=>{try{await pt(e.chord.url);const s=It(st),f=s.get(e.chord.url)||{count:0,lastAccessDateUnix:0};f.count++,f.lastAccessDateUnix=Date.now()/1e3,s.set(e.chord.url,f),st.set(s)}catch(s){let f=s.message;s instanceof Pt&&s.code===401?f="Invalid logged in user":s instanceof Ht&&(f="User is logged out"),yt(ct,[...n(),e.chord.url]);const D=`<strong>Visit not counted</strong><br/> ${f}`;Jt.push(D,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};var ee=S('<span></span> <span><a target="_blank" rel="noopener noreferrer"></a></span>',1);function nt(m,e){P(e,!0);const[n,s]=Ct(),f=()=>ft(ct,"$failedVisitCounts",n);let D=vt(e,"showArtist",3,!1),k=F(void 0);st.subscribe(l=>{if(l&&l.has(e.chord.url)){const c=l.get(e.chord.url),u=new Date(c.lastAccessDateUnix*1e3);A(k,`visits: ${c.count} - last: ${u.toLocaleDateString()}`)}});const a=(D()?e.chord.artist+" - ":"")+e.chord.title,r=l=>l.type==="doc"?`${Rt}/docviewer/${l.url}`:l.url;var o=ee(),h=O(o),_=p(h,2),y=d(_);y.__click=[te,e,f],y.textContent=a,i(_),M((l,c)=>{ut(h,1,l,"svelte-1yqqigs"),et(y,"href",c),et(y,"title",t(k))},[()=>wt(Dt(e.chord.type)),()=>r(e.chord)]),b(m,o),H(),s()}ot(["click"]);var re=S('<li class="ul2col-item"><!> <!></li>'),ae=S('<ul class="ul2col-container"></ul>');function se(m,e){P(e,!0);let n=vt(e,"chords",15),s=F(void 0);st.subscribe(a=>{a&&(A(s,a,!0),n(n().sort((r,o)=>{const h=a.get(r.url),_=a.get(o.url);return h&&_?_.lastAccessDateUnix-h.lastAccessDateUnix:h?-1:_?1:r.artist!=o.artist?r.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:r.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(a,r,o)=>o[a.type]===!1?!1:r.length===0||a.artist.toLowerCase().match(r.toLowerCase())?!0:a.title.toLowerCase().match(r.toLowerCase());var D=K(),k=O(D);gt(k,n,a=>{var r=ae();I(r,21,n,R,(o,h)=>{var _=K();const y=$(()=>{var u;return(u=t(s))==null?void 0:u.get(t(h).url)});var l=O(_);{var c=u=>{var x=re(),v=d(x);{var g=L=>{var C=kt();M(()=>q(C,`(${t(y).count??""})`)),b(L,C)};J(v,L=>{t(y)&&L(g)})}var w=p(v,2);nt(w,{get chord(){return t(h)},showArtist:!0}),i(x),b(u,x)};J(l,u=>{f(t(h),e.searchString,e.filters)&&u(c)})}b(o,_)}),i(r),b(a,r)}),b(m,D),H()}const oe=(m,e)=>m<e?-1:m>e?1:0,Tt=(m,e)=>{const n=m.toLowerCase(),s=e.toLowerCase();return oe(n,s)};var ne=S('<li class="navigationBtn svelte-1deg5s8"><a class="navigationLink svelte-1deg5s8"> </a></li>'),le=S('<li class="ul2col-item"><!></li>'),ie=S('<ul class="ul2col-container"></ul>'),ce=S('<tr class="svelte-1deg5s8"><td class="svelte-1deg5s8"> <!></td></tr>'),ue=S('<ol id="indexList" class="navigationBar disable-scrollbars svelte-1deg5s8"></ol> <table id="artistTable"><tbody></tbody></table>',1);function ve(m,e){P(e,!0);let n=vt(e,"searchString",3,"");const s=e.chords.reduce((v,g)=>{const w=g.artist;return v[w]||(v[w]=[]),v[w].push(g),v},{}),f=[],D=Object.keys(s).sort(Tt).map((v,g,w)=>{if(g===0||v[0].toLowerCase()!=w[g-1][0].toLowerCase()){const L="anchor_letter_"+v[0];return f.push({letter:v[0],tag:L}),{name:v,tag:L}}return{name:v}});let k=F(0),a=F(0),r=F(void 0);const o=v=>{if(t(r)){var g=t(r).getBoundingClientRect();if(g.top<20){A(a,20);return}A(a,g.top,!0)}};bt(()=>o(t(k)));const h=(v,g,w)=>s[v].sort((C,B)=>C.title<B.title?-1:1).filter(C=>{const B=C.type;return w[B]===!1?!1:g.length===0?!0:!!C.title.toLowerCase().match(g.toLowerCase())}),_=(v,g)=>!!v.toLowerCase().match(g.toLowerCase());var y=ue(),l=O(y);let c;I(l,21,()=>f,R,(v,g)=>{var w=ne(),L=d(w),C=d(L,!0);i(L),i(w),M(B=>{et(L,"href","#"+t(g).tag),q(C,B)},[()=>t(g).letter.toUpperCase()]),b(v,w)}),i(l);var u=p(l,2),x=d(u);I(x,21,()=>D,R,(v,g)=>{var w=K();const L=$(()=>h(t(g).name,n(),e.filters)),C=$(()=>_(t(g).name,n()));var B=O(w);{var N=Z=>{var G=ce();const rt=$(()=>t(C)?s[t(g).name]:t(L));var z=d(G),W=d(z),at=p(W);gt(at,n,j=>{var Q=ie();I(Q,21,()=>t(rt),R,(X,lt)=>{var T=le(),V=d(T);nt(V,{get chord(){return t(lt)}}),i(T),b(X,T)}),i(Q),b(j,Q)}),i(z),i(G),M(()=>{et(z,"id",t(g).tag),q(W,`${t(g).name??""} `)}),b(Z,G)};J(B,Z=>{(t(C)||t(L).length>0)&&Z(N)})}b(v,w)}),i(x),i(u),Kt(u,v=>A(r,v),()=>t(r)),M(()=>c=dt(l,"",c,{"--barTop":`${t(a)??""}px`})),Lt("y",()=>t(k),v=>A(k,v,!0)),b(m,y),H()}var de=S('<li class="ul2col-item"><!></li>'),fe=S('<div><span> </span> <ul class="ul2col-container"></ul></div>');function he(m,e){P(e,!0);const n=k=>k.charAt(0).toUpperCase()+k.slice(1).toLowerCase(),s=tt({});for(const k of e.chords)k.tags.forEach(r=>{s[r]||(s[r]=[]),s[r].push(k)});Object.keys(s).forEach(k=>{s[k].sort((a,r)=>{const o=a.artist.toLowerCase(),h=r.artist.toLowerCase(),_=a.title.toLowerCase(),y=r.title.toLowerCase();return o<h?-1:o>h?1:_<y?-1:1})});var f=K(),D=O(f);I(D,17,()=>Object.keys(s).sort(Tt),R,(k,a)=>{var r=K(),o=O(r);{var h=_=>{var y=fe(),l=d(y),c=d(l,!0);i(l);var u=p(l,2);I(u,21,()=>s[t(a)],R,(x,v)=>{var g=K(),w=O(g);{var L=C=>{var B=de(),N=d(B);nt(N,{get chord(){return t(v)},showArtist:!0}),i(B),b(C,B)};J(w,C=>{e.filters[t(v).type]&&C(L)})}b(x,g)}),i(u),i(y),M(x=>q(c,x),[()=>n(t(a))]),b(_,y)};J(o,_=>{(e.searchString.length===0||t(a).toLowerCase().match(e.searchString.toLowerCase()))&&_(h)})}b(k,r)}),b(m,f),H()}var ge=S('<li class="ul2col-item"><!> <!></li>'),me=S('<ul class="ul2col-container"></ul>');function _e(m,e){P(e,!0);let n=vt(e,"chords",15),s=F(void 0);st.subscribe(a=>{a&&(A(s,a,!0),n(n().sort((r,o)=>{const h=a.get(r.url),_=a.get(o.url);return h&&_?h.count!==_.count?_.count-h.count:_.lastAccessDateUnix-h.lastAccessDateUnix:h?-1:_?1:r.artist!=o.artist?r.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:r.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(a,r,o)=>o[a.type]===!1?!1:r.length===0||a.artist.toLowerCase().match(r.toLowerCase())?!0:a.title.toLowerCase().match(r.toLowerCase());var D=K(),k=O(D);gt(k,n,a=>{var r=me();I(r,21,n,R,(o,h)=>{var _=K();const y=$(()=>{var u;return(u=t(s))==null?void 0:u.get(t(h).url)});var l=O(_);{var c=u=>{var x=ge(),v=d(x);{var g=L=>{var C=kt();M(()=>q(C,`(${t(y).count??""})`)),b(L,C)};J(v,L=>{t(y)&&L(g)})}var w=p(v,2);nt(w,{get chord(){return t(h)},showArtist:!0}),i(x),b(u,x)};J(l,u=>{f(t(h),e.searchString,e.filters)&&u(c)})}b(o,_)}),i(r),b(a,r)}),b(m,D),H()}var pe=S('<span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-5k8p3l"> </span>',1),be=S('<div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Last Check</span> <span class="col table-head svelte-5k8p3l">Checks</span> <span class="col table-head svelte-5k8p3l">Skipped</span> <span class="col table-head svelte-5k8p3l">Errors</span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span></div> <br/> <div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Status</span> <span class="col table-head svelte-5k8p3l">Ref</span> <span class="col table-head svelte-5k8p3l">Host</span> <span class="col table-head svelte-5k8p3l">Data</span> <!></div>',1),ke=S('<p style="color: red"> </p>'),we=S("<p>Fetching results...</p>"),Ce=S('<div role="dialog" class="modal svelte-5k8p3l"><div class="contents svelte-5k8p3l"><h3 class="title-bar svelte-5k8p3l">Urls checks <button>Close</button></h3> <!></div></div>');function ye(m,e){P(e,!0);const n=a=>{const r=new Date(a.timestamp);return r.toDateString()+" "+r.toTimeString()},s=a=>a.fails.sort((r,o)=>r.chord.url<o.chord.url?-1:1);var f=K(),D=O(f);{var k=a=>{var r=Ce(),o=d(r),h=d(o),_=p(d(h));_.__click=function(...l){var c;(c=e.close)==null||c.apply(this,l)},i(h);var y=p(h,2);Wt(y,Ut,l=>{var c=we();b(l,c)},(l,c)=>{var u=be();const x=$(()=>n(t(c))),v=$(()=>s(t(c)));var g=O(u),w=p(d(g),8),L=d(w,!0);i(w);var C=p(w,2),B=d(C,!0);i(C);var N=p(C,2),Z=d(N,!0);i(N);var G=p(N,2),rt=d(G,!0);i(G),i(g);var z=p(g,4),W=p(d(z),8);I(W,17,()=>t(v),R,(at,j)=>{var Q=pe(),X=O(Q),lt=d(X,!0);i(X);var T=p(X,2),V=d(T);i(T);var U=p(T,2),E=d(U),it=d(E,!0);i(E),i(U);var Y=p(U,2),At=d(Y,!0);i(Y),M(Bt=>{q(lt,t(j).status),q(V,`${t(j).chord.artist??""} - ${t(j).chord.title??""}`),et(E,"href",t(j).chord.url),q(it,new URL(t(j).chord.url).hostname),q(At,Bt)},[()=>t(j).error?JSON.stringify(t(j).error):""]),b(at,Q)}),i(z),M(()=>{q(L,t(x)),q(B,t(c).nbChecks),q(Z,t(c).nbSkipped),q(rt,t(c).nbFails)}),b(l,u)},(l,c)=>{var u=ke(),x=d(u);i(u),M(()=>q(x,`Could not retrieve checks: ${t(c).message??""}`)),b(l,u)}),i(o),i(r),b(a,r)};J(D,a=>{e.isOpen&&a(k)})}b(m,f),H()}ot(["click"]);var Le=(m,e)=>e(),xe=S('<li class="ul2col-separator"> </li>'),Se=S('<!> <li class="ul2col-item"><!></li>',1),De=S('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function Te(m,e){P(e,!0);const n=Date.now(),s=1e3*3600*24*7,f=s*4,D=[{label:"last week",time:n-s},{label:"one month ago",time:n-f},{label:"two months ago",time:n-2*f},{label:"six months ago",time:n-6*f},{label:"one year ago",time:n-12*f}],k=e.chords.filter(c=>c.creationDate).sort((c,u)=>u.creationDate-c.creationDate).map((c,u,x)=>{const v={...c};if(u>0){const g=x[u-1];for(const{time:w,label:L}of D)g.creationDate>w&&c.creationDate<w&&(v.dateTag=L)}return v});let a=6,r=F(tt([]));const o=()=>{a+=4,A(r,k.slice(0,a),!0)};ht(()=>{o()});var h=De(),_=d(h),y=p(d(_));y.__click=[Le,o],i(_);var l=p(_,2);I(l,21,()=>t(r),R,(c,u)=>{var x=Se(),v=O(x);{var g=C=>{var B=xe(),N=d(B,!0);i(B),M(()=>q(N,t(u).dateTag)),b(C,B)};J(v,C=>{t(u).dateTag&&C(g)})}var w=p(v,2),L=d(w);nt(L,{get chord(){return t(u)}}),i(w),b(c,x)}),i(l),i(h),b(m,h),H()}ot(["click"]);const Ae=(m,e,n,s,f)=>{t(e).length<=n||(t(e).splice(t(e).length-n),A(s,t(e).slice(t(e).length-n).map(D=>f.chords[D]),!0))};var Be=S("<button>&nbsp↶&nbsp</button>"),Ve=S('<li class="ul2col-item"><!></li>'),Ue=S('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br/> <ul class="ul2col-container"></ul></div>');function qe(m,e){P(e,!0);const n=6;let s=F(tt([])),f=F(tt([]));const D=()=>{t(s).length>=e.chords.length-n&&A(s,[],!0);for(let l=0;l<n;l++){let c=-1;for(;c===-1||t(s).includes(c);)c=Math.floor(Math.random()*e.chords.length);t(s).push(c)}A(f,t(s).slice(t(s).length-n).map(l=>e.chords[l]),!0)};ht(()=>{D()});var k=Ue(),a=d(k),r=p(d(a)),o=d(r);{var h=l=>{var c=Be();c.__click=[Ae,s,n,f,e],b(l,c)};J(o,l=>{t(s).length>n&&l(h)})}var _=p(o,2);_.__click=D,i(r),i(a);var y=p(a,4);I(y,21,()=>t(f),l=>l.url,(l,c)=>{var u=Ve(),x=d(u);nt(x,{get chord(){return t(c)},showArtist:!0}),i(u),b(l,u)}),i(y),i(k),b(m,k),H()}ot(["click"]);var Fe=()=>Et.open(ye),Me=()=>zt("/songbook/edit"),Oe=(m,e)=>A(e,""),Ee=(m,e,n)=>{t(e)[t(n)]=!t(e)[t(n)],A(e,t(e),!0)},Ne=S('<button class="filter-control svelte-1gfqv35"><input type="checkbox"/> <span></span></button>'),je=(m,e,n)=>A(e,t(n),!0),Ie=S("<button> </button>"),Re=S('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"/> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1gfqv35"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1gfqv35"></div></div> <!>',1);function _r(m,e){P(e,!0);const[n,s]=Ct(),f=()=>ft(ct,"$failedVisitCounts",n),D=()=>ft(Gt,"$user",n);Qt.set("Songbook");const{chords:k}=e.data;let a=F(tt([]));const r=T=>{t(a).push(T),A(a,t(a),!0),setTimeout(()=>{t(a).shift(),A(a,t(a),!0)},5e3)};ht(async()=>{try{if(f().length&&D()){r({level:"info",header:"Trying to count missed visits while logged out"});for(const T of f())await pt(T);r({level:"success",header:`Counted ${f().length} missed visits`}),yt(ct,[])}}catch{r({level:"error",header:"Couldnt upload failed visit counts"})}try{const V=(await qt()).reduce((U,E)=>(U.set(E.url,{...E}),U),new Map);st.set(V)}catch{r({level:"error",header:"Couldnt upload failed visit counts"})}});let o=F("");const h=[{label:"By artist",component:ve},{label:"By tags",component:he},{label:"By frequency",component:_e},{label:"By access date",component:se}];let _=F(tt(h[0]));const y={pdf:!0,doc:!0,youtube:!0,link:!0};let l=F(tt({...y}));const c=Object.keys(y);var u=Re(),x=O(u);Nt(x,{title:"Song Book",description:"My song book",iconPath:"/songbook.png"});var v=p(x,2),g=d(v),w=d(g);w.__click=[Fe],dt(w,"",{},{position:"relative"});var L=p(w,2);L.__click=[Me],dt(L,"",{},{position:"relative"}),i(g),i(v);var C=p(v,2);I(C,17,()=>t(a),R,(T,V)=>{jt(T,{get item(){return t(V)}})});var B=p(C,2);$t(B,{});var N=p(B,2),Z=d(N);i(N);var G=p(N,2);Te(G,{chords:k});var rt=p(G,2);qe(rt,{chords:k});var z=p(rt,2),W=p(d(z),2);mt(W);var at=p(W,2);at.__click=[Oe,o];var j=p(at,2),Q=p(d(j),2);I(Q,17,()=>c,R,(T,V)=>{var U=Ne();U.__click=[Ee,l,V];var E=d(U);mt(E);var it=p(E,2);i(U),M(Y=>{et(U,"aria-label",`filter for ${t(V)??""}`),et(E,"id",t(V)),ut(it,1,Y,"svelte-1gfqv35")},[()=>wt(Dt(t(V)))]),Ot(E,()=>t(l)[t(V)],Y=>t(l)[t(V)]=Y),b(T,U)}),i(j);var X=p(j,4);I(X,21,()=>h,R,(T,V)=>{var U=Ie();let E;U.__click=[je,_,V];var it=d(U,!0);i(U),M(Y=>{E=ut(U,1,"control svelte-1gfqv35",null,E,Y),q(it,t(V).label)},[()=>({selected:t(_)===t(V)})]),b(T,U)}),i(X),i(z);var lt=p(z,2);Ft(lt,()=>t(_).component,(T,V)=>{V(T,{chords:k,get searchString(){return t(o)},get filters(){return t(l)}})}),M(()=>q(Z,`This is a list of ${k.length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Mt(W,()=>t(o),T=>A(o,T)),b(m,u),H(),s()}ot(["click"]);export{_r as component,mr as universal};
