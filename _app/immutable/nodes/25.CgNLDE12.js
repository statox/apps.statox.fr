import{g as Vt,u as pt,a as Ut,b as qt}from"../chunks/CiMaeCna.js";import"../chunks/NZTpNUN0.js";import{o as ht}from"../chunks/BlCreX5I.js";import{z as P,C as bt,g as t,p as S,x as M,a as b,E as G,s as A,A as F,f as O,v as p,F as v,G as n,c as H,aZ as tt,a_ as kt,B as et}from"../chunks/R2JDhSNG.js";import{d as ot,w as wt,s as q,g as Ft}from"../chunks/C3Q0-X8e.js";import{e as I,i as R}from"../chunks/UCjBP_y5.js";import{c as Mt}from"../chunks/BMB44i5w.js";import{a as ut,s as rt,r as _t}from"../chunks/DmNmkrrX.js";import{c as Ct,s as dt}from"../chunks/II6s2hXF.js";import{b as Ot,c as Et}from"../chunks/CpZDNLuF.js";import{a as ft,s as yt,b as Lt}from"../chunks/Ct-TLQDZ.js";import{m as Nt}from"../chunks/AseJjqf2.js";import{a as xt}from"../chunks/Aww9F1vT.js";import{M as jt}from"../chunks/Cf5hGKY0.js";import{M as It}from"../chunks/FElWoEaI.js";import{i as J}from"../chunks/4u1zq58c.js";import{k as gt}from"../chunks/813eipOm.js";import{p as vt}from"../chunks/B764EtYD.js";import{b as Rt,g as zt}from"../chunks/B0l88DD7.js";import{t as Jt}from"../chunks/Csd1YvgP.js";import{A as Pt}from"../chunks/UCu7ArvF.js";import{U as Gt,u as Ht}from"../chunks/C54_DghZ.js";import{b as Kt}from"../chunks/D2cvcPZd.js";import{a as Wt}from"../chunks/D7viMnSX.js";import"../chunks/CohOaeDR.js";import{p as Zt}from"../chunks/D7obuF16.js";const Qt=!1,Xt=async()=>({chords:await Vt()}),hr=Object.freeze(Object.defineProperty({__proto__:null,load:Xt,ssr:Qt},Symbol.toStringTag,{value:"Module"}));var Yt=S('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1kbb9q3"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1kbb9q3">Back to top</span></button>');function $t(_,e){P(e,!0);let l=F(0),s=F(!0),d;const D=o=>{o>0?A(s,!1):A(s,!0),d&&clearTimeout(d),d=setTimeout(()=>{A(s,!0)},3e3)},k=()=>{const o=document.documentElement.scrollTop||document.body.scrollTop;o>0&&(window.requestAnimationFrame(k),window.scrollTo(0,o-o/2))};bt(()=>D(t(l)));var a=Yt();let r;a.__click=k,M(o=>r=ut(a,1,"top-link svelte-1kbb9q3",null,r,o),[()=>({hide:t(s)})]),xt("y",()=>t(l),o=>A(l,o,!0)),b(_,a),G()}ot(["click"]);const st=wt();let St=[];const mt=localStorage.getItem("failedVisitCounts");if(mt!==null)try{St=JSON.parse(mt)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const ct=wt(St);ct.subscribe(_=>{localStorage.setItem("failedVisitCounts",JSON.stringify(_))});const Dt=_=>_==="doc"?"fas fa-file-word":_==="pdf"?"fas fa-file-pdf":_==="youtube"?"fa fa-youtube":"fas fa-link",te=async(_,e,l)=>{try{await pt(e.chord.url);const s=Ft(st),d=s.get(e.chord.url)||{count:0,lastAccessDateUnix:0};d.count++,d.lastAccessDateUnix=Date.now()/1e3,s.set(e.chord.url,d),st.set(s)}catch(s){let d=s.message;s instanceof Pt&&s.code===401?d="Invalid logged in user":s instanceof Gt&&(d="User is logged out"),Lt(ct,[...l(),e.chord.url]);const D=`<strong>Visit not counted</strong><br/> ${d}`;Jt.push(D,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};var ee=S('<span></span> <span><a target="_blank" rel="noopener noreferrer"> </a></span>',1);function nt(_,e){P(e,!0);const[l,s]=yt(),d=()=>ft(ct,"$failedVisitCounts",l);let D=vt(e,"showArtist",3,!1),k=F(void 0);st.subscribe(i=>{if(i&&i.has(e.chord.url)){const f=i.get(e.chord.url),y=new Date(f.lastAccessDateUnix*1e3);A(k,`visits: ${f.count} - last: ${y.toLocaleDateString()}`)}});const a=(D()?e.chord.artist+" - ":"")+e.chord.title,r=i=>i.type==="doc"?`${Rt}/docviewer/${i.url}`:i.url;var o=ee(),h=O(o),m=p(h,2),C=v(m);C.__click=[te,e,d];var u=v(C,!0);n(C),n(m),M((i,f)=>{ut(h,1,i,"svelte-1yqqigs"),rt(C,"href",f),rt(C,"title",t(k)),q(u,a)},[()=>Ct(Dt(e.chord.type)),()=>r(e.chord)]),b(_,o),G(),s()}ot(["click"]);var re=S('<li class="ul2col-item"><!> <!></li>'),ae=S('<ul class="ul2col-container"></ul>');function se(_,e){P(e,!0);let l=vt(e,"chords",15),s=F(void 0);st.subscribe(a=>{a&&(A(s,a,!0),l(l().sort((r,o)=>{const h=a.get(r.url),m=a.get(o.url);return h&&m?m.lastAccessDateUnix-h.lastAccessDateUnix:h?-1:m?1:r.artist!=o.artist?r.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:r.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const d=(a,r,o)=>o[a.type]===!1?!1:r.length===0||a.artist.toLowerCase().match(r.toLowerCase())?!0:a.title.toLowerCase().match(r.toLowerCase());var D=H(),k=O(D);gt(k,l,a=>{var r=ae();I(r,21,l,R,(o,h)=>{const m=tt(()=>t(s)?.get(t(h).url));var C=H(),u=O(C);{var i=f=>{var y=re(),c=v(y);{var g=x=>{var L=kt();M(()=>q(L,`(${t(m).count??""})`)),b(x,L)};J(c,x=>{t(m)&&x(g)})}var w=p(c,2);nt(w,{get chord(){return t(h)},showArtist:!0}),n(y),b(f,y)};J(u,f=>{d(t(h),e.searchString,e.filters)&&f(i)})}b(o,C)}),n(r),b(a,r)}),b(_,D),G()}const oe=(_,e)=>_<e?-1:_>e?1:0,Tt=(_,e)=>{const l=_.toLowerCase(),s=e.toLowerCase();return oe(l,s)};var ne=S('<li class="navigationBtn svelte-1deg5s8"><a class="navigationLink svelte-1deg5s8"> </a></li>'),le=S('<li class="ul2col-item"><!></li>'),ie=S('<ul class="ul2col-container"></ul>'),ce=S('<tr class="svelte-1deg5s8"><td class="svelte-1deg5s8"> <!></td></tr>'),ue=S('<ol id="indexList" class="navigationBar disable-scrollbars svelte-1deg5s8"></ol> <table id="artistTable"><tbody></tbody></table>',1);function ve(_,e){P(e,!0);let l=vt(e,"searchString",3,"");const s=e.chords.reduce((c,g)=>{const w=g.artist;return c[w]||(c[w]=[]),c[w].push(g),c},{}),d=[],D=Object.keys(s).sort(Tt).map((c,g,w)=>{if(g===0||c[0].toLowerCase()!=w[g-1][0].toLowerCase()){const x="anchor_letter_"+c[0];return d.push({letter:c[0],tag:x}),{name:c,tag:x}}return{name:c}});let k=F(0),a=F(0),r=F(void 0);const o=c=>{if(t(r)){var g=t(r).getBoundingClientRect();if(g.top<20){A(a,20);return}A(a,g.top,!0)}};bt(()=>o(t(k)));const h=(c,g,w)=>s[c].sort((L,B)=>L.title<B.title?-1:1).filter(L=>{const B=L.type;return w[B]===!1?!1:g.length===0?!0:!!L.title.toLowerCase().match(g.toLowerCase())}),m=(c,g)=>!!c.toLowerCase().match(g.toLowerCase());var C=ue(),u=O(C);let i;I(u,21,()=>d,R,(c,g)=>{var w=ne(),x=v(w),L=v(x,!0);n(x),n(w),M(B=>{rt(x,"href","#"+t(g).tag),q(L,B)},[()=>t(g).letter.toUpperCase()]),b(c,w)}),n(u);var f=p(u,2),y=v(f);I(y,21,()=>D,R,(c,g)=>{const w=tt(()=>h(t(g).name,l(),e.filters)),x=tt(()=>m(t(g).name,l()));var L=H(),B=O(L);{var N=Y=>{const $=tt(()=>t(x)?s[t(g).name]:t(w));var K=ce(),z=v(K),W=v(z),at=p(W);gt(at,l,j=>{var Z=ie();I(Z,21,()=>t($),R,(Q,lt)=>{var T=le(),V=v(T);nt(V,{get chord(){return t(lt)}}),n(T),b(Q,T)}),n(Z),b(j,Z)}),n(z),n(K),M(()=>{rt(z,"id",t(g).tag),q(W,`${t(g).name??""} `)}),b(Y,K)};J(B,Y=>{(t(x)||t(w).length>0)&&Y(N)})}b(c,L)}),n(y),n(f),Kt(f,c=>A(r,c),()=>t(r)),M(c=>i=dt(u,"",i,c),[()=>({"--barTop":`${t(a)??""}px`})]),xt("y",()=>t(k),c=>A(k,c,!0)),b(_,C),G()}var de=S('<li class="ul2col-item"><!></li>'),fe=S('<div><span> </span> <ul class="ul2col-container"></ul></div>');function he(_,e){P(e,!0);const l=k=>k.charAt(0).toUpperCase()+k.slice(1).toLowerCase(),s=et({});for(const k of e.chords)k.tags.forEach(r=>{s[r]||(s[r]=[]),s[r].push(k)});Object.keys(s).forEach(k=>{s[k].sort((a,r)=>{const o=a.artist.toLowerCase(),h=r.artist.toLowerCase(),m=a.title.toLowerCase(),C=r.title.toLowerCase();return o<h?-1:o>h?1:m<C?-1:1})});var d=H(),D=O(d);I(D,17,()=>Object.keys(s).sort(Tt),R,(k,a)=>{var r=H(),o=O(r);{var h=m=>{var C=fe(),u=v(C),i=v(u,!0);n(u);var f=p(u,2);I(f,21,()=>s[t(a)],R,(y,c)=>{var g=H(),w=O(g);{var x=L=>{var B=de(),N=v(B);nt(N,{get chord(){return t(c)},showArtist:!0}),n(B),b(L,B)};J(w,L=>{e.filters[t(c).type]&&L(x)})}b(y,g)}),n(f),n(C),M(y=>q(i,y),[()=>l(t(a))]),b(m,C)};J(o,m=>{(e.searchString.length===0||t(a).toLowerCase().match(e.searchString.toLowerCase()))&&m(h)})}b(k,r)}),b(_,d),G()}var ge=S('<li class="ul2col-item"><!> <!></li>'),_e=S('<ul class="ul2col-container"></ul>');function me(_,e){P(e,!0);let l=vt(e,"chords",15),s=F(void 0);st.subscribe(a=>{a&&(A(s,a,!0),l(l().sort((r,o)=>{const h=a.get(r.url),m=a.get(o.url);return h&&m?h.count!==m.count?m.count-h.count:m.lastAccessDateUnix-h.lastAccessDateUnix:h?-1:m?1:r.artist!=o.artist?r.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:r.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const d=(a,r,o)=>o[a.type]===!1?!1:r.length===0||a.artist.toLowerCase().match(r.toLowerCase())?!0:a.title.toLowerCase().match(r.toLowerCase());var D=H(),k=O(D);gt(k,l,a=>{var r=_e();I(r,21,l,R,(o,h)=>{const m=tt(()=>t(s)?.get(t(h).url));var C=H(),u=O(C);{var i=f=>{var y=ge(),c=v(y);{var g=x=>{var L=kt();M(()=>q(L,`(${t(m).count??""})`)),b(x,L)};J(c,x=>{t(m)&&x(g)})}var w=p(c,2);nt(w,{get chord(){return t(h)},showArtist:!0}),n(y),b(f,y)};J(u,f=>{d(t(h),e.searchString,e.filters)&&f(i)})}b(o,C)}),n(r),b(a,r)}),b(_,D),G()}var pe=S('<span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-5k8p3l"> </span>',1),be=S('<div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Last Check</span> <span class="col table-head svelte-5k8p3l">Checks</span> <span class="col table-head svelte-5k8p3l">Skipped</span> <span class="col table-head svelte-5k8p3l">Errors</span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span></div> <br/> <div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Status</span> <span class="col table-head svelte-5k8p3l">Ref</span> <span class="col table-head svelte-5k8p3l">Host</span> <span class="col table-head svelte-5k8p3l">Data</span> <!></div>',1),ke=S('<p style="color: red"> </p>'),we=S("<p>Fetching results...</p>"),Ce=S('<div role="dialog" class="modal svelte-5k8p3l"><div class="contents svelte-5k8p3l"><h3 class="title-bar svelte-5k8p3l">Urls checks <button>Close</button></h3> <!></div></div>');function ye(_,e){P(e,!0);const l=a=>{const r=new Date(a.timestamp);return r.toDateString()+" "+r.toTimeString()},s=a=>a.fails.sort((r,o)=>r.chord.url<o.chord.url?-1:1);var d=H(),D=O(d);{var k=a=>{var r=Ce(),o=v(r),h=v(o),m=p(v(h));m.__click=function(...u){e.close?.apply(this,u)},n(h);var C=p(h,2);Wt(C,Ut,u=>{var i=we();b(u,i)},(u,i)=>{const f=tt(()=>l(t(i))),y=tt(()=>s(t(i)));var c=be(),g=O(c),w=p(v(g),8),x=v(w,!0);n(w);var L=p(w,2),B=v(L,!0);n(L);var N=p(L,2),Y=v(N,!0);n(N);var $=p(N,2),K=v($,!0);n($),n(g);var z=p(g,4),W=p(v(z),8);I(W,17,()=>t(y),R,(at,j)=>{var Z=pe(),Q=O(Z),lt=v(Q,!0);n(Q);var T=p(Q,2),V=v(T);n(T);var U=p(T,2),E=v(U),it=v(E,!0);n(E),n(U);var X=p(U,2),At=v(X,!0);n(X),M(Bt=>{q(lt,t(j).status),q(V,`${t(j).chord.artist??""} - ${t(j).chord.title??""}`),rt(E,"href",t(j).chord.url),q(it,new URL(t(j).chord.url).hostname),q(At,Bt)},[()=>t(j).error?JSON.stringify(t(j).error):""]),b(at,Z)}),n(z),M(()=>{q(x,t(f)),q(B,t(i).nbChecks),q(Y,t(i).nbSkipped),q(K,t(i).nbFails)}),b(u,c)},(u,i)=>{var f=ke(),y=v(f);n(f),M(()=>q(y,`Could not retrieve checks: ${t(i).message??""}`)),b(u,f)}),n(o),n(r),b(a,r)};J(D,a=>{e.isOpen&&a(k)})}b(_,d),G()}ot(["click"]);var Le=(_,e)=>e(),xe=S('<li class="ul2col-separator"> </li>'),Se=S('<!> <li class="ul2col-item"><!></li>',1),De=S('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function Te(_,e){P(e,!0);const l=Date.now(),s=1e3*3600*24*7,d=s*4,D=[{label:"last week",time:l-s},{label:"one month ago",time:l-d},{label:"two months ago",time:l-2*d},{label:"six months ago",time:l-6*d},{label:"one year ago",time:l-12*d}],k=e.chords.filter(i=>i.creationDate).sort((i,f)=>f.creationDate-i.creationDate).map((i,f,y)=>{const c={...i};if(f>0){const g=y[f-1];for(const{time:w,label:x}of D)g.creationDate>w&&i.creationDate<w&&(c.dateTag=x)}return c});let a=6,r=F(et([]));const o=()=>{a+=4,A(r,k.slice(0,a),!0)};ht(()=>{o()});var h=De(),m=v(h),C=p(v(m));C.__click=[Le,o],n(m);var u=p(m,2);I(u,21,()=>t(r),R,(i,f)=>{var y=Se(),c=O(y);{var g=L=>{var B=xe(),N=v(B,!0);n(B),M(()=>q(N,t(f).dateTag)),b(L,B)};J(c,L=>{t(f).dateTag&&L(g)})}var w=p(c,2),x=v(w);nt(x,{get chord(){return t(f)}}),n(w),b(i,y)}),n(u),n(h),b(_,h),G()}ot(["click"]);const Ae=(_,e,l,s,d)=>{t(e).length<=l||(t(e).splice(t(e).length-l),A(s,t(e).slice(t(e).length-l).map(D=>d.chords[D]),!0))};var Be=S("<button>&nbsp↶&nbsp</button>"),Ve=S('<li class="ul2col-item"><!></li>'),Ue=S('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br/> <ul class="ul2col-container"></ul></div>');function qe(_,e){P(e,!0);const l=6;let s=F(et([])),d=F(et([]));const D=()=>{t(s).length>=e.chords.length-l&&A(s,[],!0);for(let u=0;u<l;u++){let i=-1;for(;i===-1||t(s).includes(i);)i=Math.floor(Math.random()*e.chords.length);t(s).push(i)}A(d,t(s).slice(t(s).length-l).map(u=>e.chords[u]),!0)};ht(()=>{D()});var k=Ue(),a=v(k),r=p(v(a)),o=v(r);{var h=u=>{var i=Be();i.__click=[Ae,s,l,d,e],b(u,i)};J(o,u=>{t(s).length>l&&u(h)})}var m=p(o,2);m.__click=D,n(r),n(a);var C=p(a,4);I(C,21,()=>t(d),u=>u.url,(u,i)=>{var f=Ve(),y=v(f);nt(y,{get chord(){return t(i)},showArtist:!0}),n(f),b(u,f)}),n(C),n(k),b(_,k),G()}ot(["click"]);var Fe=()=>Nt.open(ye),Me=()=>zt("/songbook/edit"),Oe=(_,e)=>A(e,""),Ee=(_,e,l)=>{t(e)[t(l)]=!t(e)[t(l)],A(e,t(e),!0)},Ne=S('<button class="filter-control svelte-1gfqv35"><input type="checkbox"/> <span></span></button>'),je=(_,e,l)=>A(e,t(l),!0),Ie=S("<button> </button>"),Re=S('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"/> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1gfqv35"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1gfqv35"></div></div> <!>',1);function gr(_,e){P(e,!0);const[l,s]=yt(),d=()=>ft(ct,"$failedVisitCounts",l),D=()=>ft(Ht,"$user",l);Zt.set("Songbook");const{chords:k}=e.data;let a=F(et([]));const r=T=>{t(a).push(T),A(a,t(a),!0),setTimeout(()=>{t(a).shift(),A(a,t(a),!0)},5e3)};ht(async()=>{try{if(d().length&&D()){r({level:"info",header:"Trying to count missed visits while logged out"});for(const T of d())await pt(T);r({level:"success",header:`Counted ${d().length} missed visits`}),Lt(ct,[])}}catch{r({level:"error",header:"Couldnt upload failed visit counts"})}try{const V=(await qt()).reduce((U,E)=>(U.set(E.url,{...E}),U),new Map);st.set(V)}catch{r({level:"error",header:"Couldnt upload failed visit counts"})}});let o=F("");const h=[{label:"By artist",component:ve},{label:"By tags",component:he},{label:"By frequency",component:me},{label:"By access date",component:se}];let m=F(et(h[0]));const C={pdf:!0,doc:!0,youtube:!0,link:!0};let u=F(et({...C}));const i=Object.keys(C);var f=Re(),y=O(f);jt(y,{title:"Song Book",description:"My song book",iconPath:"/songbook.png"});var c=p(y,2),g=v(c),w=v(g);w.__click=[Fe],dt(w,"",{},{position:"relative"});var x=p(w,2);x.__click=[Me],dt(x,"",{},{position:"relative"}),n(g),n(c);var L=p(c,2);I(L,17,()=>t(a),R,(T,V)=>{It(T,{get item(){return t(V)}})});var B=p(L,2);$t(B,{});var N=p(B,2),Y=v(N);n(N);var $=p(N,2);Te($,{get chords(){return k}});var K=p($,2);qe(K,{get chords(){return k}});var z=p(K,2),W=p(v(z),2);_t(W);var at=p(W,2);at.__click=[Oe,o];var j=p(at,2),Z=p(v(j),2);I(Z,17,()=>i,R,(T,V)=>{var U=Ne();U.__click=[Ee,u,V];var E=v(U);_t(E);var it=p(E,2);n(U),M(X=>{rt(U,"aria-label",`filter for ${t(V)??""}`),rt(E,"id",t(V)),ut(it,1,X,"svelte-1gfqv35")},[()=>Ct(Dt(t(V)))]),Et(E,()=>t(u)[t(V)],X=>t(u)[t(V)]=X),b(T,U)}),n(j);var Q=p(j,4);I(Q,21,()=>h,R,(T,V)=>{var U=Ie();let E;U.__click=[je,m,V];var it=v(U,!0);n(U),M(X=>{E=ut(U,1,"control svelte-1gfqv35",null,E,X),q(it,t(V).label)},[()=>({selected:t(m)===t(V)})]),b(T,U)}),n(Q),n(z);var lt=p(z,2);Mt(lt,()=>t(m).component,(T,V)=>{V(T,{get chords(){return k},get searchString(){return t(o)},get filters(){return t(u)}})}),M(()=>q(Y,`This is a list of ${k.length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Ot(W,()=>t(o),T=>A(o,T)),b(_,f),G(),s()}ot(["click"]);export{gr as component,hr as universal};
