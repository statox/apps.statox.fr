import"../chunks/NZTpNUN0.js";import{a as it}from"../chunks/Dpa7cG8s.js";import{p as st,b as m,f as d,s as o,a as s,d as lt,e as N,r as O,g as a,h as b,i as r,c as D,t as j,j as V}from"../chunks/D1gec7hp.js";import{s as Y}from"../chunks/DqykZqCX.js";import{i as v}from"../chunks/BQPfd91e.js";import{r as pt}from"../chunks/CwBosGx5.js";import{d as vt}from"../chunks/DBXcV7xI.js";import{b as _t}from"../chunks/cDPM8xt1.js";import{B as x,a as q}from"../chunks/hBZXBj3o.js";import{P as mt}from"../chunks/CELBgAxi.js";import{g as ct}from"../chunks/DMOHQlkJ.js";import{c as gt}from"../chunks/ldFxFRwj.js";import"../chunks/uzsX0xSz.js";var ft=m('<button>Start a new game</button> <br/> <input type="string"/> <button>Join Game</button>',1),ut=m("<p>Connecting to the server…</p>"),dt=m("<p>Waiting for an opponent to connect…</p>"),bt=m("<p> </p> <!>",1),yt=m("<p>Something went wrong. Board is not defined.</p>"),wt=m('<p>Game over</p> <button>Restart</button> <span style="font-weight: bold"><!></span> <!>',1),St=m("<p>Disconnected</p>"),ht=m("<h3>Online game <button>Back</button></h3> <!> <!> <!> <!> <!> <!>",1);function At(z,F){st(F,!0);let n,B=b(null),c=b(null),g=b(null),S=b(null),l=b("initial"),h=b("");const H=async()=>{const t=await gt.gravitrips.getNewGame();r(h,t.gameId,!0),G()},K=mt.replace(/^http?/,"ws");it(()=>{n&&n.close()});const G=()=>{n=new WebSocket(K+"/gravitrips/ws?"+a(h)),r(l,"connecting"),r(c,null),r(g,null),r(S,null),n.onopen=()=>{r(l,"waiting_for_opponent")},n.onclose=t=>{console.log(t.reason),r(l,"disconnected")},n.onmessage=t=>{const e=JSON.parse(t.data);e.type==="game_ready"?(r(l,"playing"),r(B,e.youAre,!0),r(c,e.board,!0)):e.type==="update_board"?(r(c,e.board,!0),r(g,e.boardState,!0),r(S,e.winningCells,!0)):e.type==="waiting_for_opponent"?r(g,null):e.type==="game_over"&&r(l,"game_over")}},I=t=>{if(!n||n.readyState!==WebSocket.OPEN)return;const e=JSON.stringify({type:"move",column:t});n.send(e)},Q=()=>{if(!n||n.readyState!==WebSocket.OPEN)return;const t=JSON.stringify({type:"restart"});n.send(t)};var W=ht(),P=d(W),T=o(N(P));T.__click=()=>ct("/gravitrips"),O(P);var E=o(P,2);{var X=t=>{var e=ft(),f=d(e);f.__click=H;var _=o(f,4);pt(_);var y=o(_,2);y.__click=G,_t(_,()=>a(h),p=>r(h,p)),s(t,e)};v(E,t=>{["initial","waiting_for_opponent","game_over","disconnected"].includes(a(l))&&t(X)})}var J=o(E,2);{var Z=t=>{var e=ut();s(t,e)};v(J,t=>{a(l)==="connecting"&&t(Z)})}var A=o(J,2);{var $=t=>{var e=dt();s(t,e)};v(A,t=>{a(l)==="waiting_for_opponent"&&t($)})}var L=o(A,2);{var tt=t=>{var e=D(),f=d(e);{var _=p=>{var u=bt(),w=d(u),C=N(w);O(w);var i=o(w,2);q(i,{nbColumns:7,nbRows:6,get board(){return a(c)},get winningCells(){return a(S)},onMove:I}),j(()=>Y(C,`You are Player ${a(B)??""}`)),s(p,u)},y=p=>{var u=yt();s(p,u)};v(f,p=>{a(c)!==null?p(_):p(y,!1)})}s(t,e)};v(L,t=>{a(l)==="playing"&&t(tt)})}var M=o(L,2);{var et=t=>{var e=wt(),f=o(d(e),2);f.__click=Q;var _=o(f,2),y=N(_);{var p=i=>{var k=V("Game Over");s(i,k)},u=i=>{var k=D(),ot=d(k);{var nt=R=>{var U=V();j(()=>Y(U,`Player ${a(g)??""} wins`)),s(R,U)};v(ot,R=>{(a(g)===x.winPlayer1||a(g)===x.winPlayer2)&&R(nt)},!0)}s(i,k)};v(y,i=>{a(g)===x.draw?i(p):i(u,!1)})}O(_);var w=o(_,2);{var C=i=>{q(i,{nbColumns:7,nbRows:6,get board(){return a(c)},get winningCells(){return a(S)},onMove:I})};v(w,i=>{a(c)!==null&&i(C)})}s(t,e)};v(M,t=>{a(l)==="game_over"&&t(et)})}var at=o(M,2);{var rt=t=>{var e=St();s(t,e)};v(at,t=>{a(l)==="disconnected"&&t(rt)})}s(z,W),lt()}vt(["click"]);export{At as component};
