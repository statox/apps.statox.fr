import{g as Ut,u as wt,a as Mt,b as Ot}from"../chunks/api.DbTWFf8f.js";import"../chunks/disclose-version.Bg9kRutz.js";import{i as tt}from"../chunks/legacy.C_zHTfcZ.js";import{p as W,aN as Ft,n as U,v as K,g as t,s as $,aH as ht,a$ as Ct,w as F,x as h,aF as d,aG as n,aY as I,aE as It,ab as at,aW as Et,aX as Nt,b8 as dt,aa as _t,o as mt}from"../chunks/index-client.DFiFioa0.js";import{s as M}from"../chunks/render.DyWnrpBj.js";import{e as j,i as H}from"../chunks/each.BNBFAId0.js";import{m as yt,a as _,t as T,s as Y,e as Q,q as Lt}from"../chunks/template.B8U5gakx.js";import{c as Rt}from"../chunks/svelte-component.BVWpMp56.js";import{s as st,c as xt,r as bt}from"../chunks/attributes.CrehYEsb.js";import{t as St,s as Dt,U as jt,u as Ht}from"../chunks/service.Dcomg13w.js";import{s as ft}from"../chunks/style.PwPRnE0L.js";import{b as Jt,d as Pt}from"../chunks/input.BXvQgZI5.js";import{p as O}from"../chunks/props.DmfObHap.js";import{s as Tt,b as At,a as pt}from"../chunks/store.DwD3Y092.js";import{m as zt}from"../chunks/Modals.CA6OwqXW.js";import{p as Gt}from"../chunks/proxy.BjU_LvYU.js";import{a as Bt}from"../chunks/window.eNcFncZD.js";import{M as Wt}from"../chunks/Main.-Dy2zY-3.js";import{M as Kt}from"../chunks/Main.Bvsa_JsB.js";import{i as G}from"../chunks/if.7Qw3ChGi.js";import{k as gt}from"../chunks/key.BDaYqtWk.js";import{b as Xt,g as Yt}from"../chunks/entry.-vgx3SFq.js";import{t as Qt}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.BwITkVjo.js";import{A as Zt}from"../chunks/index.DOVxHO28.js";import{b as te}from"../chunks/this.LcflnJzx.js";import{a as ee}from"../chunks/await.CvzPeN68.js";import{p as ae}from"../chunks/Main.svelte_svelte_type_style_lang.7DKd0dU9.js";const se=!1,re=async()=>({chords:await Ut()}),pa=Object.freeze(Object.defineProperty({__proto__:null,load:re,ssr:se},Symbol.toStringTag,{value:"Module"}));var oe=T('<button class="top-link svelte-1kbb9q3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1kbb9q3"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1kbb9q3">Back to top</span></button>');function ne(C,u){W(u,!0);let L=ht(0),f=ht(!0),k;const b=i=>{i>0?$(f,!1):$(f,!0),k&&clearTimeout(k),k=setTimeout(()=>{$(f,!0)},3e3)},x=()=>{const i=document.documentElement.scrollTop||document.body.scrollTop;i>0&&(window.requestAnimationFrame(x),window.scrollTo(0,i-i/2))};Ft(()=>b(t(L)));var w=oe();w.__click=x,U(()=>St(w,"hide",t(f))),Bt("y",()=>t(L),i=>$(L,Gt(i))),_(C,w),K()}yt(["click"]);const ot=Ct();let Vt=[];const kt=localStorage.getItem("failedVisitCounts");if(kt!==null)try{Vt=JSON.parse(kt)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const it=Ct(Vt);it.subscribe(C=>{localStorage.setItem("failedVisitCounts",JSON.stringify(C))});const $t=C=>C==="doc"?"fas fa-file-word":C==="pdf"?"fas fa-file-pdf":C==="youtube"?"fa fa-youtube":"fas fa-link";var le=T('<span></span> <span><a target="_blank" rel="noopener noreferrer"></a></span>',1);function nt(C,u){W(u,!1);const[L,f]=Tt(),k=()=>pt(it,"$failedVisitCounts",L);let b=O(u,"chord",8),x=O(u,"showArtist",8,!1),w=I();ot.subscribe(s=>{if(s&&s.has(b().url)){const g=s.get(b().url),o=new Date(g.lastAccessDateUnix*1e3);$(w,`visits: ${g.count} - last: ${o.toLocaleDateString()}`)}});const i=(x()?b().artist+" - ":"")+b().title,a=s=>s.type==="doc"?`${Xt}/docviewer/${s.url}`:s.url,e=async()=>{try{await wt(b().url);const s=It(ot),g=s.get(b().url)||{count:0,lastAccessDateUnix:0};g.count++,g.lastAccessDateUnix=Date.now()/1e3,s.set(b().url,g),ot.set(s)}catch(s){let g=s.message;s instanceof Zt&&s.code===401?g="Invalid logged in user":s instanceof jt&&(g="User is logged out"),At(it,[...k(),b().url]);const o=`<strong>Visit not counted</strong><br/> ${g}`;Qt.push(o,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};tt();var c=le(),p=F(c);const l=at(()=>xt($t(b().type)));var m=h(p,2),r=d(m);U(()=>st(r,"href",a(b()))),r.textContent=i,n(m),U(()=>{Dt(p,t(l),"svelte-1yqqigs"),st(r,"title",t(w))}),Y("click",r,e),_(C,c),K(),f()}var ie=T('<li class="ul2col-item"><!> <!></li>'),ce=T('<ul class="ul2col-container"></ul>');function ue(C,u){W(u,!1);let L=O(u,"searchString",8),f=O(u,"chords",12),k=O(u,"filters",8),b=I();ot.subscribe(a=>{a&&($(b,a),f(f().sort((e,c)=>{const p=a.get(e.url),l=a.get(c.url);return p&&l?l.lastAccessDateUnix-p.lastAccessDateUnix:p?-1:l?1:e.artist!=c.artist?e.artist.toLowerCase()<c.artist.toLowerCase()?-1:1:e.title.toLowerCase()<c.title.toLowerCase()?-1:1})))});const x=(a,e,c)=>c[a.type]===!1?!1:e.length===0||a.artist.toLowerCase().match(e.toLowerCase())?!0:a.title.toLowerCase().match(e.toLowerCase());tt();var w=Q(),i=F(w);gt(i,f,a=>{var e=ce();j(e,5,f,H,(c,p)=>{var l=Q();const m=at(()=>t(b).get(t(p).url));var r=F(l);{var s=g=>{var o=ie(),v=d(o);{var y=D=>{var A=Lt();U(()=>M(A,`(${t(m).count??""})`)),_(D,A)};G(v,D=>{t(m)&&D(y)})}var S=h(v,2);nt(S,{get chord(){return t(p)},showArtist:!0}),n(o),_(g,o)};G(r,g=>{x(t(p),L(),k())&&g(s)})}_(c,l)}),n(e),_(a,e)}),_(C,w),K()}const ve=(C,u)=>C<u?-1:C>u?1:0,qt=(C,u)=>{const L=C.toLowerCase(),f=u.toLowerCase();return ve(L,f)};var de=T('<li class="navigationBtn svelte-1deg5s8"><a class="navigationLink svelte-1deg5s8"> </a></li>'),fe=T('<li class="ul2col-item"><!></li>'),pe=T('<ul class="ul2col-container"></ul>'),me=T('<tr class="svelte-1deg5s8"><td class="svelte-1deg5s8"> <!></td></tr>'),ge=T('<ol id="indexList" class="navigationBar disable-scrollbars svelte-1deg5s8"></ol> <table id="artistTable"><tbody></tbody></table>',1);function he(C,u){W(u,!1);let L=O(u,"searchString",8,""),f=O(u,"chords",8),k=O(u,"filters",8);const b=f().reduce((o,v)=>{const y=v.artist;return o[y]||(o[y]=[]),o[y].push(v),o},{}),x=[],w=Object.keys(b).sort(qt).map((o,v,y)=>{if(v===0||o[0].toLowerCase()!=y[v-1][0].toLowerCase()){const S="anchor_letter_"+o[0];return x.push({letter:o[0],tag:S}),{name:o,tag:S}}return{name:o}});let i=I(),a=I(0),e=I();const c=o=>{if(t(e)){var v=t(e).getBoundingClientRect();if(v.top<20){$(a,20);return}$(a,v.top)}},p=(o,v,y)=>b[o].sort((D,A)=>D.title<A.title?-1:1).filter(D=>{const A=D.type;return y[A]===!1?!1:v.length===0?!0:!!D.title.toLowerCase().match(v.toLowerCase())}),l=(o,v)=>!!o.toLowerCase().match(v.toLowerCase());Et(()=>t(i),()=>{c(t(i))}),Nt(),tt();var m=ge(),r=F(m);j(r,5,()=>x,H,(o,v)=>{var y=de(),S=d(y),D=d(S,!0);U(()=>M(D,t(v).letter.toUpperCase())),n(S),n(y),U(()=>st(S,"href","#"+t(v).tag)),_(o,y)}),n(r);var s=h(r,2),g=d(s);j(g,5,()=>w,H,(o,v)=>{var y=Q();const S=at(()=>p(t(v).name,L(),k())),D=at(()=>l(t(v).name,L()));var A=F(y);{var J=E=>{var P=me();const Z=at(()=>t(D)?b[t(v).name]:t(S));var X=d(P),et=d(X),N=h(et);gt(N,L,rt=>{var z=pe();j(z,5,()=>t(Z),H,(lt,V)=>{var B=fe(),q=d(B);nt(q,{get chord(){return t(V)}}),n(B),_(lt,B)}),n(z),_(rt,z)}),n(X),n(P),U(()=>{st(X,"id",t(v).tag),M(et,`${t(v).name??""} `)}),_(E,P)};G(A,E=>{(t(D)||t(S).length>0)&&E(J)})}_(o,y)}),n(g),n(s),te(s,o=>$(e,o),()=>t(e)),U(()=>ft(r,"--barTop",`${t(a)??""}px`)),Bt("y",()=>t(i),o=>$(i,o)),_(C,m),K()}var _e=T('<li class="ul2col-item"><!></li>'),be=T('<div><span> </span> <ul class="ul2col-container"></ul></div>');function ke(C,u){W(u,!1);let L=O(u,"searchString",8),f=O(u,"chords",8),k=O(u,"filters",8);const b=a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase(),x=I({});for(const a of f())a.tags.forEach(c=>{t(x)[c]||dt(x,t(x)[c]=[]),t(x)[c].push(a)});Object.keys(t(x)).forEach(a=>{t(x)[a].sort((e,c)=>{const p=e.artist.toLowerCase(),l=c.artist.toLowerCase(),m=e.title.toLowerCase(),r=c.title.toLowerCase();return p<l?-1:p>l?1:m<r?-1:1})}),tt();var w=Q(),i=F(w);j(i,1,()=>Object.keys(t(x)).sort(qt),H,(a,e)=>{var c=Q(),p=F(c);{var l=m=>{var r=be(),s=d(r),g=d(s,!0);U(()=>M(g,b(t(e)))),n(s);var o=h(s,2);j(o,5,()=>t(x)[t(e)],H,(v,y)=>{var S=Q(),D=F(S);{var A=J=>{var E=_e(),P=d(E);nt(P,{get chord(){return t(y)},showArtist:!0}),n(E),_(J,E)};G(D,J=>{k()[t(y).type]&&J(A)})}_(v,S)}),n(o),n(r),_(m,r)};G(p,m=>{(L().length===0||t(e).toLowerCase().match(L().toLowerCase()))&&m(l)})}_(a,c)}),_(C,w),K()}var we=T('<li class="ul2col-item"><!> <!></li>'),Ce=T('<ul class="ul2col-container"></ul>');function ye(C,u){W(u,!1);let L=O(u,"searchString",8),f=O(u,"chords",12),k=O(u,"filters",8),b=I();ot.subscribe(a=>{a&&($(b,a),f(f().sort((e,c)=>{const p=a.get(e.url),l=a.get(c.url);return p&&l?p.count!==l.count?l.count-p.count:l.lastAccessDateUnix-p.lastAccessDateUnix:p?-1:l?1:e.artist!=c.artist?e.artist.toLowerCase()<c.artist.toLowerCase()?-1:1:e.title.toLowerCase()<c.title.toLowerCase()?-1:1})))});const x=(a,e,c)=>c[a.type]===!1?!1:e.length===0||a.artist.toLowerCase().match(e.toLowerCase())?!0:a.title.toLowerCase().match(e.toLowerCase());tt();var w=Q(),i=F(w);gt(i,f,a=>{var e=Ce();j(e,5,f,H,(c,p)=>{var l=Q();const m=at(()=>t(b).get(t(p).url));var r=F(l);{var s=g=>{var o=we(),v=d(o);{var y=D=>{var A=Lt();U(()=>M(A,`(${t(m).count??""})`)),_(D,A)};G(v,D=>{t(m)&&D(y)})}var S=h(v,2);nt(S,{get chord(){return t(p)},showArtist:!0}),n(o),_(g,o)};G(r,g=>{x(t(p),L(),k())&&g(s)})}_(c,l)}),n(e),_(a,e)}),_(C,w),K()}var Le=T('<span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-5k8p3l"> </span>',1),xe=T('<div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Last Check</span> <span class="col table-head svelte-5k8p3l">Checks</span> <span class="col table-head svelte-5k8p3l">Skipped</span> <span class="col table-head svelte-5k8p3l">Errors</span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span></div> <br> <div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Status</span> <span class="col table-head svelte-5k8p3l">Ref</span> <span class="col table-head svelte-5k8p3l">Host</span> <span class="col table-head svelte-5k8p3l">Data</span> <!></div>',1),Se=T('<p style="color: red"> </p>'),De=T("<p>Fetching results...</p>"),Te=T('<div role="dialog" class="modal svelte-5k8p3l"><div class="contents svelte-5k8p3l"><h3 class="title-bar svelte-5k8p3l">Urls checks <button>Close</button></h3> <!></div></div>');function Ae(C,u){W(u,!0);const L=w=>{const i=new Date(w.timestamp);return i.toDateString()+" "+i.toTimeString()},f=w=>w.fails.sort((i,a)=>i.chord.url<a.chord.url?-1:1);var k=Q(),b=F(k);{var x=w=>{var i=Te(),a=d(i),e=d(a),c=h(d(e));c.__click=function(...l){var m;(m=u.close)==null||m.apply(this,l)},n(e);var p=h(e,2);ee(p,Mt,l=>{var m=De();_(l,m)},(l,m)=>{var r=xe();const s=_t(()=>L(t(m))),g=_t(()=>f(t(m)));var o=F(r),v=h(d(o),8),y=d(v,!0);n(v);var S=h(v,2),D=d(S,!0);n(S);var A=h(S,2),J=d(A,!0);n(A);var E=h(A,2),P=d(E,!0);n(E),n(o);var Z=h(o,4),X=h(d(Z),8);j(X,17,()=>t(g),H,(et,N)=>{var rt=Le(),z=F(rt),lt=d(z,!0);n(z);var V=h(z,2),B=d(V);n(V);var q=h(V,2),R=d(q),ut=d(R,!0);n(R),n(q);var ct=h(q,2),vt=d(ct,!0);U(()=>M(vt,t(N).error?JSON.stringify(t(N).error):"")),n(ct),U(()=>{M(lt,t(N).status),M(B,`${t(N).chord.artist??""} - ${t(N).chord.title??""}`),st(R,"href",t(N).chord.url),M(ut,new URL(t(N).chord.url).hostname)}),_(et,rt)}),n(Z),U(()=>{M(y,t(s)),M(D,t(m).nbChecks),M(J,t(m).nbSkipped),M(P,t(m).nbFails)}),_(l,r)},(l,m)=>{var r=Se(),s=d(r);n(r),U(()=>M(s,`Could not retrieve checks: ${t(m).message??""}`)),_(l,r)}),n(a),n(i),_(w,i)};G(b,w=>{u.isOpen&&w(x)})}_(C,k),K()}yt(["click"]);var Be=T('<li class="ul2col-separator"> </li>'),Ve=T('<!> <li class="ul2col-item"><!></li>',1),$e=T('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function qe(C,u){W(u,!1);let L=O(u,"chords",8);const f=Date.now(),k=1e3*3600*24*7,b=k*4,x=[{label:"last week",time:f-k},{label:"one month ago",time:f-b},{label:"two monthes ago",time:f-2*b},{label:"six monthes ago",time:f-6*b},{label:"one year ago",time:f-12*b}],w=L().filter(r=>r.creationDate).sort((r,s)=>s.creationDate-r.creationDate).map((r,s,g)=>{const o={...r};if(s>0){const v=g[s-1];for(const{time:y,label:S}of x)v.creationDate>y&&r.creationDate<y&&(o.dateTag=S)}return o});let i=6,a=I([]);const e=()=>{i+=4,$(a,w.slice(0,i))};mt(()=>{e()}),tt();var c=$e(),p=d(c),l=h(d(p));n(p);var m=h(p,2);j(m,5,()=>t(a),H,(r,s)=>{var g=Ve(),o=F(g);{var v=D=>{var A=Be(),J=d(A,!0);n(A),U(()=>M(J,t(s).dateTag)),_(D,A)};G(o,D=>{t(s).dateTag&&D(v)})}var y=h(o,2),S=d(y);nt(S,{get chord(){return t(s)}}),n(y),_(r,g)}),n(m),n(c),Y("click",l,()=>e()),_(C,c),K()}var Ue=T("<button>&nbsp↶&nbsp</button>"),Me=T('<li class="ul2col-item"><!></li>'),Oe=T('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br> <ul class="ul2col-container"></ul></div>');function Fe(C,u){W(u,!1);let L=O(u,"chords",8);const f=6;let k=I([]),b=I([]);const x=()=>{t(k).length>=L().length-f&&$(k,[]);for(let r=0;r<f;r++){let s=-1;for(;s===-1||t(k).includes(s);)s=Math.floor(Math.random()*L().length);t(k).push(s)}$(b,t(k).slice(t(k).length-f).map(r=>L()[r]))},w=()=>{t(k).length<=f||(t(k).splice(t(k).length-f),$(b,t(k).slice(t(k).length-f).map(r=>L()[r])))};mt(()=>{x()}),tt();var i=Oe(),a=d(i),e=h(d(a)),c=d(e);{var p=r=>{var s=Ue();Y("click",s,w),_(r,s)};G(c,r=>{t(k).length>f&&r(p)})}var l=h(c,2);n(e),n(a);var m=h(a,4);j(m,5,()=>t(b),r=>r.url,(r,s)=>{var g=Me(),o=d(g);nt(o,{get chord(){return t(s)},showArtist:!0}),n(g),_(r,g)}),n(m),n(i),Y("click",l,x),_(C,i),K()}var Ie=T('<button class="filter-control svelte-1gfqv35"><input type="checkbox"> <span></span></button>'),Ee=T('<button class="control svelte-1gfqv35"> </button>'),Ne=T('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1gfqv35"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1gfqv35"></div></div> <!>',1);function ma(C,u){W(u,!1);const[L,f]=Tt(),k=()=>pt(it,"$failedVisitCounts",L),b=()=>pt(Ht,"$user",L);ae.set("Songbook");let x=O(u,"data",8);const{chords:w}=x();let i=I([]);const a=V=>{t(i).push(V),$(i,t(i)),setTimeout(()=>{t(i).shift(),$(i,t(i))},5e3)};mt(async()=>{try{if(k().length&&b()){a({level:"info",header:"Trying to count missed visits while logged out"});for(const V of k())await wt(V);a({level:"success",header:`Counted ${k().length} missed visits`}),At(it,[])}}catch{a({level:"error",header:"Couldnt upload failed visit counts"})}try{const B=(await Ot()).reduce((q,R)=>(q.set(R.url,{...R}),q),new Map);ot.set(B)}catch{a({level:"error",header:"Couldnt upload failed visit counts"})}});let e=I("");const c=[{label:"By artist",component:he},{label:"By tags",component:ke},{label:"By frequency",component:ye},{label:"By access date",component:ue}];let p=I(c[0]),l=I({pdf:!0,doc:!0,youtube:!0,link:!0});const m=Object.keys(t(l));tt();var r=Ne(),s=F(r);Wt(s,{title:"Song Book",description:"My song book",iconPath:"/songbook.png"});var g=h(s,2),o=d(g),v=d(o);ft(v,"position","relative");var y=h(v,2);ft(y,"position","relative"),n(o),n(g);var S=h(g,2);j(S,1,()=>t(i),H,(V,B)=>{Kt(V,{get item(){return t(B)}})});var D=h(S,2);ne(D,{});var A=h(D,2),J=d(A);n(A);var E=h(A,2);qe(E,{chords:w});var P=h(E,2);Fe(P,{chords:w});var Z=h(P,2),X=h(d(Z),2);bt(X);var et=h(X,2),N=h(et,2),rt=h(d(N),2);j(rt,1,()=>m,H,(V,B)=>{var q=Ie(),R=d(q);bt(R);var ut=h(R,2);const ct=at(()=>xt($t(t(B))));n(q),U(()=>{st(q,"aria-label",`filter for ${t(B)??""}`),st(R,"id",t(B)),Dt(ut,t(ct),"svelte-1gfqv35")}),Pt(R,()=>t(l)[t(B)],vt=>dt(l,t(l)[t(B)]=vt)),Y("click",q,()=>{dt(l,t(l)[t(B)]=!t(l)[t(B)]),$(l,t(l))}),_(V,q)}),n(N);var z=h(N,4);j(z,5,()=>c,H,(V,B)=>{var q=Ee(),R=d(q,!0);n(q),U(()=>{St(q,"selected",t(p)===t(B)),M(R,t(B).label)}),Y("click",q,()=>$(p,t(B))),_(V,q)}),n(z),n(Z);var lt=h(Z,2);Rt(lt,()=>t(p).component,(V,B)=>{B(V,{chords:w,get searchString(){return t(e)},get filters(){return t(l)}})}),U(()=>M(J,`This is a list of ${w.length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Y("click",v,()=>zt.open(Ae)),Y("click",y,()=>Yt("/songbook/edit")),Jt(X,()=>t(e),V=>$(e,V)),Y("click",et,()=>$(e,"")),_(C,r),K(),f()}export{ma as component,pa as universal};
