import"../chunks/NZTpNUN0.js";import{z as Pe,A,B as $,g as r,p as F,f as U,F as C,x as q,a as M,E as Ie,s as f,v as x,a$ as Ae,G as b,aZ as ne,y as Oe,a_ as le,c as ae}from"../chunks/Br9SMxIB.js";import{d as Te,e as Z,s as j}from"../chunks/BBzb7ThI.js";import{i as J}from"../chunks/CvXxFVm9.js";import{e as V,i as D}from"../chunks/D1-nhZYT.js";import{b as ie,a as oe,r as ce,s as Ee,c as ue}from"../chunks/DWdbj9D8.js";import{b as ve}from"../chunks/C6S4cPPP.js";import{M as qe}from"../chunks/DKmGubEx.js";var w=(e=>(e[e.notOver=0]="notOver",e[e.winPlayer1=1]="winPlayer1",e[e.winPlayer2=2]="winPlayer2",e[e.draw=3]="draw",e))(w||{});const k=7,P=6,_=4;class Fe extends Error{constructor(s){super("Can't play in column "+s)}}const Q=e=>e.map(s=>[...s]),he=(e,s)=>e[s].length!==P,N=e=>{const s=[];for(let t=0;t<e.length;t++)e[t].length<P&&s.push(t);return s},Ge=e=>{const s=k*P,t=e.reduce((l,c)=>l+c.length,0);return s===t},Re=e=>{for(let s=0;s<k;s++)for(let t=0;t<P;t++){if(e[s].length<t||!e[s][t])continue;const l=e[s][t];let c=0,o=0,m=0,u=0;for(let n=0;n<_;n++)t+n<=e[s].length&&e[s][t+n]===l&&c++,s+n<e.length&&e[s+n][t]===l&&o++,s+n<e.length&&t+n<=e[s+n].length&&e[s+n][t+n]===l&&m++,s+n<e.length&&t-n>=0&&e[s+n][t-n]===l&&u++;if(c===_||o===_||m===_||u===_)return l}return null},We=e=>{if(O(e)===0)return null;for(let s=0;s<k;s++)for(let t=0;t<P;t++){if(e[s].length<t||!e[s][t])continue;const l=e[s][t],c=[],o=[],m=[],u=[];for(let n=0;n<_;n++)t+n<=e[s].length&&e[s][t+n]===l&&c.push([t+n,s]),s+n<e.length&&e[s+n][t]===l&&o.push([t,s+n]),s+n<e.length&&t+n<=e[s+n].length&&e[s+n][t+n]===l&&m.push([t+n,s+n]),s+n<e.length&&t-n>=0&&e[s+n][t-n]===l&&u.push([t-n,s+n]);if(c.length===_)return c;if(o.length===_)return o;if(m.length===_)return m;if(u.length===_)return u}return null},O=e=>{if(Ge(e))return 3;const s=Re(e);return s===1?1:s===2?2:0},G=(e,s,t)=>{if(!he(e,t))throw new Fe(t);return e[t].push(s),e},$e=e=>{const s=N(e),t=Math.floor(Math.random()*s.length);return s[t]},Ve=(e,s)=>{const t=$e(e);return{board:G(e,s,t),move:t}},De=(e,s,t)=>{const l=Ue(e,s,t?.iterations,t?.c);return{board:G(e,s,l),move:l}};class me{board;player;move;parent;children=[];visits=0;wins=0;constructor(s,t,l=null,c=null){this.board=s,this.player=t,this.move=l,this.parent=c}isFullyExpanded(){return this.children.length===N(this.board).length}isTerminal(){return O(this.board)!==w.notOver}}function fe(e,s,t,l=Math.sqrt(2)){return t===0?1/0:s/t+l*Math.sqrt(Math.log(e)/t)}function Ne(e,s){for(;!e.isTerminal();)if(e.isFullyExpanded())e=He(e,s);else return ze(e);return e}function ze(e){const s=e.children.map(u=>u.move),l=N(e.board).filter(u=>!s.includes(u)),c=l[Math.floor(Math.random()*l.length)],o=Q(e.board);G(o,e.player,c);const m=new me(o,e.player===1?2:1,c,e);return e.children.push(m),m}function He(e,s){return e.children.reduce((t,l)=>{const c=fe(e.visits,t.wins,t.visits,s);return fe(e.visits,l.wins,l.visits,s)>c?l:t})}function Ke(e){const s=Q(e.board);let t=e.player;for(;;){const l=O(s);if(l!==w.notOver)return l;const c=N(s),o=c[Math.floor(Math.random()*c.length)];G(s,t,o),t=t===1?2:1}}function Le(e,s){let t=e;for(;t!==null;)t.visits+=1,s===w.winPlayer1&&t.parent?.player===1||s===w.winPlayer2&&t.parent?.player===2?t.wins+=1:s===w.draw&&(t.wins+=.5),t=t.parent}function Ue(e,s,t=1e3,l=Math.sqrt(2)){const c=new me(Q(e),s,null,null);for(let m=0;m<t;m++){const u=Ne(c,l),n=Ke(u);Le(u,n)}return c.children.reduce((m,u)=>m.visits>u.visits?m:u).move}var Ze=F('<option class="svelte-1bdwycb"> </option>'),je=(e,s,t,l)=>{r(s)&&(f(t,r(s).iterations,!0),f(l,r(s).c,!0))},Je=F('<option class="svelte-1bdwycb"> </option>'),Qe=(e,s)=>f(s,null),Se=(e,s)=>f(s,null),Xe=F(`<div class="svelte-1bdwycb"><h4 class="svelte-1bdwycb">Monte Carlo Tree Search parameters</h4> <label for="mcts-preset" class="svelte-1bdwycb">Preset difficulty</label> <select class="svelte-1bdwycb"></select> <br class="svelte-1bdwycb"/><br class="svelte-1bdwycb"/> <label for="mcts-iterations" class="svelte-1bdwycb">Iterations:</label> <input id="mcts-iterations" type="number" min="0" class="svelte-1bdwycb"/> <small class="svelte-1bdwycb">Number of simulations MCTS will run before choosing a move. Higher values usually mean
            stronger play but slower decisions.</small> <br class="svelte-1bdwycb"/><br class="svelte-1bdwycb"/> <label for="mcts-c" class="svelte-1bdwycb">C (exploration constant):</label> <input id="mcts-c" type="number" min="0" step="0.1" class="svelte-1bdwycb"/> <small class="svelte-1bdwycb">Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
            favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2
            ≈ 1.41.</small></div>`),Ye=(e,s,t,l)=>s(r(t),r(l)),Be=F('<div class="svelte-1bdwycb"><button><div></div></button></div>'),et=F('<!> <div class="main svelte-1bdwycb"><h3 class="svelte-1bdwycb">Gravitrip</h3></div> <div class="svelte-1bdwycb">See <a href="https://www.quora.com/What-is-the-winning-strategy-for-the-first-player-in-Connect-Four-games" class="svelte-1bdwycb">this quora thread</a> for some tips on the winning strategy</div> <div class="svelte-1bdwycb">Computer stategy: <select class="svelte-1bdwycb"></select></div> <!> <span class="svelte-1bdwycb"><button class="svelte-1bdwycb">Restart game</button> <span style="font-weight: bold" class="svelte-1bdwycb"><!></span></span> <div class="board svelte-1bdwycb"></div>',1);function ct(e,s){Pe(s,!0);let t=A($(Array.from({length:7},()=>[]))),l=ne(()=>O(r(t))),c=ne(()=>We(r(t))),o=A(null);const m=[{name:"easy",iterations:200,c:2},{name:"medium",iterations:1e3,c:1.41},{name:"hard",iterations:5e3,c:.7}];let u=A($(m[1])),n=A($(r(u).iterations)),R=A($(r(u).c)),T=A("mcts");const pe=Array.from({length:P},(a,i)=>i),de=Array.from({length:k},(a,i)=>i);let y=A(1);const S=()=>{f(t,Array.from({length:7},()=>[]),!0),f(y,1)},X=(a,i)=>{r(y)===1&&he(r(t),a)&&O(r(t))===w.notOver&&(f(t,G(r(t),i,a),!0),f(y,r(y)===1?2:1,!0),setTimeout(()=>be(),200))},be=()=>{if(r(y)!==2||O(r(t))!==w.notOver)return;let a;if(r(T)==="random")a=Ve(r(t),r(y));else if(r(T)==="mcts")a=De(r(t),r(y),{iterations:r(n),c:r(R)});else throw new Error("computer strategy not implemented");const{board:i,move:v}=a;f(t,i,!0),f(o,v,!0),f(y,1)},we=(a,i)=>r(c)===null?!1:r(c).filter(v=>v[0]===a&&v[1]===i).length>0,ye=a=>{switch(a.keyCode){case 82:S();break;case 39:if(r(o)===null){f(o,Math.floor(k/2),!0);return}f(o,Math.min(r(o)+1,k-1),!0);break;case 37:if(r(o)===null){f(o,Math.floor(k/2),!0);return}f(o,Math.max(r(o)-1,0),!0);break;case 32:if(r(o)===null)return;X(r(o),r(y));break}};var Y=et();Z("keydown",Ae,ye);var B=U(Y);qe(B,{title:"Gravitrip",description:"Gravitrip"});var z=x(B,6),H=x(C(z));V(H,20,()=>["mcts","random"],D,(a,i)=>{var v=Ze(),g=C(v,!0);b(v);var d={};q(()=>{j(g,i),d!==(d=i)&&(v.value=(v.__value=i)??"")}),M(a,v)}),b(H),b(z);var ee=x(z,2);{var ge=a=>{var i=Xe(),v=x(C(i),4);v.__change=[je,u,n,R],V(v,21,()=>m,D,(h,I)=>{var p=Je(),W=C(p,!0);b(p);var E={};q(()=>{j(W,r(I).name),E!==(E=r(I))&&(p.value=(p.__value=r(I))??"")}),M(h,p)}),b(v);var g=x(v,7);ce(g),g.__change=[Qe,u];var d=x(g,9);ce(d),d.__change=[Se,u],Oe(2),b(i),ie(v,()=>r(u),h=>f(u,h)),ve(g,()=>r(n),h=>f(n,h)),ve(d,()=>r(R),h=>f(R,h)),M(a,i)};J(ee,a=>{r(T)==="mcts"&&a(ge)})}var K=x(ee,2),te=C(K);te.__click=S;var se=x(te,2),_e=C(se);{var Me=a=>{var i=le("Game Over");M(a,i)},xe=a=>{var i=ae(),v=U(i);{var g=d=>{var h=le();q(()=>j(h,`Player ${r(l)??""} wins`)),M(d,h)};J(v,d=>{(r(l)===w.winPlayer1||r(l)===w.winPlayer2)&&d(g)},!0)}M(a,i)};J(_e,a=>{r(l)===w.draw?a(Me):a(xe,!1)})}b(se),b(K);var L=x(K,2);V(L,21,()=>pe.reverse(),D,(a,i)=>{var v=ae(),g=U(v);V(g,17,()=>de,D,(d,h)=>{var I=Be(),p=C(I);let W;p.__click=[Ye,X,h,y];var E=C(p);let re;b(p),b(I),q((Ce,ke)=>{Ee(p,"aria-label","col-"+r(h)),W=ue(p,1,"outer-cell svelte-1bdwycb",null,W,Ce),re=ue(E,1,"cell svelte-1bdwycb",null,re,ke),oe(E,`--drop-distance: ${P-r(i)};`)},[()=>({selected:r(o)===r(h),"winning-cell":we(r(i),r(h))}),()=>({player1:r(t)[r(h)][r(i)]===1,player2:r(t)[r(h)][r(i)]===2,drop:r(t)[r(h)][r(i)]&&r(i)===r(t)[r(h)].length-1})]),Z("mouseenter",p,()=>f(o,r(h),!0)),Z("mouseleave",p,()=>f(o,null)),M(d,I)}),M(a,v)}),b(L),q(()=>oe(L,`--nb-col: ${k}; --nb-row: ${P}`)),ie(H,()=>r(T),a=>f(T,a)),M(e,Y),Ie()}Te(["change","click"]);export{ct as component};
