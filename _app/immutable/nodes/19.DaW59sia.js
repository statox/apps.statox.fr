import"../chunks/disclose-version.Bg9kRutz.js";import{i as ce}from"../chunks/legacy.Bspvssc3.js";import{k as re,v as B,n as ne,ag as r,w as a,ah as s,g as e,s as E,m as H,a_ as Le,ai as G,l as fe,o as Ie,aU as Ee}from"../chunks/index-client.CflbJY84.js";import{s as X}from"../chunks/render.D9j6VzsR.js";import{a as He}from"../chunks/await.CCcugD2l.js";import{i as R}from"../chunks/if.DLCvTpsY.js";import{e as se,a as v,f as pe,t as w,n as Te}from"../chunks/template.BGksMNs9.js";import{s as he,a as me}from"../chunks/store.6NDgt3ZJ.js";import{c as Ue,o as Ne}from"../chunks/store.BObuO1UO.js";import{u as ge,U as Oe}from"../chunks/service.CZXndgQS.js";import{M as Me}from"../chunks/Main.Dd_irUsP.js";import{r as Pe,a as _e,A as Fe}from"../chunks/index._8JHsi-E.js";import{e as be,i as ye}from"../chunks/each.CJUKzImm.js";import{r as C,s as j,a as q}from"../chunks/attributes.D4L4WMZE.js";import{b as oe,c as Be}from"../chunks/input.BoLElzTc.js";import{b as Re}from"../chunks/select.Ch5s4wfo.js";import{p as J,a as qe}from"../chunks/props.CpxbqgeU.js";import{t as De}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.BFGvlWpq.js";import{M as Ge,a as Je,b as Ve}from"../chunks/Main.4fegPC9p.js";import{a as Ke}from"../chunks/datetime.CJSQP4eG.js";import{p as Qe}from"../chunks/Main.svelte_svelte_type_style_lang.BQJ34aRA.js";const Xe=!1,Oa=Object.freeze(Object.defineProperty({__proto__:null,ssr:Xe},Symbol.toStringTag,{value:"Module"})),$e=async()=>Pe({path:"/webWatcher/getAllWatchers"}),Ce=async h=>_e({path:"/webWatcher/createWatcher",data:h}),Ye=async h=>_e({path:"/webWatcher/deleteWatcher",data:{id:h}}),Ze=async h=>_e({path:"/webWatcher/toggleWatcherEnabled",data:h});var ea=w('<label for="css-selector">CSS selector</label> <input type="textarea">',1),aa=w('<button class="form-action svelte-1cixduj">Submit</button>'),ta=w('<span class="form-action svelte-1cixduj">Login to upload an entry</span>'),sa=w('<div role="dialog" class="modal svelte-1cixduj"><div class="contents svelte-1cixduj"><h3 class="title-bar svelte-1cixduj">Add a new clipboard entry <button>Close</button></h3> <!> <form class="form-content svelte-1cixduj"><label for="name">Name</label> <input type="text"> <label for="check-interval">Check interval</label> <!> <label for="notification-message">Notification message (the @mention is automatically added)</label> <input type="textarea"> <label for="watch-type">Watcher type</label> <select id="watch-type"><option>CSS</option><option>HASH</option></select> <label for="content">URL</label> <input type="textarea"> <!> <br> <!></form></div></div>');function ra(h,o){re(o,!1);const[W,k]=he(),z=()=>me(ge,"$user",W);let g=J(o,"isOpen",8),t=J(o,"onUpload",8),l=G([]),d=G(),M=G(),D=G(),x=G(),A=G(),_=G();const U=async()=>{var i;E(l,[]),(i=e(d))!=null&&i.length||e(l).push({level:"error",header:"name must be defined"}),e(M)||e(l).push({level:"error",header:"notification message must be defined"}),e(_)==="CSS"&&!e(x)&&e(l).push({level:"error",header:"A CSS watcher must have a css selector defined"}),e(A)<15*60&&e(l).push({level:"error",header:"Check interval too small. Must be >= 15mn"});try{new URL(e(D))}catch{e(l).push({level:"error",header:"The URL is invalid"})}if(!e(l).length)try{e(_)==="CSS"?await Ce({name:e(d),notificationMessage:e(M),url:e(D),cssSelector:e(x),checkIntervalSeconds:e(A),watchType:e(_)}):e(_)==="HASH"&&await Ce({name:e(d),notificationMessage:e(M),url:e(D),checkIntervalSeconds:e(A),watchType:e(_)}),t()(),Ue()}catch(c){let u=c.message;c instanceof Fe&&c.code===401?u="Invalid logged in user":c instanceof Oe&&(u="User is logged out");const f=`<strong>Entry not created</strong><br/> ${u}`;De.push(f,{theme:{"--toastBarBackground":"#FF0000"}})}};ce();var m=se(),b=B(m);{var p=i=>{var c=sa(),u=r(c),f=r(u),L=a(r(f));s(f);var I=a(f,2);be(I,1,()=>e(l),ye,(n,y)=>{Me(n,{get item(){return e(y)}})});var Y=a(I,2),T=a(r(Y),2);C(T);var $=a(T,4);Ge($,{allowedUnits:["minutes","hours","days"],defaultDuration:{value:1,unit:"hours"},get valueInSeconds(){return e(A)},set valueInSeconds(n){E(A,n)},$$legacy:!0});var N=a($,4);C(N);var S=a(N,4);H(()=>{e(_),Le(()=>{})});var O=r(S);O.value=(O.__value="CSS")==null?"":"CSS";var P=a(O);P.value=(P.__value="HASH")==null?"":"HASH",s(S);var F=a(S,4);C(F);var Z=a(F,2);{var ee=n=>{var y=ea(),ae=a(B(y),2);C(ae),oe(ae,()=>e(x),le=>E(x,le)),v(n,y)};R(Z,n=>{e(_)==="CSS"&&n(ee)})}var ve=a(Z,4);{var de=n=>{var y=aa();pe("click",y,U),v(n,y)},ue=n=>{var y=ta();v(n,y)};R(ve,n=>{z()?n(de):n(ue,!1)})}s(Y),s(u),s(c),pe("click",L,function(...n){var y;(y=Ue)==null||y.apply(this,n)}),oe(T,()=>e(d),n=>E(d,n)),oe(N,()=>e(M),n=>E(M,n)),Re(S,()=>e(_),n=>E(_,n)),oe(F,()=>e(D),n=>E(D,n)),v(i,c)};R(b,i=>{g()&&i(p)})}v(h,m),ne(),k()}function We(h,o,W,k){const z=h.target,g=z==null?void 0:z.getAttribute("aria-checked");E(o,qe(g!=="true")),W(e(o)===!0?"on":"off"),k("change",W())}var na=w('<div class="s s--inner svelte-1n7axnp"><span> </span> <button role="switch" class="svelte-1n7axnp"><span class="svelte-1n7axnp">on</span> <span class="svelte-1n7axnp">off</span></button></div>'),la=w('<div class="s s--slider svelte-1n7axnp"><span> </span> <button role="switch" class="svelte-1n7axnp"></button></div>'),ia=w('<input type="radio" class="svelte-1n7axnp"> <label class="svelte-1n7axnp"> </label>',1),oa=w('<div class="s s--multi svelte-1n7axnp"><div role="radiogroup" class="group-container svelte-1n7axnp"><div class="legend"> </div> <!></div></div>');function ca(h,o){re(o,!0);const W=[];let k=J(o,"design",3,"inner label"),z=J(o,"options",19,()=>[]),g=J(o,"fontSize",3,16),t=J(o,"value",15,"on"),l=Ee(!0);const d=Math.floor(Math.random()*100),M=fe();Ie(()=>{E(l,t()==="on")});var D=se(),x=B(D);{var A=U=>{var m=na(),b=r(m);j(b,"id",`switch-${d}`);var p=r(b,!0);s(b);var i=a(b,2);j(i,"aria-labelledby",`switch-${d}`),i.__click=[We,l,t,M],s(m),H(()=>{X(p,o.label),j(i,"aria-checked",e(l))}),v(U,m)},_=U=>{var m=se(),b=B(m);{var p=c=>{var u=la(),f=r(u);j(f,"id",`switch-${d}`);var L=r(f,!0);s(f);var I=a(f,2);j(I,"aria-labelledby",`switch-${d}`),I.__click=[We,l,t,M],s(u),H(()=>{j(u,"style",`font-size:${g()??""}px`),X(L,o.label),j(I,"aria-checked",e(l))}),v(c,u)},i=c=>{var u=oa(),f=r(u);j(f,"aria-labelledby",`label-${d}`),j(f,"id",`group-${d}`);var L=r(f);j(L,"id",`label-${d}`);var I=r(L,!0);s(L);var Y=a(L,2);be(Y,17,z,ye,(T,$)=>{var N=ia(),S=B(N);C(S);var O,P=a(S,2),F=r(P,!0);s(P),H(()=>{j(S,"id",`${e($)}-${d}`),O!==(O=e($))&&(S.value=(S.__value=e($))==null?"":e($)),j(P,"for",`${e($)}-${d}`),X(F,e($))}),Be(W,[],S,()=>(e($),t()),t),v(T,N)}),s(f),s(u),H(()=>{j(f,"style",`font-size:${g()??""}px`),X(I,o.label)}),v(c,u)};R(b,c=>{k()=="slider"?c(p):c(i,!1)},!0)}v(U,m)};R(x,U=>{k()=="inner"?U(A):U(_,!1)})}v(h,D),ne()}Te(["click"]);var va=w('<p class="section-3-item svelte-1jnygz9"><label for="css-selector">CSS selector <!></label> <input disabled type="textarea" class="svelte-1jnygz9"></p>'),da=w('<div class="section error-section svelte-1jnygz9"><p class="section-4-item svelte-1jnygz9"><label for="last-check">Last error</label> <input disabled type="textarea" class="svelte-1jnygz9"></p> <p class="section-4-item svelte-1jnygz9"><label for="last-update">Last error message</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div>'),ua=w('<div class="item svelte-1jnygz9"><h3 class="item-title svelte-1jnygz9"><div class="item-name svelte-1jnygz9"> </div> <div class="item-actions svelte-1jnygz9"><!> <!></div></h3> <div class="section svelte-1jnygz9"><p class="section-1-item svelte-1jnygz9"><label for="check-interval">Check interval</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div> <div class="section svelte-1jnygz9"><p class="section-2-item svelte-1jnygz9"><label for="notification-message">Notification message</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div> <div class="section svelte-1jnygz9"><p class="section-3-item svelte-1jnygz9"><label for="content">URL</label> <a target="_blank" rel="noopener noreferrer"> </a></p> <!></div> <div class="section svelte-1jnygz9"><p class="section-4-item svelte-1jnygz9"><label for="last-check">Last check</label> <input disabled type="textarea" class="svelte-1jnygz9"></p> <p class="section-4-item svelte-1jnygz9"><label for="last-update">Last content change</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div> <!> <div class="section svelte-1jnygz9"><p class="section-3-item svelte-1jnygz9"><label for="last-update">Last content</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div></div>');function pa(h,o){re(o,!1);const[W,k]=he(),z=()=>me(ge,"$user",W),g=fe();let t=J(o,"watcher",8);const l=p=>{const i=new Date(p*1e3);return i.toLocaleDateString()+" "+i.toLocaleTimeString()},d=t().lastCheckDateUnix===0?"Never checked before":l(t().lastCheckDateUnix),M=t().lastUpdateDateUnix===0?"Never changed":l(t().lastUpdateDateUnix),D=Ke.fromMillis(t().checkIntervalSeconds*1e3).rescale().toHuman(),x=async()=>{if(!t().id){console.error("id must be defined");return}try{await Ye(t().id),g("delete")}catch(p){const i=`<strong>Watcher not deleted</strong><br/> ${p.message}`;De.push(i,{theme:{"--toastBarBackground":"#FF0000"}})}},A=async p=>{await Ze({watcherId:t().id,setToEnabled:p.detail==="on"}),g("update")};let _=t().archivalDateUnix?"off":"on";ce();var U=se(),m=B(U);{var b=p=>{var i=ua(),c=r(i),u=r(c),f=r(u,!0);s(u);var L=a(u,2),I=r(L);ca(I,{value:_,label:"Enabled",design:"slider",$$events:{change:A}});var Y=a(I,2);Je(Y,{deleteAction:x}),s(L),s(c);var T=a(c,2),$=r(T),N=a(r($),2);C(N),q(N,D),s($),s(T);var S=a(T,2),O=r(S),P=a(r(O),2);C(P),s(O),s(S);var F=a(S,2),Z=r(F),ee=a(r(Z),2),ve=r(ee,!0);s(ee),s(Z);var de=a(Z,2);{var ue=V=>{var K=va(),Q=r(K),ie=a(r(Q));Ve(ie,{get content(){return t().cssSelector}}),s(Q);var te=a(Q,2);C(te),s(K),H(()=>q(te,t().cssSelector)),v(V,K)};R(de,V=>{t().watchType==="CSS"&&V(ue)})}s(F);var n=a(F,2),y=r(n),ae=a(r(y),2);C(ae),q(ae,d),s(y);var le=a(y,2),xe=a(r(le),2);C(xe),q(xe,M),s(le),s(n);var Se=a(n,2);{var Ae=V=>{var K=da(),Q=r(K),ie=a(r(Q),2);C(ie),H(()=>q(ie,l(t().lastErrorDateUnix))),s(Q);var te=a(Q,2),ze=a(r(te),2);C(ze),s(te),s(K),H(()=>q(ze,t().lastErrorMessage)),v(V,K)};R(Se,V=>{t().lastErrorDateUnix&&V(Ae)})}var we=a(Se,2),je=r(we),ke=a(r(je),2);C(ke),s(je),s(we),s(i),H(()=>{X(f,t().name),q(P,t().notificationMessage),j(ee,"href",t().url),X(ve,t().url),q(ke,t().lastContent)}),v(p,i)};R(m,p=>{z()&&p(b)})}v(h,U),ne(),k()}var fa=w('<div class="container svelte-c8nodu"></div>');function ha(h,o){re(o,!1);let W=J(o,"watchers",8);const k=fe(),z=(t,l)=>t.archivalDateUnix===null&&l.archivalDateUnix!==null?-1:t.archivalDateUnix!==null&&l.archivalDateUnix===null?1:l.id-t.id;ce();var g=fa();be(g,5,()=>W().sort(z),ye,(t,l)=>{pa(t,{get watcher(){return e(l)},$$events:{delete:()=>k("delete"),update:()=>k("update")}})}),s(g),v(h,g),ne()}var ma=w("<p>Something went wrong</p> <p> </p>",1),ga=w("<p>Loading data</p>"),_a=w("<h2>Create a new watcher</h2> <button>Add an entry</button> <h2>Watchers</h2> <!>",1);function Pa(h,o){re(o,!1);const[W,k]=he(),z=()=>me(ge,"$user",W);Qe.set("Web Watchers");let g=G($e());const t=()=>E(g,$e());ce();var l=se(),d=B(l);{var M=x=>{var A=_a(),_=a(B(A),2),U=a(_,4);He(U,()=>e(g),m=>{var b=ga();v(m,b)},(m,b)=>{ha(m,{get watchers(){return e(b)},$$events:{delete:t,update:t}})},(m,b)=>{var p=ma(),i=a(B(p),2),c=r(i,!0);H(()=>X(c,JSON.stringify(e(b)))),s(i),v(m,p)}),pe("click",_,()=>Ne(ra,{onUpload:t})),v(x,A)},D=x=>{Me(x,{item:{level:"info",header:"Login to list the watchers"}})};R(d,x=>{z()?x(M):x(D,!1)})}v(h,l),ne(),k()}export{Pa as component,Oa as universal};
