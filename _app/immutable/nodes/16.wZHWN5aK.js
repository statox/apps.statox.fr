import"../chunks/NZTpNUN0.js";import{z as xe,A as k,B as N,g as r,p as E,f as j,F as C,x as T,a as M,E as Ce,v as x,s as m,aZ as ee,G as g,a_ as te,c as ne,y as Pe}from"../chunks/Br9SMxIB.js";import{d as ke,e as re,s as D}from"../chunks/BBzb7ThI.js";import{i as J}from"../chunks/CvXxFVm9.js";import{e as $,i as z}from"../chunks/D1-nhZYT.js";import{b as se,a as Ie,s as Ae,c as ie,r as le}from"../chunks/DWdbj9D8.js";import{b as ae}from"../chunks/C6S4cPPP.js";import{M as Oe}from"../chunks/DKmGubEx.js";var d=(e=>(e[e.notOver=0]="notOver",e[e.winPlayer1=1]="winPlayer1",e[e.winPlayer2=2]="winPlayer2",e[e.draw=3]="draw",e))(d||{});const q=7,I=6,b=4;class Te extends Error{constructor(n){super("Can't play in column "+n)}}const K=e=>e.map(n=>[...n]),ce=(e,n)=>e[n].length!==I,H=e=>{const n=[];for(let t=0;t<e.length;t++)e[t].length<I&&n.push(t);return n},qe=e=>{const n=q*I,t=e.reduce((i,l)=>i+l.length,0);return n===t},Ee=e=>{for(let n=0;n<q;n++)for(let t=0;t<I;t++){if(e[n].length<t||!e[n][t])continue;const i=e[n][t];let l=0,h=0,v=0,a=0;for(let s=0;s<b;s++)t+s<=e[n].length&&e[n][t+s]===i&&l++,n+s<e.length&&e[n+s][t]===i&&h++,n+s<e.length&&t+s<=e[n+s].length&&e[n+s][t+s]===i&&v++,n+s<e.length&&t-s>=0&&e[n+s][t-s]===i&&a++;if(l===b||h===b||v===b||a===b)return i}return null},Fe=e=>{if(A(e)===0)return null;for(let n=0;n<q;n++)for(let t=0;t<I;t++){if(e[n].length<t||!e[n][t])continue;const i=e[n][t],l=[],h=[],v=[],a=[];for(let s=0;s<b;s++)t+s<=e[n].length&&e[n][t+s]===i&&l.push([t+s,n]),n+s<e.length&&e[n+s][t]===i&&h.push([t,n+s]),n+s<e.length&&t+s<=e[n+s].length&&e[n+s][t+s]===i&&v.push([t+s,n+s]),n+s<e.length&&t-s>=0&&e[n+s][t-s]===i&&a.push([t-s,n+s]);if(l.length===b)return l;if(h.length===b)return h;if(v.length===b)return v;if(a.length===b)return a}return null},A=e=>{if(qe(e))return 3;const n=Ee(e);return n===1?1:n===2?2:0},F=(e,n,t)=>{if(!ce(e,t))throw new Te(t);return e[t].push(n),e},Ge=e=>{const n=H(e),t=Math.floor(Math.random()*n.length);return n[t]},Re=(e,n)=>{const t=Ge(e);return F(e,n,t)},We=(e,n,t)=>{const i=Le(e,n,t?.iterations,t?.c);return F(e,n,i)};class ue{board;player;move;parent;children=[];visits=0;wins=0;constructor(n,t,i=null,l=null){this.board=n,this.player=t,this.move=i,this.parent=l}isFullyExpanded(){return this.children.length===H(this.board).length}isTerminal(){return A(this.board)!==d.notOver}}function oe(e,n,t,i=Math.sqrt(2)){return t===0?1/0:n/t+i*Math.sqrt(Math.log(e)/t)}function Ve(e,n){for(;!e.isTerminal();)if(e.isFullyExpanded())e=$e(e,n);else return Ne(e);return e}function Ne(e){const n=e.children.map(a=>a.move),i=H(e.board).filter(a=>!n.includes(a)),l=i[Math.floor(Math.random()*i.length)],h=K(e.board);F(h,e.player,l);const v=new ue(h,e.player===1?2:1,l,e);return e.children.push(v),v}function $e(e,n){return e.children.reduce((t,i)=>{const l=oe(e.visits,t.wins,t.visits,n);return oe(e.visits,i.wins,i.visits,n)>l?i:t})}function ze(e){const n=K(e.board);let t=e.player;for(;;){const i=A(n);if(i!==d.notOver)return i;const l=H(n),h=l[Math.floor(Math.random()*l.length)];F(n,t,h),t=t===1?2:1}}function He(e,n){let t=e;for(;t!==null;)t.visits+=1,n===d.winPlayer1&&t.parent?.player===1||n===d.winPlayer2&&t.parent?.player===2?t.wins+=1:n===d.draw&&(t.wins+=.5),t=t.parent}function Le(e,n,t=1e3,i=Math.sqrt(2)){const l=new ue(K(e),n,null,null);for(let v=0;v<t;v++){const a=Ve(l,i),s=ze(a);He(a,s)}return l.children.reduce((v,a)=>v.visits>a.visits?v:a).move}const Ue=(e,n,t)=>{m(n,Array.from({length:7},()=>[]),!0),m(t,1)};var Ze=(e,n,t,i)=>n(r(t),r(i)),je=E("<div><button><div></div></button></div>"),De=E("<option> </option>"),Je=(e,n,t,i)=>{r(n)&&(m(t,r(n).iterations,!0),m(i,r(n).c,!0))},Ke=E("<option> </option>"),Qe=(e,n)=>m(n,null),Se=(e,n)=>m(n,null),Xe=E(`<div><h4>Monte Carlo Tree Search parameters</h4> <label for="mcts-preset">Preset difficulty</label> <select></select> <br/><br/> <label for="mcts-iterations">Iterations:</label> <input id="mcts-iterations" type="number" min="0"/> <small>Number of simulations MCTS will run before choosing a move. Higher values usually mean
            stronger play but slower decisions.</small> <br/><br/> <label for="mcts-c">C (exploration constant):</label> <input id="mcts-c" type="number" min="0" step="0.1"/> <small>Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
            favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2
            ≈ 1.41.</small></div>`),Ye=E('<!> <div class="main"><h3>Gravitrip</h3></div> <div>See <a href="https://www.quora.com/What-is-the-winning-strategy-for-the-first-player-in-Connect-Four-games">this quora thread</a> for some tips on the winning strategy</div> <span><button>Restart game</button> <span style="font-weight: bold"><!></span></span> <div class="board svelte-1bdwycb"></div> <div>Computer stategy: <select></select></div> <!>',1);function at(e,n){xe(n,!0);let t=k(N(Array.from({length:7},()=>[]))),i=ee(()=>A(r(t))),l=ee(()=>Fe(r(t))),h=k(null);const v=[{name:"easy",iterations:200,c:2},{name:"medium",iterations:1e3,c:1.41},{name:"hard",iterations:5e3,c:.7}];let a=k(N(v[1])),s=k(N(r(a).iterations)),G=k(N(r(a).c)),O=k("mcts");const ve=Array.from({length:I},(c,o)=>o),fe=Array.from({length:q},(c,o)=>o);let w=k(1);const he=(c,o)=>{r(w)===1&&ce(r(t),c)&&A(r(t))===d.notOver&&(m(t,F(r(t),o,c),!0),m(w,r(w)===1?2:1,!0),setTimeout(()=>me(),300))},me=()=>{r(w)===2&&A(r(t))===d.notOver&&(r(O)==="random"?m(t,Re(r(t),r(w)),!0):r(O)==="mcts"&&m(t,We(r(t),r(w),{iterations:r(s),c:r(G)}),!0),m(w,r(w)===1?2:1,!0))},pe=(c,o)=>r(l)===null?!1:r(l).filter(u=>u[0]===c&&u[1]===o).length>0;var Q=Ye(),S=j(Q);Oe(S,{title:"Gravitrip",description:"Gravitrip"});var L=x(S,6),X=C(L);X.__click=[Ue,t,w];var Y=x(X,2),_e=C(Y);{var ge=c=>{var o=te("Game Over");M(c,o)},de=c=>{var o=ne(),u=j(o);{var y=_=>{var f=te();T(()=>D(f,`Player ${r(i)??""} wins`)),M(_,f)};J(u,_=>{(r(i)===d.winPlayer1||r(i)===d.winPlayer2)&&_(y)},!0)}M(c,o)};J(_e,c=>{r(i)===d.draw?c(ge):c(de,!1)})}g(Y),g(L);var R=x(L,2);$(R,21,()=>ve.reverse(),z,(c,o)=>{var u=ne(),y=j(u);$(y,17,()=>fe,z,(_,f)=>{var P=je(),p=C(P);let W;p.__click=[Ze,he,f,w];var V=C(p);let B;g(p),g(P),T((be,Me)=>{Ae(p,"aria-label","col-"+r(f)),W=ie(p,1,"outer-cell svelte-1bdwycb",null,W,be),B=ie(V,1,"cell svelte-1bdwycb",null,B,Me)},[()=>({selected:r(h)===r(f),"winning-cell":pe(r(o),r(f))}),()=>({player1:r(t)[r(f)][r(o)]===1,player2:r(t)[r(f)][r(o)]===2})]),re("mouseenter",p,()=>m(h,r(f),!0)),re("mouseleave",p,()=>m(h,null)),M(_,P)}),M(c,u)}),g(R);var U=x(R,2),Z=x(C(U));$(Z,20,()=>["mcts","random"],z,(c,o)=>{var u=De(),y=C(u,!0);g(u);var _={};T(()=>{D(y,o),_!==(_=o)&&(u.value=(u.__value=o)??"")}),M(c,u)}),g(Z),g(U);var we=x(U,2);{var ye=c=>{var o=Xe(),u=x(C(o),4);u.__change=[Je,a,s,G],$(u,21,()=>v,z,(f,P)=>{var p=Ke(),W=C(p,!0);g(p);var V={};T(()=>{D(W,r(P).name),V!==(V=r(P))&&(p.value=(p.__value=r(P))??"")}),M(f,p)}),g(u);var y=x(u,7);le(y),y.__change=[Qe,a];var _=x(y,9);le(_),_.__change=[Se,a],Pe(2),g(o),se(u,()=>r(a),f=>m(a,f)),ae(y,()=>r(s),f=>m(s,f)),ae(_,()=>r(G),f=>m(G,f)),M(c,o)};J(we,c=>{r(O)==="mcts"&&c(ye)})}T(()=>Ie(R,`--nb-col: ${q}; --nb-row: ${I}`)),se(Z,()=>r(O),c=>m(O,c)),M(e,Q),Ce()}ke(["click","change"]);export{at as component};
