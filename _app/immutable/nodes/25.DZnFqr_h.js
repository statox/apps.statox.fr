import"../chunks/NZTpNUN0.js";import{o as Q}from"../chunks/np3e4Z_M.js";import{p as S,h as P,a8 as R,c as L,f as x,a as v,d as V,b as _,e as u,s as c,r as f,g as e,i as $,u as O,t as X}from"../chunks/Brv8g2mx.js";import{d as W,s as I}from"../chunks/BlLNWVag.js";import{i as F}from"../chunks/D2xXzMMK.js";import{s as q,a as B}from"../chunks/DgiLbMs0.js";import{m as Y}from"../chunks/DhJDjgwN.js";import{u as H}from"../chunks/DjK5HcX4.js";import{M as N}from"../chunks/D0GvDZuH.js";import{e as j,i as z}from"../chunks/CjXiWo-Z.js";import{r as Z}from"../chunks/CqUsCvuq.js";import{b as ee}from"../chunks/DLiMpzP4.js";import{r as te,a as ae,A as re,U as oe}from"../chunks/UFiDLvq0.js";import{t as se}from"../chunks/CNpLp5dR.js";import{D as J}from"../chunks/DTyfSRsR.js";import{a as ne}from"../chunks/VNWGfoUl.js";import"../chunks/DxsUBIQY.js";import"../chunks/C9RvLV9E.js";import{p as ie}from"../chunks/DWDG2EIs.js";const ve=async l=>ae({path:"/personalTracker/upload",data:{event:l},isUnauthenticatedCall:!0}),G=async()=>{const{events:l}=await te({path:"/personalTracker/getAll"});return l};var le=_('<button class="form-action svelte-3t0xi3">Submit</button>'),me=_('<span class="form-action svelte-3t0xi3">Login to upload an entry</span>'),de=_('<div role="dialog" class="modal svelte-3t0xi3"><div class="contents svelte-3t0xi3"><h4 class="title-bar svelte-3t0xi3">Add a new event <button>Close</button></h4> <!> <form class="form-content svelte-3t0xi3"><label for="weight">Weight</label> <input type="number" step="0.1"/> <br/> <!></form></div></div>');function ce(l,n){S(n,!0);const k=()=>B(H,"$user",U),[U,w]=q();let s=P(R([])),i=P(0);const h=async()=>{if($(s,[],!0),e(i)!==Number(e(i).toFixed(1))&&e(s).push({level:"error",header:"Value have at most 1 number after the comma"}),(e(i)<80||e(i)>110)&&e(s).push({level:"error",header:"Value must be in kg"}),e(s).length)return;const t=J.now().toUTC().toUnixInteger();try{await ve({timestampUTC:t,type:"weight",value:Math.floor(e(i)*100)}),n.onUpload(),n.close()}catch(a){let r=a.message;a instanceof re&&a.code===401?r="Invalid logged in user":a instanceof oe&&(r="User is logged out");const m=`<strong>Entry not created</strong><br/> ${r}`;se.push(m,{theme:{"--toastBarBackground":"#FF0000"}})}};var p=L(),b=x(p);{var A=t=>{var a=de(),r=u(a),m=u(r),M=c(u(m));M.__click=function(...o){n.close?.apply(this,o)},f(m);var y=c(m,2);j(y,17,()=>e(s),z,(o,d)=>{N(o,{get item(){return e(d)}})});var D=c(y,2),g=c(u(D),2);Z(g);var E=c(g,4);{var C=o=>{var d=le();d.__click=h,v(o,d)},T=o=>{var d=me();v(o,d)};F(E,o=>{k()?o(C):o(T,!1)})}f(D),f(r),f(a),ee(g,()=>e(i),o=>$(i,o)),v(t,a)};F(b,t=>{n.isOpen&&t(A)})}v(l,p),V(),w()}W(["click"]);var ue=_('<div class="event svelte-cyscl8"><div class="event-date"> </div> <div class="event-type"> </div> <div class="event-value"> </div></div>'),fe=_('<div class="event svelte-cyscl8"><div>Date</div> <div>Type</div> <div>Value</div></div> <!>',1),pe=_("<p>Loading events</p>");function ge(l,n){S(n,!0);const k=()=>B(H,"$user",U),[U,w]=q();var s=L(),i=x(s);{var h=p=>{var b=L(),A=x(b);ne(A,()=>n.events,t=>{var a=pe();v(t,a)},(t,a)=>{var r=fe(),m=c(x(r),2);j(m,17,()=>e(a),z,(M,y)=>{const D=O(()=>J.fromSeconds(e(y).eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm"));var g=ue(),E=u(g),C=u(E,!0);f(E);var T=c(E,2),o=u(T,!0);f(T);var d=c(T,2),K=u(d,!0);f(d),f(g),X(()=>{I(C,e(D)),I(o,e(y).type),I(K,e(y).value)}),v(M,g)}),v(t,r)},(t,a)=>{{let r=O(()=>({level:"error",header:"Something went wrong getting events",message:e(a)}));N(t,{get item(){return e(r)}})}}),v(p,b)};F(i,p=>{k()&&n.events&&p(h)})}v(l,s),V(),w()}var _e=_("<div><button>Add an entry</button></div> <!>",1);function Ve(l,n){S(n,!0);const k=()=>B(H,"$user",U),[U,w]=q();let s=P(void 0);ie.set("Personal Tracker");const i=()=>$(s,G(),!0);Q(()=>$(s,G(),!0));var h=L(),p=x(h);{var b=t=>{var a=_e(),r=x(a),m=u(r);m.__click=()=>Y.open(ce,{onUpload:i}),f(r);var M=c(r,2);ge(M,{get events(){return e(s)}}),v(t,a)},A=t=>{N(t,{item:{level:"info",header:"Login to add an entry or see events"}})};F(p,t=>{k()?t(b):t(A,!1)})}v(l,h),V(),w()}W(["click"]);export{Ve as component};
