import"../chunks/DsnmJJEf.js";import{p as _e,c as oe,f as I,a as t,d as pe,b as l,g as e,I as he,s as n,e as v,r as o,t as k,j as X,h as be,C as Se,aI as le,n as Ce,i as ae}from"../chunks/BI5tnybL.js";import{d as fe,s as P}from"../chunks/BHBOcJDT.js";import{i as u}from"../chunks/BcTGm7Fo.js";import{M as Ee}from"../chunks/BwGSCHVW.js";import{M as We}from"../chunks/DZoLVZHK.js";import"../chunks/CbJJCuUa.js";import{o as je}from"../chunks/CW6Daupv.js";import{e as me,i as ue}from"../chunks/V4cWF7mx.js";import{b as Ue,s as Fe,a as ce}from"../chunks/Db8wGxCz.js";import{i as Le}from"../chunks/BU96bRAZ.js";import{a as re,s as ke}from"../chunks/fB5nFxe2.js";import{M as xe}from"../chunks/D4b6Boo_.js";import{e as ne,p as $e,P as Oe}from"../chunks/BB2Sb3IT.js";import{D as se}from"../chunks/CkcISRbr.js";import{g as ge}from"../chunks/CQfaKTAK.js";import"../chunks/DlRVxj54.js";import{p as Ie}from"../chunks/L3zL1n65.js";/* empty css                */import"../chunks/DKXeG7-1.js";var Ae=l("<p>Loading events</p>"),He=l('<button class="emotion-item svelte-cyscl8"> </button>'),Ve=l('<div class="selection svelte-cyscl8"></div>'),qe=l('<div class="event svelte-cyscl8"><div class="event-date"> </div> <div class="event-value svelte-cyscl8"><!></div> <div class="event-value svelte-cyscl8"><!></div> <div class="event-value svelte-cyscl8"><!></div> <div class="event-actions svelte-cyscl8"><button class="svelte-cyscl8">Edit</button></div></div>'),Ge=l('<div class="events-header svelte-cyscl8"><div>Date</div> <div>Mood</div> <div>Weight</div> <div>Emotions</div> <div>Actions</div></div> <!>',1);function Ye(Y,z){_e(z,!1);const $=()=>re($e,"$personalTrackerPassword",S),c=()=>re(ne,"$eventsStore",S),[S,A]=ke();je(()=>{ne.fetch($())});const _=y=>{ge(`/personal-tracker/add/${y}`)};Le();var H=oe(),B=I(H);{var Z=y=>{var x=Ae();t(y,x)},J=y=>{var x=oe(),C=I(x);{var E=h=>{{let M=he(()=>({level:"error",header:"Something went wrong getting events",message:c().error.message}));xe(h,{get item(){return e(M)}})}},W=h=>{var M=Ge(),d=n(I(M),2);me(d,1,()=>c().events.sort((p,s)=>s.eventDateUnix-p.eventDateUnix),ue,(p,s)=>{const ee=he(()=>se.fromSeconds(e(s).eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm"));var U=qe(),f=v(U),b=v(f,!0);o(f);var m=n(f,2),F=v(m);{var D=a=>{var r=X();k(()=>P(r,e(s).mood)),t(a,r)},K=a=>{var r=X("-");t(a,r)};u(F,a=>{e(s).mood!==void 0?a(D):a(K,!1)})}o(m);var T=n(m,2),N=v(T);{var V=a=>{var r=X();k(R=>P(r,`${R??""} kg`),[()=>(e(s).weight/100).toFixed(1)]),t(a,r)},ve=a=>{var r=X("-");t(a,r)};u(N,a=>{e(s).weight!==void 0?a(V):a(ve,!1)})}o(T);var Q=n(T,2),i=v(Q);{var L=a=>{var r=Ve();me(r,5,()=>e(s).emotionwheel.emotions,ue,(R,G)=>{var g=He(),O=v(g);o(g),k(()=>{Ue(g,`--color: ${e(G).color??""}`),P(O,`${e(G).category??""}
                                ${e(G).subcategory??""}
                                ${e(G).emotion??""}`)}),t(R,g)}),o(r),t(a,r)},te=a=>{var r=X("-");t(a,r)};u(i,a=>{e(s).emotionwheel?.emotions?a(L):a(te,!1)})}o(Q);var q=n(Q,2),ie=v(q);ie.__click=()=>_(e(s).eventDateUnix),o(q),o(U),k(()=>P(b,e(ee))),t(p,U)}),t(h,M)};u(C,h=>{c().error?h(E):h(W,!1)},!0)}t(y,x)};u(B,y=>{c().loading?y(Z):y(J,!1)})}t(Y,H),pe(),A()}fe(["click"]);var ze=l("<p>Loading events</p>"),Be=l('<div class="add-indicator svelte-juywa"><span class="plus-sign svelte-juywa">+</span></div>'),Je=l('<div class="indicator mood svelte-juywa"> </div>'),Ke=l('<div class="indicator weight svelte-juywa">W</div>'),Ne=l('<div class="indicator emotions svelte-juywa">E</div>'),Qe=l('<div class="event-indicators svelte-juywa"><!> <!> <!></div>'),Re=l('<div role="button" tabindex="0"><div class="day-number svelte-juywa"> </div> <!> <!></div>'),Xe=l('<div class="calendar-container svelte-juywa"><div class="calendar-header svelte-juywa"><button class="nav-button svelte-juywa">&lt;</button> <h3 class="month-year svelte-juywa"> </h3> <button class="nav-button svelte-juywa">&gt;</button> <button class="today-button svelte-juywa">Today</button></div> <div class="calendar-grid svelte-juywa"><div class="day-name svelte-juywa">Mon</div> <div class="day-name svelte-juywa">Tue</div> <div class="day-name svelte-juywa">Wed</div> <div class="day-name svelte-juywa">Thu</div> <div class="day-name svelte-juywa">Fri</div> <div class="day-name svelte-juywa">Sat</div> <div class="day-name svelte-juywa">Sun</div> <!></div> <div class="calendar-legend svelte-juywa"><div class="legend-item svelte-juywa"><div class="indicator mood svelte-juywa">5</div> <span>Mood</span></div> <div class="legend-item svelte-juywa"><div class="indicator weight svelte-juywa">W</div> <span>Weight</span></div> <div class="legend-item svelte-juywa"><div class="indicator emotions svelte-juywa">E</div> <span>Emotions</span></div></div></div>');function Ze(Y,z){_e(z,!0);const $=()=>re($e,"$personalTrackerPassword",S),c=()=>re(ne,"$eventsStore",S),[S,A]=ke();let _=be(Se(se.now().startOf("month")));je(()=>{ne.fetch($())});const H=()=>{ae(_,e(_).minus({months:1}),!0)},B=()=>{ae(_,e(_).plus({months:1}),!0)},Z=()=>{ae(_,se.now().startOf("month"),!0)},J=d=>{ge(`/personal-tracker/add/${d}`)},y=(d,p)=>{const s=d.startOf("month"),U=s.weekday-1,f=42,b=[];let m=s.minus({days:U});for(let F=0;F<f;F++){const D=m.toUTC().plus({days:1}).startOf("day").toUnixInteger(),K=p.find(V=>V.eventDateUnix===D),T=m.month===d.month,N=m.hasSame(se.now(),"day");b.push({date:m,timestamp:D,event:K,isCurrentMonth:T,isToday:N}),m=m.plus({days:1})}return b},x=le(()=>y(e(_),c().events)),C=le(()=>e(_).toFormat("MMMM yyyy"));var E=oe(),W=I(E);{var h=d=>{var p=ze();t(d,p)},M=d=>{var p=oe(),s=I(p);{var ee=f=>{{let b=le(()=>({level:"error",header:"Something went wrong getting events",message:c().error.message}));xe(f,{get item(){return e(b)}})}},U=f=>{var b=Xe(),m=v(b),F=v(m);F.__click=H;var D=n(F,2),K=v(D,!0);o(D);var T=n(D,2);T.__click=B;var N=n(T,2);N.__click=Z,o(m);var V=n(m,2),ve=n(v(V),14);me(ve,17,()=>e(x),ue,(Q,i)=>{var L=Re();let te;L.__click=()=>J(e(i).timestamp);var q=v(L),ie=v(q,!0);o(q);var a=n(q,2);{var r=g=>{var O=Be();t(g,O)};u(a,g=>{e(i).event||g(r)})}var R=n(a,2);{var G=g=>{var O=Qe(),ye=v(O);{var Me=w=>{var j=Je(),de=v(j,!0);o(j),k(()=>{ce(j,"title",`Mood: ${e(i).event.mood??""}`),P(de,e(i).event.mood)}),t(w,j)};u(ye,w=>{e(i).event.mood!==void 0&&w(Me)})}var we=n(ye,2);{var De=w=>{var j=Ke();k(de=>ce(j,"title",`Weight: ${de??""} kg`),[()=>(e(i).event.weight/100).toFixed(1)]),t(w,j)};u(we,w=>{e(i).event.weight!==void 0&&w(De)})}var Te=n(we,2);{var Pe=w=>{var j=Ne();k(()=>ce(j,"title",`${e(i).event.emotionwheel.emotions.length??""} emotions`)),t(w,j)};u(Te,w=>{e(i).event.emotionwheel?.emotions&&w(Pe)})}o(O),t(g,O)};u(R,g=>{e(i).event&&g(G)})}o(L),k(()=>{te=Fe(L,1,"calendar-day svelte-juywa",null,te,{"other-month":!e(i).isCurrentMonth,"has-event":e(i).event,today:e(i).isToday}),P(ie,e(i).date.day)}),t(Q,L)}),o(V),Ce(2),o(b),k(()=>P(K,e(C))),t(f,b)};u(s,f=>{c().error?f(ee):f(U,!1)},!0)}t(d,p)};u(W,d=>{c().loading?d(h):d(M,!1)})}t(Y,E),pe(),A()}fe(["click"]);var et=l('<div class="controls svelte-8wagie"><button>Add an entry</button> <button class="view-toggle svelte-8wagie"> </button></div> <!>',1),tt=l("<!> <!>",1);function jt(Y,z){_e(z,!0);const $={name:"Personal Tracker",description:"Track me metrics",iconPath:"/personal_tracker.png",showAuthInHeader:!0};Ie.set($);let c=be("calendar");const S=()=>{ae(c,e(c)==="calendar"?"list":"calendar",!0)};var A=tt(),_=I(A);We(_,{get title(){return $.name},get description(){return $.description},get iconPath(){return $.iconPath}});var H=n(_,2);Ee(H,{message:"Login to see events",requiredScope:"admin",children:(B,Z)=>{Oe(B,{children:(J,y)=>{var x=et(),C=I(x),E=v(C);E.__click=()=>ge("/personal-tracker/add");var W=n(E,2);W.__click=S;var h=v(W,!0);o(W),o(C);var M=n(C,2);{var d=s=>{Ze(s,{})},p=s=>{Ye(s,{})};u(M,s=>{e(c)==="calendar"?s(d):s(p,!1)})}k(()=>P(h,e(c)==="calendar"?"ðŸ“‹ List View":"ðŸ“… Calendar View")),t(J,x)},$$slots:{default:!0}})},$$slots:{default:!0}}),t(Y,A),pe()}fe(["click"]);export{jt as component};
