import"../chunks/NZTpNUN0.js";import{z as at,A as U,B as ot,p as X,f as G,F as C,x as I,a as w,E as ct,v as T,s as y,g as l,aZ as Z,G as b,a_ as j,c as D}from"../chunks/Br9SMxIB.js";import{d as ut,s as ft}from"../chunks/BBzb7ThI.js";import{i as H}from"../chunks/CvXxFVm9.js";import{e as J,i as K}from"../chunks/D1-nhZYT.js";import{a as vt,s as ht,c as L}from"../chunks/DWdbj9D8.js";import{M as pt}from"../chunks/DKmGubEx.js";var v=(t=>(t[t.notOver=0]="notOver",t[t.winPlayer1=1]="winPlayer1",t[t.winPlayer2=2]="winPlayer2",t[t.draw=3]="draw",t))(v||{});const x=7,m=6,h=4;class gt extends Error{constructor(n){super("Can't play in column "+n)}}const F=t=>t.map(n=>[...n]),Y=(t,n)=>t[n].length!==m,V=t=>{const n=[];for(let e=0;e<t.length;e++)t[e].length<m&&n.push(e);return n},mt=t=>{const n=x*m,e=t.reduce((s,a)=>s+a.length,0);return n===e},wt=t=>{for(let n=0;n<x;n++)for(let e=0;e<m;e++){if(t[n].length<e||!t[n][e])continue;const s=t[n][e];let a=0,o=0,c=0,i=0;for(let r=0;r<h;r++)e+r<=t[n].length&&t[n][e+r]===s&&a++,n+r<t.length&&t[n+r][e]===s&&o++,n+r<t.length&&e+r<=t[n+r].length&&t[n+r][e+r]===s&&c++,n+r<t.length&&e-r>=0&&t[n+r][e-r]===s&&i++;if(a===h||o===h||c===h||i===h)return s}return null},yt=t=>{if(_(t)===0)return null;for(let n=0;n<x;n++)for(let e=0;e<m;e++){if(t[n].length<e||!t[n][e])continue;const s=t[n][e],a=[],o=[],c=[],i=[];for(let r=0;r<h;r++)e+r<=t[n].length&&t[n][e+r]===s&&a.push([e+r,n]),n+r<t.length&&t[n+r][e]===s&&o.push([e,n+r]),n+r<t.length&&e+r<=t[n+r].length&&t[n+r][e+r]===s&&c.push([e+r,n+r]),n+r<t.length&&e-r>=0&&t[n+r][e-r]===s&&i.push([e-r,n+r]);if(a.length===h)return a;if(o.length===h)return o;if(c.length===h)return c;if(i.length===h)return i}return null},_=t=>{if(mt(t))return 3;const n=wt(t);return n===1?1:n===2?2:0},P=(t,n,e)=>{if(!Y(t,e))throw new gt(e);return t[e].push(n),t},_t=(t,n)=>{const e=Pt(t,n);return P(t,n,e)};class B{board;player;move;parent;children=[];visits=0;wins=0;constructor(n,e,s=null,a=null){this.board=n,this.player=e,this.move=s,this.parent=a}isFullyExpanded(){return this.children.length===V(this.board).length}isTerminal(){return _(this.board)!==v.notOver}}function Q(t,n,e,s=Math.sqrt(2)){return e===0?1/0:n/e+s*Math.sqrt(Math.log(t)/e)}function dt(t){for(;!t.isTerminal();)if(t.isFullyExpanded())t=bt(t);else return Mt(t);return t}function Mt(t){const n=t.children.map(i=>i.move),s=V(t.board).filter(i=>!n.includes(i)),a=s[Math.floor(Math.random()*s.length)],o=F(t.board);P(o,t.player,a);const c=new B(o,t.player===1?2:1,a,t);return t.children.push(c),c}function bt(t){return t.children.reduce((n,e)=>{const s=Q(t.visits,n.wins,n.visits);return Q(t.visits,e.wins,e.visits)>s?e:n})}function xt(t){const n=F(t.board);let e=t.player;for(;;){const s=_(n);if(s!==v.notOver)return s;const a=V(n),o=a[Math.floor(Math.random()*a.length)];P(n,e,o),e=e===1?2:1}}function Ct(t,n){let e=t;for(;e!==null;)e.visits+=1,n===v.winPlayer1&&e.parent?.player===1||n===v.winPlayer2&&e.parent?.player===2?e.wins+=1:n===v.draw&&(e.wins+=.5),e=e.parent}function Pt(t,n,e=1e3){const s=new B(F(t),n,null,null);for(let o=0;o<e;o++){const c=dt(s),i=xt(c);Ct(c,i)}return s.children.reduce((o,c)=>o.visits>c.visits?o:c).move}const kt=(t,n,e)=>{y(n,Array.from({length:7},()=>[]),!0),y(e,1)};var Ot=(t,n,e,s)=>n(l(e),l(s)),At=X("<div><button><div></div></button></div>"),Et=X('<!> <div class="main"><h3>Gravitrip</h3></div> <span><button>Restart game</button> <span style="font-weight: bold"><!></span></span> <div class="board svelte-1bdwycb"></div>',1);function Rt(t,n){at(n,!0);let e=U(ot(Array.from({length:7},()=>[]))),s=Z(()=>_(l(e))),a=Z(()=>yt(l(e)));const o=Array.from({length:m},(f,u)=>u),c=Array.from({length:x},(f,u)=>u);let i=U(1);const r=(f,u)=>{l(i)===1&&Y(l(e),f)&&_(l(e))===v.notOver&&(y(e,P(l(e),u,f),!0),y(i,l(i)===1?2:1,!0),setTimeout(()=>S(),300))},S=()=>{l(i)===2&&_(l(e))===v.notOver&&(y(e,_t(l(e),l(i)),!0),y(i,l(i)===1?2:1,!0))},tt=(f,u)=>l(a)===null?!1:l(a).filter(g=>g[0]===f&&g[1]===u).length>0;var W=Et(),q=G(W);pt(q,{title:"Gravitrip",description:"Gravitrip"});var k=T(q,4),R=C(k);R.__click=[kt,e,i];var $=T(R,2),et=C($);{var nt=f=>{var u=j("Game Over");w(f,u)},rt=f=>{var u=D(),g=G(u);{var A=d=>{var p=j();I(()=>ft(p,`Player ${l(s)??""} wins`)),w(d,p)};H(g,d=>{(l(s)===v.winPlayer1||l(s)===v.winPlayer2)&&d(A)},!0)}w(f,u)};H(et,f=>{l(s)===v.draw?f(nt):f(rt,!1)})}b($),b(k);var O=T(k,2);J(O,21,()=>o.reverse(),K,(f,u)=>{var g=D(),A=G(g);J(A,17,()=>c,K,(d,p)=>{var E=At(),M=C(E);let z;M.__click=[Ot,r,p,i];var st=C(M);let N;b(M),b(E),I((lt,it)=>{ht(M,"aria-label","col-"+l(p)),z=L(M,1,"outer-cell svelte-1bdwycb",null,z,lt),N=L(st,1,"cell svelte-1bdwycb",null,N,it)},[()=>({"winning-cell":tt(l(u),l(p))}),()=>({player1:l(e)[l(p)][l(u)]===1,player2:l(e)[l(p)][l(u)]===2})]),w(d,E)}),w(f,g)}),b(O),I(()=>vt(O,`--nb-col: ${x}; --nb-row: ${m}`)),w(t,W),ct()}ut(["click"]);export{Rt as component};
