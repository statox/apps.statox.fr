import"../chunks/DsnmJJEf.js";import{p as he,c as N,f as D,a as t,d as we,b as l,g as e,I as ke,s as i,e as v,r as o,t as $,j as ae,h as xe,C as We,aI as pe,n as Fe,i as ve}from"../chunks/DkXSg9Km.js";import{d as be,s as O}from"../chunks/Cyetx9DU.js";import{i as d}from"../chunks/Dw7qq8GU.js";import{M as Le}from"../chunks/qNvLz8AQ.js";import{M as Oe}from"../chunks/CrhFVsLi.js";import"../chunks/CQQT6HDV.js";import{o as Me}from"../chunks/CSozHYSm.js";import{e as ge,i as ye}from"../chunks/DZfzBhg_.js";import{b as Ie,s as Ae,a as se}from"../chunks/yH9QFfND.js";import{i as He}from"../chunks/ccnLYwlq.js";import{a as Q,s as De}from"../chunks/Chs2GqvL.js";import{u as Te}from"../chunks/DVKWB0F4.js";import{M as Pe}from"../chunks/CLLwXVC1.js";import"../chunks/RZZgkjFT.js";import"../chunks/B_ZMb8oH.js";import{e as de,p as Se,P as Ve}from"../chunks/-PFtY_iv.js";import{D as ie}from"../chunks/CkcISRbr.js";import{g as $e}from"../chunks/Di2i2vco.js";import"../chunks/C5RbRG69.js";import{p as qe}from"../chunks/vRHFL2XH.js";/* empty css                */var Ge=l("<p>Loading events</p>"),Ye=l('<button class="emotion-item svelte-cyscl8"> </button>'),ze=l('<div class="selection svelte-cyscl8"></div>'),Be=l('<div class="event svelte-cyscl8"><div class="event-date"> </div> <div class="event-value svelte-cyscl8"><!></div> <div class="event-value svelte-cyscl8"><!></div> <div class="event-value svelte-cyscl8"><!></div> <div class="event-actions svelte-cyscl8"><button class="svelte-cyscl8">Edit</button></div></div>'),Je=l('<div class="events-header svelte-cyscl8"><div>Date</div> <div>Mood</div> <div>Weight</div> <div>Emotions</div> <div>Actions</div></div> <!>',1);function Ke(R,X){he(X,!1);const T=()=>Q(Se,"$personalTrackerPassword",y),_=()=>Q(Te,"$user",y),P=()=>Q(de,"$eventsStore",y),[y,q]=De();Me(()=>{de.fetch(T())});const f=S=>{$e(`/personal-tracker/add/${S}`)};He();var G=N(),re=D(G);{var Z=S=>{var I=N(),A=D(I);{var Y=h=>{var E=Ge();t(h,E)},C=h=>{var E=N(),m=D(E);{var U=j=>{{let W=ke(()=>({level:"error",header:"Something went wrong getting events",message:P().error.message}));Pe(j,{get item(){return e(W)}})}},c=j=>{var W=Je(),w=i(D(W),2);ge(w,1,()=>P().events.sort((p,s)=>s.eventDateUnix-p.eventDateUnix),ye,(p,s)=>{const z=ke(()=>ie.fromSeconds(e(s).eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm"));var F=Be(),u=v(F),k=v(u,!0);o(u);var x=i(u,2),B=v(x);{var ee=a=>{var n=ae();$(()=>O(n,e(s).mood)),t(a,n)},le=a=>{var n=ae("-");t(a,n)};d(B,a=>{e(s).mood!==void 0?a(ee):a(le,!1)})}o(x);var J=i(x,2),ce=v(J);{var oe=a=>{var n=ae();$(H=>O(n,`${H??""} kg`),[()=>(e(s).weight/100).toFixed(1)]),t(a,n)},me=a=>{var n=ae("-");t(a,n)};d(ce,a=>{e(s).weight!==void 0?a(oe):a(me,!1)})}o(J);var te=i(J,2),r=v(te);{var M=a=>{var n=ze();ge(n,5,()=>e(s).emotionwheel.emotions,ye,(H,L)=>{var V=Ye(),_e=v(V);o(V),$(()=>{Ie(V,`--color: ${e(L).color??""}`),O(_e,`${e(L).category??""}
                                    ${e(L).subcategory??""}
                                    ${e(L).emotion??""}`)}),t(H,V)}),o(n),t(a,n)},ne=a=>{var n=ae("-");t(a,n)};d(r,a=>{e(s).emotionwheel?.emotions?a(M):a(ne,!1)})}o(te);var K=i(te,2),ue=v(K);ue.__click=()=>f(e(s).eventDateUnix),o(K),o(F),$(()=>O(k,e(z))),t(p,F)}),t(j,W)};d(m,j=>{P().error?j(U):j(c,!1)},!0)}t(h,E)};d(A,h=>{P().loading?h(Y):h(C,!1)})}t(S,I)};d(re,S=>{_()&&S(Z)})}t(R,G),we(),q()}be(["click"]);var Ne=l("<p>Loading events</p>"),Qe=l('<div class="indicator mood svelte-juywa"> </div>'),Re=l('<div class="indicator weight svelte-juywa">W</div>'),Xe=l('<div class="indicator emotions svelte-juywa">E</div>'),Ze=l('<div class="event-indicators svelte-juywa"><!> <!> <!></div>'),et=l('<div><div class="day-number svelte-juywa"> </div> <!></div>'),tt=l('<div class="calendar-container svelte-juywa"><div class="calendar-header svelte-juywa"><button class="nav-button svelte-juywa">&lt;</button> <h3 class="month-year svelte-juywa"> </h3> <button class="nav-button svelte-juywa">&gt;</button> <button class="today-button svelte-juywa">Today</button></div> <div class="calendar-grid svelte-juywa"><div class="day-name svelte-juywa">Mon</div> <div class="day-name svelte-juywa">Tue</div> <div class="day-name svelte-juywa">Wed</div> <div class="day-name svelte-juywa">Thu</div> <div class="day-name svelte-juywa">Fri</div> <div class="day-name svelte-juywa">Sat</div> <div class="day-name svelte-juywa">Sun</div> <!></div> <div class="calendar-legend svelte-juywa"><div class="legend-item svelte-juywa"><div class="indicator mood svelte-juywa">5</div> <span>Mood</span></div> <div class="legend-item svelte-juywa"><div class="indicator weight svelte-juywa">W</div> <span>Weight</span></div> <div class="legend-item svelte-juywa"><div class="indicator emotions svelte-juywa">E</div> <span>Emotions</span></div></div></div>');function at(R,X){he(X,!0);const T=()=>Q(Se,"$personalTrackerPassword",y),_=()=>Q(de,"$eventsStore",y),P=()=>Q(Te,"$user",y),[y,q]=De();let f=xe(We(ie.now().startOf("month")));Me(()=>{de.fetch(T())});const G=()=>{ve(f,e(f).minus({months:1}),!0)},re=()=>{ve(f,e(f).plus({months:1}),!0)},Z=()=>{ve(f,ie.now().startOf("month"),!0)},S=m=>{$e(`/personal-tracker/add/${m.eventDateUnix}`)},I=(m,U)=>{const c=m.startOf("month"),W=c.weekday-1,w=42,p=[];let s=c.minus({days:W});for(let z=0;z<w;z++){const F=s.toUTC().plus({days:1}).startOf("day").toUnixInteger(),u=U.find(B=>B.eventDateUnix===F),k=s.month===m.month,x=s.hasSame(ie.now(),"day");p.push({date:s,timestamp:F,event:u,isCurrentMonth:k,isToday:x}),s=s.plus({days:1})}return p},A=pe(()=>I(e(f),_().events)),Y=pe(()=>e(f).toFormat("MMMM yyyy"));var C=N(),h=D(C);{var E=m=>{var U=N(),c=D(U);{var j=w=>{var p=Ne();t(w,p)},W=w=>{var p=N(),s=D(p);{var z=u=>{{let k=pe(()=>({level:"error",header:"Something went wrong getting events",message:_().error.message}));Pe(u,{get item(){return e(k)}})}},F=u=>{var k=tt(),x=v(k),B=v(x);B.__click=G;var ee=i(B,2),le=v(ee,!0);o(ee);var J=i(ee,2);J.__click=re;var ce=i(J,2);ce.__click=Z,o(x);var oe=i(x,2),me=i(v(oe),14);ge(me,17,()=>e(A),ye,(te,r)=>{var M=et();let ne;M.__click=()=>e(r).event&&S(e(r).event);var K=v(M),ue=v(K,!0);o(K);var a=i(K,2);{var n=H=>{var L=Ze(),V=v(L);{var _e=g=>{var b=Qe(),fe=v(b,!0);o(b),$(()=>{se(b,"title",`Mood: ${e(r).event.mood??""}`),O(fe,e(r).event.mood)}),t(g,b)};d(V,g=>{e(r).event.mood!==void 0&&g(_e)})}var je=i(V,2);{var Ce=g=>{var b=Re();$(fe=>se(b,"title",`Weight: ${fe??""} kg`),[()=>(e(r).event.weight/100).toFixed(1)]),t(g,b)};d(je,g=>{e(r).event.weight!==void 0&&g(Ce)})}var Ee=i(je,2);{var Ue=g=>{var b=Xe();$(()=>se(b,"title",`${e(r).event.emotionwheel.emotions.length??""} emotions`)),t(g,b)};d(Ee,g=>{e(r).event.emotionwheel?.emotions&&g(Ue)})}o(L),t(H,L)};d(a,H=>{e(r).event&&H(n)})}o(M),$(()=>{ne=Ae(M,1,"calendar-day svelte-juywa",null,ne,{"other-month":!e(r).isCurrentMonth,"has-event":e(r).event,today:e(r).isToday}),se(M,"role",e(r).event?"button":void 0),se(M,"tabindex",e(r).event?0:void 0),O(ue,e(r).date.day)}),t(te,M)}),o(oe),Fe(2),o(k),$(()=>O(le,e(Y))),t(u,k)};d(s,u=>{_().error?u(z):u(F,!1)},!0)}t(w,p)};d(c,w=>{_().loading?w(j):w(W,!1)})}t(m,U)};d(h,m=>{P()&&m(E)})}t(R,C),we(),q()}be(["click"]);var st=l('<div class="controls svelte-8wagie"><button>Add an entry</button> <button class="view-toggle svelte-8wagie"> </button></div> <!>',1),rt=l("<!> <!>",1);function Dt(R,X){he(X,!0);const T={name:"Personal Tracker",description:"Track me metrics",iconPath:"/personal_tracker.png",showAuthInHeader:!0};qe.set(T);let _=xe("calendar");const P=()=>{ve(_,e(_)==="calendar"?"list":"calendar",!0)};var y=rt(),q=D(y);Oe(q,{get title(){return T.name},get description(){return T.description},get iconPath(){return T.iconPath}});var f=i(q,2);Le(f,{message:"Login to see events",requiredScope:"admin",children:(G,re)=>{Ve(G,{children:(Z,S)=>{var I=st(),A=D(I),Y=v(A);Y.__click=()=>$e("/personal-tracker/add");var C=i(Y,2);C.__click=P;var h=v(C,!0);o(C),o(A);var E=i(A,2);{var m=c=>{at(c,{})},U=c=>{Ke(c,{})};d(E,c=>{e(_)==="calendar"?c(m):c(U,!1)})}$(()=>O(h,e(_)==="calendar"?"ðŸ“‹ List View":"ðŸ“… Calendar View")),t(Z,I)},$$slots:{default:!0}})},$$slots:{default:!0}}),t(R,y),we()}be(["click"]);export{Dt as component};
