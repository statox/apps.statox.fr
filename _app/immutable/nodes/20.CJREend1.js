import"../chunks/NZTpNUN0.js";import{a as ie}from"../chunks/np3e4Z_M.js";import{p as se,b as m,f as d,s as o,a as s,d as le,e as N,r as O,g as a,h as b,i as r,c as D,t as j,j as V}from"../chunks/Brv8g2mx.js";import{d as pe,s as Y}from"../chunks/BlLNWVag.js";import{i as v}from"../chunks/D2xXzMMK.js";import{r as ve}from"../chunks/BJ0eyrNi.js";import{b as _e}from"../chunks/DLiMpzP4.js";import{B as x,a as q}from"../chunks/D_wmUE3b.js";import{P as me}from"../chunks/CELBgAxi.js";import{g as ce}from"../chunks/BAbArA4T.js";import{c as ge}from"../chunks/B1O5efb_.js";var fe=m('<button>Start a new game</button> <br/> <input type="string"/> <button>Join Game</button>',1),ue=m("<p>Connecting to the server…</p>"),de=m("<p>Waiting for an opponent to connect…</p>"),be=m("<p> </p> <!>",1),ye=m("<p>Something went wrong. Board is not defined.</p>"),we=m('<p>Game over</p> <button>Restart</button> <span style="font-weight: bold"><!></span> <!>',1),Se=m("<p>Disconnected</p>"),he=m("<h3>Online game <button>Back</button></h3> <!> <!> <!> <!> <!> <!>",1);function Ee(z,F){se(F,!0);let n,B=b(null),c=b(null),g=b(null),S=b(null),l=b("initial"),h=b("");const H=async()=>{const e=await ge.gravitrips.getNewGame();r(h,e.gameId,!0),G()},K=me.replace(/^http?/,"ws");ie(()=>{n&&n.close()});const G=()=>{n=new WebSocket(K+"/gravitrips/ws?"+a(h)),r(l,"connecting"),r(c,null),r(g,null),r(S,null),n.onopen=()=>{r(l,"waiting_for_opponent")},n.onclose=e=>{console.log(e.reason),r(l,"disconnected")},n.onmessage=e=>{const t=JSON.parse(e.data);t.type==="game_ready"?(r(l,"playing"),r(B,t.youAre,!0),r(c,t.board,!0)):t.type==="update_board"?(r(c,t.board,!0),r(g,t.boardState,!0),r(S,t.winningCells,!0)):t.type==="waiting_for_opponent"?r(g,null):t.type==="game_over"&&r(l,"game_over")}},I=e=>{if(!n||n.readyState!==WebSocket.OPEN)return;const t=JSON.stringify({type:"move",column:e});n.send(t)},Q=()=>{if(!n||n.readyState!==WebSocket.OPEN)return;const e=JSON.stringify({type:"restart"});n.send(e)};var W=he(),P=d(W),T=o(N(P));T.__click=()=>ce("/gravitrips"),O(P);var E=o(P,2);{var X=e=>{var t=fe(),f=d(t);f.__click=H;var _=o(f,4);ve(_);var y=o(_,2);y.__click=G,_e(_,()=>a(h),p=>r(h,p)),s(e,t)};v(E,e=>{["initial","waiting_for_opponent","game_over","disconnected"].includes(a(l))&&e(X)})}var J=o(E,2);{var Z=e=>{var t=ue();s(e,t)};v(J,e=>{a(l)==="connecting"&&e(Z)})}var A=o(J,2);{var $=e=>{var t=de();s(e,t)};v(A,e=>{a(l)==="waiting_for_opponent"&&e($)})}var L=o(A,2);{var ee=e=>{var t=D(),f=d(t);{var _=p=>{var u=be(),w=d(u),C=N(w);O(w);var i=o(w,2);q(i,{nbColumns:7,nbRows:6,get board(){return a(c)},get winningCells(){return a(S)},onMove:I}),j(()=>Y(C,`You are Player ${a(B)??""}`)),s(p,u)},y=p=>{var u=ye();s(p,u)};v(f,p=>{a(c)!==null?p(_):p(y,!1)})}s(e,t)};v(L,e=>{a(l)==="playing"&&e(ee)})}var M=o(L,2);{var te=e=>{var t=we(),f=o(d(t),2);f.__click=Q;var _=o(f,2),y=N(_);{var p=i=>{var k=V("Game Over");s(i,k)},u=i=>{var k=D(),oe=d(k);{var ne=R=>{var U=V();j(()=>Y(U,`Player ${a(g)??""} wins`)),s(R,U)};v(oe,R=>{(a(g)===x.winPlayer1||a(g)===x.winPlayer2)&&R(ne)},!0)}s(i,k)};v(y,i=>{a(g)===x.draw?i(p):i(u,!1)})}O(_);var w=o(_,2);{var C=i=>{q(i,{nbColumns:7,nbRows:6,get board(){return a(c)},get winningCells(){return a(S)},onMove:I})};v(w,i=>{a(c)!==null&&i(C)})}s(e,t)};v(M,e=>{a(l)==="game_over"&&e(te)})}var ae=o(M,2);{var re=e=>{var t=Se();s(e,t)};v(ae,e=>{a(l)==="disconnected"&&e(re)})}s(z,W),le()}pe(["click"]);export{Ee as component};
