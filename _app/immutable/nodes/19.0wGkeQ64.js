import"../chunks/NZTpNUN0.js";import{p as fe,h as C,a5 as S,b as I,s as u,e as p,i as c,g as e,r as h,t as z,a as P,n as D,d as ge,f as Y,be as Re,u as ve,j as me,c as He}from"../chunks/OOCdeaM4.js";import{d as be,s as _e,e as Ne}from"../chunks/DBBHR-3t.js";import{i as q}from"../chunks/BMFH8sZT.js";import{s as E}from"../chunks/DazWBkG7.js";import{M as qe}from"../chunks/C8MJLfl1.js";import{m as H,g as L,c as R,b as O,B as g,d as $,a as De,n as Ee,e as Ie,i as Le,f as Ue}from"../chunks/H9lSQ-CD.js";import{e as Ve,i as Fe}from"../chunks/80iJqotc.js";import{r as de}from"../chunks/C2XHBoXy.js";import{b as pe}from"../chunks/CCHh_OeQ.js";import"../chunks/DRxGxY2p.js";import"../chunks/DRmGx022.js";import{p as Ge}from"../chunks/CgiMXJad.js";/* empty css                */import"../chunks/bMdrnNxv.js";import{g as je}from"../chunks/DTf1Xn17.js";const Ae=a=>{const o=L(a),t=Math.floor(Math.random()*o.length);return o[t]},Ke=(a,o)=>{const t=Ae(a);return{board:H(a,o,t),move:t}},We=(a,o,t)=>{const n=Xe(a,o,t.iterations,t.c);return{board:H(a,o,n),move:n}};class ye{board;player;move;parent;children=[];visits=0;wins=0;constructor(o,t,n=null,r=null){this.board=o,this.player=t,this.move=n,this.parent=r}isFullyExpanded(){return this.children.length===L(this.board).length}isTerminal(){return O(this.board)!==g.notOver}}function he(a,o,t,n=Math.sqrt(2)){return t===0?1/0:o/t+n*Math.sqrt(Math.log(a)/t)}function Ye(a,o){for(;!a.isTerminal();)if(a.isFullyExpanded())a=ze(a,o);else return $e(a);return a}function $e(a){const o=a.children.map(i=>i.move),n=L(a.board).filter(i=>!o.includes(i)),r=n[Math.floor(Math.random()*n.length)],s=R(a.board);H(s,a.player,r);const m=new ye(s,a.player===1?2:1,r,a);return a.children.push(m),m}function ze(a,o){return a.children.reduce((t,n)=>{const r=he(a.visits,t.wins,t.visits,o);return he(a.visits,n.wins,n.visits,o)>r?n:t})}function Je(a){const o=R(a.board);let t=a.player;for(;;){const n=O(o);if(n!==g.notOver)return n;const r=L(o),s=r[Math.floor(Math.random()*r.length)];H(o,t,s),t=t===1?2:1}}function Qe(a,o){let t=a;for(;t!==null;)t.visits+=1,o===g.winPlayer1&&t.parent?.player===1||o===g.winPlayer2&&t.parent?.player===2?t.wins+=1:o===g.draw&&(t.wins+=.5),t=t.parent}function Xe(a,o,t=1e3,n=Math.sqrt(2)){const r=new ye(R(a),o,null,null);for(let m=0;m<t;m++){const i=Ye(r,n),y=Je(i);Qe(i,y)}return r.children.reduce((m,i)=>m.visits>i.visits?m:i).move}var Ze=I("<button> </button>"),et=I(`<div><h4>Monte Carlo Tree Search parameters</h4> <div class="difficulty-options svelte-90tef"><label for="mcts-preset">Preset difficulty</label> <!></div> <div><h5>Iterations:</h5> <input id="mcts-iterations" type="number" min="0"/></div> <div>Number of simulations MCTS will run before choosing a move. Higher values usually mean
        stronger play but slower decisions.</div> <div><h5>C (exploration constant):</h5> <input id="mcts-c" type="number" min="0" step="0.1"/></div> <div>Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
        favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2 ≈
        1.41.</div></div>`);function tt(a,o){fe(o,!0);const t=[{name:"easy",iterations:200,c:2},{name:"medium",iterations:1e3,c:1.41},{name:"hard",iterations:5e3,c:.7}],n=t[1];let r=C(S(n.iterations)),s=C(S(n.c));const m=()=>{o.onUpdate({iterations:e(r),c:e(s)})};var i=et(),y=u(p(i),2),d=u(p(y),2);Ve(d,17,()=>t,Fe,(w,_)=>{var M=Ze();M.__click=()=>{c(r,e(_).iterations,!0),c(s,e(_).c,!0),m()};let k;var U=p(M,!0);h(M),z(()=>{k=E(M,1,"",null,k,{selected:e(s)===e(_).c&&e(r)===e(_).iterations}),_e(U,e(_).name)}),P(w,M)}),h(y);var b=u(y,2),v=u(p(b),2);de(v),v.__change=m,h(b);var T=u(b,4),x=u(p(T),2);de(x),x.__change=m,h(T),D(2),h(i),pe(v,()=>e(r),w=>c(r,w)),pe(x,()=>e(s),w=>c(s,w)),P(a,i),ge()}be(["click","change"]);var at=I("Game Over - <!>",1),rt=I('<!> <h3>Local game <button>Back</button></h3> <div class="opponent-choice svelte-1m0eka9"><label for="opponent-options">Choose your opponent:</label> <div class="opponent-options svelte-1m0eka9"><div><button>Human</button> Play with another human on the same computer.</div> <div><button>Random</button> The computer makes completely random moves, no intelligence at all.</div> <div><button>MCTS</button> The computer uses a <a href="https://en.wikipedia.org/wiki/Monte_Carlo_tree_search">Monte Carlo tree search</a> algorithm to make smart moves. You can tweak the difficulty at the bottom of the page.</div></div></div> <div class="game-controls svelte-1m0eka9"><button>New game</button> <button>Cancel move</button></div> <div class="game-results svelte-1m0eka9"><!></div> <!> <div class="computer-settings svelte-1m0eka9"><!></div>',1);function yt(a,o){fe(o,!0);const t={name:"Gravitrips",description:"4 in a row",iconPath:"/gravitrips.png"};Ge.set(t);let n=C(S($())),r=C(S([])),s=ve(()=>O(e(n))),m=ve(()=>Ue(e(n))),i=C("mcts"),y=C(S({iterations:1e3,c:1.41})),d=C(1),b=1,v=2;const T=()=>{c(n,$(),!0),c(r,[],!0),c(d,1),[b,v]=[v,b],e(i)!=="manual"&&v===e(d)&&k()},x=(l,f)=>{e(r).push({board:R(l),moveByPlayer:f}),c(r,e(r),!0)},w=()=>{if(e(i)==="manual")e(r).pop(),_();else{if(e(r).length===1&&e(r)[e(r).length-1].moveByPlayer===v)return;e(r)[e(r).length-1].moveByPlayer===v&&e(r).pop(),e(r).length&&e(r)[e(r).length-1].moveByPlayer===b&&e(r).pop()}c(r,e(r),!0),e(r).length===0?c(n,$(),!0):c(n,R(e(r)[e(r).length-1].board),!0)},_=()=>c(d,e(d)===1?2:1,!0),M=l=>{if(b!==e(d)&&e(i)!=="manual"||!Le(e(n),l)||O(e(n))!==g.notOver)return;let f;if(b===e(d))f=b;else if(v===e(d)&&e(i)==="manual")f=v;else return;c(n,H(e(n),f,l),!0),x(e(n),f),_(),e(i)!=="manual"&&setTimeout(()=>k(),200)},k=()=>{if(v!==e(d)||O(e(n))!==g.notOver||e(i)==="manual")return;let l;if(e(i)==="random")l=Ke(e(n),e(d));else if(e(i)==="mcts")l=We(e(n),e(d),e(y));else throw new Error("computer strategy not implemented");const{board:f}=l;c(n,f,!0),x(e(n),v),_()},U=l=>{switch(l.key){case"r":T();break}};var J=rt();Ne("keydown",Re,U);var Q=Y(J);qe(Q,{get title(){return t.name},get description(){return t.description},get iconPath(){return t.iconPath}});var V=u(Q,2),we=u(p(V));we.__click=()=>je("/gravitrips"),h(V);var F=u(V,2),X=u(p(F),2),G=p(X),Z=p(G);Z.__click=()=>{c(i,"manual")};let ee;D(),h(G);var j=u(G,2),te=p(j);te.__click=()=>{c(i,"random"),v===e(d)&&k()};let ae;D(),h(j);var re=u(j,2),ne=p(re);ne.__click=()=>{c(i,"mcts"),v===e(d)&&k()};let oe;D(3),h(re),h(X),h(F);var A=u(F,2),ie=p(A);ie.__click=T;var se=u(ie,2);se.__click=w,h(A);var K=u(A,2),Me=p(K);{var ke=l=>{var f=at(),xe=u(Y(f));{var Be=B=>{var N=me("Draw");P(B,N)},Te=B=>{var N=He(),Se=Y(N);{var Oe=W=>{var ue=me();z(()=>_e(ue,`Player ${e(s)??""} wins`)),P(W,ue)};q(Se,W=>{(e(s)===g.winPlayer1||e(s)===g.winPlayer2)&&W(Oe)},!0)}P(B,N)};q(xe,B=>{e(s)===g.draw?B(Be):B(Te,!1)})}P(l,f)};q(Me,l=>{e(s)!==g.notOver&&l(ke)})}h(K);var le=u(K,2);De(le,{get nbColumns(){return Ie},get nbRows(){return Ee},get board(){return e(n)},get winningCells(){return e(m)},onMove:M});var ce=u(le,2),Ce=p(ce);{var Pe=l=>{tt(l,{onUpdate:f=>c(y,f,!0)})};q(Ce,l=>{e(i)==="mcts"&&l(Pe)})}h(ce),z(()=>{ee=E(Z,1,"",null,ee,{selected:e(i)==="manual"}),ae=E(te,1,"",null,ae,{selected:e(i)==="random"}),oe=E(ne,1,"",null,oe,{selected:e(i)==="mcts"}),se.disabled=e(r).length===0}),P(a,J),ge()}be(["click"]);export{yt as component};
