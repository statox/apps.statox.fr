import"../chunks/NZTpNUN0.js";import{p as H,b as _,s as i,f as $,a as g,d as O,e as u,r as m,t as R,n as Y,g as t,h as v,i as n,u as Z}from"../chunks/CKl30C1c.js";import{s as j,e as z}from"../chunks/CXUVAb3i.js";import{i as x}from"../chunks/Bf-KvY8u.js";import{r as I}from"../chunks/BIVvBMnW.js";import{b as L}from"../chunks/2C5CoL1D.js";import{s as B,a as C}from"../chunks/DBHw-l6w.js";import{a as G,g as J}from"../chunks/C8S7tTw2.js";import{u as K,l as Q,c as V}from"../chunks/CQdnaxUn.js";import{s as S}from"../chunks/NZ_7-SuS.js";import{M as W}from"../chunks/CeIpYOI6.js";var X=_("<p> </p>"),ee=_('<form><section><label for="username">Username</label> <input id="username" name="username" type="text" autocomplete="username" required/></section> <section><label for="current-password">Password</label> <input id="current-password" name="password" type="password" autocomplete="current-password" required/></section> <button type="submit">Sign in</button></form> <!>',1),re=_("<h2>Login</h2> <!>",1);function de(U,k){H(k,!0);const p=()=>C(K,"$user",q),[q,A]=B();let l=v(""),f=v(""),o=v(void 0),d="/";G(({from:e})=>{e?.url.pathname!=="/auth/login"&&(d=e?.url.pathname||d)});const D=async e=>{e.preventDefault();try{await Q(t(l),t(f)),await V(),p()?.status=="logged_in"?(S.set(!0),setTimeout(()=>S.set(!1),2500),J(d)):n(o,new Error("Invalid password or username"),!0)}catch(r){if(r?.message==='{"message":"UNAUTHORIZED"}'){n(o,"Invalid password or username");return}n(o,r,!0)}};var h=re(),E=i($(h),2);{var M=e=>{var r=X(),s=u(r);m(r),R(()=>j(s,`You are already logged in a ${p()?.user.username??""}`)),g(e,r)},N=e=>{var r=ee(),s=$(r),c=u(s),b=i(u(c),2);I(b),m(c);var w=i(c,2),y=i(u(w),2);I(y),m(w),Y(2),m(s);var P=i(s,2);{var T=a=>{{let F=Z(()=>({level:"error",header:"Failed auth",message:t(o).toString()}));W(a,{get item(){return t(F)}})}};x(P,a=>{t(o)&&a(T)})}z("submit",s,D),L(b,()=>t(l),a=>n(l,a)),L(y,()=>t(f),a=>n(f,a)),g(e,r)};x(E,e=>{p()?.status=="logged_in"?e(M):e(N,!1)})}g(U,h),O(),A()}export{de as component};
