import"../chunks/NZTpNUN0.js";import{p as he,e as _,G as B,b as V,s as v,i as h,r as f,t as z,g as e,a as M,F as H,h as c,d as fe,f as Q,a$ as Be,a_ as ue,j as ve,c as Se}from"../chunks/CbdQCwiJ.js";import{d as ge,s as be,e as Fe}from"../chunks/C_JLaYK3.js";import{i as q}from"../chunks/Cwax3Gcm.js";import{c as I,r as de}from"../chunks/De0WW0FM.js";import{M as Oe}from"../chunks/ldi1zNb-.js";import{m as O,g as D,c as F,b as S,B as g,d as Y,a as Ae,n as Ge,e as Ne,i as Re,f as qe}from"../chunks/a91bN_-B.js";import{e as He,i as Ie}from"../chunks/DownwXoY.js";import{b as me}from"../chunks/BG7yEM_d.js";import"../chunks/CY6KV77E.js";import{p as Ve}from"../chunks/BFB_vL5V.js";const De=r=>{const o=D(r),t=Math.floor(Math.random()*o.length);return o[t]},Ee=(r,o)=>{const t=De(r);return{board:O(r,o,t),move:t}},Ue=(r,o,t)=>{const a=Qe(r,o,t.iterations,t.c);return{board:O(r,o,a),move:a}};class we{board;player;move;parent;children=[];visits=0;wins=0;constructor(o,t,a=null,i=null){this.board=o,this.player=t,this.move=a,this.parent=i}isFullyExpanded(){return this.children.length===D(this.board).length}isTerminal(){return S(this.board)!==g.notOver}}function pe(r,o,t,a=Math.sqrt(2)){return t===0?1/0:o/t+a*Math.sqrt(Math.log(r)/t)}function $e(r,o){for(;!r.isTerminal();)if(r.isFullyExpanded())r=Le(r,o);else return Ke(r);return r}function Ke(r){const o=r.children.map(u=>u.move),a=D(r.board).filter(u=>!o.includes(u)),i=a[Math.floor(Math.random()*a.length)],p=F(r.board);O(p,r.player,i);const n=new we(p,r.player===1?2:1,i,r);return r.children.push(n),n}function Le(r,o){return r.children.reduce((t,a)=>{const i=pe(r.visits,t.wins,t.visits,o);return pe(r.visits,a.wins,a.visits,o)>i?a:t})}function We(r){const o=F(r.board);let t=r.player;for(;;){const a=S(o);if(a!==g.notOver)return a;const i=D(o),p=i[Math.floor(Math.random()*i.length)];O(o,t,p),t=t===1?2:1}}function je(r,o){let t=r;for(;t!==null;)t.visits+=1,o===g.winPlayer1&&t.parent?.player===1||o===g.winPlayer2&&t.parent?.player===2?t.wins+=1:o===g.draw&&(t.wins+=.5),t=t.parent}function Qe(r,o,t=1e3,a=Math.sqrt(2)){const i=new we(F(r),o,null,null);for(let n=0;n<t;n++){const u=$e(i,a),l=We(u);je(u,l)}return i.children.reduce((n,u)=>n.visits>u.visits?n:u).move}var Ye=(r,o,t,a,i)=>{c(o,e(t).iterations,!0),c(a,e(t).c,!0),i()},ze=V("<button> </button>"),Je=V(`<div><h4>Monte Carlo Tree Search parameters</h4> <div class="difficulty-options svelte-130wfia"><label for="mcts-preset">Preset difficulty</label> <!></div> <div><h5>Iterations:</h5> <input id="mcts-iterations" type="number" min="0"/></div> <div>Number of simulations MCTS will run before choosing a move. Higher values usually mean
        stronger play but slower decisions.</div> <div><h5>C (exploration constant):</h5> <input id="mcts-c" type="number" min="0" step="0.1"/></div> <div>Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
        favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2 ≈
        1.41.</div></div>`);function Xe(r,o){he(o,!0);const t=[{name:"easy",iterations:200,c:2},{name:"medium",iterations:1e3,c:1.41},{name:"hard",iterations:5e3,c:.7}],a=t[1];let i=_(B(a.iterations)),p=_(B(a.c));const n=()=>{o.onUpdate({iterations:e(i),c:e(p)})};var u=Je(),l=v(h(u),2),y=v(h(l),2);He(y,17,()=>t,Ie,(w,C)=>{var b=ze();b.__click=[Ye,i,C,p,n];let A;var G=h(b,!0);f(b),z(N=>{A=I(b,1,"svelte-130wfia",null,A,N),be(G,e(C).name)},[()=>({selected:e(p)===e(C).c&&e(i)===e(C).iterations})]),M(w,b)}),f(l);var d=v(l,2),k=v(h(d),2);de(k),k.__change=n,f(d);var x=v(d,4),T=v(h(x),2);de(T),T.__change=n,f(x),H(2),f(u),me(k,()=>e(i),w=>c(i,w)),me(T,()=>e(p),w=>c(p,w)),M(r,u),fe()}ge(["click","change"]);var Ze=(r,o)=>{c(o,"manual")},et=V("Game Over - <!>",1),tt=V(`<!> <div class="page-intro svelte-1bdwycb"><div>Gravitrips (which you might know as <a href="https://en.wikipedia.org/wiki/Connect_Four">Connect Four</a>) is a classic two-player strategy game where players take turns dropping pieces into a
        grid, aiming to align four in a row. On this page, you can challenge a friend on the same
        computer or test your skills against computer opponents with different AI strategies.</div> <br/> <div>Some resources: <ul><li><a href="https://www.quora.com/What-is-the-winning-strategy-for-the-first-player-in-Connect-Four-games">Quora thread</a> with some tips on the winning strategy</li> <li><a href="http://statox.fr/uploads/a-knowledge-based-approach-of-connect-four.pdf">A Knowledge-based Approach of Connect-Four - Victor Allis</a>. The first paper solving the game and proposing rules to follow to win or force a
                draw.</li> <li><a href="https://drimify.com/en/resources/connect-four-strategy-win-time-play/">A bogus marketting article</a> talking about some human stategies</li></ul></div></div> <div class="opponent-choice svelte-1bdwycb"><label for="opponent-options">Choose your opponent:</label> <div class="opponent-options svelte-1bdwycb"><div><button>Human</button> Play with another human on the same computer.</div> <div><button>Random</button> The computer makes completely random moves, no intelligence at all.</div> <div><button>MCTS</button> The computer uses a <a href="https://en.wikipedia.org/wiki/Monte_Carlo_tree_search">Monte Carlo tree search</a> algorithm to make smart moves. You can tweak the difficulty at the bottom of the page.</div></div></div> <div class="game-controls svelte-1bdwycb"><button>New game</button> <button>Cancel move</button></div> <div class="game-results svelte-1bdwycb"><!></div> <!> <div class="computer-settings svelte-1bdwycb"><!></div>`,1);function mt(r,o){he(o,!0),Ve.set("Gravitrips");let t=_(B(Y())),a=_(B([])),i=ue(()=>S(e(t))),p=ue(()=>qe(e(t))),n=_("mcts"),u=_(B({iterations:1e3,c:1.41})),l=_(1),y=1,d=2;const k=()=>{c(t,Y(),!0),c(a,[],!0),c(l,1),[y,d]=[d,y],e(n)!=="manual"&&d===e(l)&&b()},x=(s,m)=>{e(a).push({board:F(s),moveByPlayer:m}),c(a,e(a),!0)},T=()=>{if(e(n)==="manual")e(a).pop(),w();else{if(e(a).length===1&&e(a)[e(a).length-1].moveByPlayer===d)return;e(a)[e(a).length-1].moveByPlayer===d&&e(a).pop(),e(a).length&&e(a)[e(a).length-1].moveByPlayer===y&&e(a).pop()}c(a,e(a),!0),e(a).length===0?c(t,Y(),!0):c(t,F(e(a)[e(a).length-1].board),!0)},w=()=>c(l,e(l)===1?2:1,!0),C=s=>{if(y!==e(l)&&e(n)!=="manual"||!Re(e(t),s)||S(e(t))!==g.notOver)return;let m;if(y===e(l))m=y;else if(d===e(l)&&e(n)==="manual")m=d;else return;c(t,O(e(t),m,s),!0),x(e(t),m),w(),e(n)!=="manual"&&setTimeout(()=>b(),200)},b=()=>{if(d!==e(l)||S(e(t))!==g.notOver||e(n)==="manual")return;let s;if(e(n)==="random")s=Ee(e(t),e(l));else if(e(n)==="mcts")s=Ue(e(t),e(l),e(u));else throw new Error("computer strategy not implemented");const{board:m}=s;c(t,m,!0),x(e(t),d),w()},A=s=>{switch(s.key){case"r":k();break}};var G=tt();Fe("keydown",Be,A);var N=Q(G);Oe(N,{title:"Gravitrip",description:"Gravitrip",iconPath:"/gravitrips.png"});var E=v(N,4),J=v(h(E),2),U=h(J),X=h(U);X.__click=[Ze,n];let Z;H(),f(U);var $=v(U,2),ee=h($);ee.__click=()=>{c(n,"random"),d===e(l)&&b()};let te;H(),f($);var ae=v($,2),re=h(ae);re.__click=()=>{c(n,"mcts"),d===e(l)&&b()};let oe;H(3),f(ae),f(J),f(E);var K=v(E,2),ne=h(K);ne.__click=k;var ie=v(ne,2);ie.__click=T,f(K);var L=v(K,2),ye=h(L);{var _e=s=>{var m=et(),W=v(Q(m));{var Ce=P=>{var R=ve("Draw");M(P,R)},Pe=P=>{var R=Se(),xe=Q(R);{var Te=j=>{var ce=ve();z(()=>be(ce,`Player ${e(i)??""} wins`)),M(j,ce)};q(xe,j=>{(e(i)===g.winPlayer1||e(i)===g.winPlayer2)&&j(Te)},!0)}M(P,R)};q(W,P=>{e(i)===g.draw?P(Ce):P(Pe,!1)})}M(s,m)};q(ye,s=>{e(i)!==g.notOver&&s(_e)})}f(L);var se=v(L,2);Ae(se,{get nbColumns(){return Ne},get nbRows(){return Ge},get board(){return e(t)},get winningCells(){return e(p)},onMove:C});var le=v(se,2),Me=h(le);{var ke=s=>{Xe(s,{onUpdate:m=>c(u,m,!0)})};q(Me,s=>{e(n)==="mcts"&&s(ke)})}f(le),z((s,m,W)=>{Z=I(X,1,"svelte-1bdwycb",null,Z,s),te=I(ee,1,"svelte-1bdwycb",null,te,m),oe=I(re,1,"svelte-1bdwycb",null,oe,W),ie.disabled=e(a).length===0},[()=>({selected:e(n)==="manual"}),()=>({selected:e(n)==="random"}),()=>({selected:e(n)==="mcts"})]),M(r,G),fe()}ge(["click"]);export{mt as component};
