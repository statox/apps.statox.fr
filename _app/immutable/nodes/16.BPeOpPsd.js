import"../chunks/NZTpNUN0.js";import{p as X,g,G as T,h as t,b as O,s as f,i as k,r as _,t as N,a as y,F as ue,e as l,d as Y,f as K,a$ as ce,a_ as L,j as $,c as me}from"../chunks/tjCGPzdr.js";import{d as Z,s as U,e as ve}from"../chunks/DOKer7p_.js";import{i as I}from"../chunks/BsrVr-Z0.js";import{e as ee,i as te}from"../chunks/An4e5j9g.js";import{r as z,b as re}from"../chunks/DKsZ4ghV.js";import{M as pe}from"../chunks/CJFchB7S.js";import{m as P,g as R,c as V,b as B,B as p,a as de,n as he,d as q,i as fe,e as be}from"../chunks/BLGMfthj.js";import{b as J}from"../chunks/B25JaP4K.js";import"../chunks/CqiQQVFS.js";import{p as ge}from"../chunks/CbZYYCkE.js";const _e=r=>{const a=R(r),e=Math.floor(Math.random()*a.length);return a[e]},we=(r,a)=>{const e=_e(r);return{board:P(r,a,e),move:e}},ye=(r,a,e)=>{console.log("MCTS run with",e);const n=Te(r,a,e.iterations,e.c);return{board:P(r,a,n),move:n}};class ae{board;player;move;parent;children=[];visits=0;wins=0;constructor(a,e,n=null,i=null){this.board=a,this.player=e,this.move=n,this.parent=i}isFullyExpanded(){return this.children.length===R(this.board).length}isTerminal(){return B(this.board)!==p.notOver}}function Q(r,a,e,n=Math.sqrt(2)){return e===0?1/0:a/e+n*Math.sqrt(Math.log(r)/e)}function Me(r,a){for(;!r.isTerminal();)if(r.isFullyExpanded())r=xe(r,a);else return Ce(r);return r}function Ce(r){const a=r.children.map(m=>m.move),n=R(r.board).filter(m=>!a.includes(m)),i=n[Math.floor(Math.random()*n.length)],s=V(r.board);P(s,r.player,i);const u=new ae(s,r.player===1?2:1,i,r);return r.children.push(u),u}function xe(r,a){return r.children.reduce((e,n)=>{const i=Q(r.visits,e.wins,e.visits,a);return Q(r.visits,n.wins,n.visits,a)>i?n:e})}function ke(r){const a=V(r.board);let e=r.player;for(;;){const n=B(a);if(n!==p.notOver)return n;const i=R(a),s=i[Math.floor(Math.random()*i.length)];P(a,e,s),e=e===1?2:1}}function Se(r,a){let e=r;for(;e!==null;)e.visits+=1,a===p.winPlayer1&&e.parent?.player===1||a===p.winPlayer2&&e.parent?.player===2?e.wins+=1:a===p.draw&&(e.wins+=.5),e=e.parent}function Te(r,a,e=1e3,n=Math.sqrt(2)){const i=new ae(V(r),a,null,null);for(let u=0;u<e;u++){const m=Me(i,n),c=ke(m);Se(m,c)}return i.children.reduce((u,m)=>u.visits>m.visits?u:m).move}var Be=(r,a,e,n,i)=>{t(a)&&(l(e,t(a).iterations,!0),l(n,t(a).c,!0),i())},Pe=O("<option> </option>"),Ge=(r,a,e)=>{l(a,null),e()},qe=(r,a,e)=>{l(a,null),e()},Oe=O(`<div><h4>Monte Carlo Tree Search parameters</h4> <label for="mcts-preset">Preset difficulty</label> <select></select> <br/><br/> <label for="mcts-iterations">Iterations:</label> <input id="mcts-iterations" type="number" min="0"/> <small>Number of simulations MCTS will run before choosing a move. Higher values usually mean
        stronger play but slower decisions.</small> <br/><br/> <label for="mcts-c">C (exploration constant):</label> <input id="mcts-c" type="number" min="0" step="0.1"/> <small>Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
        favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2 ≈
        1.41.</small></div>`);function Re(r,a){X(a,!0);const e=[{name:"easy",iterations:200,c:2},{name:"medium",iterations:1e3,c:1.41},{name:"hard",iterations:5e3,c:.7}];let n=g(T(e[1])),i=g(T(t(n).iterations)),s=g(T(t(n).c));const u=()=>{a.onUpdate({iterations:t(i),c:t(s)})};var m=Oe(),c=f(k(m),4);c.__change=[Be,n,i,s,u],ee(c,21,()=>e,te,(d,S)=>{var b=Pe(),G=k(b,!0);_(b);var C={};N(()=>{U(G,t(S).name),C!==(C=t(S))&&(b.value=(b.__value=t(S))??"")}),y(d,b)}),_(c);var w=f(c,7);z(w),w.__change=[Ge,n,u];var M=f(w,9);z(M),M.__change=[qe,n,u],ue(2),_(m),re(c,()=>t(n),d=>l(n,d)),J(w,()=>t(i),d=>l(i,d)),J(M,()=>t(s),d=>l(s,d)),y(r,m),Y()}Z(["change"]);var Fe=O("<option> </option>"),Ae=O('<!> <div class="main"><h3>Gravitrip</h3></div> <div>See <a href="https://www.quora.com/What-is-the-winning-strategy-for-the-first-player-in-Connect-Four-games">this quora thread</a> for some tips on the winning strategy</div> <div>Computer stategy: <select></select></div> <!> <span><button>Restart game</button> <span style="font-weight: bold"><!></span></span> <!>',1);function $e(r,a){X(a,!0),ge.set("Gravitrip");let e=g(T(Array.from({length:7},()=>[]))),n=L(()=>B(t(e))),i=L(()=>be(t(e))),s=g(null),u=g("mcts"),m=g(T({iterations:1e3,c:1.41})),c=g(1);const w=()=>{l(e,Array.from({length:7},()=>[]),!0),l(c,1)},M=(o,v)=>{t(c)===1&&fe(t(e),o)&&B(t(e))===p.notOver&&(l(e,P(t(e),v,o),!0),l(c,t(c)===1?2:1,!0),setTimeout(()=>d(),200))},d=()=>{if(t(c)!==2||B(t(e))!==p.notOver)return;let o;if(t(u)==="random")o=we(t(e),t(c));else if(t(u)==="mcts")o=ye(t(e),t(c),t(m));else throw new Error("computer strategy not implemented");const{board:v,move:h}=o;l(e,v,!0),l(s,h,!0),l(c,1)},S=o=>{switch(o.keyCode){case 82:w();break;case 39:if(t(s)===null){l(s,Math.floor(q/2),!0);return}l(s,Math.min(t(s)+1,q-1),!0);break;case 37:if(t(s)===null){l(s,Math.floor(q/2),!0);return}l(s,Math.max(t(s)-1,0),!0);break;case 32:if(t(s)===null)return;M(t(s),t(c));break}};var b=Ae();ve("keydown",ce,S);var G=K(b);pe(G,{title:"Gravitrip",description:"Gravitrip"});var C=f(G,6),F=f(k(C));ee(F,20,()=>["mcts","random"],te,(o,v)=>{var h=Fe(),E=k(h,!0);_(h);var x={};N(()=>{U(E,v),x!==(x=v)&&(h.value=(h.__value=v)??"")}),y(o,h)}),_(F),_(C);var D=f(C,2);{var ne=o=>{Re(o,{onUpdate:v=>l(m,v,!0)})};I(D,o=>{t(u)==="mcts"&&o(ne)})}var A=f(D,2),W=k(A);W.__click=w;var j=f(W,2),oe=k(j);{var se=o=>{var v=$("Game Over");y(o,v)},ie=o=>{var v=me(),h=K(v);{var E=x=>{var H=$();N(()=>U(H,`Player ${t(n)??""} wins`)),y(x,H)};I(h,x=>{(t(n)===p.winPlayer1||t(n)===p.winPlayer2)&&x(E)},!0)}y(o,v)};I(oe,o=>{t(n)===p.draw?o(se):o(ie,!1)})}_(j),_(A);var le=f(A,2);de(le,{get nbColumns(){return q},get nbRows(){return he},get board(){return t(e)},get winningCells(){return t(i)},onMove:o=>M(o,t(c))}),re(F,()=>t(u),o=>l(u,o)),y(r,b),Y()}Z(["click"]);export{$e as component};
