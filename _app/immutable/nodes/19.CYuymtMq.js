import{g as Vt,u as pt,a as Ut,b as qt}from"../chunks/DtrTsPiG.js";import"../chunks/CWj6FrbW.js";import{p as z,aJ as bt,k as M,g as t,n as H,aD as O,s as A,aO as kt,v as F,w as p,aB as d,aC as i,aA as Ot,aE as $,aa as tt,o as ht}from"../chunks/CLwkvAa9.js";import{s as q}from"../chunks/Cc5B25b1.js";import{e as I,i as R}from"../chunks/D8fgoJlV.js";import{f as ot,t as S,a as b,e as K,j as wt}from"../chunks/DTjFRfZP.js";import{c as Mt}from"../chunks/DyaMv-gb.js";import{b as ut,c as Ct,a as et,s as dt,r as _t}from"../chunks/vB8enBEs.js";import{b as Ft,d as Et}from"../chunks/0grfOFio.js";import{a as ft,s as yt,b as Lt}from"../chunks/DCRvqHxR.js";import{m as jt}from"../chunks/DJEC7TI5.js";import{a as xt}from"../chunks/CV7cuUzA.js";import{M as Nt}from"../chunks/BsEu9Qde.js";import{M as It}from"../chunks/B0n3PbH2.js";import{i as P}from"../chunks/CxmqhxOM.js";import{k as gt}from"../chunks/DdqAdstM.js";import{p as vt}from"../chunks/qY3aL9mB.js";import{b as Rt,g as Jt}from"../chunks/BA-LNzZ1.js";import{t as Pt}from"../chunks/CBOFSRMi.js";import{A as zt}from"../chunks/BZHERX3J.js";import{U as Ht,u as Gt}from"../chunks/CFpy96OJ.js";import{b as Kt}from"../chunks/Ce38ME_H.js";import{a as Wt}from"../chunks/D70CLPPX.js";import"../chunks/DoJ6nzXR.js";import{p as Qt}from"../chunks/DZL1l416.js";const Xt=!1,Yt=async()=>({chords:await Vt()}),fa=Object.freeze(Object.defineProperty({__proto__:null,load:Yt,ssr:Xt},Symbol.toStringTag,{value:"Module"}));var Zt=S('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1kbb9q3"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1kbb9q3">Back to top</span></button>');function $t(_,e){z(e,!0);let n=O(0),s=O(!0),f;const D=o=>{o>0?A(s,!1):A(s,!0),f&&clearTimeout(f),f=setTimeout(()=>{A(s,!0)},3e3)},k=()=>{const o=document.documentElement.scrollTop||document.body.scrollTop;o>0&&(window.requestAnimationFrame(k),window.scrollTo(0,o-o/2))};bt(()=>D(t(n)));var r=Zt();let a;r.__click=k,M(o=>a=ut(r,1,"top-link svelte-1kbb9q3",null,a,o),[()=>({hide:t(s)})]),xt("y",()=>t(n),o=>A(n,o,!0)),b(_,r),H()}ot(["click"]);const st=kt();let St=[];const mt=localStorage.getItem("failedVisitCounts");if(mt!==null)try{St=JSON.parse(mt)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const ct=kt(St);ct.subscribe(_=>{localStorage.setItem("failedVisitCounts",JSON.stringify(_))});const Dt=_=>_==="doc"?"fas fa-file-word":_==="pdf"?"fas fa-file-pdf":_==="youtube"?"fa fa-youtube":"fas fa-link",te=async(_,e,n)=>{try{await pt(e.chord.url);const s=Ot(st),f=s.get(e.chord.url)||{count:0,lastAccessDateUnix:0};f.count++,f.lastAccessDateUnix=Date.now()/1e3,s.set(e.chord.url,f),st.set(s)}catch(s){let f=s.message;s instanceof zt&&s.code===401?f="Invalid logged in user":s instanceof Ht&&(f="User is logged out"),Lt(ct,[...n(),e.chord.url]);const D=`<strong>Visit not counted</strong><br/> ${f}`;Pt.push(D,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};var ee=S('<span></span> <span><a target="_blank" rel="noopener noreferrer"></a></span>',1);function nt(_,e){z(e,!0);const[n,s]=yt(),f=()=>ft(ct,"$failedVisitCounts",n);let D=vt(e,"showArtist",3,!1),k=O(void 0);st.subscribe(l=>{if(l&&l.has(e.chord.url)){const c=l.get(e.chord.url),u=new Date(c.lastAccessDateUnix*1e3);A(k,`visits: ${c.count} - last: ${u.toLocaleDateString()}`)}});const r=(D()?e.chord.artist+" - ":"")+e.chord.title,a=l=>l.type==="doc"?`${Rt}/docviewer/${l.url}`:l.url;var o=ee(),h=F(o),m=p(h,2),y=d(m);y.__click=[te,e,f],y.textContent=r,i(m),M((l,c)=>{ut(h,1,l,"svelte-1yqqigs"),et(y,"href",c),et(y,"title",t(k))},[()=>Ct(Dt(e.chord.type)),()=>a(e.chord)]),b(_,o),H(),s()}ot(["click"]);var ae=S('<li class="ul2col-item"><!> <!></li>'),re=S('<ul class="ul2col-container"></ul>');function se(_,e){z(e,!0);let n=vt(e,"chords",15),s=O(void 0);st.subscribe(r=>{r&&(A(s,r,!0),n(n().sort((a,o)=>{const h=r.get(a.url),m=r.get(o.url);return h&&m?m.lastAccessDateUnix-h.lastAccessDateUnix:h?-1:m?1:a.artist!=o.artist?a.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:a.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(r,a,o)=>o[r.type]===!1?!1:a.length===0||r.artist.toLowerCase().match(a.toLowerCase())?!0:r.title.toLowerCase().match(a.toLowerCase());var D=K(),k=F(D);gt(k,n,r=>{var a=re();I(a,21,n,R,(o,h)=>{var m=K();const y=$(()=>{var u;return(u=t(s))==null?void 0:u.get(t(h).url)});var l=F(m);{var c=u=>{var x=ae(),v=d(x);{var g=L=>{var C=wt();M(()=>q(C,`(${t(y).count??""})`)),b(L,C)};P(v,L=>{t(y)&&L(g)})}var w=p(v,2);nt(w,{get chord(){return t(h)},showArtist:!0}),i(x),b(u,x)};P(l,u=>{f(t(h),e.searchString,e.filters)&&u(c)})}b(o,m)}),i(a),b(r,a)}),b(_,D),H()}const oe=(_,e)=>_<e?-1:_>e?1:0,Tt=(_,e)=>{const n=_.toLowerCase(),s=e.toLowerCase();return oe(n,s)};var ne=S('<li class="navigationBtn svelte-1deg5s8"><a class="navigationLink svelte-1deg5s8"> </a></li>'),le=S('<li class="ul2col-item"><!></li>'),ie=S('<ul class="ul2col-container"></ul>'),ce=S('<tr class="svelte-1deg5s8"><td class="svelte-1deg5s8"> <!></td></tr>'),ue=S('<ol id="indexList" class="navigationBar disable-scrollbars svelte-1deg5s8"></ol> <table id="artistTable"><tbody></tbody></table>',1);function ve(_,e){z(e,!0);let n=vt(e,"searchString",3,"");const s=e.chords.reduce((v,g)=>{const w=g.artist;return v[w]||(v[w]=[]),v[w].push(g),v},{}),f=[],D=Object.keys(s).sort(Tt).map((v,g,w)=>{if(g===0||v[0].toLowerCase()!=w[g-1][0].toLowerCase()){const L="anchor_letter_"+v[0];return f.push({letter:v[0],tag:L}),{name:v,tag:L}}return{name:v}});let k=O(0),r=O(0),a=O(void 0);const o=v=>{if(t(a)){var g=t(a).getBoundingClientRect();if(g.top<20){A(r,20);return}A(r,g.top,!0)}};bt(()=>o(t(k)));const h=(v,g,w)=>s[v].sort((C,B)=>C.title<B.title?-1:1).filter(C=>{const B=C.type;return w[B]===!1?!1:g.length===0?!0:!!C.title.toLowerCase().match(g.toLowerCase())}),m=(v,g)=>!!v.toLowerCase().match(g.toLowerCase());var y=ue(),l=F(y);let c;I(l,21,()=>f,R,(v,g)=>{var w=ne(),L=d(w),C=d(L,!0);i(L),i(w),M(B=>{et(L,"href","#"+t(g).tag),q(C,B)},[()=>t(g).letter.toUpperCase()]),b(v,w)}),i(l);var u=p(l,2),x=d(u);I(x,21,()=>D,R,(v,g)=>{var w=K();const L=$(()=>h(t(g).name,n(),e.filters)),C=$(()=>m(t(g).name,n()));var B=F(w);{var j=Z=>{var G=ce();const at=$(()=>t(C)?s[t(g).name]:t(L));var J=d(G),W=d(J),rt=p(W);gt(rt,n,N=>{var Q=ie();I(Q,21,()=>t(at),R,(X,lt)=>{var T=le(),V=d(T);nt(V,{get chord(){return t(lt)}}),i(T),b(X,T)}),i(Q),b(N,Q)}),i(J),i(G),M(()=>{et(J,"id",t(g).tag),q(W,`${t(g).name??""} `)}),b(Z,G)};P(B,Z=>{(t(C)||t(L).length>0)&&Z(j)})}b(v,w)}),i(x),i(u),Kt(u,v=>A(a,v),()=>t(a)),M(()=>c=dt(l,"",c,{"--barTop":`${t(r)??""}px`})),xt("y",()=>t(k),v=>A(k,v,!0)),b(_,y),H()}var de=S('<li class="ul2col-item"><!></li>'),fe=S('<div><span> </span> <ul class="ul2col-container"></ul></div>');function he(_,e){z(e,!0);const n=k=>k.charAt(0).toUpperCase()+k.slice(1).toLowerCase(),s=tt({});for(const k of e.chords)k.tags.forEach(a=>{s[a]||(s[a]=[]),s[a].push(k)});Object.keys(s).forEach(k=>{s[k].sort((r,a)=>{const o=r.artist.toLowerCase(),h=a.artist.toLowerCase(),m=r.title.toLowerCase(),y=a.title.toLowerCase();return o<h?-1:o>h?1:m<y?-1:1})});var f=K(),D=F(f);I(D,17,()=>Object.keys(s).sort(Tt),R,(k,r)=>{var a=K(),o=F(a);{var h=m=>{var y=fe(),l=d(y),c=d(l,!0);i(l);var u=p(l,2);I(u,21,()=>s[t(r)],R,(x,v)=>{var g=K(),w=F(g);{var L=C=>{var B=de(),j=d(B);nt(j,{get chord(){return t(v)},showArtist:!0}),i(B),b(C,B)};P(w,C=>{e.filters[t(v).type]&&C(L)})}b(x,g)}),i(u),i(y),M(x=>q(c,x),[()=>n(t(r))]),b(m,y)};P(o,m=>{(e.searchString.length===0||t(r).toLowerCase().match(e.searchString.toLowerCase()))&&m(h)})}b(k,a)}),b(_,f),H()}var ge=S('<li class="ul2col-item"><!> <!></li>'),_e=S('<ul class="ul2col-container"></ul>');function me(_,e){z(e,!0);let n=vt(e,"chords",15),s=O(void 0);st.subscribe(r=>{r&&(A(s,r,!0),n(n().sort((a,o)=>{const h=r.get(a.url),m=r.get(o.url);return h&&m?h.count!==m.count?m.count-h.count:m.lastAccessDateUnix-h.lastAccessDateUnix:h?-1:m?1:a.artist!=o.artist?a.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:a.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(r,a,o)=>o[r.type]===!1?!1:a.length===0||r.artist.toLowerCase().match(a.toLowerCase())?!0:r.title.toLowerCase().match(a.toLowerCase());var D=K(),k=F(D);gt(k,n,r=>{var a=_e();I(a,21,n,R,(o,h)=>{var m=K();const y=$(()=>{var u;return(u=t(s))==null?void 0:u.get(t(h).url)});var l=F(m);{var c=u=>{var x=ge(),v=d(x);{var g=L=>{var C=wt();M(()=>q(C,`(${t(y).count??""})`)),b(L,C)};P(v,L=>{t(y)&&L(g)})}var w=p(v,2);nt(w,{get chord(){return t(h)},showArtist:!0}),i(x),b(u,x)};P(l,u=>{f(t(h),e.searchString,e.filters)&&u(c)})}b(o,m)}),i(a),b(r,a)}),b(_,D),H()}var pe=S('<span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-5k8p3l"> </span>',1),be=S('<div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Last Check</span> <span class="col table-head svelte-5k8p3l">Checks</span> <span class="col table-head svelte-5k8p3l">Skipped</span> <span class="col table-head svelte-5k8p3l">Errors</span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span></div> <br> <div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Status</span> <span class="col table-head svelte-5k8p3l">Ref</span> <span class="col table-head svelte-5k8p3l">Host</span> <span class="col table-head svelte-5k8p3l">Data</span> <!></div>',1),ke=S('<p style="color: red"> </p>'),we=S("<p>Fetching results...</p>"),Ce=S('<div role="dialog" class="modal svelte-5k8p3l"><div class="contents svelte-5k8p3l"><h3 class="title-bar svelte-5k8p3l">Urls checks <button>Close</button></h3> <!></div></div>');function ye(_,e){z(e,!0);const n=r=>{const a=new Date(r.timestamp);return a.toDateString()+" "+a.toTimeString()},s=r=>r.fails.sort((a,o)=>a.chord.url<o.chord.url?-1:1);var f=K(),D=F(f);{var k=r=>{var a=Ce(),o=d(a),h=d(o),m=p(d(h));m.__click=function(...l){var c;(c=e.close)==null||c.apply(this,l)},i(h);var y=p(h,2);Wt(y,Ut,l=>{var c=we();b(l,c)},(l,c)=>{var u=be();const x=$(()=>n(t(c))),v=$(()=>s(t(c)));var g=F(u),w=p(d(g),8),L=d(w,!0);i(w);var C=p(w,2),B=d(C,!0);i(C);var j=p(C,2),Z=d(j,!0);i(j);var G=p(j,2),at=d(G,!0);i(G),i(g);var J=p(g,4),W=p(d(J),8);I(W,17,()=>t(v),R,(rt,N)=>{var Q=pe(),X=F(Q),lt=d(X,!0);i(X);var T=p(X,2),V=d(T);i(T);var U=p(T,2),E=d(U),it=d(E,!0);i(E),i(U);var Y=p(U,2),At=d(Y,!0);i(Y),M(Bt=>{q(lt,t(N).status),q(V,`${t(N).chord.artist??""} - ${t(N).chord.title??""}`),et(E,"href",t(N).chord.url),q(it,new URL(t(N).chord.url).hostname),q(At,Bt)},[()=>t(N).error?JSON.stringify(t(N).error):""]),b(rt,Q)}),i(J),M(()=>{q(L,t(x)),q(B,t(c).nbChecks),q(Z,t(c).nbSkipped),q(at,t(c).nbFails)}),b(l,u)},(l,c)=>{var u=ke(),x=d(u);i(u),M(()=>q(x,`Could not retrieve checks: ${t(c).message??""}`)),b(l,u)}),i(o),i(a),b(r,a)};P(D,r=>{e.isOpen&&r(k)})}b(_,f),H()}ot(["click"]);var Le=(_,e)=>e(),xe=S('<li class="ul2col-separator"> </li>'),Se=S('<!> <li class="ul2col-item"><!></li>',1),De=S('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function Te(_,e){z(e,!0);const n=Date.now(),s=1e3*3600*24*7,f=s*4,D=[{label:"last week",time:n-s},{label:"one month ago",time:n-f},{label:"two months ago",time:n-2*f},{label:"six months ago",time:n-6*f},{label:"one year ago",time:n-12*f}],k=e.chords.filter(c=>c.creationDate).sort((c,u)=>u.creationDate-c.creationDate).map((c,u,x)=>{const v={...c};if(u>0){const g=x[u-1];for(const{time:w,label:L}of D)g.creationDate>w&&c.creationDate<w&&(v.dateTag=L)}return v});let r=6,a=O(tt([]));const o=()=>{r+=4,A(a,k.slice(0,r),!0)};ht(()=>{o()});var h=De(),m=d(h),y=p(d(m));y.__click=[Le,o],i(m);var l=p(m,2);I(l,21,()=>t(a),R,(c,u)=>{var x=Se(),v=F(x);{var g=C=>{var B=xe(),j=d(B,!0);i(B),M(()=>q(j,t(u).dateTag)),b(C,B)};P(v,C=>{t(u).dateTag&&C(g)})}var w=p(v,2),L=d(w);nt(L,{get chord(){return t(u)}}),i(w),b(c,x)}),i(l),i(h),b(_,h),H()}ot(["click"]);const Ae=(_,e,n,s,f)=>{t(e).length<=n||(t(e).splice(t(e).length-n),A(s,t(e).slice(t(e).length-n).map(D=>f.chords[D]),!0))};var Be=S("<button>&nbspâ†¶&nbsp</button>"),Ve=S('<li class="ul2col-item"><!></li>'),Ue=S('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br> <ul class="ul2col-container"></ul></div>');function qe(_,e){z(e,!0);const n=6;let s=O(tt([])),f=O(tt([]));const D=()=>{t(s).length>=e.chords.length-n&&A(s,[],!0);for(let l=0;l<n;l++){let c=-1;for(;c===-1||t(s).includes(c);)c=Math.floor(Math.random()*e.chords.length);t(s).push(c)}A(f,t(s).slice(t(s).length-n).map(l=>e.chords[l]),!0)};ht(()=>{D()});var k=Ue(),r=d(k),a=p(d(r)),o=d(a);{var h=l=>{var c=Be();c.__click=[Ae,s,n,f,e],b(l,c)};P(o,l=>{t(s).length>n&&l(h)})}var m=p(o,2);m.__click=D,i(a),i(r);var y=p(r,4);I(y,21,()=>t(f),l=>l.url,(l,c)=>{var u=Ve(),x=d(u);nt(x,{get chord(){return t(c)},showArtist:!0}),i(u),b(l,u)}),i(y),i(k),b(_,k),H()}ot(["click"]);var Oe=()=>jt.open(ye),Me=()=>Jt("/songbook/edit"),Fe=(_,e)=>A(e,""),Ee=(_,e,n)=>{t(e)[t(n)]=!t(e)[t(n)],A(e,t(e),!0)},je=S('<button class="filter-control svelte-1gfqv35"><input type="checkbox"> <span></span></button>'),Ne=(_,e,n)=>A(e,t(n),!0),Ie=S("<button> </button>"),Re=S('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1gfqv35"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1gfqv35"></div></div> <!>',1);function ha(_,e){z(e,!0);const[n,s]=yt(),f=()=>ft(ct,"$failedVisitCounts",n),D=()=>ft(Gt,"$user",n);Qt.set("Songbook");const{chords:k}=e.data;let r=O(tt([]));const a=T=>{t(r).push(T),A(r,t(r),!0),setTimeout(()=>{t(r).shift(),A(r,t(r),!0)},5e3)};ht(async()=>{try{if(f().length&&D()){a({level:"info",header:"Trying to count missed visits while logged out"});for(const T of f())await pt(T);a({level:"success",header:`Counted ${f().length} missed visits`}),Lt(ct,[])}}catch{a({level:"error",header:"Couldnt upload failed visit counts"})}try{const V=(await qt()).reduce((U,E)=>(U.set(E.url,{...E}),U),new Map);st.set(V)}catch{a({level:"error",header:"Couldnt upload failed visit counts"})}});let o=O("");const h=[{label:"By artist",component:ve},{label:"By tags",component:he},{label:"By frequency",component:me},{label:"By access date",component:se}];let m=O(tt(h[0]));const y={pdf:!0,doc:!0,youtube:!0,link:!0};let l=O(tt({...y}));const c=Object.keys(y);var u=Re(),x=F(u);Nt(x,{title:"Song Book",description:"My song book",iconPath:"/songbook.png"});var v=p(x,2),g=d(v),w=d(g);w.__click=[Oe],dt(w,"",{},{position:"relative"});var L=p(w,2);L.__click=[Me],dt(L,"",{},{position:"relative"}),i(g),i(v);var C=p(v,2);I(C,17,()=>t(r),R,(T,V)=>{It(T,{get item(){return t(V)}})});var B=p(C,2);$t(B,{});var j=p(B,2),Z=d(j);i(j);var G=p(j,2);Te(G,{chords:k});var at=p(G,2);qe(at,{chords:k});var J=p(at,2),W=p(d(J),2);_t(W);var rt=p(W,2);rt.__click=[Fe,o];var N=p(rt,2),Q=p(d(N),2);I(Q,17,()=>c,R,(T,V)=>{var U=je();U.__click=[Ee,l,V];var E=d(U);_t(E);var it=p(E,2);i(U),M(Y=>{et(U,"aria-label",`filter for ${t(V)??""}`),et(E,"id",t(V)),ut(it,1,Y,"svelte-1gfqv35")},[()=>Ct(Dt(t(V)))]),Et(E,()=>t(l)[t(V)],Y=>t(l)[t(V)]=Y),b(T,U)}),i(N);var X=p(N,4);I(X,21,()=>h,R,(T,V)=>{var U=Ie();let E;U.__click=[Ne,m,V];var it=d(U,!0);i(U),M(Y=>{E=ut(U,1,"control svelte-1gfqv35",null,E,Y),q(it,t(V).label)},[()=>({selected:t(m)===t(V)})]),b(T,U)}),i(X),i(J);var lt=p(J,2);Mt(lt,()=>t(m).component,(T,V)=>{V(T,{chords:k,get searchString(){return t(o)},get filters(){return t(l)}})}),M(()=>q(Z,`This is a list of ${k.length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Ft(W,()=>t(o),T=>A(o,T)),b(_,u),H(),s()}ot(["click"]);export{ha as component,fa as universal};
