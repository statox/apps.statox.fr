import{g as Bt,u as bt,a as Vt,b as Ut}from"../chunks/Lxgydr2u.js";import"../chunks/NZTpNUN0.js";import{o as ht}from"../chunks/1QUK--hH.js";import{p as J,k as wt,g as t,b as S,t as I,a as g,d as z,i as A,h as M,f as O,s as h,e as m,r as n,c as Y,u as tt,j as kt,Y as et}from"../chunks/DgoBSJc-.js";import{d as lt,w as Ct,s as U,g as Mt}from"../chunks/CEmcvi-N.js";import{e as F,i as N}from"../chunks/CM6o1U-z.js";import{c as It}from"../chunks/C-b_6phE.js";import{s as rt,r as pt}from"../chunks/BobObAPF.js";import{s as vt,c as yt,a as mt}from"../chunks/Cl-9avSH.js";import{b as Ot,c as Ft}from"../chunks/BoL4DXBn.js";import{s as Lt,b as xt,a as ft}from"../chunks/B3zh8tvr.js";import{m as Et}from"../chunks/M2Ah9uao.js";import{a as St}from"../chunks/BJA_siYH.js";import{M as Rt}from"../chunks/8yWn0DCP.js";import{M as jt}from"../chunks/I4gp5Djb.js";import{i as H}from"../chunks/v9wTuNyK.js";import{k as gt}from"../chunks/UzcMCzEl.js";import{p as dt}from"../chunks/mVPhl119.js";import{b as Nt,g as Pt}from"../chunks/CyXLSe6E.js";import{t as Ht}from"../chunks/CbMfUzwz.js";import{A as Jt,U as zt}from"../chunks/BI4tYcJk.js";import"../chunks/DPSdUY9Q.js";import{u as Gt}from"../chunks/b4YYT05T.js";import{b as Kt}from"../chunks/BIQ4GWrd.js";import{a as Wt}from"../chunks/Dw-VRuPN.js";import"../chunks/DuPUj2a-.js";import"../chunks/osQD9mIT.js";import{p as Yt}from"../chunks/hqaMbjU1.js";const Qt=!1,Xt=async()=>({chords:await Bt()}),ir=Object.freeze(Object.defineProperty({__proto__:null,load:Xt,ssr:Qt},Symbol.toStringTag,{value:"Module"}));var Zt=S('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1vskasp"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1vskasp">Back to top</span></button>');function $t(k,s){J(s,!0);let u=M(0),c=M(!0),C;const D=l=>{l>0?A(c,!1):A(c,!0),C&&clearTimeout(C),C=setTimeout(()=>{A(c,!0)},3e3)},b=()=>{const l=document.documentElement.scrollTop||document.body.scrollTop;l>0&&(window.requestAnimationFrame(b),window.scrollTo(0,l-l/2))};wt(()=>D(t(u)));var a=Zt();let e;a.__click=b,I(()=>e=vt(a,1,"top-link svelte-1vskasp",null,e,{hide:t(c)})),St("y",()=>t(u),l=>A(u,l,!0)),g(k,a),z()}lt(["click"]);const nt=Ct();let Dt=[];const _t=localStorage.getItem("failedVisitCounts");if(_t!==null)try{Dt=JSON.parse(_t)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const ut=Ct(Dt);ut.subscribe(k=>{localStorage.setItem("failedVisitCounts",JSON.stringify(k))});const Tt=k=>k==="doc"?"fas fa-file-word":k==="pdf"?"fas fa-file-pdf":k==="youtube"?"fa fa-youtube":"fas fa-link";var te=S('<span></span> <span><a target="_blank" rel="noopener noreferrer"> </a></span>',1);function it(k,s){J(s,!0);const u=()=>ft(ut,"$failedVisitCounts",c),[c,C]=Lt();let D=dt(s,"showArtist",3,!1),b=M(void 0);nt.subscribe(r=>{if(r&&r.has(s.chord.url)){const d=r.get(s.chord.url),i=new Date(d.lastAccessDateUnix*1e3);A(b,`visits: ${d.count} - last: ${i.toLocaleDateString()}`)}});const a=(D()?s.chord.artist+" - ":"")+s.chord.title,e=r=>r.type==="doc"?`${Nt}/docviewer/${r.url}`:r.url,l=async()=>{try{await bt({url:s.chord.url});const r=Mt(nt),d=r.get(s.chord.url)||{count:0,lastAccessDateUnix:0};d.count++,d.lastAccessDateUnix=Date.now()/1e3,r.set(s.chord.url,d),nt.set(r)}catch(r){let d=r.message;r instanceof Jt&&r.code===401?d="Invalid logged in user":r instanceof zt&&(d="User is logged out"),xt(ut,[...u(),s.chord.url]);const i=`<strong>Visit not counted</strong><br/> ${d}`;Ht.push(i,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};var v=te(),p=O(v),x=h(p,2),_=m(x);_.__click=l;var o=m(_,!0);n(_),n(x),I((r,d)=>{vt(p,1,r,"svelte-et925i"),rt(_,"href",d),rt(_,"title",t(b)),U(o,a)},[()=>yt(Tt(s.chord.type)),()=>e(s.chord)]),g(k,v),z(),C()}lt(["click"]);var ee=S('<li class="ul2col-item"><!> <!></li>'),re=S('<ul class="ul2col-container"></ul>');function ae(k,s){J(s,!0);let u=dt(s,"chords",15),c=M(void 0);nt.subscribe(a=>{a&&(A(c,a,!0),u(u().sort((e,l)=>{const v=a.get(e.url),p=a.get(l.url);return v&&p?p.lastAccessDateUnix-v.lastAccessDateUnix:v?-1:p?1:e.artist!=l.artist?e.artist.toLowerCase()<l.artist.toLowerCase()?-1:1:e.title.toLowerCase()<l.title.toLowerCase()?-1:1})))});const C=(a,e,l)=>l[a.type]===!1?!1:e.length===0||a.artist.toLowerCase().match(e.toLowerCase())?!0:a.title.toLowerCase().match(e.toLowerCase());var D=Y(),b=O(D);gt(b,u,a=>{var e=re();F(e,21,u,N,(l,v)=>{const p=tt(()=>t(c)?.get(t(v).url));var x=Y(),_=O(x);{var o=r=>{var d=ee(),i=m(d);{var f=y=>{var L=kt();I(()=>U(L,`(${t(p).count??""})`)),g(y,L)};H(i,y=>{t(p)&&y(f)})}var w=h(i,2);it(w,{get chord(){return t(v)},showArtist:!0}),n(d),g(r,d)};H(_,r=>{C(t(v),s.searchString,s.filters)&&r(o)})}g(l,x)}),n(e),g(a,e)}),g(k,D),z()}const se=(k,s)=>k<s?-1:k>s?1:0,At=(k,s)=>{const u=k.toLowerCase(),c=s.toLowerCase();return se(u,c)};var oe=S('<li class="navigationBtn svelte-16xotip"><a class="navigationLink svelte-16xotip"> </a></li>'),ne=S('<li class="ul2col-item"><!></li>'),le=S('<ul class="ul2col-container"></ul>'),ie=S('<tr class="svelte-16xotip"><td class="svelte-16xotip"> <!></td></tr>'),ce=S('<ol id="indexList" class="navigationBar disable-scrollbars svelte-16xotip"></ol> <table id="artistTable"><tbody></tbody></table>',1);function ue(k,s){J(s,!0);let u=dt(s,"searchString",3,"");const c=s.chords.reduce((i,f)=>{const w=f.artist;return i[w]||(i[w]=[]),i[w].push(f),i},{}),C=[],D=Object.keys(c).sort(At).map((i,f,w)=>{if(f===0||i[0].toLowerCase()!=w[f-1][0].toLowerCase()){const y="anchor_letter_"+i[0];return C.push({letter:i[0],tag:y}),{name:i,tag:y}}return{name:i}});let b=M(0),a=M(0),e=M(void 0);const l=i=>{if(t(e)){var f=t(e).getBoundingClientRect();if(f.top<20){A(a,20);return}A(a,f.top,!0)}};wt(()=>l(t(b)));const v=(i,f,w)=>c[i].sort((L,q)=>L.title<q.title?-1:1).filter(L=>{const q=L.type;return w[q]===!1?!1:f.length===0?!0:!!L.title.toLowerCase().match(f.toLowerCase())}),p=(i,f)=>!!i.toLowerCase().match(f.toLowerCase());var x=ce(),_=O(x);let o;F(_,21,()=>C,N,(i,f)=>{var w=oe(),y=m(w),L=m(y,!0);n(y),n(w),I(q=>{rt(y,"href","#"+t(f).tag),U(L,q)},[()=>t(f).letter.toUpperCase()]),g(i,w)}),n(_);var r=h(_,2),d=m(r);F(d,21,()=>D,N,(i,f)=>{const w=tt(()=>v(t(f).name,u(),s.filters)),y=tt(()=>p(t(f).name,u()));var L=Y(),q=O(L);{var E=G=>{const at=tt(()=>t(y)?c[t(f).name]:t(w));var Q=ie(),K=m(Q),X=m(K),Z=h(X);gt(Z,u,R=>{var P=le();F(P,21,()=>t(at),N,($,st)=>{var W=ne(),B=m(W);it(B,{get chord(){return t(st)}}),n(W),g($,W)}),n(P),g(R,P)}),n(K),n(Q),I(()=>{rt(K,"id",t(f).tag),U(X,`${t(f).name??""} `)}),g(G,Q)};H(q,G=>{(t(y)||t(w).length>0)&&G(E)})}g(i,L)}),n(d),n(r),Kt(r,i=>A(e,i),()=>t(e)),I(()=>o=mt(_,"",o,{"--barTop":`${t(a)??""}px`})),St("y",()=>t(b),i=>A(b,i,!0)),g(k,x),z()}var ve=S('<li class="ul2col-item"><!></li>'),de=S('<div><span> </span> <ul class="ul2col-container"></ul></div>');function me(k,s){J(s,!0);const u=b=>b.charAt(0).toUpperCase()+b.slice(1).toLowerCase(),c=et({});for(const b of s.chords)b.tags.forEach(e=>{c[e]||(c[e]=[]),c[e].push(b)});Object.keys(c).forEach(b=>{c[b].sort((a,e)=>{const l=a.artist.toLowerCase(),v=e.artist.toLowerCase(),p=a.title.toLowerCase(),x=e.title.toLowerCase();return l<v?-1:l>v?1:p<x?-1:1})});var C=Y(),D=O(C);F(D,17,()=>Object.keys(c).sort(At),N,(b,a)=>{var e=Y(),l=O(e);{var v=p=>{var x=de(),_=m(x),o=m(_,!0);n(_);var r=h(_,2);F(r,21,()=>c[t(a)],N,(d,i)=>{var f=Y(),w=O(f);{var y=L=>{var q=ve(),E=m(q);it(E,{get chord(){return t(i)},showArtist:!0}),n(q),g(L,q)};H(w,L=>{s.filters[t(i).type]&&L(y)})}g(d,f)}),n(r),n(x),I(d=>U(o,d),[()=>u(t(a))]),g(p,x)};H(l,p=>{(s.searchString.length===0||t(a).toLowerCase().match(s.searchString.toLowerCase()))&&p(v)})}g(b,e)}),g(k,C),z()}var fe=S('<li class="ul2col-item"><!> <!></li>'),he=S('<ul class="ul2col-container"></ul>');function ge(k,s){J(s,!0);let u=dt(s,"chords",15),c=M(void 0);nt.subscribe(a=>{a&&(A(c,a,!0),u(u().sort((e,l)=>{const v=a.get(e.url),p=a.get(l.url);return v&&p?v.count!==p.count?p.count-v.count:p.lastAccessDateUnix-v.lastAccessDateUnix:v?-1:p?1:e.artist!=l.artist?e.artist.toLowerCase()<l.artist.toLowerCase()?-1:1:e.title.toLowerCase()<l.title.toLowerCase()?-1:1})))});const C=(a,e,l)=>l[a.type]===!1?!1:e.length===0||a.artist.toLowerCase().match(e.toLowerCase())?!0:a.title.toLowerCase().match(e.toLowerCase());var D=Y(),b=O(D);gt(b,u,a=>{var e=he();F(e,21,u,N,(l,v)=>{const p=tt(()=>t(c)?.get(t(v).url));var x=Y(),_=O(x);{var o=r=>{var d=fe(),i=m(d);{var f=y=>{var L=kt();I(()=>U(L,`(${t(p).count??""})`)),g(y,L)};H(i,y=>{t(p)&&y(f)})}var w=h(i,2);it(w,{get chord(){return t(v)},showArtist:!0}),n(d),g(r,d)};H(_,r=>{C(t(v),s.searchString,s.filters)&&r(o)})}g(l,x)}),n(e),g(a,e)}),g(k,D),z()}var pe=S('<span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-161wm6q"> </span>',1),_e=S('<div class="rows svelte-161wm6q"><span class="col table-head svelte-161wm6q">Last Check</span> <span class="col table-head svelte-161wm6q">Checks</span> <span class="col table-head svelte-161wm6q">Skipped</span> <span class="col table-head svelte-161wm6q">Errors</span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span></div> <br/> <div class="rows svelte-161wm6q"><span class="col table-head svelte-161wm6q">Status</span> <span class="col table-head svelte-161wm6q">Ref</span> <span class="col table-head svelte-161wm6q">Host</span> <span class="col table-head svelte-161wm6q">Data</span> <!></div>',1),be=S('<p style="color: red"> </p>'),we=S("<p>Fetching results...</p>"),ke=S('<div role="dialog" class="modal svelte-161wm6q"><div class="contents svelte-161wm6q"><h3 class="title-bar svelte-161wm6q">Urls checks <button>Close</button></h3> <!></div></div>');function Ce(k,s){J(s,!0);const u=a=>{const e=new Date(a.timestamp);return e.toDateString()+" "+e.toTimeString()},c=a=>a.fails.sort((e,l)=>e.chord.url<l.chord.url?-1:1);var C=Y(),D=O(C);{var b=a=>{var e=ke(),l=m(e),v=m(l),p=h(m(v));p.__click=function(..._){s.close?.apply(this,_)},n(v);var x=h(v,2);Wt(x,Vt,_=>{var o=we();g(_,o)},(_,o)=>{const r=tt(()=>u(t(o))),d=tt(()=>c(t(o)));var i=_e(),f=O(i),w=h(m(f),8),y=m(w,!0);n(w);var L=h(w,2),q=m(L,!0);n(L);var E=h(L,2),G=m(E,!0);n(E);var at=h(E,2),Q=m(at,!0);n(at),n(f);var K=h(f,4),X=h(m(K),8);F(X,17,()=>t(d),N,(Z,R)=>{var P=pe(),$=O(P),st=m($,!0);n($);var W=h($,2),B=m(W);n(W);var T=h(W,2),V=m(T),j=m(V,!0);n(V),n(T);var ot=h(T,2),ct=m(ot,!0);n(ot),I(qt=>{U(st,t(R).status),U(B,`${t(R).chord.artist??""} - ${t(R).chord.title??""}`),rt(V,"href",t(R).chord.url),U(j,new URL(t(R).chord.url).hostname),U(ct,qt)},[()=>t(R).error?JSON.stringify(t(R).error):""]),g(Z,P)}),n(K),I(()=>{U(y,t(r)),U(q,t(o).nbChecks),U(G,t(o).nbSkipped),U(Q,t(o).nbFails)}),g(_,i)},(_,o)=>{var r=be(),d=m(r);n(r),I(()=>U(d,`Could not retrieve checks: ${t(o).message??""}`)),g(_,r)}),n(l),n(e),g(a,e)};H(D,a=>{s.isOpen&&a(b)})}g(k,C),z()}lt(["click"]);var ye=S('<li class="ul2col-separator"> </li>'),Le=S('<!> <li class="ul2col-item"><!></li>',1),xe=S('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function Se(k,s){J(s,!0);const u=Date.now(),c=1e3*3600*24*7,C=c*4,D=[{label:"last week",time:u-c},{label:"one month ago",time:u-C},{label:"two months ago",time:u-2*C},{label:"six months ago",time:u-6*C},{label:"one year ago",time:u-12*C}],b=s.chords.filter(o=>o.creationDate).sort((o,r)=>r.creationDate-o.creationDate).map((o,r,d)=>{const i={...o};if(r>0){const f=d[r-1];for(const{time:w,label:y}of D)f.creationDate>w&&o.creationDate<w&&(i.dateTag=y)}return i});let a=6,e=M(et([]));const l=()=>{a+=4,A(e,b.slice(0,a),!0)};ht(()=>{l()});var v=xe(),p=m(v),x=h(m(p));x.__click=()=>l(),n(p);var _=h(p,2);F(_,21,()=>t(e),N,(o,r)=>{var d=Le(),i=O(d);{var f=L=>{var q=ye(),E=m(q,!0);n(q),I(()=>U(E,t(r).dateTag)),g(L,q)};H(i,L=>{t(r).dateTag&&L(f)})}var w=h(i,2),y=m(w);it(y,{get chord(){return t(r)}}),n(w),g(o,d)}),n(_),n(v),g(k,v),z()}lt(["click"]);var De=S("<button>&nbspâ†¶&nbsp</button>"),Te=S('<li class="ul2col-item"><!></li>'),Ae=S('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br/> <ul class="ul2col-container"></ul></div>');function qe(k,s){J(s,!0);const u=6;let c=M(et([])),C=M(et([]));const D=()=>{t(c).length>=s.chords.length-u&&A(c,[],!0);for(let o=0;o<u;o++){let r=-1;for(;r===-1||t(c).includes(r);)r=Math.floor(Math.random()*s.chords.length);t(c).push(r)}A(C,t(c).slice(t(c).length-u).map(o=>s.chords[o]),!0)},b=()=>{t(c).length<=u||(t(c).splice(t(c).length-u),A(C,t(c).slice(t(c).length-u).map(o=>s.chords[o]),!0))};ht(()=>{D()});var a=Ae(),e=m(a),l=h(m(e)),v=m(l);{var p=o=>{var r=De();r.__click=b,g(o,r)};H(v,o=>{t(c).length>u&&o(p)})}var x=h(v,2);x.__click=D,n(l),n(e);var _=h(e,4);F(_,21,()=>t(C),o=>o.url,(o,r)=>{var d=Te(),i=m(d);it(i,{get chord(){return t(r)},showArtist:!0}),n(d),g(o,d)}),n(_),n(a),g(k,a),z()}lt(["click"]);var Be=S('<button class="filter-control svelte-1k2cvi7"><input type="checkbox"/> <span></span></button>'),Ve=S("<button> </button>"),Ue=S('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"/> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1k2cvi7"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1k2cvi7"></div></div> <!>',1);function cr(k,s){J(s,!0);const u=()=>ft(ut,"$failedVisitCounts",C),c=()=>ft(Gt,"$user",C),[C,D]=Lt(),b={name:"Songbook",description:"My song book",iconPath:"/songbook.png",showAuthInHeader:!0};Yt.set(b);const{chords:a}=s.data;let e=M(et([]));const l=B=>{t(e).push(B),A(e,t(e),!0),setTimeout(()=>{t(e).shift(),A(e,t(e),!0)},5e3)};ht(async()=>{try{if(u().length&&c()){l({level:"info",header:"Trying to count missed visits while logged out"});for(const B of u())await bt({url:B});l({level:"success",header:`Counted ${u().length} missed visits`}),xt(ut,[])}}catch{l({level:"error",header:"Couldnt upload failed visit counts"})}try{const T=(await Ut()).reduce((V,j)=>(V.set(j.url,{...j}),V),new Map);nt.set(T)}catch{l({level:"error",header:"Couldnt upload failed visit counts"})}});let v=M("");const p=[{label:"By artist",component:ue},{label:"By tags",component:me},{label:"By frequency",component:ge},{label:"By access date",component:ae}];let x=M(et(p[0]));const _={pdf:!0,doc:!0,youtube:!0,link:!0};let o=M(et({..._}));const r=Object.keys(_);var d=Ue(),i=O(d);Rt(i,{get title(){return b.name},get description(){return b.description},get iconPath(){return b.iconPath}});var f=h(i,2),w=m(f),y=m(w);y.__click=()=>Et.open(Ce),mt(y,"",{},{position:"relative"});var L=h(y,2);L.__click=()=>Pt("/songbook/edit"),mt(L,"",{},{position:"relative"}),n(w),n(f);var q=h(f,2);F(q,17,()=>t(e),N,(B,T)=>{jt(B,{get item(){return t(T)}})});var E=h(q,2);$t(E,{});var G=h(E,2),at=m(G);n(G);var Q=h(G,2);Se(Q,{get chords(){return a}});var K=h(Q,2);qe(K,{get chords(){return a}});var X=h(K,2),Z=h(m(X),2);pt(Z);var R=h(Z,2);R.__click=()=>A(v,"");var P=h(R,2),$=h(m(P),2);F($,17,()=>r,N,(B,T)=>{var V=Be();V.__click=()=>{t(o)[t(T)]=!t(o)[t(T)],A(o,t(o),!0)};var j=m(V);pt(j);var ot=h(j,2);n(V),I(ct=>{rt(V,"aria-label",`filter for ${t(T)??""}`),rt(j,"id",t(T)),vt(ot,1,ct,"svelte-1k2cvi7")},[()=>yt(Tt(t(T)))]),Ft(j,()=>t(o)[t(T)],ct=>t(o)[t(T)]=ct),g(B,V)}),n(P);var st=h(P,4);F(st,21,()=>p,N,(B,T)=>{var V=Ve();let j;V.__click=()=>A(x,t(T),!0);var ot=m(V,!0);n(V),I(()=>{j=vt(V,1,"control svelte-1k2cvi7",null,j,{selected:t(x)===t(T)}),U(ot,t(T).label)}),g(B,V)}),n(st),n(X);var W=h(X,2);It(W,()=>t(x).component,(B,T)=>{T(B,{get chords(){return a},get searchString(){return t(v)},get filters(){return t(o)}})}),I(()=>U(at,`This is a list of ${a.length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Ot(Z,()=>t(v),B=>A(v,B)),g(k,d),z(),D()}lt(["click"]);export{cr as component,ir as universal};
