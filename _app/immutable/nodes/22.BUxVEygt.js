import"../chunks/NZTpNUN0.js";import"../chunks/DxsUBIQY.js";import{o as j,a as R}from"../chunks/np3e4Z_M.js";import{p as S,b as T,t as H,a as y,d as M,s as c,e as r,r as l,D as A,ap as D,n as W,bd as L,by as q,g as _,Q as E,i as z,c as O,f as Z,bz as Q}from"../chunks/Brv8g2mx.js";import{e as p,s as K,d as U}from"../chunks/BlLNWVag.js";import{s as P,a as G}from"../chunks/mz9VyEVN.js";import{i as C}from"../chunks/CdKWMwlC.js";import{m as Y}from"../chunks/DhJDjgwN.js";import{p as V}from"../chunks/CorppH5c.js";import{r as J,a as X}from"../chunks/BJ0eyrNi.js";import{i as F}from"../chunks/D2xXzMMK.js";import{P as $}from"../chunks/D7-1WNqH.js";import{T as tt}from"../chunks/DP3j-b_7.js";import{M as et}from"../chunks/CMjT-JG0.js";import"../chunks/DNtVHDmA.js";import{p as it}from"../chunks/DWDG2EIs.js";/* empty css                */class st{audioContext;notesInQueue=[];currentBeatInBar;beatsPerBar;currentSubdivision;subdivisionsInBeat;tempo;lookahead;scheduleAheadTime;nextNoteTime;isRunning;intervalID;onBeatStart;onBeatEnd;constructor(a=80){this.audioContext=null,this.notesInQueue=[],this.currentBeatInBar=0,this.currentSubdivision=0,this.subdivisionsInBeat=1,this.beatsPerBar=4,this.tempo=a,this.lookahead=25,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.isRunning=!1,this.intervalID=null}nextNote(){const a=60/this.subdivisionsInBeat/this.tempo;this.nextNoteTime+=a,this.currentSubdivision++,this.currentSubdivision>=this.subdivisionsInBeat&&(this.currentBeatInBar++,this.currentSubdivision=0),this.currentBeatInBar>=this.beatsPerBar&&(this.currentBeatInBar=0)}scheduleNote(a,t,s){if(!this.audioContext)return;this.notesInQueue.push({note:a,time:s});const i=this.audioContext.createOscillator(),o=this.audioContext.createGain(),n=1e3,h=400,d=200;t!==0?i.frequency.value=d:a%this.beatsPerBar===0?i.frequency.value=n:i.frequency.value=h,o.gain.value=1,o.gain.exponentialRampToValueAtTime(1,s+.001),o.gain.exponentialRampToValueAtTime(.001,s+.02),i.connect(o),o.connect(this.audioContext.destination);const u=this.audioContext.createConstantSource();u.onended=()=>{this.onBeatStart?.(a,t),i.start(),i.stop(s+.03),i.onended=()=>{this.onBeatEnd?.()}},u.start(s),u.stop(this.audioContext.currentTime+1e-4)}scheduler(){if(this.audioContext)for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;)this.scheduleNote(this.currentBeatInBar,this.currentSubdivision,this.nextNoteTime),this.nextNote()}start(){this.isRunning||(this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.isRunning=!0,this.currentBeatInBar=0,this.currentSubdivision=0,this.nextNoteTime=this.audioContext.currentTime+.05,this.intervalID=setInterval(()=>this.scheduler(),this.lookahead))}stop(){this.isRunning=!1,this.intervalID&&clearInterval(this.intervalID)}startStop(){this.isRunning?this.stop():this.start()}}var ot=T('<div class="controls-container svelte-8u7cmv"><div class="controls-sub-container svelte-8u7cmv"><label for="beatsInBar"><h4>Beats in bar</h4></label> <div class="subdivisions-container svelte-8u7cmv"><button>-1</button> <span style="font-size: large; margin-left: 1em; margin-right: 1em"> </span> <button>+1</button></div></div> <br/> <div class="controls-sub-container svelte-8u7cmv"><label for="subdivisionsInBeat"><h4>Subdivisions in beat</h4></label> <div class="subdivisions-container svelte-8u7cmv"><button aria-label="1 subdivision by beat"><svg width="15" height="15" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 15px; height: auto;"><path d="M 4.3 0 v 9.6 A 2.9 2.9 0 0 0 0 12.1 A 3 3 0 0 0 3 15 c 1.5 0 2.8 -1.3 2.8 -2.9 V 3 V 0 H 4.3 Z"></path></svg></button> <button aria-label="2 subdivision by beat"><svg width="15" height="15" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 15px; height: auto;"><path d="M4.3 0v9.6A2.9 2.9 0 0 0 0 12.1 3 3 0 0 0 3 15c1.5 0 2.8-1.3 2.8-2.9V3h7.7v6.6a2.9 2.9 0 0 0-4.3 2.5 2.9 2.9 0 0 0 5.8 0V0H4.3Z"></path></svg></button> <button aria-label="3 subdivision by beat"><svg width="24" height="21" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 24px; height: auto; top: -3px;"><path clip-rule="evenodd" d="M4.3 15.6V6H24v12.1a3 3 0 0 1-3 2.9 2.9 2.9 0 0 1-2.8-2.9 2.9 2.9 0 0 1 4.3-2.5V9H15v9.1a2.9 2.9 0 0 1-3 2.9 3 3 0 0 1-3-2.9 2.9 2.9 0 0 1 3-2.8c.5 0 1 0 1.3.3V9H5.8v9.1C5.8 19.7 4.5 21 3 21a3 3 0 0 1-3-2.9 2.9 2.9 0 0 1 4.3-2.5Z"></path><path d="M12.6 2.2 13.9.5V0h-3.1v.4h2.5l-1.4 1.7v.4h.4c.9 0 1.3.4 1.3 1s-.4 1-1.2 1c-.7 0-1.3-.3-1.6-.6l-.2.4c.4.4 1 .6 1.8.6 1.1 0 1.7-.6 1.7-1.4 0-.8-.5-1.3-1.5-1.4Z"></path></svg></button> <button aria-label="4 subdivision by beat"><svg width="27" height="13" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 27px; height: auto;"><path clip-rule="evenodd" d="M3.5 0v7.9a2 2 0 0 0-1.1-.3C1 7.6 0 8.6 0 9.9c0 1.3 1 2.4 2.4 2.4 1.3 0 2.3-1 2.3-2.4V3.4H11V8a2 2 0 0 0-1.1-.3 2.3 2.3 0 1 0 0 4.7c1.3 0 2.4-1 2.4-2.4V3.4h6.1V8a2.4 2.4 0 0 0-1-.3c-1.4 0-2.5 1-2.5 2.3 0 1.3 1.1 2.4 2.4 2.4 1.3 0 2.4-1 2.4-2.4V3.4h6.2V8l-1.2-.3c-1.3 0-2.3 1-2.3 2.3a2.3 2.3 0 1 0 4.7 0V0H3.5Zm7.4 2.7H4.7V1.5H11v1.2Zm7.4 0h-6.1V1.5h6.1v1.2Zm1.3 0h6.2V1.5h-6.2v1.2Z"></path></svg></button></div></div></div>');function at(f,a){S(a,!1);let t=V(a,"metronome",12);C();var s=ot(),i=r(s),o=c(r(i),2),n=r(o),h=c(n,2),d=r(h,!0);l(h);var u=c(h,2);l(o),l(i);var v=c(i,4),m=c(r(v),2),g=r(m);let x;var e=c(g,2);let w;var b=c(e,2);let I;var k=c(b,2);let B;l(m),l(v),l(s),H(()=>{K(d,(D(t()),A(()=>t().beatsPerBar))),x=P(g,1,"svelte-8u7cmv",null,x,{selected:t().subdivisionsInBeat===1}),w=P(e,1,"svelte-8u7cmv",null,w,{selected:t().subdivisionsInBeat===2}),I=P(b,1,"svelte-8u7cmv",null,I,{selected:t().subdivisionsInBeat===3}),B=P(k,1,"svelte-8u7cmv",null,B,{selected:t().subdivisionsInBeat===4})}),p("click",n,()=>t(t().beatsPerBar=Math.max(t().beatsPerBar-1,1),!0)),p("click",u,()=>t(t().beatsPerBar=Math.min(t().beatsPerBar+1,10),!0)),p("click",g,()=>t(t().subdivisionsInBeat=1,!0)),p("click",e,()=>t(t().subdivisionsInBeat=2,!0)),p("click",b,()=>t(t().subdivisionsInBeat=3,!0)),p("click",k,()=>t(t().subdivisionsInBeat=4,!0)),y(f,s),M()}var nt=T('<div class="tempo-container svelte-gstu11"><div class="tempo-less svelte-gstu11"><button>-5</button> <button>-1</button></div> <div class="tempo-value svelte-gstu11" style="font-size: x-large"><input style="font-size: x-large; margin-right: 0.1em;" type="number" min="1" max="400"/> BPM</div> <div class="tempo-more svelte-gstu11"><button>+1</button> <button>+5</button></div></div>');function rt(f,a){S(a,!1);let t=V(a,"metronome",12);const s=x=>{if(!x||!x.target)return;const e=x.target,w=Number(e.value);!w||w<1||t(t().tempo=w,!0)};C();var i=nt(),o=r(i),n=r(o),h=c(n,2);l(o);var d=c(o,2),u=r(d);J(u),W(),l(d);var v=c(d,2),m=r(v),g=c(m,2);l(v),l(i),H(()=>X(u,(D(t()),A(()=>t().tempo)))),p("click",n,()=>t(t().tempo=Number(t().tempo)-5,!0)),p("click",h,()=>t(t().tempo=Number(t().tempo)-1,!0)),p("change",u,s),p("click",m,()=>t(t().tempo=Number(t().tempo)+1,!0)),p("click",g,()=>t(t().tempo=Number(t().tempo)+5,!0)),y(f,i),M()}var lt=q('<svg width="20" height="20" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: auto;"><path d="M 0 0 V 20 L 6 20 L 6 0 L 0 0 M 9 0 V 20 H 15 V 0 H 9"></path></svg>'),ut=q('<svg width="20" height="20" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: auto;"><path d="M 0 0 V 20 L 17 10"></path></svg>'),vt=T('<div class="controls-container svelte-vxo2tw"><button style="min-width: 300px"><!></button></div>');function dt(f,a){S(a,!1);let t=V(a,"metronome",12);const s=()=>{t().startStop(),t(t())},i=v=>{const m=" ";if([m].includes(v.key)&&(v.preventDefault(),v.key===m)){s();return}};C();var o=vt();p("keydown",L,i);var n=r(o),h=r(n);{var d=v=>{var m=lt();y(v,m)},u=v=>{var m=ut();y(v,m)};F(h,v=>{D(t()),A(()=>t().isRunning)?v(d):v(u,!1)})}l(n),l(o),p("click",n,s),y(f,o),M()}var ht=T('<div id="canvas-container" class="d-flex justify-content-center"><!></div>');function ct(f,a){S(a,!1);let t=V(a,"metronome",12),s=!1,i=0,o=0;const n=(e,w)=>{s=!0,i=e,o=w},h=()=>{s=!1};let d,u="white",v="white";const m=e=>{e.setup=()=>{d=e,e.createCanvas(600,300),e.textSize(40)},e.draw=()=>{const w=document.getElementById("canvas-container");if(w){const B=w?.clientWidth||600;e.width!==B&&e.resizeCanvas(B,Math.max(B/3,100))}e.clear(),e.stroke(u);const b=Math.min(e.width/t().beatsPerBar,e.height),I=e.height/t().subdivisionsInBeat;for(let B=0;B<t().beatsPerBar;B++){B===i?e.strokeWeight(5):e.strokeWeight(1),e.noFill(),e.circle(B*b+b/2,e.height/2,b*.9),e.strokeWeight(1);for(let N=0;N<t().subdivisionsInBeat;N++)s&&B===i&&N===o?e.fill(u):e.noFill(),e.circle(B*b+b/2,N*I+I/2,b/t().subdivisionsInBeat*.9)}s?e.fill(v):e.fill(u),e.fill(u);const k=(i+1).toString();e.text(k,i*b+b/2-e.textWidth(k)/2,e.height/2+e.textSize()/2)}};j(()=>{const e=getComputedStyle(document.body);u=e.getPropertyValue("--nc-tx-3"),v=e.getPropertyValue("--nc-tx-2"),t(t().onBeatStart=n,!0),t(t().onBeatEnd=h,!0)}),R(()=>{d?.remove()}),C();var g=ht(),x=r(g);$(x,{sketch:m}),l(g),y(f,g),M()}var mt=T('<div class="controls-container svelte-7ka7d9"><button>Tap</button></div>');function bt(f,a){S(a,!1);let t=V(a,"onNewBPM",8),s=new tt,i=E(!1);const o=()=>{s.addBeat(),z(i,!0),setTimeout(()=>z(i,!1),100),s.bpm>0&&t()(Math.ceil(s.bpm))};C();var n=mt(),h=r(n);let d;l(n),H(()=>d=P(h,1,"svelte-7ka7d9",null,d,{taped:_(i)})),p("click",h,o),y(f,n),M()}var pt=T(`<div role="dialog" class="modal svelte-ezojap"><div class="contents svelte-ezojap"><h4 class="title-bar svelte-ezojap">Metronome <button>Close</button></h4> <div>This is a simple metronome: <ul><li>Use the play/pause button or the space bar to start and stop the metronome</li> <li>You can change the tempo by:</li> <ul><li>Entering a number directly in the input</li> <li>Using the -5, -1, +1 and +5 buttons</li> <li>Taping a tempo on the tap button. When taping the tempo each tap counts
                            for a subdivision if subdivisions are enabled. Stop taping for approx. 3
                            seconds to restart the tap counter.</li></ul> <li>The "Beats in bar" setting change the number of beats counted by the
                        metronome. The first beat is accented with a higher frequency tone.</li> <li>The "Subdivisions in beat" setting allow to change how the beats are
                        divided. The subdivisions after the first one are played with a lower
                        frequency tone.</li> <li>The visualization at the bottom follow the beats and their subdivisions.</li></ul></div> <br/> <h5>Bugs</h5> <ul><li>While it goes against my opinion on what the web should look like, this page
                    works better with Chrome-based browsers.</li> <li>For some reason the display of the tempo settings is broken on Firefox, the
                    input doesn't resize properly.</li> <li>The sound doesn't work on Safari on iOS (and maybe on MacOS too).</li></ul></div></div>`);function ft(f,a){var t=O(),s=Z(t);{var i=o=>{var n=pt(),h=r(n),d=r(h),u=c(r(d));u.__click=function(...v){a.close?.apply(this,v)},l(d),W(8),l(h),l(n),y(o,n)};F(s,o=>{a.isOpen&&o(i)})}y(f,t)}U(["click"]);var gt=T('<!> <div class="main svelte-iy8fh1"><h3>Metronome <span><button aria-label="info"><i class="fa fa-info-circle" aria-hidden="true"></i></button></span></h3> <div><!></div> <div class="section svelte-iy8fh1"><!> <!></div> <div class="section svelte-iy8fh1"><!></div> <div class="section svelte-iy8fh1"><!></div></div>',1);function Dt(f,a){S(a,!1),it.set("Metronome");let t=E(new st(80));R(()=>{_(t).stop()}),C();var s=gt(),i=Z(s);et(i,{title:"Metronome",description:"Metronome"});var o=c(i,2),n=r(o),h=c(r(n)),d=r(h);G(d,"",{},{position:"relative"}),l(h),l(n);var u=c(n,2),v=r(u);dt(v,{get metronome(){return _(t)}}),l(u);var m=c(u,2),g=r(m);rt(g,{get metronome(){return _(t)}});var x=c(g,2);bt(x,{onNewBPM:k=>{Q(t,_(t).tempo=k/_(t).subdivisionsInBeat),z(t,_(t))}}),l(m);var e=c(m,2),w=r(e);at(w,{get metronome(){return _(t)}}),l(e);var b=c(e,2),I=r(b);ct(I,{get metronome(){return _(t)}}),l(b),l(o),p("click",d,()=>Y.open(ft)),y(f,s),M()}export{Dt as component};
