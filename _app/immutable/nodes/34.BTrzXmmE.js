import"../chunks/NZTpNUN0.js";import{p as te,h as U,Y as we,c as ie,f as P,a as d,d as ae,b,e as l,s as a,r as s,g as e,i as W,t as ee}from"../chunks/DnM7dGtc.js";import{d as Se,s as oe}from"../chunks/6Z5RDsVp.js";import{a as De}from"../chunks/zDk3TYrg.js";import{i as N}from"../chunks/lY64Rcfk.js";import{s as ce,a as ve}from"../chunks/CVcH4W3l.js";import{m as Me}from"../chunks/DT0uYGbH.js";import{u as de}from"../chunks/CmfuKG-C.js";import{M as ye}from"../chunks/n_r9TYHL.js";import{c as re}from"../chunks/DMpkERri.js";import{e as xe,i as ke}from"../chunks/NHIKzi1z.js";import{r as u,a as k,s as Ae}from"../chunks/IQ_nNP8V.js";import{b as $}from"../chunks/Dkhza57w.js";import{b as Le}from"../chunks/CxhW-Sfk.js";import{A as Ee,U as Ie}from"../chunks/BI4tYcJk.js";import{t as Ue}from"../chunks/DbXWiUQC.js";import{M as He}from"../chunks/hrZvdv_J.js";import{M as Te}from"../chunks/tZF4Vw7A.js";import{M as qe}from"../chunks/CGfUd1Ff.js";import{M as Ne}from"../chunks/BYJRY-Jh.js";import{a as Fe}from"../chunks/DTyfSRsR.js";import"../chunks/CKAZmBfe.js";import"../chunks/Cidogj0H.js";import{p as Oe}from"../chunks/BLVtKp5L.js";const Be=!1,Ct=Object.freeze(Object.defineProperty({__proto__:null,ssr:Be},Symbol.toStringTag,{value:"Module"})),_e=re.webWatcher.getAllWatchers,ge=re.webWatcher.createWatcher,Re=re.webWatcher.deleteWatcher,Pe=re.webWatcher.toggleWatcherEnabled;var je=b('<label for="css-selector">CSS selector</label> <input type="textarea"/>',1),ze=b('<button class="form-action svelte-8qhbr8">Submit</button>'),Je=b('<span class="form-action svelte-8qhbr8">Login to upload an entry</span>'),Ve=b('<div role="dialog" class="modal svelte-8qhbr8"><div class="contents svelte-8qhbr8"><h3 class="title-bar svelte-8qhbr8">Add a new watcher <button>Close</button></h3> <!> <form class="form-content svelte-8qhbr8"><label for="name">Name</label> <input type="text"/> <label for="check-interval">Check interval</label> <!> <label for="notification-message">Notification message (the @mention is automatically added)</label> <input type="textarea"/> <label for="watch-type">Watcher type</label> <select id="watch-type"><option>CSS</option><option>HASH</option></select> <label for="content">URL</label> <input type="textarea"/> <!> <br/> <!></form></div></div>');function Ye(C,t){te(t,!0);const D=()=>ve(de,"$user",g),[g,m]=ce();let o=U(we([])),f=U(""),_=U(""),w=U(""),y=U(""),S=U(0),i=U("CSS");const M=async()=>{W(o,[],!0),e(f)?.length||e(o).push({level:"error",header:"name must be defined"}),e(_)||e(o).push({level:"error",header:"notification message must be defined"}),e(i)==="CSS"&&!e(y)&&e(o).push({level:"error",header:"A CSS watcher must have a css selector defined"}),e(S)<15*60&&e(o).push({level:"error",header:"Check interval too small. Must be >= 15mn"});try{new URL(e(w))}catch{e(o).push({level:"error",header:"The URL is invalid"})}if(!e(o).length)try{e(i)==="CSS"?await ge({name:e(f),notificationMessage:e(_),url:e(w),cssSelector:e(y),checkIntervalSeconds:e(S),watchType:e(i)}):e(i)==="HASH"&&await ge({name:e(f),notificationMessage:e(_),url:e(w),checkIntervalSeconds:e(S),watchType:e(i)}),t.onUpload(),t.close()}catch(n){let v=n.message;n instanceof Ee&&n.code===401?v="Invalid logged in user":n instanceof Ie&&(v="User is logged out");const p=`<strong>Entry not created</strong><br/> ${v}`;Ue.push(p,{theme:{"--toastBarBackground":"#FF0000"}})}};var A=ie(),j=P(A);{var c=n=>{var v=Ve(),p=l(v),L=l(p),F=a(l(L));F.__click=function(...r){t.close?.apply(this,r)},s(L);var z=a(L,2);xe(z,17,()=>e(o),ke,(r,h)=>{ye(r,{get item(){return e(h)}})});var Q=a(z,2),E=a(l(Q),2);u(E);var J=a(E,4);He(J,{allowedUnits:["minutes","hours","days"],defaultDuration:{value:1,unit:"hours"},get valueInSeconds(){return e(S)},set valueInSeconds(r){W(S,r,!0)}});var O=a(J,4);u(O);var x=a(O,4),B=l(x);B.value=B.__value="CSS";var V=a(B);V.value=V.__value="HASH",s(x);var I=a(x,4);u(I);var R=a(I,2);{var Y=r=>{var h=je(),G=a(P(h),2);u(G),$(G,()=>e(y),X=>W(y,X)),d(r,h)};N(R,r=>{e(i)==="CSS"&&r(Y)})}var se=a(R,4);{var le=r=>{var h=ze();h.__click=M,d(r,h)},ne=r=>{var h=Je();d(r,h)};N(se,r=>{D()?r(le):r(ne,!1)})}s(Q),s(p),s(v),$(E,()=>e(f),r=>W(f,r)),$(O,()=>e(_),r=>W(_,r)),Le(x,()=>e(i),r=>W(i,r)),$(I,()=>e(w),r=>W(w,r)),d(n,v)};N(j,n=>{t.isOpen&&n(c)})}d(C,A),ae(),m()}Se(["click"]);var Ge=b('<p class="section-3-item svelte-1e53865"><label for="css-selector">CSS selector <!></label> <input disabled type="textarea" class="svelte-1e53865"/></p>'),Ke=b('<div class="section error-section svelte-1e53865"><p class="section-4-item svelte-1e53865"><label for="last-check">Last error</label> <input disabled type="textarea" class="svelte-1e53865"/></p> <p class="section-4-item svelte-1e53865"><label for="last-update">Last error message</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div>'),Qe=b('<div class="item svelte-1e53865"><h3 class="item-title svelte-1e53865"><div class="item-name svelte-1e53865"> </div> <div class="item-actions svelte-1e53865"><!> <!></div></h3> <div class="section svelte-1e53865"><p class="section-1-item svelte-1e53865"><label for="check-interval">Check interval</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <div class="section svelte-1e53865"><p class="section-2-item svelte-1e53865"><label for="notification-message">Notification message</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <div class="section svelte-1e53865"><p class="section-3-item svelte-1e53865"><label for="content">URL</label> <a target="_blank" rel="noopener noreferrer"> </a></p> <!></div> <div class="section svelte-1e53865"><p class="section-4-item svelte-1e53865"><label for="last-check">Last check</label> <input disabled type="textarea" class="svelte-1e53865"/></p> <p class="section-4-item svelte-1e53865"><label for="last-update">Last content change</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <!> <div class="section svelte-1e53865"><p class="section-3-item svelte-1e53865"><label for="last-update">Last content</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div></div>');function Xe(C,t){te(t,!0);const D=()=>ve(de,"$user",g),[g,m]=ce(),o=c=>{const n=new Date(c*1e3);return n.toLocaleDateString()+" "+n.toLocaleTimeString()},f=t.watcher.lastCheckDateUnix===0?"Never checked before":o(t.watcher.lastCheckDateUnix||0),_=t.watcher.lastUpdateDateUnix===0?"Never changed":o(t.watcher.lastUpdateDateUnix||0),w=Fe.fromMillis(t.watcher.checkIntervalSeconds*1e3).rescale().toHuman(),y=async()=>{if(!t.watcher.id){console.error("id must be defined");return}try{await Re({id:t.watcher.id}),t.onDelete()}catch(c){const n=`<strong>Watcher not deleted</strong><br/> ${c.message}`;Ue.push(n,{theme:{"--toastBarBackground":"#FF0000"}})}},S=async c=>{await Pe({watcherId:t.watcher.id,setToEnabled:c==="on"}),t.onUpdate()};let i=t.watcher.archivalDateUnix?"off":"on";var M=ie(),A=P(M);{var j=c=>{var n=Qe(),v=l(n),p=l(v),L=l(p,!0);s(p);var F=a(p,2),z=l(F);Ne(z,{get value(){return i},label:"Enabled",onchange:S,design:"slider"});var Q=a(z,2);qe(Q,{deleteAction:y}),s(F),s(v);var E=a(v,2),J=l(E),O=a(l(J),2);u(O),s(J),s(E);var x=a(E,2),B=l(x),V=a(l(B),2);u(V),s(B),s(x);var I=a(x,2),R=l(I),Y=a(l(R),2),se=l(Y,!0);s(Y),s(R);var le=a(R,2);{var ne=H=>{var T=Ge(),q=l(T),Z=a(l(q));Te(Z,{get content(){return t.watcher.cssSelector}}),s(q);var K=a(q,2);u(K),s(T),ee(()=>k(K,t.watcher.cssSelector)),d(H,T)};N(le,H=>{t.watcher.cssSelector&&H(ne)})}s(I);var r=a(I,2),h=l(r),G=a(l(h),2);u(G),s(h);var X=a(h,2),he=a(l(X),2);u(he),s(X),s(r);var ue=a(r,2);{var We=H=>{var T=Ke(),q=l(T),Z=a(l(q),2);u(Z),s(q);var K=a(q,2),be=a(l(K),2);u(be),s(K),s(T),ee(Ce=>{k(Z,Ce),k(be,t.watcher.lastErrorMessage)},[()=>o(t.watcher.lastErrorDateUnix)]),d(H,T)};N(ue,H=>{t.watcher.lastErrorDateUnix&&H(We)})}var me=a(ue,2),fe=l(me),pe=a(l(fe),2);u(pe),s(fe),s(me),s(n),ee(()=>{oe(L,t.watcher.name),k(O,w),k(V,t.watcher.notificationMessage),Ae(Y,"href",t.watcher.url),oe(se,t.watcher.url),k(G,f),k(he,_),k(pe,t.watcher.lastContent)}),d(c,n)};N(A,c=>{D()&&c(j)})}d(C,M),ae(),m()}var Ze=b('<div class="container svelte-ihkiaa"></div>');function $e(C,t){te(t,!0);const D=(m,o)=>m.archivalDateUnix===null&&o.archivalDateUnix!==null?-1:m.archivalDateUnix!==null&&o.archivalDateUnix===null?1:o.id-m.id;var g=Ze();xe(g,21,()=>t.watchers.sort(D),ke,(m,o)=>{Xe(m,{get watcher(){return e(o)},get onDelete(){return t.onDelete},get onUpdate(){return t.onUpdate}})}),s(g),d(C,g),ae()}var et=b("<p>Something went wrong</p> <p> </p>",1),tt=b("<p>Loading data</p>"),at=b("<h2>Create a new watcher</h2> <button>Add an entry</button> <h2>Watchers</h2> <!>",1);function Dt(C,t){te(t,!0);const D=()=>ve(de,"$user",g),[g,m]=ce();Oe.set({name:"Web Watchers",showAuthInHeader:!0});let o=U(we(_e()));const f=()=>W(o,_e(),!0);var _=ie(),w=P(_);{var y=i=>{var M=at(),A=a(P(M),2);A.__click=()=>Me.open(Ye,{onUpload:f});var j=a(A,4);De(j,()=>e(o),c=>{var n=tt();d(c,n)},(c,n)=>{$e(c,{get watchers(){return e(n)},onDelete:f,onUpdate:f})},(c,n)=>{var v=et(),p=a(P(v),2),L=l(p,!0);s(p),ee(F=>oe(L,F),[()=>JSON.stringify(e(n))]),d(c,v)}),d(i,M)},S=i=>{ye(i,{item:{level:"info",header:"Login to list the watchers"}})};N(w,i=>{D()?i(y):i(S,!1)})}d(C,_),ae(),m()}Se(["click"]);export{Dt as component,Ct as universal};
