import"../chunks/DsnmJJEf.js";import{p as _e,c as oe,f as A,a as t,d as pe,b as m,g as e,I as he,s as v,e as i,r,t as j,j as R,h as we,C as Te,aI as ce,n as Pe,i as ae}from"../chunks/DkXSg9Km.js";import{d as fe,s as S}from"../chunks/Cyetx9DU.js";import{i as f}from"../chunks/Dw7qq8GU.js";import{M as Se}from"../chunks/qNvLz8AQ.js";import{M as Ce}from"../chunks/CrhFVsLi.js";import"../chunks/CQQT6HDV.js";import{o as be}from"../chunks/CSozHYSm.js";import{e as me,i as ue}from"../chunks/DZfzBhg_.js";import{b as Ee,s as Ue,a as X}from"../chunks/yH9QFfND.js";import{i as We}from"../chunks/ccnLYwlq.js";import{a as re,s as je}from"../chunks/Chs2GqvL.js";import"../chunks/DVKWB0F4.js";import{M as ke}from"../chunks/CLLwXVC1.js";import"../chunks/RZZgkjFT.js";import"../chunks/B_ZMb8oH.js";import{e as ne,p as xe,P as Fe}from"../chunks/-PFtY_iv.js";import{D as se}from"../chunks/CkcISRbr.js";import{g as ge}from"../chunks/B4HZvW_C.js";import"../chunks/n3BQNdM3.js";import{p as Le}from"../chunks/vRHFL2XH.js";/* empty css                */var Oe=m("<p>Loading events</p>"),Ie=m('<button class="emotion-item svelte-cyscl8"> </button>'),Ae=m('<div class="selection svelte-cyscl8"></div>'),He=m('<div class="event svelte-cyscl8"><div class="event-date"> </div> <div class="event-value svelte-cyscl8"><!></div> <div class="event-value svelte-cyscl8"><!></div> <div class="event-value svelte-cyscl8"><!></div> <div class="event-actions svelte-cyscl8"><button class="svelte-cyscl8">Edit</button></div></div>'),Ve=m('<div class="events-header svelte-cyscl8"><div>Date</div> <div>Mood</div> <div>Weight</div> <div>Emotions</div> <div>Actions</div></div> <!>',1);function qe(Y,z){_e(z,!1);const M=()=>re(xe,"$personalTrackerPassword",C),l=()=>re(ne,"$eventsStore",C),[C,H]=je();be(()=>{ne.fetch(M())});const u=g=>{ge(`/personal-tracker/add/${g}`)};We();var V=oe(),B=A(V);{var Z=g=>{var k=Oe();t(g,k)},J=g=>{var k=oe(),E=A(k);{var U=h=>{{let $=he(()=>({level:"error",header:"Something went wrong getting events",message:l().error.message}));ke(h,{get item(){return e($)}})}},W=h=>{var $=Ve(),d=v(A($),2);me(d,1,()=>l().events.sort((_,a)=>a.eventDateUnix-_.eventDateUnix),ue,(_,a)=>{const ee=he(()=>se.fromSeconds(e(a).eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm"));var F=He(),p=i(F),w=i(p,!0);r(p);var c=v(p,2),L=i(c);{var D=s=>{var n=R();j(()=>S(n,e(a).mood)),t(s,n)},K=s=>{var n=R("-");t(s,n)};f(L,s=>{e(a).mood!==void 0?s(D):s(K,!1)})}r(c);var T=v(c,2),N=i(T);{var q=s=>{var n=R();j(O=>S(n,`${O??""} kg`),[()=>(e(a).weight/100).toFixed(1)]),t(s,n)},ie=s=>{var n=R("-");t(s,n)};f(N,s=>{e(a).weight!==void 0?s(q):s(ie,!1)})}r(T);var Q=v(T,2),o=i(Q);{var x=s=>{var n=Ae();me(n,5,()=>e(a).emotionwheel.emotions,ue,(O,P)=>{var I=Ie(),de=i(I);r(I),j(()=>{Ee(I,`--color: ${e(P).color??""}`),S(de,`${e(P).category??""}
                                ${e(P).subcategory??""}
                                ${e(P).emotion??""}`)}),t(O,I)}),r(n),t(s,n)},te=s=>{var n=R("-");t(s,n)};f(o,s=>{e(a).emotionwheel?.emotions?s(x):s(te,!1)})}r(Q);var G=v(Q,2),ve=i(G);ve.__click=()=>u(e(a).eventDateUnix),r(G),r(F),j(()=>S(w,e(ee))),t(_,F)}),t(h,$)};f(E,h=>{l().error?h(U):h(W,!1)},!0)}t(g,k)};f(B,g=>{l().loading?g(Z):g(J,!1)})}t(Y,V),pe(),H()}fe(["click"]);var Ge=m("<p>Loading events</p>"),Ye=m('<div class="indicator mood svelte-juywa"> </div>'),ze=m('<div class="indicator weight svelte-juywa">W</div>'),Be=m('<div class="indicator emotions svelte-juywa">E</div>'),Je=m('<div class="event-indicators svelte-juywa"><!> <!> <!></div>'),Ke=m('<div><div class="day-number svelte-juywa"> </div> <!></div>'),Ne=m('<div class="calendar-container svelte-juywa"><div class="calendar-header svelte-juywa"><button class="nav-button svelte-juywa">&lt;</button> <h3 class="month-year svelte-juywa"> </h3> <button class="nav-button svelte-juywa">&gt;</button> <button class="today-button svelte-juywa">Today</button></div> <div class="calendar-grid svelte-juywa"><div class="day-name svelte-juywa">Mon</div> <div class="day-name svelte-juywa">Tue</div> <div class="day-name svelte-juywa">Wed</div> <div class="day-name svelte-juywa">Thu</div> <div class="day-name svelte-juywa">Fri</div> <div class="day-name svelte-juywa">Sat</div> <div class="day-name svelte-juywa">Sun</div> <!></div> <div class="calendar-legend svelte-juywa"><div class="legend-item svelte-juywa"><div class="indicator mood svelte-juywa">5</div> <span>Mood</span></div> <div class="legend-item svelte-juywa"><div class="indicator weight svelte-juywa">W</div> <span>Weight</span></div> <div class="legend-item svelte-juywa"><div class="indicator emotions svelte-juywa">E</div> <span>Emotions</span></div></div></div>');function Qe(Y,z){_e(z,!0);const M=()=>re(xe,"$personalTrackerPassword",C),l=()=>re(ne,"$eventsStore",C),[C,H]=je();let u=we(Te(se.now().startOf("month")));be(()=>{ne.fetch(M())});const V=()=>{ae(u,e(u).minus({months:1}),!0)},B=()=>{ae(u,e(u).plus({months:1}),!0)},Z=()=>{ae(u,se.now().startOf("month"),!0)},J=d=>{ge(`/personal-tracker/add/${d.eventDateUnix}`)},g=(d,_)=>{const a=d.startOf("month"),F=a.weekday-1,p=42,w=[];let c=a.minus({days:F});for(let L=0;L<p;L++){const D=c.toUTC().plus({days:1}).startOf("day").toUnixInteger(),K=_.find(q=>q.eventDateUnix===D),T=c.month===d.month,N=c.hasSame(se.now(),"day");w.push({date:c,timestamp:D,event:K,isCurrentMonth:T,isToday:N}),c=c.plus({days:1})}return w},k=ce(()=>g(e(u),l().events)),E=ce(()=>e(u).toFormat("MMMM yyyy"));var U=oe(),W=A(U);{var h=d=>{var _=Ge();t(d,_)},$=d=>{var _=oe(),a=A(_);{var ee=p=>{{let w=ce(()=>({level:"error",header:"Something went wrong getting events",message:l().error.message}));ke(p,{get item(){return e(w)}})}},F=p=>{var w=Ne(),c=i(w),L=i(c);L.__click=V;var D=v(L,2),K=i(D,!0);r(D);var T=v(D,2);T.__click=B;var N=v(T,2);N.__click=Z,r(c);var q=v(c,2),ie=v(i(q),14);me(ie,17,()=>e(k),ue,(Q,o)=>{var x=Ke();let te;x.__click=()=>e(o).event&&J(e(o).event);var G=i(x),ve=i(G,!0);r(G);var s=v(G,2);{var n=O=>{var P=Je(),I=i(P);{var de=y=>{var b=Ye(),le=i(b,!0);r(b),j(()=>{X(b,"title",`Mood: ${e(o).event.mood??""}`),S(le,e(o).event.mood)}),t(y,b)};f(I,y=>{e(o).event.mood!==void 0&&y(de)})}var ye=v(I,2);{var Me=y=>{var b=ze();j(le=>X(b,"title",`Weight: ${le??""} kg`),[()=>(e(o).event.weight/100).toFixed(1)]),t(y,b)};f(ye,y=>{e(o).event.weight!==void 0&&y(Me)})}var $e=v(ye,2);{var De=y=>{var b=Be();j(()=>X(b,"title",`${e(o).event.emotionwheel.emotions.length??""} emotions`)),t(y,b)};f($e,y=>{e(o).event.emotionwheel?.emotions&&y(De)})}r(P),t(O,P)};f(s,O=>{e(o).event&&O(n)})}r(x),j(()=>{te=Ue(x,1,"calendar-day svelte-juywa",null,te,{"other-month":!e(o).isCurrentMonth,"has-event":e(o).event,today:e(o).isToday}),X(x,"role",e(o).event?"button":void 0),X(x,"tabindex",e(o).event?0:void 0),S(ve,e(o).date.day)}),t(Q,x)}),r(q),Pe(2),r(w),j(()=>S(K,e(E))),t(p,w)};f(a,p=>{l().error?p(ee):p(F,!1)},!0)}t(d,_)};f(W,d=>{l().loading?d(h):d($,!1)})}t(Y,U),pe(),H()}fe(["click"]);var Re=m('<div class="controls svelte-8wagie"><button>Add an entry</button> <button class="view-toggle svelte-8wagie"> </button></div> <!>',1),Xe=m("<!> <!>",1);function bt(Y,z){_e(z,!0);const M={name:"Personal Tracker",description:"Track me metrics",iconPath:"/personal_tracker.png",showAuthInHeader:!0};Le.set(M);let l=we("calendar");const C=()=>{ae(l,e(l)==="calendar"?"list":"calendar",!0)};var H=Xe(),u=A(H);Ce(u,{get title(){return M.name},get description(){return M.description},get iconPath(){return M.iconPath}});var V=v(u,2);Se(V,{message:"Login to see events",requiredScope:"admin",children:(B,Z)=>{Fe(B,{children:(J,g)=>{var k=Re(),E=A(k),U=i(E);U.__click=()=>ge("/personal-tracker/add");var W=v(U,2);W.__click=C;var h=i(W,!0);r(W),r(E);var $=v(E,2);{var d=a=>{Qe(a,{})},_=a=>{qe(a,{})};f($,a=>{e(l)==="calendar"?a(d):a(_,!1)})}j(()=>S(h,e(l)==="calendar"?"ðŸ“‹ List View":"ðŸ“… Calendar View")),t(J,k)},$$slots:{default:!0}})},$$slots:{default:!0}}),t(Y,H),pe()}fe(["click"]);export{bt as component};
