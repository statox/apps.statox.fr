import"../chunks/NZTpNUN0.js";import{z as xe,A as k,B as V,g as n,p as q,f as Z,F as C,x as E,a as M,E as Ce,v as x,s as m,aZ as te,G as g,a_ as re,c as ne,y as Pe}from"../chunks/Br9SMxIB.js";import{d as ke,s as j,e as se}from"../chunks/BBzb7ThI.js";import{i as J}from"../chunks/CvXxFVm9.js";import{e as N,i as $}from"../chunks/D1-nhZYT.js";import{b as le,a as Ie,r as ae,s as Ae,c as ie}from"../chunks/DWdbj9D8.js";import{b as oe}from"../chunks/C6S4cPPP.js";import{M as Oe}from"../chunks/DKmGubEx.js";var d=(e=>(e[e.notOver=0]="notOver",e[e.winPlayer1=1]="winPlayer1",e[e.winPlayer2=2]="winPlayer2",e[e.draw=3]="draw",e))(d||{});const T=7,I=6,y=4;class Ee extends Error{constructor(r){super("Can't play in column "+r)}}const K=e=>e.map(r=>[...r]),ue=(e,r)=>e[r].length!==I,z=e=>{const r=[];for(let t=0;t<e.length;t++)e[t].length<I&&r.push(t);return r},Te=e=>{const r=T*I,t=e.reduce((l,o)=>l+o.length,0);return r===t},qe=e=>{for(let r=0;r<T;r++)for(let t=0;t<I;t++){if(e[r].length<t||!e[r][t])continue;const l=e[r][t];let o=0,v=0,f=0,c=0;for(let s=0;s<y;s++)t+s<=e[r].length&&e[r][t+s]===l&&o++,r+s<e.length&&e[r+s][t]===l&&v++,r+s<e.length&&t+s<=e[r+s].length&&e[r+s][t+s]===l&&f++,r+s<e.length&&t-s>=0&&e[r+s][t-s]===l&&c++;if(o===y||v===y||f===y||c===y)return l}return null},Fe=e=>{if(A(e)===0)return null;for(let r=0;r<T;r++)for(let t=0;t<I;t++){if(e[r].length<t||!e[r][t])continue;const l=e[r][t],o=[],v=[],f=[],c=[];for(let s=0;s<y;s++)t+s<=e[r].length&&e[r][t+s]===l&&o.push([t+s,r]),r+s<e.length&&e[r+s][t]===l&&v.push([t,r+s]),r+s<e.length&&t+s<=e[r+s].length&&e[r+s][t+s]===l&&f.push([t+s,r+s]),r+s<e.length&&t-s>=0&&e[r+s][t-s]===l&&c.push([t-s,r+s]);if(o.length===y)return o;if(v.length===y)return v;if(f.length===y)return f;if(c.length===y)return c}return null},A=e=>{if(Te(e))return 3;const r=qe(e);return r===1?1:r===2?2:0},F=(e,r,t)=>{if(!ue(e,t))throw new Ee(t);return e[t].push(r),e},Ge=e=>{const r=z(e),t=Math.floor(Math.random()*r.length);return r[t]},Re=(e,r)=>{const t=Ge(e);return{board:F(e,r,t),move:t}},We=(e,r,t)=>{const l=He(e,r,t?.iterations,t?.c);return{board:F(e,r,l),move:l}};class ve{board;player;move;parent;children=[];visits=0;wins=0;constructor(r,t,l=null,o=null){this.board=r,this.player=t,this.move=l,this.parent=o}isFullyExpanded(){return this.children.length===z(this.board).length}isTerminal(){return A(this.board)!==d.notOver}}function ce(e,r,t,l=Math.sqrt(2)){return t===0?1/0:r/t+l*Math.sqrt(Math.log(e)/t)}function Ve(e,r){for(;!e.isTerminal();)if(e.isFullyExpanded())e=$e(e,r);else return Ne(e);return e}function Ne(e){const r=e.children.map(c=>c.move),l=z(e.board).filter(c=>!r.includes(c)),o=l[Math.floor(Math.random()*l.length)],v=K(e.board);F(v,e.player,o);const f=new ve(v,e.player===1?2:1,o,e);return e.children.push(f),f}function $e(e,r){return e.children.reduce((t,l)=>{const o=ce(e.visits,t.wins,t.visits,r);return ce(e.visits,l.wins,l.visits,r)>o?l:t})}function ze(e){const r=K(e.board);let t=e.player;for(;;){const l=A(r);if(l!==d.notOver)return l;const o=z(r),v=o[Math.floor(Math.random()*o.length)];F(r,t,v),t=t===1?2:1}}function De(e,r){let t=e;for(;t!==null;)t.visits+=1,r===d.winPlayer1&&t.parent?.player===1||r===d.winPlayer2&&t.parent?.player===2?t.wins+=1:r===d.draw&&(t.wins+=.5),t=t.parent}function He(e,r,t=1e3,l=Math.sqrt(2)){const o=new ve(K(e),r,null,null);for(let f=0;f<t;f++){const c=Ve(o,l),s=ze(c);De(c,s)}return o.children.reduce((f,c)=>f.visits>c.visits?f:c).move}const Le=(e,r,t)=>{m(r,Array.from({length:7},()=>[]),!0),m(t,1)};var Ue=q("<option> </option>"),Ze=(e,r,t,l)=>{n(r)&&(m(t,n(r).iterations,!0),m(l,n(r).c,!0))},je=q("<option> </option>"),Je=(e,r)=>m(r,null),Ke=(e,r)=>m(r,null),Qe=q(`<div><h4>Monte Carlo Tree Search parameters</h4> <label for="mcts-preset">Preset difficulty</label> <select></select> <br/><br/> <label for="mcts-iterations">Iterations:</label> <input id="mcts-iterations" type="number" min="0"/> <small>Number of simulations MCTS will run before choosing a move. Higher values usually mean
            stronger play but slower decisions.</small> <br/><br/> <label for="mcts-c">C (exploration constant):</label> <input id="mcts-c" type="number" min="0" step="0.1"/> <small>Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
            favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2
            ≈ 1.41.</small></div>`),Se=(e,r,t,l)=>r(n(t),n(l)),Xe=q("<div><button><div></div></button></div>"),Ye=q('<!> <div class="main"><h3>Gravitrip</h3></div> <div>See <a href="https://www.quora.com/What-is-the-winning-strategy-for-the-first-player-in-Connect-Four-games">this quora thread</a> for some tips on the winning strategy</div> <span><button>Restart game</button> <span style="font-weight: bold"><!></span></span> <div>Computer stategy: <select></select></div> <!> <div class="board svelte-1bdwycb"></div>',1);function it(e,r){xe(r,!0);let t=k(V(Array.from({length:7},()=>[]))),l=te(()=>A(n(t))),o=te(()=>Fe(n(t))),v=k(null);const f=[{name:"easy",iterations:200,c:2},{name:"medium",iterations:1e3,c:1.41},{name:"hard",iterations:5e3,c:.7}];let c=k(V(f[1])),s=k(V(n(c).iterations)),G=k(V(n(c).c)),O=k("mcts");const fe=Array.from({length:I},(a,i)=>i),he=Array.from({length:T},(a,i)=>i);let b=k(1);const me=(a,i)=>{n(b)===1&&ue(n(t),a)&&A(n(t))===d.notOver&&(m(t,F(n(t),i,a),!0),m(b,n(b)===1?2:1,!0),pe())},pe=()=>{if(n(b)!==2||A(n(t))!==d.notOver)return;let a;if(n(O)==="random")a=Re(n(t),n(b));else if(n(O)==="mcts")a=We(n(t),n(b),{iterations:n(s),c:n(G)});else throw new Error("computer strategy not implemented");const{board:i,move:u}=a;m(t,i,!0),m(v,u,!0),m(b,1)},_e=(a,i)=>n(o)===null?!1:n(o).filter(u=>u[0]===a&&u[1]===i).length>0;var Q=Ye(),S=Z(Q);Oe(S,{title:"Gravitrip",description:"Gravitrip"});var D=x(S,6),X=C(D);X.__click=[Le,t,b];var Y=x(X,2),ge=C(Y);{var de=a=>{var i=re("Game Over");M(a,i)},we=a=>{var i=ne(),u=Z(i);{var w=_=>{var h=re();E(()=>j(h,`Player ${n(l)??""} wins`)),M(_,h)};J(u,_=>{(n(l)===d.winPlayer1||n(l)===d.winPlayer2)&&_(w)},!0)}M(a,i)};J(ge,a=>{n(l)===d.draw?a(de):a(we,!1)})}g(Y),g(D);var H=x(D,2),L=x(C(H));N(L,20,()=>["mcts","random"],$,(a,i)=>{var u=Ue(),w=C(u,!0);g(u);var _={};E(()=>{j(w,i),_!==(_=i)&&(u.value=(u.__value=i)??"")}),M(a,u)}),g(L),g(H);var B=x(H,2);{var ye=a=>{var i=Qe(),u=x(C(i),4);u.__change=[Ze,c,s,G],N(u,21,()=>f,$,(h,P)=>{var p=je(),R=C(p,!0);g(p);var W={};E(()=>{j(R,n(P).name),W!==(W=n(P))&&(p.value=(p.__value=n(P))??"")}),M(h,p)}),g(u);var w=x(u,7);ae(w),w.__change=[Je,c];var _=x(w,9);ae(_),_.__change=[Ke,c],Pe(2),g(i),le(u,()=>n(c),h=>m(c,h)),oe(w,()=>n(s),h=>m(s,h)),oe(_,()=>n(G),h=>m(G,h)),M(a,i)};J(B,a=>{n(O)==="mcts"&&a(ye)})}var U=x(B,2);N(U,21,()=>fe.reverse(),$,(a,i)=>{var u=ne(),w=Z(u);N(w,17,()=>he,$,(_,h)=>{var P=Xe(),p=C(P);let R;p.__click=[Se,me,h,b];var W=C(p);let ee;g(p),g(P),E((be,Me)=>{Ae(p,"aria-label","col-"+n(h)),R=ie(p,1,"outer-cell svelte-1bdwycb",null,R,be),ee=ie(W,1,"cell svelte-1bdwycb",null,ee,Me)},[()=>({selected:n(v)===n(h),"winning-cell":_e(n(i),n(h))}),()=>({player1:n(t)[n(h)][n(i)]===1,player2:n(t)[n(h)][n(i)]===2})]),se("mouseenter",p,()=>m(v,n(h),!0)),se("mouseleave",p,()=>m(v,null)),M(_,P)}),M(a,u)}),g(U),E(()=>Ie(U,`--nb-col: ${T}; --nb-row: ${I}`)),le(L,()=>n(O),a=>m(O,a)),M(e,Q),Ce()}ke(["click","change"]);export{it as component};
