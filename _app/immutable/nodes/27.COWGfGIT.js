import{g as Bt,u as pt,a as Vt,b as Ut}from"../chunks/BVn0uVaB.js";import"../chunks/NZTpNUN0.js";import{a as mt}from"../chunks/DczscSsP.js";import{p as P,H as bt,g as t,b as S,t as O,a as b,d as z,i as q,h as M,f as F,s as p,e as v,r as l,c as G,a$ as tt,j as wt,aj as et}from"../chunks/CAng7chV.js";import{d as ot,w as kt,s as U,g as Mt}from"../chunks/B31O6ZDe.js";import{e as I,i as R}from"../chunks/BjJWMaWl.js";import{c as Ot}from"../chunks/Cy7Wbuen.js";import{c as ut,d as Ct,s as rt,a as dt,r as _t}from"../chunks/h-aEY1xR.js";import{b as Ft,c as jt}from"../chunks/B4T-OeiH.js";import{a as ft,s as yt,b as Lt}from"../chunks/DueeSYB5.js";import{m as Et}from"../chunks/vTeVU-fP.js";import{a as xt}from"../chunks/6I778MRn.js";import{M as Nt}from"../chunks/CGwCgvcP.js";import{M as It}from"../chunks/ap-v-anE.js";import{i as J}from"../chunks/D8trZI8D.js";import{k as ht}from"../chunks/CgU_GdrL.js";import{p as vt}from"../chunks/CFmQBWvH.js";import{b as Rt,g as Ht}from"../chunks/C-Z6awDl.js";import{t as Jt}from"../chunks/Cho2_ESd.js";import{A as Pt}from"../chunks/DbZds5bN.js";import{U as zt,u as Gt}from"../chunks/DNN2QcUe.js";import{b as Kt}from"../chunks/B7GS_M74.js";import{a as Wt}from"../chunks/C1xFjqlY.js";import"../chunks/B2E521tF.js";import{p as Qt}from"../chunks/SdzEE8ls.js";const Xt=!1,Yt=async()=>({chords:await Bt()}),fr=Object.freeze(Object.defineProperty({__proto__:null,load:Yt,ssr:Xt},Symbol.toStringTag,{value:"Module"}));var Zt=S('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1vskasp"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1vskasp">Back to top</span></button>');function $t(_,e){P(e,!0);let n=M(0),s=M(!0),f;const D=o=>{o>0?q(s,!1):q(s,!0),f&&clearTimeout(f),f=setTimeout(()=>{q(s,!0)},3e3)},w=()=>{const o=document.documentElement.scrollTop||document.body.scrollTop;o>0&&(window.requestAnimationFrame(w),window.scrollTo(0,o-o/2))};bt(()=>D(t(n)));var a=Zt();let r;a.__click=w,O(o=>r=ut(a,1,"top-link svelte-1vskasp",null,r,o),[()=>({hide:t(s)})]),xt("y",()=>t(n),o=>q(n,o,!0)),b(_,a),z()}ot(["click"]);const st=kt();let St=[];const gt=localStorage.getItem("failedVisitCounts");if(gt!==null)try{St=JSON.parse(gt)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const ct=kt(St);ct.subscribe(_=>{localStorage.setItem("failedVisitCounts",JSON.stringify(_))});const Dt=_=>_==="doc"?"fas fa-file-word":_==="pdf"?"fas fa-file-pdf":_==="youtube"?"fa fa-youtube":"fas fa-link",te=async(_,e,n)=>{try{await pt(e.chord.url);const s=Mt(st),f=s.get(e.chord.url)||{count:0,lastAccessDateUnix:0};f.count++,f.lastAccessDateUnix=Date.now()/1e3,s.set(e.chord.url,f),st.set(s)}catch(s){let f=s.message;s instanceof Pt&&s.code===401?f="Invalid logged in user":s instanceof zt&&(f="User is logged out"),Lt(ct,[...n(),e.chord.url]);const D=`<strong>Visit not counted</strong><br/> ${f}`;Jt.push(D,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};var ee=S('<span></span> <span><a target="_blank" rel="noopener noreferrer"> </a></span>',1);function nt(_,e){P(e,!0);const n=()=>ft(ct,"$failedVisitCounts",s),[s,f]=yt();let D=vt(e,"showArtist",3,!1),w=M(void 0);st.subscribe(i=>{if(i&&i.has(e.chord.url)){const d=i.get(e.chord.url),y=new Date(d.lastAccessDateUnix*1e3);q(w,`visits: ${d.count} - last: ${y.toLocaleDateString()}`)}});const a=(D()?e.chord.artist+" - ":"")+e.chord.title,r=i=>i.type==="doc"?`${Rt}/docviewer/${i.url}`:i.url;var o=ee(),m=F(o),g=p(m,2),C=v(g);C.__click=[te,e,n];var u=v(C,!0);l(C),l(g),O((i,d)=>{ut(m,1,i,"svelte-et925i"),rt(C,"href",d),rt(C,"title",t(w)),U(u,a)},[()=>Ct(Dt(e.chord.type)),()=>r(e.chord)]),b(_,o),z(),f()}ot(["click"]);var re=S('<li class="ul2col-item"><!> <!></li>'),ae=S('<ul class="ul2col-container"></ul>');function se(_,e){P(e,!0);let n=vt(e,"chords",15),s=M(void 0);st.subscribe(a=>{a&&(q(s,a,!0),n(n().sort((r,o)=>{const m=a.get(r.url),g=a.get(o.url);return m&&g?g.lastAccessDateUnix-m.lastAccessDateUnix:m?-1:g?1:r.artist!=o.artist?r.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:r.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(a,r,o)=>o[a.type]===!1?!1:r.length===0||a.artist.toLowerCase().match(r.toLowerCase())?!0:a.title.toLowerCase().match(r.toLowerCase());var D=G(),w=F(D);ht(w,n,a=>{var r=ae();I(r,21,n,R,(o,m)=>{const g=tt(()=>t(s)?.get(t(m).url));var C=G(),u=F(C);{var i=d=>{var y=re(),c=v(y);{var h=x=>{var L=wt();O(()=>U(L,`(${t(g).count??""})`)),b(x,L)};J(c,x=>{t(g)&&x(h)})}var k=p(c,2);nt(k,{get chord(){return t(m)},showArtist:!0}),l(y),b(d,y)};J(u,d=>{f(t(m),e.searchString,e.filters)&&d(i)})}b(o,C)}),l(r),b(a,r)}),b(_,D),z()}const oe=(_,e)=>_<e?-1:_>e?1:0,Tt=(_,e)=>{const n=_.toLowerCase(),s=e.toLowerCase();return oe(n,s)};var ne=S('<li class="navigationBtn svelte-16xotip"><a class="navigationLink svelte-16xotip"> </a></li>'),le=S('<li class="ul2col-item"><!></li>'),ie=S('<ul class="ul2col-container"></ul>'),ce=S('<tr class="svelte-16xotip"><td class="svelte-16xotip"> <!></td></tr>'),ue=S('<ol id="indexList" class="navigationBar disable-scrollbars svelte-16xotip"></ol> <table id="artistTable"><tbody></tbody></table>',1);function ve(_,e){P(e,!0);let n=vt(e,"searchString",3,"");const s=e.chords.reduce((c,h)=>{const k=h.artist;return c[k]||(c[k]=[]),c[k].push(h),c},{}),f=[],D=Object.keys(s).sort(Tt).map((c,h,k)=>{if(h===0||c[0].toLowerCase()!=k[h-1][0].toLowerCase()){const x="anchor_letter_"+c[0];return f.push({letter:c[0],tag:x}),{name:c,tag:x}}return{name:c}});let w=M(0),a=M(0),r=M(void 0);const o=c=>{if(t(r)){var h=t(r).getBoundingClientRect();if(h.top<20){q(a,20);return}q(a,h.top,!0)}};bt(()=>o(t(w)));const m=(c,h,k)=>s[c].sort((L,A)=>L.title<A.title?-1:1).filter(L=>{const A=L.type;return k[A]===!1?!1:h.length===0?!0:!!L.title.toLowerCase().match(h.toLowerCase())}),g=(c,h)=>!!c.toLowerCase().match(h.toLowerCase());var C=ue(),u=F(C);let i;I(u,21,()=>f,R,(c,h)=>{var k=ne(),x=v(k),L=v(x,!0);l(x),l(k),O(A=>{rt(x,"href","#"+t(h).tag),U(L,A)},[()=>t(h).letter.toUpperCase()]),b(c,k)}),l(u);var d=p(u,2),y=v(d);I(y,21,()=>D,R,(c,h)=>{const k=tt(()=>m(t(h).name,n(),e.filters)),x=tt(()=>g(t(h).name,n()));var L=G(),A=F(L);{var E=Z=>{const $=tt(()=>t(x)?s[t(h).name]:t(k));var K=ce(),H=v(K),W=v(H),at=p(W);ht(at,n,N=>{var Q=ie();I(Q,21,()=>t($),R,(X,lt)=>{var T=le(),B=v(T);nt(B,{get chord(){return t(lt)}}),l(T),b(X,T)}),l(Q),b(N,Q)}),l(H),l(K),O(()=>{rt(H,"id",t(h).tag),U(W,`${t(h).name??""} `)}),b(Z,K)};J(A,Z=>{(t(x)||t(k).length>0)&&Z(E)})}b(c,L)}),l(y),l(d),Kt(d,c=>q(r,c),()=>t(r)),O(c=>i=dt(u,"",i,c),[()=>({"--barTop":`${t(a)??""}px`})]),xt("y",()=>t(w),c=>q(w,c,!0)),b(_,C),z()}var de=S('<li class="ul2col-item"><!></li>'),fe=S('<div><span> </span> <ul class="ul2col-container"></ul></div>');function me(_,e){P(e,!0);const n=w=>w.charAt(0).toUpperCase()+w.slice(1).toLowerCase(),s=et({});for(const w of e.chords)w.tags.forEach(r=>{s[r]||(s[r]=[]),s[r].push(w)});Object.keys(s).forEach(w=>{s[w].sort((a,r)=>{const o=a.artist.toLowerCase(),m=r.artist.toLowerCase(),g=a.title.toLowerCase(),C=r.title.toLowerCase();return o<m?-1:o>m?1:g<C?-1:1})});var f=G(),D=F(f);I(D,17,()=>Object.keys(s).sort(Tt),R,(w,a)=>{var r=G(),o=F(r);{var m=g=>{var C=fe(),u=v(C),i=v(u,!0);l(u);var d=p(u,2);I(d,21,()=>s[t(a)],R,(y,c)=>{var h=G(),k=F(h);{var x=L=>{var A=de(),E=v(A);nt(E,{get chord(){return t(c)},showArtist:!0}),l(A),b(L,A)};J(k,L=>{e.filters[t(c).type]&&L(x)})}b(y,h)}),l(d),l(C),O(y=>U(i,y),[()=>n(t(a))]),b(g,C)};J(o,g=>{(e.searchString.length===0||t(a).toLowerCase().match(e.searchString.toLowerCase()))&&g(m)})}b(w,r)}),b(_,f),z()}var he=S('<li class="ul2col-item"><!> <!></li>'),_e=S('<ul class="ul2col-container"></ul>');function ge(_,e){P(e,!0);let n=vt(e,"chords",15),s=M(void 0);st.subscribe(a=>{a&&(q(s,a,!0),n(n().sort((r,o)=>{const m=a.get(r.url),g=a.get(o.url);return m&&g?m.count!==g.count?g.count-m.count:g.lastAccessDateUnix-m.lastAccessDateUnix:m?-1:g?1:r.artist!=o.artist?r.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:r.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(a,r,o)=>o[a.type]===!1?!1:r.length===0||a.artist.toLowerCase().match(r.toLowerCase())?!0:a.title.toLowerCase().match(r.toLowerCase());var D=G(),w=F(D);ht(w,n,a=>{var r=_e();I(r,21,n,R,(o,m)=>{const g=tt(()=>t(s)?.get(t(m).url));var C=G(),u=F(C);{var i=d=>{var y=he(),c=v(y);{var h=x=>{var L=wt();O(()=>U(L,`(${t(g).count??""})`)),b(x,L)};J(c,x=>{t(g)&&x(h)})}var k=p(c,2);nt(k,{get chord(){return t(m)},showArtist:!0}),l(y),b(d,y)};J(u,d=>{f(t(m),e.searchString,e.filters)&&d(i)})}b(o,C)}),l(r),b(a,r)}),b(_,D),z()}var pe=S('<span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-161wm6q"> </span>',1),be=S('<div class="rows svelte-161wm6q"><span class="col table-head svelte-161wm6q">Last Check</span> <span class="col table-head svelte-161wm6q">Checks</span> <span class="col table-head svelte-161wm6q">Skipped</span> <span class="col table-head svelte-161wm6q">Errors</span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span></div> <br/> <div class="rows svelte-161wm6q"><span class="col table-head svelte-161wm6q">Status</span> <span class="col table-head svelte-161wm6q">Ref</span> <span class="col table-head svelte-161wm6q">Host</span> <span class="col table-head svelte-161wm6q">Data</span> <!></div>',1),we=S('<p style="color: red"> </p>'),ke=S("<p>Fetching results...</p>"),Ce=S('<div role="dialog" class="modal svelte-161wm6q"><div class="contents svelte-161wm6q"><h3 class="title-bar svelte-161wm6q">Urls checks <button>Close</button></h3> <!></div></div>');function ye(_,e){P(e,!0);const n=a=>{const r=new Date(a.timestamp);return r.toDateString()+" "+r.toTimeString()},s=a=>a.fails.sort((r,o)=>r.chord.url<o.chord.url?-1:1);var f=G(),D=F(f);{var w=a=>{var r=Ce(),o=v(r),m=v(o),g=p(v(m));g.__click=function(...u){e.close?.apply(this,u)},l(m);var C=p(m,2);Wt(C,Vt,u=>{var i=ke();b(u,i)},(u,i)=>{const d=tt(()=>n(t(i))),y=tt(()=>s(t(i)));var c=be(),h=F(c),k=p(v(h),8),x=v(k,!0);l(k);var L=p(k,2),A=v(L,!0);l(L);var E=p(L,2),Z=v(E,!0);l(E);var $=p(E,2),K=v($,!0);l($),l(h);var H=p(h,4),W=p(v(H),8);I(W,17,()=>t(y),R,(at,N)=>{var Q=pe(),X=F(Q),lt=v(X,!0);l(X);var T=p(X,2),B=v(T);l(T);var V=p(T,2),j=v(V),it=v(j,!0);l(j),l(V);var Y=p(V,2),qt=v(Y,!0);l(Y),O(At=>{U(lt,t(N).status),U(B,`${t(N).chord.artist??""} - ${t(N).chord.title??""}`),rt(j,"href",t(N).chord.url),U(it,new URL(t(N).chord.url).hostname),U(qt,At)},[()=>t(N).error?JSON.stringify(t(N).error):""]),b(at,Q)}),l(H),O(()=>{U(x,t(d)),U(A,t(i).nbChecks),U(Z,t(i).nbSkipped),U(K,t(i).nbFails)}),b(u,c)},(u,i)=>{var d=we(),y=v(d);l(d),O(()=>U(y,`Could not retrieve checks: ${t(i).message??""}`)),b(u,d)}),l(o),l(r),b(a,r)};J(D,a=>{e.isOpen&&a(w)})}b(_,f),z()}ot(["click"]);var Le=(_,e)=>e(),xe=S('<li class="ul2col-separator"> </li>'),Se=S('<!> <li class="ul2col-item"><!></li>',1),De=S('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function Te(_,e){P(e,!0);const n=Date.now(),s=1e3*3600*24*7,f=s*4,D=[{label:"last week",time:n-s},{label:"one month ago",time:n-f},{label:"two months ago",time:n-2*f},{label:"six months ago",time:n-6*f},{label:"one year ago",time:n-12*f}],w=e.chords.filter(i=>i.creationDate).sort((i,d)=>d.creationDate-i.creationDate).map((i,d,y)=>{const c={...i};if(d>0){const h=y[d-1];for(const{time:k,label:x}of D)h.creationDate>k&&i.creationDate<k&&(c.dateTag=x)}return c});let a=6,r=M(et([]));const o=()=>{a+=4,q(r,w.slice(0,a),!0)};mt(()=>{o()});var m=De(),g=v(m),C=p(v(g));C.__click=[Le,o],l(g);var u=p(g,2);I(u,21,()=>t(r),R,(i,d)=>{var y=Se(),c=F(y);{var h=L=>{var A=xe(),E=v(A,!0);l(A),O(()=>U(E,t(d).dateTag)),b(L,A)};J(c,L=>{t(d).dateTag&&L(h)})}var k=p(c,2),x=v(k);nt(x,{get chord(){return t(d)}}),l(k),b(i,y)}),l(u),l(m),b(_,m),z()}ot(["click"]);const qe=(_,e,n,s,f)=>{t(e).length<=n||(t(e).splice(t(e).length-n),q(s,t(e).slice(t(e).length-n).map(D=>f.chords[D]),!0))};var Ae=S("<button>&nbsp↶&nbsp</button>"),Be=S('<li class="ul2col-item"><!></li>'),Ve=S('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br/> <ul class="ul2col-container"></ul></div>');function Ue(_,e){P(e,!0);const n=6;let s=M(et([])),f=M(et([]));const D=()=>{t(s).length>=e.chords.length-n&&q(s,[],!0);for(let u=0;u<n;u++){let i=-1;for(;i===-1||t(s).includes(i);)i=Math.floor(Math.random()*e.chords.length);t(s).push(i)}q(f,t(s).slice(t(s).length-n).map(u=>e.chords[u]),!0)};mt(()=>{D()});var w=Ve(),a=v(w),r=p(v(a)),o=v(r);{var m=u=>{var i=Ae();i.__click=[qe,s,n,f,e],b(u,i)};J(o,u=>{t(s).length>n&&u(m)})}var g=p(o,2);g.__click=D,l(r),l(a);var C=p(a,4);I(C,21,()=>t(f),u=>u.url,(u,i)=>{var d=Be(),y=v(d);nt(y,{get chord(){return t(i)},showArtist:!0}),l(d),b(u,d)}),l(C),l(w),b(_,w),z()}ot(["click"]);var Me=()=>Et.open(ye),Oe=()=>Ht("/songbook/edit"),Fe=(_,e)=>q(e,""),je=(_,e,n)=>{t(e)[t(n)]=!t(e)[t(n)],q(e,t(e),!0)},Ee=S('<button class="filter-control svelte-1k2cvi7"><input type="checkbox"/> <span></span></button>'),Ne=(_,e,n)=>q(e,t(n),!0),Ie=S("<button> </button>"),Re=S('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"/> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1k2cvi7"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1k2cvi7"></div></div> <!>',1);function mr(_,e){P(e,!0);const n=()=>ft(ct,"$failedVisitCounts",f),s=()=>ft(Gt,"$user",f),[f,D]=yt();Qt.set("Songbook");const{chords:w}=e.data;let a=M(et([]));const r=T=>{t(a).push(T),q(a,t(a),!0),setTimeout(()=>{t(a).shift(),q(a,t(a),!0)},5e3)};mt(async()=>{try{if(n().length&&s()){r({level:"info",header:"Trying to count missed visits while logged out"});for(const T of n())await pt(T);r({level:"success",header:`Counted ${n().length} missed visits`}),Lt(ct,[])}}catch{r({level:"error",header:"Couldnt upload failed visit counts"})}try{const B=(await Ut()).reduce((V,j)=>(V.set(j.url,{...j}),V),new Map);st.set(B)}catch{r({level:"error",header:"Couldnt upload failed visit counts"})}});let o=M("");const m=[{label:"By artist",component:ve},{label:"By tags",component:me},{label:"By frequency",component:ge},{label:"By access date",component:se}];let g=M(et(m[0]));const C={pdf:!0,doc:!0,youtube:!0,link:!0};let u=M(et({...C}));const i=Object.keys(C);var d=Re(),y=F(d);Nt(y,{title:"Song Book",description:"My song book",iconPath:"/songbook.png"});var c=p(y,2),h=v(c),k=v(h);k.__click=[Me],dt(k,"",{},{position:"relative"});var x=p(k,2);x.__click=[Oe],dt(x,"",{},{position:"relative"}),l(h),l(c);var L=p(c,2);I(L,17,()=>t(a),R,(T,B)=>{It(T,{get item(){return t(B)}})});var A=p(L,2);$t(A,{});var E=p(A,2),Z=v(E);l(E);var $=p(E,2);Te($,{get chords(){return w}});var K=p($,2);Ue(K,{get chords(){return w}});var H=p(K,2),W=p(v(H),2);_t(W);var at=p(W,2);at.__click=[Fe,o];var N=p(at,2),Q=p(v(N),2);I(Q,17,()=>i,R,(T,B)=>{var V=Ee();V.__click=[je,u,B];var j=v(V);_t(j);var it=p(j,2);l(V),O(Y=>{rt(V,"aria-label",`filter for ${t(B)??""}`),rt(j,"id",t(B)),ut(it,1,Y,"svelte-1k2cvi7")},[()=>Ct(Dt(t(B)))]),jt(j,()=>t(u)[t(B)],Y=>t(u)[t(B)]=Y),b(T,V)}),l(N);var X=p(N,4);I(X,21,()=>m,R,(T,B)=>{var V=Ie();let j;V.__click=[Ne,g,B];var it=v(V,!0);l(V),O(Y=>{j=ut(V,1,"control svelte-1k2cvi7",null,j,Y),U(it,t(B).label)},[()=>({selected:t(g)===t(B)})]),b(T,V)}),l(X),l(H);var lt=p(H,2);Ot(lt,()=>t(g).component,(T,B)=>{B(T,{get chords(){return w},get searchString(){return t(o)},get filters(){return t(u)}})}),O(()=>U(Z,`This is a list of ${w.length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Ft(W,()=>t(o),T=>q(o,T)),b(_,d),z(),D()}ot(["click"]);export{mr as component,fr as universal};
