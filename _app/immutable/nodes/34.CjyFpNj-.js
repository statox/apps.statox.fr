import"../chunks/DsnmJJEf.js";import"../chunks/Bdxdj0h6.js";import{p as x,h as l,C as $,d as C,g as t,b as D,s as p,f as T,i as s,a as B}from"../chunks/C1Jxye1l.js";import{i as E}from"../chunks/BAFXAy0q.js";import{g as U}from"../chunks/CagW43ER.js";import"../chunks/BrfKzKPW.js";import{p as P}from"../chunks/rc8jUsVI.js";/* empty css                */import{A as j}from"../chunks/CYl4EDKT.js";import{r as u}from"../chunks/Z-lh6Sw0.js";import{b as m}from"../chunks/DeqYhWtL.js";import{F as I,a as R,c as q,s as G,h as H}from"../chunks/DcRy-_dq.js";import{A as N}from"../chunks/QnWVP2T3.js";import{t as A}from"../chunks/Dr9dkngU.js";import{g as V,u as z}from"../chunks/B6OQXK24.js";const J={type:"object",required:["artist","title","url","creationDate","tags"],additionalProperties:!1,properties:{artist:{type:"string",minLength:1},title:{type:"string",minLength:1},url:{type:"string",minLength:1},creationDate:{type:"number"},tags:{type:"array",items:{type:"string"}}}},L=new N,k=L.compile(J);function K(a){if(!k(a)){const e=L.errorsText(k.errors);throw new Error(`Invalid PersonalTracker data: ${e}`)}}const O=async a=>{try{K(a)}catch(e){const r=`<strong>Validation Error</strong><br/> ${e.message}`;throw A.push(r,{theme:{"--toastBarBackground":"#FF0000"}}),e}try{const e=await V(),r=[a,...e];await z({chords:r})}catch(e){let r=e.message;e instanceof j&&e.code===401&&(r="Invalid logged in user");const i=`<strong>Entry not created</strong><br/> ${r}`;A.push(i,{theme:{"--toastBarBackground":"#FF0000"}})}};var Q=D('<label for="artist">Artist</label> <input type="text"/> <label for="title">Title</label> <input type="text"/> <label for="url">URL</label> <input type="text"/> <label for="tags">Tags</label> <input type="text"/> <!>',1);function W(a,e){x(e,!0);let r=l(""),i=l(""),d=l(""),c=l(""),g=l(!1),n=l($([]));const M=async()=>{if(s(n,[],!0),t(r)||t(n).push({level:"error",header:"Title must be defined"}),t(i)||t(n).push({level:"error",header:"Artist must be defined"}),t(d)||t(n).push({level:"error",header:"URL must be defined"}),t(n).length)return;const h=t(c)?t(c).replaceAll(" ","").split(","):[],_={title:t(r),artist:t(i),url:t(d),tags:h,creationDate:Date.now()};try{s(g,!0),await O(_),G("Song added successfully"),e.onUpload()}catch(f){H(f)}finally{s(g,!1)}};I(a,{title:"Add a new song",backUrl:"/songbook/edit",authMessage:"Login to add a new song",get noticeMessages(){return t(n)},children:(h,_)=>{R(h,{children:(f,X)=>{var F=Q(),b=p(T(F),2);u(b);var y=p(b,4);u(y);var v=p(y,4);u(v);var w=p(v,4);u(w);var S=p(w,2);q(S,{onclick:M,get loading(){return t(g)}}),m(b,()=>t(i),o=>s(i,o)),m(y,()=>t(r),o=>s(r,o)),m(v,()=>t(d),o=>s(d,o)),m(w,()=>t(c),o=>s(c,o)),B(f,F)}})},$$slots:{default:!0}}),C()}function mt(a,e){x(e,!1);const r={name:"Songbook",description:"My collection of chords",showAuthInHeader:!0};P.set(r),E(),W(a,{onUpload:()=>U("/songbook/edit")}),C()}export{mt as component};
