import"../chunks/NZTpNUN0.js";import{p as re,g as b,G as B,h as t,b as O,s as f,i as P,r as _,t as N,a as M,F as he,e as i,d as ae,f as Q,a$ as fe,a_ as X,j as Y,c as ge}from"../chunks/tjCGPzdr.js";import{d as ne,s as L,e as be}from"../chunks/DOKer7p_.js";import{i as V}from"../chunks/BsrVr-Z0.js";import{e as oe,i as se}from"../chunks/An4e5j9g.js";import{r as Z,b as ie}from"../chunks/DKsZ4ghV.js";import{M as _e}from"../chunks/CJFchB7S.js";import{m as T,g as F,c as S,b as k,B as g,d as D,a as ye,n as we,e as Me,i as Ce,f as xe}from"../chunks/CBhOl9Kc.js";import{b as ee}from"../chunks/B25JaP4K.js";import"../chunks/CqiQQVFS.js";import{p as Pe}from"../chunks/CDdcYdZI.js";const Be=a=>{const n=F(a),e=Math.floor(Math.random()*n.length);return n[e]},ke=(a,n)=>{const e=Be(a);return{board:T(a,n,e),move:e}},Se=(a,n,e)=>{const r=Fe(a,n,e.iterations,e.c);return{board:T(a,n,r),move:r}};class le{board;player;move;parent;children=[];visits=0;wins=0;constructor(n,e,r=null,s=null){this.board=n,this.player=e,this.move=r,this.parent=s}isFullyExpanded(){return this.children.length===F(this.board).length}isTerminal(){return k(this.board)!==g.notOver}}function te(a,n,e,r=Math.sqrt(2)){return e===0?1/0:n/e+r*Math.sqrt(Math.log(a)/e)}function Te(a,n){for(;!a.isTerminal();)if(a.isFullyExpanded())a=qe(a,n);else return Ge(a);return a}function Ge(a){const n=a.children.map(c=>c.move),r=F(a.board).filter(c=>!n.includes(c)),s=r[Math.floor(Math.random()*r.length)],m=S(a.board);T(m,a.player,s);const l=new le(m,a.player===1?2:1,s,a);return a.children.push(l),l}function qe(a,n){return a.children.reduce((e,r)=>{const s=te(a.visits,e.wins,e.visits,n);return te(a.visits,r.wins,r.visits,n)>s?r:e})}function Ne(a){const n=S(a.board);let e=a.player;for(;;){const r=k(n);if(r!==g.notOver)return r;const s=F(n),m=s[Math.floor(Math.random()*s.length)];T(n,e,m),e=e===1?2:1}}function Oe(a,n){let e=a;for(;e!==null;)e.visits+=1,n===g.winPlayer1&&e.parent?.player===1||n===g.winPlayer2&&e.parent?.player===2?e.wins+=1:n===g.draw&&(e.wins+=.5),e=e.parent}function Fe(a,n,e=1e3,r=Math.sqrt(2)){const s=new le(S(a),n,null,null);for(let l=0;l<e;l++){const c=Te(s,r),u=Ne(c);Oe(c,u)}return s.children.reduce((l,c)=>l.visits>c.visits?l:c).move}var Re=(a,n,e,r,s)=>{t(n)&&(i(e,t(n).iterations,!0),i(r,t(n).c,!0),s())},Ee=O("<option> </option>"),He=(a,n,e)=>{i(n,null),e()},Ie=(a,n,e)=>{i(n,null),e()},Ue=O(`<div><h4>Monte Carlo Tree Search parameters</h4> <label for="mcts-preset">Preset difficulty</label> <select></select> <br/><br/> <label for="mcts-iterations">Iterations:</label> <input id="mcts-iterations" type="number" min="0"/> <small>Number of simulations MCTS will run before choosing a move. Higher values usually mean
        stronger play but slower decisions.</small> <br/><br/> <label for="mcts-c">C (exploration constant):</label> <input id="mcts-c" type="number" min="0" step="0.1"/> <small>Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
        favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2 ≈
        1.41.</small></div>`);function Ve(a,n){re(n,!0);const e=[{name:"easy",iterations:200,c:2},{name:"medium",iterations:1e3,c:1.41},{name:"hard",iterations:5e3,c:.7}];let r=b(B(e[1])),s=b(B(t(r).iterations)),m=b(B(t(r).c));const l=()=>{n.onUpdate({iterations:t(s),c:t(m)})};var c=Ue(),u=f(P(c),4);u.__change=[Re,r,s,m,l],oe(u,21,()=>e,se,(h,C)=>{var y=Ee(),G=P(y,!0);_(y);var q={};N(()=>{L(G,t(C).name),q!==(q=t(C))&&(y.value=(y.__value=t(C))??"")}),M(h,y)}),_(u);var p=f(u,7);Z(p),p.__change=[He,r,l];var d=f(p,9);Z(d),d.__change=[Ie,r,l],he(2),_(c),ie(u,()=>t(r),h=>i(r,h)),ee(p,()=>t(s),h=>i(s,h)),ee(d,()=>t(m),h=>i(m,h)),M(a,c),ae()}ne(["change"]);var De=O("<option> </option>"),Le=O('<!> <div class="main"><h3>Gravitrip</h3></div> <div>See <a href="https://www.quora.com/What-is-the-winning-strategy-for-the-first-player-in-Connect-Four-games">this quora thread</a> for some tips on the winning strategy</div> <div>Computer stategy: <select></select></div> <!> <span><button>New game</button> <button>Cancel move</button> <span style="font-weight: bold"><!></span></span> <!>',1);function et(a,n){re(n,!0),Pe.set("Gravitrip");let e=b(B(D())),r=b(B([])),s=X(()=>k(t(e))),m=X(()=>xe(t(e))),l=b("mcts"),c=b(B({iterations:1e3,c:1.41})),u=b(1),p=1,d=2;const h=()=>{i(e,D(),!0),i(r,[],!0),i(u,1),[p,d]=[d,p],d===t(u)&&W()},C=(o,v)=>{t(r).push({board:S(o),moveByPlayer:v}),i(r,t(r),!0)},y=()=>{t(r).length===1&&t(r)[t(r).length-1].moveByPlayer===d||(t(r)[t(r).length-1].moveByPlayer===d&&t(r).pop(),t(r).length&&t(r)[t(r).length-1].moveByPlayer===p&&t(r).pop(),i(r,t(r),!0),t(r).length===0?i(e,D(),!0):i(e,S(t(r)[t(r).length-1].board),!0))},G=()=>i(u,t(u)===1?2:1,!0),q=o=>{p===t(u)&&Ce(t(e),o)&&k(t(e))===g.notOver&&(i(e,T(t(e),p,o),!0),C(t(e),p),G(),setTimeout(()=>W(),200))},W=()=>{if(d!==t(u)||k(t(e))!==g.notOver)return;let o;if(t(l)==="random")o=ke(t(e),t(u));else if(t(l)==="mcts")o=Se(t(e),t(u),t(c));else throw new Error("computer strategy not implemented");const{board:v}=o;i(e,v,!0),C(t(e),d),G()},ce=o=>{switch(o.key){case"r":h();break}};var j=Le();be("keydown",fe,ce);var A=Q(j);_e(A,{title:"Gravitrip",description:"Gravitrip"});var R=f(A,6),E=f(P(R));oe(E,20,()=>["mcts","random"],se,(o,v)=>{var w=De(),U=P(w,!0);_(w);var x={};N(()=>{L(U,v),x!==(x=v)&&(w.value=(w.__value=v)??"")}),M(o,w)}),_(E),_(R);var K=f(R,2);{var ue=o=>{Ve(o,{onUpdate:v=>i(c,v,!0)})};V(K,o=>{t(l)==="mcts"&&o(ue)})}var H=f(K,2),$=P(H);$.__click=h;var I=f($,2);I.__click=y;var z=f(I,2),ve=P(z);{var me=o=>{var v=Y("Game Over");M(o,v)},pe=o=>{var v=ge(),w=Q(v);{var U=x=>{var J=Y();N(()=>L(J,`Player ${t(s)??""} wins`)),M(x,J)};V(w,x=>{(t(s)===g.winPlayer1||t(s)===g.winPlayer2)&&x(U)},!0)}M(o,v)};V(ve,o=>{t(s)===g.draw?o(me):o(pe,!1)})}_(z),_(H);var de=f(H,2);ye(de,{get nbColumns(){return Me},get nbRows(){return we},get board(){return t(e)},get winningCells(){return t(m)},onMove:q}),N(()=>I.disabled=t(r).length===0),ie(E,()=>t(l),o=>i(l,o)),M(a,j),ae()}ne(["click"]);export{et as component};
