import{g as Bt,u as pt,a as Vt,b as Ut}from"../chunks/Lxgydr2u.js";import"../chunks/NZTpNUN0.js";import{o as ft}from"../chunks/CVDCh7bQ.js";import{p as z,k as bt,g as t,b as x,t as O,a as p,d as H,i as A,h as M,f as F,s as _,e as d,r as o,c as G,u as $,j as wt,a5 as tt}from"../chunks/OOCdeaM4.js";import{d as ot,w as kt,s as U,g as Mt}from"../chunks/DBBHR-3t.js";import{e as j,i as N}from"../chunks/80iJqotc.js";import{c as Ot}from"../chunks/BuKKo_mU.js";import{s as et,r as gt}from"../chunks/C2XHBoXy.js";import{s as ut,c as Ct,a as dt}from"../chunks/DazWBkG7.js";import{b as Ft,c as It}from"../chunks/CCHh_OeQ.js";import{s as yt,b as Lt,a as mt}from"../chunks/BY6cWyRb.js";import{m as Et}from"../chunks/Dg7M2ZgA.js";import{a as xt}from"../chunks/DpMDsIYA.js";import{M as Rt}from"../chunks/C8MJLfl1.js";import{M as jt}from"../chunks/DKcpRBkl.js";import{i as P}from"../chunks/BMFH8sZT.js";import{k as ht}from"../chunks/Ct21G3Rc.js";import{p as vt}from"../chunks/CFDm-sZd.js";import{b as Nt,g as Jt}from"../chunks/uzpfujBj.js";import{t as Pt}from"../chunks/Du_j8uFv.js";import{A as zt,U as Ht}from"../chunks/BI4tYcJk.js";import"../chunks/DPSdUY9Q.js";import{u as Gt}from"../chunks/bMdrnNxv.js";import{b as Kt}from"../chunks/BZoYCivA.js";import{a as Wt}from"../chunks/Bfiui_HV.js";import"../chunks/DRxGxY2p.js";import"../chunks/BuN-Fgeb.js";import{p as Qt}from"../chunks/Zs3ZkE6R.js";const Xt=!1,Yt=async()=>({chords:await Bt()}),ir=Object.freeze(Object.defineProperty({__proto__:null,load:Yt,ssr:Xt},Symbol.toStringTag,{value:"Module"}));var Zt=x('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1vskasp"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1vskasp">Back to top</span></button>');function $t(k,s){z(s,!0);let u=M(0),i=M(!0),C;const T=l=>{l>0?A(i,!1):A(i,!0),C&&clearTimeout(C),C=setTimeout(()=>{A(i,!0)},3e3)},b=()=>{const l=document.documentElement.scrollTop||document.body.scrollTop;l>0&&(window.requestAnimationFrame(b),window.scrollTo(0,l-l/2))};bt(()=>T(t(u)));var r=Zt();let e;r.__click=b,O(()=>e=ut(r,1,"top-link svelte-1vskasp",null,e,{hide:t(i)})),xt("y",()=>t(u),l=>A(u,l,!0)),p(k,r),H()}ot(["click"]);const st=kt();let St=[];const _t=localStorage.getItem("failedVisitCounts");if(_t!==null)try{St=JSON.parse(_t)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const ct=kt(St);ct.subscribe(k=>{localStorage.setItem("failedVisitCounts",JSON.stringify(k))});const Dt=k=>k==="doc"?"fas fa-file-word":k==="pdf"?"fas fa-file-pdf":k==="youtube"?"fa fa-youtube":"fas fa-link";var te=x('<span></span> <span><a target="_blank" rel="noopener noreferrer"> </a></span>',1);function nt(k,s){z(s,!0);const u=()=>mt(ct,"$failedVisitCounts",i),[i,C]=yt();let T=vt(s,"showArtist",3,!1),b=M(void 0);st.subscribe(a=>{if(a&&a.has(s.chord.url)){const v=a.get(s.chord.url),n=new Date(v.lastAccessDateUnix*1e3);A(b,`visits: ${v.count} - last: ${n.toLocaleDateString()}`)}});const r=(T()?s.chord.artist+" - ":"")+s.chord.title,e=a=>a.type==="doc"?`${Nt}/docviewer/${a.url}`:a.url,l=async()=>{try{await pt({url:s.chord.url});const a=Mt(st),v=a.get(s.chord.url)||{count:0,lastAccessDateUnix:0};v.count++,v.lastAccessDateUnix=Date.now()/1e3,a.set(s.chord.url,v),st.set(a)}catch(a){let v=a.message;a instanceof zt&&a.code===401?v="Invalid logged in user":a instanceof Ht&&(v="User is logged out"),Lt(ct,[...u(),s.chord.url]);const n=`<strong>Visit not counted</strong><br/> ${v}`;Pt.push(n,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};var m=te(),g=F(m),S=_(g,2),f=d(S);f.__click=l;var c=d(f,!0);o(f),o(S),O((a,v)=>{ut(g,1,a,"svelte-et925i"),et(f,"href",v),et(f,"title",t(b)),U(c,r)},[()=>Ct(Dt(s.chord.type)),()=>e(s.chord)]),p(k,m),H(),C()}ot(["click"]);var ee=x('<li class="ul2col-item"><!> <!></li>'),re=x('<ul class="ul2col-container"></ul>');function ae(k,s){z(s,!0);let u=vt(s,"chords",15),i=M(void 0);st.subscribe(r=>{r&&(A(i,r,!0),u(u().sort((e,l)=>{const m=r.get(e.url),g=r.get(l.url);return m&&g?g.lastAccessDateUnix-m.lastAccessDateUnix:m?-1:g?1:e.artist!=l.artist?e.artist.toLowerCase()<l.artist.toLowerCase()?-1:1:e.title.toLowerCase()<l.title.toLowerCase()?-1:1})))});const C=(r,e,l)=>l[r.type]===!1?!1:e.length===0||r.artist.toLowerCase().match(e.toLowerCase())?!0:r.title.toLowerCase().match(e.toLowerCase());var T=G(),b=F(T);ht(b,u,r=>{var e=re();j(e,21,u,N,(l,m)=>{const g=$(()=>t(i)?.get(t(m).url));var S=G(),f=F(S);{var c=a=>{var v=ee(),n=d(v);{var h=L=>{var y=wt();O(()=>U(y,`(${t(g).count??""})`)),p(L,y)};P(n,L=>{t(g)&&L(h)})}var w=_(n,2);nt(w,{get chord(){return t(m)},showArtist:!0}),o(v),p(a,v)};P(f,a=>{C(t(m),s.searchString,s.filters)&&a(c)})}p(l,S)}),o(e),p(r,e)}),p(k,T),H()}const se=(k,s)=>k<s?-1:k>s?1:0,Tt=(k,s)=>{const u=k.toLowerCase(),i=s.toLowerCase();return se(u,i)};var oe=x('<li class="navigationBtn svelte-16xotip"><a class="navigationLink svelte-16xotip"> </a></li>'),ne=x('<li class="ul2col-item"><!></li>'),le=x('<ul class="ul2col-container"></ul>'),ie=x('<tr class="svelte-16xotip"><td class="svelte-16xotip"> <!></td></tr>'),ce=x('<ol id="indexList" class="navigationBar disable-scrollbars svelte-16xotip"></ol> <table id="artistTable"><tbody></tbody></table>',1);function ue(k,s){z(s,!0);let u=vt(s,"searchString",3,"");const i=s.chords.reduce((n,h)=>{const w=h.artist;return n[w]||(n[w]=[]),n[w].push(h),n},{}),C=[],T=Object.keys(i).sort(Tt).map((n,h,w)=>{if(h===0||n[0].toLowerCase()!=w[h-1][0].toLowerCase()){const L="anchor_letter_"+n[0];return C.push({letter:n[0],tag:L}),{name:n,tag:L}}return{name:n}});let b=M(0),r=M(0),e=M(void 0);const l=n=>{if(t(e)){var h=t(e).getBoundingClientRect();if(h.top<20){A(r,20);return}A(r,h.top,!0)}};bt(()=>l(t(b)));const m=(n,h,w)=>i[n].sort((y,B)=>y.title<B.title?-1:1).filter(y=>{const B=y.type;return w[B]===!1?!1:h.length===0?!0:!!y.title.toLowerCase().match(h.toLowerCase())}),g=(n,h)=>!!n.toLowerCase().match(h.toLowerCase());var S=ce(),f=F(S);let c;j(f,21,()=>C,N,(n,h)=>{var w=oe(),L=d(w),y=d(L,!0);o(L),o(w),O(B=>{et(L,"href","#"+t(h).tag),U(y,B)},[()=>t(h).letter.toUpperCase()]),p(n,w)}),o(f);var a=_(f,2),v=d(a);j(v,21,()=>T,N,(n,h)=>{const w=$(()=>m(t(h).name,u(),s.filters)),L=$(()=>g(t(h).name,u()));var y=G(),B=F(y);{var E=Y=>{const Z=$(()=>t(L)?i[t(h).name]:t(w));var K=ie(),J=d(K),W=d(J),rt=_(W);ht(rt,u,R=>{var Q=le();j(Q,21,()=>t(Z),N,(X,lt)=>{var D=ne(),q=d(D);nt(q,{get chord(){return t(lt)}}),o(D),p(X,D)}),o(Q),p(R,Q)}),o(J),o(K),O(()=>{et(J,"id",t(h).tag),U(W,`${t(h).name??""} `)}),p(Y,K)};P(B,Y=>{(t(L)||t(w).length>0)&&Y(E)})}p(n,y)}),o(v),o(a),Kt(a,n=>A(e,n),()=>t(e)),O(()=>c=dt(f,"",c,{"--barTop":`${t(r)??""}px`})),xt("y",()=>t(b),n=>A(b,n,!0)),p(k,S),H()}var ve=x('<li class="ul2col-item"><!></li>'),de=x('<div><span> </span> <ul class="ul2col-container"></ul></div>');function me(k,s){z(s,!0);const u=b=>b.charAt(0).toUpperCase()+b.slice(1).toLowerCase(),i=tt({});for(const b of s.chords)b.tags.forEach(e=>{i[e]||(i[e]=[]),i[e].push(b)});Object.keys(i).forEach(b=>{i[b].sort((r,e)=>{const l=r.artist.toLowerCase(),m=e.artist.toLowerCase(),g=r.title.toLowerCase(),S=e.title.toLowerCase();return l<m?-1:l>m?1:g<S?-1:1})});var C=G(),T=F(C);j(T,17,()=>Object.keys(i).sort(Tt),N,(b,r)=>{var e=G(),l=F(e);{var m=g=>{var S=de(),f=d(S),c=d(f,!0);o(f);var a=_(f,2);j(a,21,()=>i[t(r)],N,(v,n)=>{var h=G(),w=F(h);{var L=y=>{var B=ve(),E=d(B);nt(E,{get chord(){return t(n)},showArtist:!0}),o(B),p(y,B)};P(w,y=>{s.filters[t(n).type]&&y(L)})}p(v,h)}),o(a),o(S),O(v=>U(c,v),[()=>u(t(r))]),p(g,S)};P(l,g=>{(s.searchString.length===0||t(r).toLowerCase().match(s.searchString.toLowerCase()))&&g(m)})}p(b,e)}),p(k,C),H()}var fe=x('<li class="ul2col-item"><!> <!></li>'),he=x('<ul class="ul2col-container"></ul>');function ge(k,s){z(s,!0);let u=vt(s,"chords",15),i=M(void 0);st.subscribe(r=>{r&&(A(i,r,!0),u(u().sort((e,l)=>{const m=r.get(e.url),g=r.get(l.url);return m&&g?m.count!==g.count?g.count-m.count:g.lastAccessDateUnix-m.lastAccessDateUnix:m?-1:g?1:e.artist!=l.artist?e.artist.toLowerCase()<l.artist.toLowerCase()?-1:1:e.title.toLowerCase()<l.title.toLowerCase()?-1:1})))});const C=(r,e,l)=>l[r.type]===!1?!1:e.length===0||r.artist.toLowerCase().match(e.toLowerCase())?!0:r.title.toLowerCase().match(e.toLowerCase());var T=G(),b=F(T);ht(b,u,r=>{var e=he();j(e,21,u,N,(l,m)=>{const g=$(()=>t(i)?.get(t(m).url));var S=G(),f=F(S);{var c=a=>{var v=fe(),n=d(v);{var h=L=>{var y=wt();O(()=>U(y,`(${t(g).count??""})`)),p(L,y)};P(n,L=>{t(g)&&L(h)})}var w=_(n,2);nt(w,{get chord(){return t(m)},showArtist:!0}),o(v),p(a,v)};P(f,a=>{C(t(m),s.searchString,s.filters)&&a(c)})}p(l,S)}),o(e),p(r,e)}),p(k,T),H()}var _e=x('<span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-161wm6q"> </span>',1),pe=x('<div class="rows svelte-161wm6q"><span class="col table-head svelte-161wm6q">Last Check</span> <span class="col table-head svelte-161wm6q">Checks</span> <span class="col table-head svelte-161wm6q">Skipped</span> <span class="col table-head svelte-161wm6q">Errors</span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span> <span class="col svelte-161wm6q"> </span></div> <br/> <div class="rows svelte-161wm6q"><span class="col table-head svelte-161wm6q">Status</span> <span class="col table-head svelte-161wm6q">Ref</span> <span class="col table-head svelte-161wm6q">Host</span> <span class="col table-head svelte-161wm6q">Data</span> <!></div>',1),be=x('<p style="color: red"> </p>'),we=x("<p>Fetching results...</p>"),ke=x('<div role="dialog" class="modal svelte-161wm6q"><div class="contents svelte-161wm6q"><h3 class="title-bar svelte-161wm6q">Urls checks <button>Close</button></h3> <!></div></div>');function Ce(k,s){z(s,!0);const u=r=>{const e=new Date(r.timestamp);return e.toDateString()+" "+e.toTimeString()},i=r=>r.fails.sort((e,l)=>e.chord.url<l.chord.url?-1:1);var C=G(),T=F(C);{var b=r=>{var e=ke(),l=d(e),m=d(l),g=_(d(m));g.__click=function(...f){s.close?.apply(this,f)},o(m);var S=_(m,2);Wt(S,Vt,f=>{var c=we();p(f,c)},(f,c)=>{const a=$(()=>u(t(c))),v=$(()=>i(t(c)));var n=pe(),h=F(n),w=_(d(h),8),L=d(w,!0);o(w);var y=_(w,2),B=d(y,!0);o(y);var E=_(y,2),Y=d(E,!0);o(E);var Z=_(E,2),K=d(Z,!0);o(Z),o(h);var J=_(h,4),W=_(d(J),8);j(W,17,()=>t(v),N,(rt,R)=>{var Q=_e(),X=F(Q),lt=d(X,!0);o(X);var D=_(X,2),q=d(D);o(D);var V=_(D,2),I=d(V),it=d(I,!0);o(I),o(V);var at=_(V,2),qt=d(at,!0);o(at),O(At=>{U(lt,t(R).status),U(q,`${t(R).chord.artist??""} - ${t(R).chord.title??""}`),et(I,"href",t(R).chord.url),U(it,new URL(t(R).chord.url).hostname),U(qt,At)},[()=>t(R).error?JSON.stringify(t(R).error):""]),p(rt,Q)}),o(J),O(()=>{U(L,t(a)),U(B,t(c).nbChecks),U(Y,t(c).nbSkipped),U(K,t(c).nbFails)}),p(f,n)},(f,c)=>{var a=be(),v=d(a);o(a),O(()=>U(v,`Could not retrieve checks: ${t(c).message??""}`)),p(f,a)}),o(l),o(e),p(r,e)};P(T,r=>{s.isOpen&&r(b)})}p(k,C),H()}ot(["click"]);var ye=x('<li class="ul2col-separator"> </li>'),Le=x('<!> <li class="ul2col-item"><!></li>',1),xe=x('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function Se(k,s){z(s,!0);const u=Date.now(),i=1e3*3600*24*7,C=i*4,T=[{label:"last week",time:u-i},{label:"one month ago",time:u-C},{label:"two months ago",time:u-2*C},{label:"six months ago",time:u-6*C},{label:"one year ago",time:u-12*C}],b=s.chords.filter(c=>c.creationDate).sort((c,a)=>a.creationDate-c.creationDate).map((c,a,v)=>{const n={...c};if(a>0){const h=v[a-1];for(const{time:w,label:L}of T)h.creationDate>w&&c.creationDate<w&&(n.dateTag=L)}return n});let r=6,e=M(tt([]));const l=()=>{r+=4,A(e,b.slice(0,r),!0)};ft(()=>{l()});var m=xe(),g=d(m),S=_(d(g));S.__click=()=>l(),o(g);var f=_(g,2);j(f,21,()=>t(e),N,(c,a)=>{var v=Le(),n=F(v);{var h=y=>{var B=ye(),E=d(B,!0);o(B),O(()=>U(E,t(a).dateTag)),p(y,B)};P(n,y=>{t(a).dateTag&&y(h)})}var w=_(n,2),L=d(w);nt(L,{get chord(){return t(a)}}),o(w),p(c,v)}),o(f),o(m),p(k,m),H()}ot(["click"]);var De=x("<button>&nbspâ†¶&nbsp</button>"),Te=x('<li class="ul2col-item"><!></li>'),qe=x('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br/> <ul class="ul2col-container"></ul></div>');function Ae(k,s){z(s,!0);const u=6;let i=M(tt([])),C=M(tt([]));const T=()=>{t(i).length>=s.chords.length-u&&A(i,[],!0);for(let c=0;c<u;c++){let a=-1;for(;a===-1||t(i).includes(a);)a=Math.floor(Math.random()*s.chords.length);t(i).push(a)}A(C,t(i).slice(t(i).length-u).map(c=>s.chords[c]),!0)},b=()=>{t(i).length<=u||(t(i).splice(t(i).length-u),A(C,t(i).slice(t(i).length-u).map(c=>s.chords[c]),!0))};ft(()=>{T()});var r=qe(),e=d(r),l=_(d(e)),m=d(l);{var g=c=>{var a=De();a.__click=b,p(c,a)};P(m,c=>{t(i).length>u&&c(g)})}var S=_(m,2);S.__click=T,o(l),o(e);var f=_(e,4);j(f,21,()=>t(C),c=>c.url,(c,a)=>{var v=Te(),n=d(v);nt(n,{get chord(){return t(a)},showArtist:!0}),o(v),p(c,v)}),o(f),o(r),p(k,r),H()}ot(["click"]);var Be=x('<button class="filter-control svelte-1k2cvi7"><input type="checkbox"/> <span></span></button>'),Ve=x("<button> </button>"),Ue=x('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"/> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1k2cvi7"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1k2cvi7"></div></div> <!>',1);function cr(k,s){z(s,!0);const u=()=>mt(ct,"$failedVisitCounts",C),i=()=>mt(Gt,"$user",C),[C,T]=yt();Qt.set("Songbook");const{chords:b}=s.data;let r=M(tt([]));const e=D=>{t(r).push(D),A(r,t(r),!0),setTimeout(()=>{t(r).shift(),A(r,t(r),!0)},5e3)};ft(async()=>{try{if(u().length&&i()){e({level:"info",header:"Trying to count missed visits while logged out"});for(const D of u())await pt({url:D});e({level:"success",header:`Counted ${u().length} missed visits`}),Lt(ct,[])}}catch{e({level:"error",header:"Couldnt upload failed visit counts"})}try{const q=(await Ut()).reduce((V,I)=>(V.set(I.url,{...I}),V),new Map);st.set(q)}catch{e({level:"error",header:"Couldnt upload failed visit counts"})}});let l=M("");const m=[{label:"By artist",component:ue},{label:"By tags",component:me},{label:"By frequency",component:ge},{label:"By access date",component:ae}];let g=M(tt(m[0]));const S={pdf:!0,doc:!0,youtube:!0,link:!0};let f=M(tt({...S}));const c=Object.keys(S);var a=Ue(),v=F(a);Rt(v,{title:"Song Book",description:"My song book",iconPath:"/songbook.png"});var n=_(v,2),h=d(n),w=d(h);w.__click=()=>Et.open(Ce),dt(w,"",{},{position:"relative"});var L=_(w,2);L.__click=()=>Jt("/songbook/edit"),dt(L,"",{},{position:"relative"}),o(h),o(n);var y=_(n,2);j(y,17,()=>t(r),N,(D,q)=>{jt(D,{get item(){return t(q)}})});var B=_(y,2);$t(B,{});var E=_(B,2),Y=d(E);o(E);var Z=_(E,2);Se(Z,{get chords(){return b}});var K=_(Z,2);Ae(K,{get chords(){return b}});var J=_(K,2),W=_(d(J),2);gt(W);var rt=_(W,2);rt.__click=()=>A(l,"");var R=_(rt,2),Q=_(d(R),2);j(Q,17,()=>c,N,(D,q)=>{var V=Be();V.__click=()=>{t(f)[t(q)]=!t(f)[t(q)],A(f,t(f),!0)};var I=d(V);gt(I);var it=_(I,2);o(V),O(at=>{et(V,"aria-label",`filter for ${t(q)??""}`),et(I,"id",t(q)),ut(it,1,at,"svelte-1k2cvi7")},[()=>Ct(Dt(t(q)))]),It(I,()=>t(f)[t(q)],at=>t(f)[t(q)]=at),p(D,V)}),o(R);var X=_(R,4);j(X,21,()=>m,N,(D,q)=>{var V=Ve();let I;V.__click=()=>A(g,t(q),!0);var it=d(V,!0);o(V),O(()=>{I=ut(V,1,"control svelte-1k2cvi7",null,I,{selected:t(g)===t(q)}),U(it,t(q).label)}),p(D,V)}),o(X),o(J);var lt=_(J,2);Ot(lt,()=>t(g).component,(D,q)=>{q(D,{get chords(){return b},get searchString(){return t(l)},get filters(){return t(f)}})}),O(()=>U(Y,`This is a list of ${b.length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Ft(W,()=>t(l),D=>A(l,D)),p(k,a),H(),T()}ot(["click"]);export{cr as component,ir as universal};
