import"../chunks/disclose-version.Bg9kRutz.js";import{i as V}from"../chunks/legacy.EqIdVoM0.js";import{m as z,y as M,x as B,ae as u,z as c,af as f,g as e,s as L,ag as O,a5 as J,w as Z,v as ee}from"../chunks/index-client.S3REcJgE.js";import{c as T,a as n,e as P,t as x}from"../chunks/template.B5pchg3w.js";import{i as F}from"../chunks/if.BYsj_AMu.js";import{s as H,a as G}from"../chunks/store.BAWuPd1l.js";import{c as K,o as te}from"../chunks/store.DF07ihmy.js";import{M as N,u as W,U as ae}from"../chunks/Main.B2sGk2W4.js";import{e as R,i as X}from"../chunks/each.Nz7c8l4p.js";import{r as re}from"../chunks/attributes.BZLGEmLx.js";import{b as se}from"../chunks/input.DW_zkP8F.js";import{p as S}from"../chunks/props.C2aoZBXh.js";import{r as oe,a as ne,A as ie}from"../chunks/index.0z9Cp9wp.js";import{t as ve}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.NDn5vnUv.js";import{D as Y}from"../chunks/datetime.CJSQP4eG.js";import{s as C}from"../chunks/render.CF6uZz0T.js";import{a as le}from"../chunks/await.BGm15oIX.js";const de=async m=>ne({path:"/personalTracker/upload",data:{event:m}}),Q=async()=>{const{events:m}=await oe({path:"/personalTracker/getAll",authorize:!0});return m};var me=x('<button class="form-action svelte-1cixduj">Submit</button>'),ce=x('<span class="form-action svelte-1cixduj">Login to upload an entry</span>'),ue=x('<div role="dialog" class="modal svelte-1cixduj"><div class="contents svelte-1cixduj"><h4 class="title-bar svelte-1cixduj">Add a new event <button>Close</button></h4> <!> <form class="form-content svelte-1cixduj"><label for="weight">Weight</label> <input type="number" step="0.1"> <br> <!></form></div></div>');function fe(m,p){z(p,!1);const[U,k]=H(),A=()=>G(W,"$user",U);let g=S(p,"isOpen",8),$=S(p,"onUpload",8),i=O([]),s=O();const _=async()=>{if(L(i,[]),e(s)!==Number(e(s).toFixed(1))&&e(i).push({level:"error",header:"Value have at most 1 number after the comma"}),(e(s)<80||e(s)>110)&&e(i).push({level:"error",header:"Value must be in kg"}),e(i).length)return;const t=Y.now().toUTC().toUnixInteger();try{await de({timestampUTC:t,type:"weight",value:Math.floor(e(s)*100)}),$()(),K()}catch(a){let d=a.message;a instanceof ie&&a.code===401?d="Invalid logged in user":a instanceof ae&&(d="User is logged out");const b=`<strong>Entry not created</strong><br/> ${d}`;ve.push(b,{theme:{"--toastBarBackground":"#FF0000"}})}};V();var h=T(),v=M(h);{var l=t=>{var a=ue(),d=u(a),b=u(d),E=c(u(b));f(b);var w=c(b,2);R(w,1,()=>e(i),X,(r,o)=>{N(r,{get item(){return e(o)}})});var D=c(w,2),y=c(u(D),2);re(y);var I=c(y,4);{var j=r=>{var o=me();P("click",o,_),n(r,o)},q=r=>{var o=ce();n(r,o)};F(I,r=>{A()?r(j):r(q,!1)})}f(D),f(d),f(a),P("click",E,function(...r){var o;(o=K)==null||o.apply(this,r)}),se(y,()=>e(s),r=>L(s,r)),n(t,a)};F(v,t=>{g()&&t(l)})}n(m,h),B(),k()}var pe=x('<div class="event svelte-1lfnev1"><div class="event-date"> </div> <div class="event-type"> </div> <div class="event-value"> </div></div>'),ge=x('<div class="event svelte-1lfnev1"><div>Date</div> <div>Type</div> <div>Value</div></div> <!>',1),_e=x("<p>Loading events</p>");function he(m,p){z(p,!1);const[U,k]=H(),A=()=>G(W,"$user",U);let g=S(p,"events",8);V();var $=T(),i=M($);{var s=_=>{var h=T(),v=M(h);le(v,g,l=>{var t=_e();n(l,t)},(l,t)=>{var a=ge(),d=c(M(a),2);R(d,1,()=>e(t),X,(b,E)=>{var w=pe();const D=J(()=>Y.fromSeconds(e(E).eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm"));var y=u(w),I=u(y,!0);f(y);var j=c(y,2),q=u(j,!0);f(j);var r=c(j,2),o=u(r,!0);f(r),f(w),Z(()=>{C(I,e(D)),C(q,e(E).type),C(o,e(E).value)}),n(b,w)}),n(l,a)},(l,t)=>{var a=J(()=>({level:"error",header:"Something went wrong getting events",message:e(t)}));N(l,{get item(){return e(a)}})}),n(_,h)};F(i,_=>{A()&&g()&&_(s)})}n(m,$),B(),k()}var be=x("<div><button>Add an entry</button></div> <!>",1);function Oe(m,p){z(p,!1);const[U,k]=H(),A=()=>G(W,"$user",U);let g=O();const $=()=>L(g,Q());ee(()=>L(g,Q())),V();var i=T(),s=M(i);{var _=v=>{var l=be(),t=M(l),a=u(t);f(t);var d=c(t,2);he(d,{get events(){return e(g)}}),P("click",a,()=>te(fe,{onUpload:$})),n(v,l)},h=v=>{N(v,{item:{level:"info",header:"Login to add an entry or see events"}})};F(s,v=>{A()?v(_):v(h,!1)})}n(m,i),B(),k()}export{Oe as component};
