import"../chunks/NZTpNUN0.js";import{o as Q}from"../chunks/DnIoD-SE.js";import{p as S,b as P,W as R,f as x,a as V,d as u,s as c,r as f,g as e,c as T,e as W,t as X}from"../chunks/BTM_f0C0.js";import{d as N}from"../chunks/fpD4cHwH.js";import{c as $,a as v,f as _}from"../chunks/g3ICtxBO.js";import{i as F}from"../chunks/D_G27x0v.js";import{a as q,s as B}from"../chunks/CapB82rd.js";import{m as Y}from"../chunks/BpEBPVAn.js";import{u as H}from"../chunks/DRYpzuxW.js";import{M as O}from"../chunks/Ci27vOOA.js";import{e as j,i as z}from"../chunks/DqKhQ2eq.js";import{r as Z}from"../chunks/DbSpTE_I.js";import{b as ee}from"../chunks/BekeXsjs.js";import{r as te,a as ae,A as re,U as oe}from"../chunks/BQcXWaIU.js";import{t as se}from"../chunks/CA9Q8rd-.js";import{D as J}from"../chunks/DTyfSRsR.js";import{s as I}from"../chunks/DjCmUVr5.js";import{a as ne}from"../chunks/C_ggnHlx.js";const ie=async l=>ae({path:"/personalTracker/upload",data:{event:l},isUnauthenticatedCall:!0}),G=async()=>{const{events:l}=await te({path:"/personalTracker/getAll"});return l};var ve=_('<button class="form-action svelte-3t0xi3">Submit</button>'),le=_('<span class="form-action svelte-3t0xi3">Login to upload an entry</span>'),me=_('<div role="dialog" class="modal svelte-3t0xi3"><div class="contents svelte-3t0xi3"><h4 class="title-bar svelte-3t0xi3">Add a new event <button>Close</button></h4> <!> <form class="form-content svelte-3t0xi3"><label for="weight">Weight</label> <input type="number" step="0.1"/> <br/> <!></form></div></div>');function de(l,n){S(n,!0);const k=()=>B(H,"$user",U),[U,w]=q();let s=P(R([])),i=P(0);const h=async()=>{if(T(s,[],!0),e(i)!==Number(e(i).toFixed(1))&&e(s).push({level:"error",header:"Value have at most 1 number after the comma"}),(e(i)<80||e(i)>110)&&e(s).push({level:"error",header:"Value must be in kg"}),e(s).length)return;const t=J.now().toUTC().toUnixInteger();try{await ie({timestampUTC:t,type:"weight",value:Math.floor(e(i)*100)}),n.onUpload(),n.close()}catch(a){let r=a.message;a instanceof re&&a.code===401?r="Invalid logged in user":a instanceof oe&&(r="User is logged out");const m=`<strong>Entry not created</strong><br/> ${r}`;se.push(m,{theme:{"--toastBarBackground":"#FF0000"}})}};var p=$(),b=x(p);{var A=t=>{var a=me(),r=u(a),m=u(r),M=c(u(m));M.__click=function(...o){n.close?.apply(this,o)},f(m);var y=c(m,2);j(y,17,()=>e(s),z,(o,d)=>{O(o,{get item(){return e(d)}})});var L=c(y,2),g=c(u(L),2);Z(g);var E=c(g,4);{var C=o=>{var d=ve();d.__click=h,v(o,d)},D=o=>{var d=le();v(o,d)};F(E,o=>{k()?o(C):o(D,!1)})}f(L),f(r),f(a),ee(g,()=>e(i),o=>T(i,o)),v(t,a)};F(b,t=>{n.isOpen&&t(A)})}v(l,p),V(),w()}N(["click"]);var ce=_('<div class="event svelte-cyscl8"><div class="event-date"> </div> <div class="event-type"> </div> <div class="event-value"> </div></div>'),ue=_('<div class="event svelte-cyscl8"><div>Date</div> <div>Type</div> <div>Value</div></div> <!>',1),fe=_("<p>Loading events</p>");function pe(l,n){S(n,!0);const k=()=>B(H,"$user",U),[U,w]=q();var s=$(),i=x(s);{var h=p=>{var b=$(),A=x(b);ne(A,()=>n.events,t=>{var a=fe();v(t,a)},(t,a)=>{var r=ue(),m=c(x(r),2);j(m,17,()=>e(a),z,(M,y)=>{const L=W(()=>J.fromSeconds(e(y).eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm"));var g=ce(),E=u(g),C=u(E,!0);f(E);var D=c(E,2),o=u(D,!0);f(D);var d=c(D,2),K=u(d,!0);f(d),f(g),X(()=>{I(C,e(L)),I(o,e(y).type),I(K,e(y).value)}),v(M,g)}),v(t,r)},(t,a)=>{{let r=W(()=>({level:"error",header:"Something went wrong getting events",message:e(a)}));O(t,{get item(){return e(r)}})}}),v(p,b)};F(i,p=>{k()&&n.events&&p(h)})}v(l,s),V(),w()}var ge=_("<div><button>Add an entry</button></div> <!>",1);function Pe(l,n){S(n,!0);const k=()=>B(H,"$user",U),[U,w]=q();let s=P(void 0);const i=()=>T(s,G(),!0);Q(()=>T(s,G(),!0));var h=$(),p=x(h);{var b=t=>{var a=ge(),r=x(a),m=u(r);m.__click=()=>Y.open(de,{onUpload:i}),f(r);var M=c(r,2);pe(M,{get events(){return e(s)}}),v(t,a)},A=t=>{O(t,{item:{level:"info",header:"Login to add an entry or see events"}})};F(p,t=>{k()?t(b):t(A,!1)})}v(l,h),V(),w()}N(["click"]);export{Pe as component};
