import"../chunks/NZTpNUN0.js";import{o as R}from"../chunks/np3e4Z_M.js";import{p as B,h as V,a8 as X,c as L,f as x,a as v,d as H,b as _,e as d,s as c,r as u,g as e,i as $,u as W,t as Y}from"../chunks/Brv8g2mx.js";import{d as q,s as C}from"../chunks/BlLNWVag.js";import{i as F}from"../chunks/D2xXzMMK.js";import{s as I,a as N}from"../chunks/DgiLbMs0.js";import{m as Z}from"../chunks/DhJDjgwN.js";import{u as O}from"../chunks/CJkfdpIC.js";import{M as P}from"../chunks/BASEAKL1.js";import{e as z,i as G}from"../chunks/CjXiWo-Z.js";import{r as ee}from"../chunks/BJ0eyrNi.js";import{b as te}from"../chunks/DLiMpzP4.js";import{A as re,U as ae}from"../chunks/BI4tYcJk.js";import{c as J}from"../chunks/DPSdUY9Q.js";import{t as oe}from"../chunks/D_MrBeRO.js";import{D as K}from"../chunks/DTyfSRsR.js";import{a as se}from"../chunks/VNWGfoUl.js";import"../chunks/DxsUBIQY.js";import"../chunks/Do6AdLXA.js";import{p as ne}from"../chunks/DWDG2EIs.js";const ie=J.personalTracker.upload,j=async()=>{const{events:p}=await J.personalTracker.getAll();return p};var ve=_('<button class="form-action svelte-3t0xi3">Submit</button>'),le=_('<span class="form-action svelte-3t0xi3">Login to upload an entry</span>'),me=_('<div role="dialog" class="modal svelte-3t0xi3"><div class="contents svelte-3t0xi3"><h4 class="title-bar svelte-3t0xi3">Add a new event <button>Close</button></h4> <!> <form class="form-content svelte-3t0xi3"><label for="weight">Weight</label> <input type="number" step="0.1"/> <br/> <!></form></div></div>');function ce(p,n){B(n,!0);const k=()=>N(O,"$user",w),[w,U]=I();let s=V(X([])),i=V(0);const h=async()=>{if($(s,[],!0),e(i)!==Number(e(i).toFixed(1))&&e(s).push({level:"error",header:"Value have at most 1 number after the comma"}),(e(i)<80||e(i)>110)&&e(s).push({level:"error",header:"Value must be in kg"}),e(s).length)return;const t=K.now().toUTC().toUnixInteger();try{await ie({event:{timestampUTC:t,type:"weight",value:Math.floor(e(i)*100)}}),n.onUpload(),n.close()}catch(r){let a=r.message;r instanceof re&&r.code===401?a="Invalid logged in user":r instanceof ae&&(a="User is logged out");const l=`<strong>Entry not created</strong><br/> ${a}`;oe.push(l,{theme:{"--toastBarBackground":"#FF0000"}})}};var f=L(),b=x(f);{var M=t=>{var r=me(),a=d(r),l=d(a),E=c(d(l));E.__click=function(...o){n.close?.apply(this,o)},u(l);var y=c(l,2);z(y,17,()=>e(s),G,(o,m)=>{P(o,{get item(){return e(m)}})});var D=c(y,2),g=c(d(D),2);ee(g);var T=c(g,4);{var S=o=>{var m=ve();m.__click=h,v(o,m)},A=o=>{var m=le();v(o,m)};F(T,o=>{k()?o(S):o(A,!1)})}u(D),u(a),u(r),te(g,()=>e(i),o=>$(i,o)),v(t,r)};F(b,t=>{n.isOpen&&t(M)})}v(p,f),H(),U()}q(["click"]);var de=_('<div class="event svelte-cyscl8"><div class="event-date"> </div> <div class="event-type"> </div> <div class="event-value"> </div></div>'),ue=_('<div class="event svelte-cyscl8"><div>Date</div> <div>Type</div> <div>Value</div></div> <!>',1),fe=_("<p>Loading events</p>");function pe(p,n){B(n,!0);const k=()=>N(O,"$user",w),[w,U]=I();var s=L(),i=x(s);{var h=f=>{var b=L(),M=x(b);se(M,()=>n.events,t=>{var r=fe();v(t,r)},(t,r)=>{var a=ue(),l=c(x(a),2);z(l,17,()=>e(r),G,(E,y)=>{const D=W(()=>K.fromSeconds(e(y).eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm"));var g=de(),T=d(g),S=d(T,!0);u(T);var A=c(T,2),o=d(A,!0);u(A);var m=c(A,2),Q=d(m,!0);u(m),u(g),Y(()=>{C(S,e(D)),C(o,e(y).type),C(Q,e(y).value)}),v(E,g)}),v(t,a)},(t,r)=>{{let a=W(()=>({level:"error",header:"Something went wrong getting events",message:e(r)}));P(t,{get item(){return e(a)}})}}),v(f,b)};F(i,f=>{k()&&n.events&&f(h)})}v(p,s),H(),U()}var ge=_("<div><button>Add an entry</button></div> <!>",1);function He(p,n){B(n,!0);const k=()=>N(O,"$user",w),[w,U]=I();let s=V(void 0);ne.set("Personal Tracker");const i=()=>$(s,j(),!0);R(()=>$(s,j(),!0));var h=L(),f=x(h);{var b=t=>{var r=ge(),a=x(r),l=d(a);l.__click=()=>Z.open(ce,{onUpload:i}),u(a);var E=c(a,2);pe(E,{get events(){return e(s)}}),v(t,r)},M=t=>{P(t,{item:{level:"info",header:"Login to add an entry or see events"}})};F(f,t=>{k()?t(b):t(M,!1)})}v(p,h),H(),U()}q(["click"]);export{He as component};
