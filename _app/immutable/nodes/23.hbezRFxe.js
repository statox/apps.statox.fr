import{g as Vt,u as pt,a as Ut,b as qt}from"../chunks/DytZHO-x.js";import"../chunks/CWj6FrbW.js";import{o as ht}from"../chunks/CaQVVKkx.js";import{p as P,F as bt,v as S,w as M,i as t,a as b,x as z,C as F,g as A,f as O,y as p,G as d,H as l,c as K,aR as $,aV as kt,E as tt}from"../chunks/CGiGqk7P.js";import{d as ot,e as wt,s as q,g as Ft}from"../chunks/C57t7CU5.js";import{e as j,i as I}from"../chunks/ZXkaPWj7.js";import{c as Mt}from"../chunks/n8MjQ9XY.js";import{c as ut,d as Ct,a as et,s as dt,r as _t}from"../chunks/BbjtQk7y.js";import{b as Ot,d as Et}from"../chunks/SGPRxWVV.js";import{a as ft,s as yt,b as Lt}from"../chunks/Bo8eQkir.js";import{m as Nt}from"../chunks/DSzLtnmD.js";import{a as xt}from"../chunks/Dp3j2964.js";import{M as Rt}from"../chunks/B9EAvH6I.js";import{M as jt}from"../chunks/BLNcyNr3.js";import{i as J}from"../chunks/Cc712tkr.js";import{k as gt}from"../chunks/DtT9taq-.js";import{p as vt}from"../chunks/DzVEKABi.js";import{b as It,g as Ht}from"../chunks/DNuAwZD8.js";import{t as Jt}from"../chunks/DcgF9Wk6.js";import{A as Pt}from"../chunks/DULH4Exk.js";import{U as zt,u as Gt}from"../chunks/DPC4cLuF.js";import{b as Kt}from"../chunks/l_ii1tqG.js";import{a as Wt}from"../chunks/DaaYWjuU.js";import"../chunks/DyVAq43h.js";import{p as Qt}from"../chunks/DIQnpm5d.js";const Xt=!1,Yt=async()=>({chords:await Vt()}),fr=Object.freeze(Object.defineProperty({__proto__:null,load:Yt,ssr:Xt},Symbol.toStringTag,{value:"Module"}));var Zt=S('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1kbb9q3"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1kbb9q3">Back to top</span></button>');function $t(_,e){P(e,!0);let i=F(0),s=F(!0),f;const D=o=>{o>0?A(s,!1):A(s,!0),f&&clearTimeout(f),f=setTimeout(()=>{A(s,!0)},3e3)},k=()=>{const o=document.documentElement.scrollTop||document.body.scrollTop;o>0&&(window.requestAnimationFrame(k),window.scrollTo(0,o-o/2))};bt(()=>D(t(i)));var a=Zt();let r;a.__click=k,M(o=>r=ut(a,1,"top-link svelte-1kbb9q3",null,r,o),[()=>({hide:t(s)})]),xt("y",()=>t(i),o=>A(i,o,!0)),b(_,a),z()}ot(["click"]);const st=wt();let St=[];const mt=localStorage.getItem("failedVisitCounts");if(mt!==null)try{St=JSON.parse(mt)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const ct=wt(St);ct.subscribe(_=>{localStorage.setItem("failedVisitCounts",JSON.stringify(_))});const Dt=_=>_==="doc"?"fas fa-file-word":_==="pdf"?"fas fa-file-pdf":_==="youtube"?"fa fa-youtube":"fas fa-link",te=async(_,e,i)=>{try{await pt(e.chord.url);const s=Ft(st),f=s.get(e.chord.url)||{count:0,lastAccessDateUnix:0};f.count++,f.lastAccessDateUnix=Date.now()/1e3,s.set(e.chord.url,f),st.set(s)}catch(s){let f=s.message;s instanceof Pt&&s.code===401?f="Invalid logged in user":s instanceof zt&&(f="User is logged out"),Lt(ct,[...i(),e.chord.url]);const D=`<strong>Visit not counted</strong><br/> ${f}`;Jt.push(D,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};var ee=S('<span></span> <span><a target="_blank" rel="noopener noreferrer"> </a></span>',1);function nt(_,e){P(e,!0);const[i,s]=yt(),f=()=>ft(ct,"$failedVisitCounts",i);let D=vt(e,"showArtist",3,!1),k=F(void 0);st.subscribe(n=>{if(n&&n.has(e.chord.url)){const c=n.get(e.chord.url),y=new Date(c.lastAccessDateUnix*1e3);A(k,`visits: ${c.count} - last: ${y.toLocaleDateString()}`)}});const a=(D()?e.chord.artist+" - ":"")+e.chord.title,r=n=>n.type==="doc"?`${It}/docviewer/${n.url}`:n.url;var o=ee(),h=O(o),m=p(h,2),C=d(m);C.__click=[te,e,f];var v=d(C,!0);l(C),l(m),M((n,c)=>{ut(h,1,n,"svelte-1yqqigs"),et(C,"href",c),et(C,"title",t(k)),q(v,a)},[()=>Ct(Dt(e.chord.type)),()=>r(e.chord)]),b(_,o),z(),s()}ot(["click"]);var re=S('<li class="ul2col-item"><!> <!></li>'),ae=S('<ul class="ul2col-container"></ul>');function se(_,e){P(e,!0);let i=vt(e,"chords",15),s=F(void 0);st.subscribe(a=>{a&&(A(s,a,!0),i(i().sort((r,o)=>{const h=a.get(r.url),m=a.get(o.url);return h&&m?m.lastAccessDateUnix-h.lastAccessDateUnix:h?-1:m?1:r.artist!=o.artist?r.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:r.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(a,r,o)=>o[a.type]===!1?!1:r.length===0||a.artist.toLowerCase().match(r.toLowerCase())?!0:a.title.toLowerCase().match(r.toLowerCase());var D=K(),k=O(D);gt(k,i,a=>{var r=ae();j(r,21,i,I,(o,h)=>{var m=K();const C=$(()=>{var c;return(c=t(s))==null?void 0:c.get(t(h).url)});var v=O(m);{var n=c=>{var y=re(),u=d(y);{var g=x=>{var L=kt();M(()=>q(L,`(${t(C).count??""})`)),b(x,L)};J(u,x=>{t(C)&&x(g)})}var w=p(u,2);nt(w,{get chord(){return t(h)},showArtist:!0}),l(y),b(c,y)};J(v,c=>{f(t(h),e.searchString,e.filters)&&c(n)})}b(o,m)}),l(r),b(a,r)}),b(_,D),z()}const oe=(_,e)=>_<e?-1:_>e?1:0,Tt=(_,e)=>{const i=_.toLowerCase(),s=e.toLowerCase();return oe(i,s)};var ne=S('<li class="navigationBtn svelte-1deg5s8"><a class="navigationLink svelte-1deg5s8"> </a></li>'),le=S('<li class="ul2col-item"><!></li>'),ie=S('<ul class="ul2col-container"></ul>'),ce=S('<tr class="svelte-1deg5s8"><td class="svelte-1deg5s8"> <!></td></tr>'),ue=S('<ol id="indexList" class="navigationBar disable-scrollbars svelte-1deg5s8"></ol> <table id="artistTable"><tbody></tbody></table>',1);function ve(_,e){P(e,!0);let i=vt(e,"searchString",3,"");const s=e.chords.reduce((u,g)=>{const w=g.artist;return u[w]||(u[w]=[]),u[w].push(g),u},{}),f=[],D=Object.keys(s).sort(Tt).map((u,g,w)=>{if(g===0||u[0].toLowerCase()!=w[g-1][0].toLowerCase()){const x="anchor_letter_"+u[0];return f.push({letter:u[0],tag:x}),{name:u,tag:x}}return{name:u}});let k=F(0),a=F(0),r=F(void 0);const o=u=>{if(t(r)){var g=t(r).getBoundingClientRect();if(g.top<20){A(a,20);return}A(a,g.top,!0)}};bt(()=>o(t(k)));const h=(u,g,w)=>s[u].sort((L,B)=>L.title<B.title?-1:1).filter(L=>{const B=L.type;return w[B]===!1?!1:g.length===0?!0:!!L.title.toLowerCase().match(g.toLowerCase())}),m=(u,g)=>!!u.toLowerCase().match(g.toLowerCase());var C=ue(),v=O(C);let n;j(v,21,()=>f,I,(u,g)=>{var w=ne(),x=d(w),L=d(x,!0);l(x),l(w),M(B=>{et(x,"href","#"+t(g).tag),q(L,B)},[()=>t(g).letter.toUpperCase()]),b(u,w)}),l(v);var c=p(v,2),y=d(c);j(y,21,()=>D,I,(u,g)=>{var w=K();const x=$(()=>h(t(g).name,i(),e.filters)),L=$(()=>m(t(g).name,i()));var B=O(w);{var N=Z=>{var G=ce();const rt=$(()=>t(L)?s[t(g).name]:t(x));var H=d(G),W=d(H),at=p(W);gt(at,i,R=>{var Q=ie();j(Q,21,()=>t(rt),I,(X,lt)=>{var T=le(),V=d(T);nt(V,{get chord(){return t(lt)}}),l(T),b(X,T)}),l(Q),b(R,Q)}),l(H),l(G),M(()=>{et(H,"id",t(g).tag),q(W,`${t(g).name??""} `)}),b(Z,G)};J(B,Z=>{(t(L)||t(x).length>0)&&Z(N)})}b(u,w)}),l(y),l(c),Kt(c,u=>A(r,u),()=>t(r)),M(()=>n=dt(v,"",n,{"--barTop":`${t(a)??""}px`})),xt("y",()=>t(k),u=>A(k,u,!0)),b(_,C),z()}var de=S('<li class="ul2col-item"><!></li>'),fe=S('<div><span> </span> <ul class="ul2col-container"></ul></div>');function he(_,e){P(e,!0);const i=k=>k.charAt(0).toUpperCase()+k.slice(1).toLowerCase(),s=tt({});for(const k of e.chords)k.tags.forEach(r=>{s[r]||(s[r]=[]),s[r].push(k)});Object.keys(s).forEach(k=>{s[k].sort((a,r)=>{const o=a.artist.toLowerCase(),h=r.artist.toLowerCase(),m=a.title.toLowerCase(),C=r.title.toLowerCase();return o<h?-1:o>h?1:m<C?-1:1})});var f=K(),D=O(f);j(D,17,()=>Object.keys(s).sort(Tt),I,(k,a)=>{var r=K(),o=O(r);{var h=m=>{var C=fe(),v=d(C),n=d(v,!0);l(v);var c=p(v,2);j(c,21,()=>s[t(a)],I,(y,u)=>{var g=K(),w=O(g);{var x=L=>{var B=de(),N=d(B);nt(N,{get chord(){return t(u)},showArtist:!0}),l(B),b(L,B)};J(w,L=>{e.filters[t(u).type]&&L(x)})}b(y,g)}),l(c),l(C),M(y=>q(n,y),[()=>i(t(a))]),b(m,C)};J(o,m=>{(e.searchString.length===0||t(a).toLowerCase().match(e.searchString.toLowerCase()))&&m(h)})}b(k,r)}),b(_,f),z()}var ge=S('<li class="ul2col-item"><!> <!></li>'),_e=S('<ul class="ul2col-container"></ul>');function me(_,e){P(e,!0);let i=vt(e,"chords",15),s=F(void 0);st.subscribe(a=>{a&&(A(s,a,!0),i(i().sort((r,o)=>{const h=a.get(r.url),m=a.get(o.url);return h&&m?h.count!==m.count?m.count-h.count:m.lastAccessDateUnix-h.lastAccessDateUnix:h?-1:m?1:r.artist!=o.artist?r.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:r.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(a,r,o)=>o[a.type]===!1?!1:r.length===0||a.artist.toLowerCase().match(r.toLowerCase())?!0:a.title.toLowerCase().match(r.toLowerCase());var D=K(),k=O(D);gt(k,i,a=>{var r=_e();j(r,21,i,I,(o,h)=>{var m=K();const C=$(()=>{var c;return(c=t(s))==null?void 0:c.get(t(h).url)});var v=O(m);{var n=c=>{var y=ge(),u=d(y);{var g=x=>{var L=kt();M(()=>q(L,`(${t(C).count??""})`)),b(x,L)};J(u,x=>{t(C)&&x(g)})}var w=p(u,2);nt(w,{get chord(){return t(h)},showArtist:!0}),l(y),b(c,y)};J(v,c=>{f(t(h),e.searchString,e.filters)&&c(n)})}b(o,m)}),l(r),b(a,r)}),b(_,D),z()}var pe=S('<span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-5k8p3l"> </span>',1),be=S('<div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Last Check</span> <span class="col table-head svelte-5k8p3l">Checks</span> <span class="col table-head svelte-5k8p3l">Skipped</span> <span class="col table-head svelte-5k8p3l">Errors</span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span></div> <br/> <div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Status</span> <span class="col table-head svelte-5k8p3l">Ref</span> <span class="col table-head svelte-5k8p3l">Host</span> <span class="col table-head svelte-5k8p3l">Data</span> <!></div>',1),ke=S('<p style="color: red"> </p>'),we=S("<p>Fetching results...</p>"),Ce=S('<div role="dialog" class="modal svelte-5k8p3l"><div class="contents svelte-5k8p3l"><h3 class="title-bar svelte-5k8p3l">Urls checks <button>Close</button></h3> <!></div></div>');function ye(_,e){P(e,!0);const i=a=>{const r=new Date(a.timestamp);return r.toDateString()+" "+r.toTimeString()},s=a=>a.fails.sort((r,o)=>r.chord.url<o.chord.url?-1:1);var f=K(),D=O(f);{var k=a=>{var r=Ce(),o=d(r),h=d(o),m=p(d(h));m.__click=function(...v){var n;(n=e.close)==null||n.apply(this,v)},l(h);var C=p(h,2);Wt(C,Ut,v=>{var n=we();b(v,n)},(v,n)=>{var c=be();const y=$(()=>i(t(n))),u=$(()=>s(t(n)));var g=O(c),w=p(d(g),8),x=d(w,!0);l(w);var L=p(w,2),B=d(L,!0);l(L);var N=p(L,2),Z=d(N,!0);l(N);var G=p(N,2),rt=d(G,!0);l(G),l(g);var H=p(g,4),W=p(d(H),8);j(W,17,()=>t(u),I,(at,R)=>{var Q=pe(),X=O(Q),lt=d(X,!0);l(X);var T=p(X,2),V=d(T);l(T);var U=p(T,2),E=d(U),it=d(E,!0);l(E),l(U);var Y=p(U,2),At=d(Y,!0);l(Y),M(Bt=>{q(lt,t(R).status),q(V,`${t(R).chord.artist??""} - ${t(R).chord.title??""}`),et(E,"href",t(R).chord.url),q(it,new URL(t(R).chord.url).hostname),q(At,Bt)},[()=>t(R).error?JSON.stringify(t(R).error):""]),b(at,Q)}),l(H),M(()=>{q(x,t(y)),q(B,t(n).nbChecks),q(Z,t(n).nbSkipped),q(rt,t(n).nbFails)}),b(v,c)},(v,n)=>{var c=ke(),y=d(c);l(c),M(()=>q(y,`Could not retrieve checks: ${t(n).message??""}`)),b(v,c)}),l(o),l(r),b(a,r)};J(D,a=>{e.isOpen&&a(k)})}b(_,f),z()}ot(["click"]);var Le=(_,e)=>e(),xe=S('<li class="ul2col-separator"> </li>'),Se=S('<!> <li class="ul2col-item"><!></li>',1),De=S('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function Te(_,e){P(e,!0);const i=Date.now(),s=1e3*3600*24*7,f=s*4,D=[{label:"last week",time:i-s},{label:"one month ago",time:i-f},{label:"two months ago",time:i-2*f},{label:"six months ago",time:i-6*f},{label:"one year ago",time:i-12*f}],k=e.chords.filter(n=>n.creationDate).sort((n,c)=>c.creationDate-n.creationDate).map((n,c,y)=>{const u={...n};if(c>0){const g=y[c-1];for(const{time:w,label:x}of D)g.creationDate>w&&n.creationDate<w&&(u.dateTag=x)}return u});let a=6,r=F(tt([]));const o=()=>{a+=4,A(r,k.slice(0,a),!0)};ht(()=>{o()});var h=De(),m=d(h),C=p(d(m));C.__click=[Le,o],l(m);var v=p(m,2);j(v,21,()=>t(r),I,(n,c)=>{var y=Se(),u=O(y);{var g=L=>{var B=xe(),N=d(B,!0);l(B),M(()=>q(N,t(c).dateTag)),b(L,B)};J(u,L=>{t(c).dateTag&&L(g)})}var w=p(u,2),x=d(w);nt(x,{get chord(){return t(c)}}),l(w),b(n,y)}),l(v),l(h),b(_,h),z()}ot(["click"]);const Ae=(_,e,i,s,f)=>{t(e).length<=i||(t(e).splice(t(e).length-i),A(s,t(e).slice(t(e).length-i).map(D=>f.chords[D]),!0))};var Be=S("<button>&nbsp↶&nbsp</button>"),Ve=S('<li class="ul2col-item"><!></li>'),Ue=S('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br/> <ul class="ul2col-container"></ul></div>');function qe(_,e){P(e,!0);const i=6;let s=F(tt([])),f=F(tt([]));const D=()=>{t(s).length>=e.chords.length-i&&A(s,[],!0);for(let v=0;v<i;v++){let n=-1;for(;n===-1||t(s).includes(n);)n=Math.floor(Math.random()*e.chords.length);t(s).push(n)}A(f,t(s).slice(t(s).length-i).map(v=>e.chords[v]),!0)};ht(()=>{D()});var k=Ue(),a=d(k),r=p(d(a)),o=d(r);{var h=v=>{var n=Be();n.__click=[Ae,s,i,f,e],b(v,n)};J(o,v=>{t(s).length>i&&v(h)})}var m=p(o,2);m.__click=D,l(r),l(a);var C=p(a,4);j(C,21,()=>t(f),v=>v.url,(v,n)=>{var c=Ve(),y=d(c);nt(y,{get chord(){return t(n)},showArtist:!0}),l(c),b(v,c)}),l(C),l(k),b(_,k),z()}ot(["click"]);var Fe=()=>Nt.open(ye),Me=()=>Ht("/songbook/edit"),Oe=(_,e)=>A(e,""),Ee=(_,e,i)=>{t(e)[t(i)]=!t(e)[t(i)],A(e,t(e),!0)},Ne=S('<button class="filter-control svelte-1gfqv35"><input type="checkbox"/> <span></span></button>'),Re=(_,e,i)=>A(e,t(i),!0),je=S("<button> </button>"),Ie=S('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"/> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1gfqv35"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1gfqv35"></div></div> <!>',1);function hr(_,e){P(e,!0);const[i,s]=yt(),f=()=>ft(ct,"$failedVisitCounts",i),D=()=>ft(Gt,"$user",i);Qt.set("Songbook");const{chords:k}=e.data;let a=F(tt([]));const r=T=>{t(a).push(T),A(a,t(a),!0),setTimeout(()=>{t(a).shift(),A(a,t(a),!0)},5e3)};ht(async()=>{try{if(f().length&&D()){r({level:"info",header:"Trying to count missed visits while logged out"});for(const T of f())await pt(T);r({level:"success",header:`Counted ${f().length} missed visits`}),Lt(ct,[])}}catch{r({level:"error",header:"Couldnt upload failed visit counts"})}try{const V=(await qt()).reduce((U,E)=>(U.set(E.url,{...E}),U),new Map);st.set(V)}catch{r({level:"error",header:"Couldnt upload failed visit counts"})}});let o=F("");const h=[{label:"By artist",component:ve},{label:"By tags",component:he},{label:"By frequency",component:me},{label:"By access date",component:se}];let m=F(tt(h[0]));const C={pdf:!0,doc:!0,youtube:!0,link:!0};let v=F(tt({...C}));const n=Object.keys(C);var c=Ie(),y=O(c);Rt(y,{title:"Song Book",description:"My song book",iconPath:"/songbook.png"});var u=p(y,2),g=d(u),w=d(g);w.__click=[Fe],dt(w,"",{},{position:"relative"});var x=p(w,2);x.__click=[Me],dt(x,"",{},{position:"relative"}),l(g),l(u);var L=p(u,2);j(L,17,()=>t(a),I,(T,V)=>{jt(T,{get item(){return t(V)}})});var B=p(L,2);$t(B,{});var N=p(B,2),Z=d(N);l(N);var G=p(N,2);Te(G,{get chords(){return k}});var rt=p(G,2);qe(rt,{get chords(){return k}});var H=p(rt,2),W=p(d(H),2);_t(W);var at=p(W,2);at.__click=[Oe,o];var R=p(at,2),Q=p(d(R),2);j(Q,17,()=>n,I,(T,V)=>{var U=Ne();U.__click=[Ee,v,V];var E=d(U);_t(E);var it=p(E,2);l(U),M(Y=>{et(U,"aria-label",`filter for ${t(V)??""}`),et(E,"id",t(V)),ut(it,1,Y,"svelte-1gfqv35")},[()=>Ct(Dt(t(V)))]),Et(E,()=>t(v)[t(V)],Y=>t(v)[t(V)]=Y),b(T,U)}),l(R);var X=p(R,4);j(X,21,()=>h,I,(T,V)=>{var U=je();let E;U.__click=[Re,m,V];var it=d(U,!0);l(U),M(Y=>{E=ut(U,1,"control svelte-1gfqv35",null,E,Y),q(it,t(V).label)},[()=>({selected:t(m)===t(V)})]),b(T,U)}),l(X),l(H);var lt=p(H,2);Mt(lt,()=>t(m).component,(T,V)=>{V(T,{get chords(){return k},get searchString(){return t(o)},get filters(){return t(v)}})}),M(()=>q(Z,`This is a list of ${k.length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Ot(W,()=>t(o),T=>A(o,T)),b(_,c),z(),s()}ot(["click"]);export{hr as component,fr as universal};
