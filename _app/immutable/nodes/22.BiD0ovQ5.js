import"../chunks/NZTpNUN0.js";import{o as L,a as N}from"../chunks/l_nJxuHZ.js";import{p as P,b as S,e as r,s as v,t as R,a as x,d as M,r as l,n as W,b7 as O,bv as q,i as T,h as U,g as z,c as K,f as D,Y as H}from"../chunks/DnM7dGtc.js";import{d as C,s as Q,e as Y}from"../chunks/6Z5RDsVp.js";import{s as V,a as G}from"../chunks/BNctEiaO.js";import{m as J}from"../chunks/DT0uYGbH.js";import{r as X}from"../chunks/IQ_nNP8V.js";import{b as $}from"../chunks/Dkhza57w.js";import{p as E}from"../chunks/CEEedFV0.js";import{i as Z}from"../chunks/lY64Rcfk.js";import{P as tt}from"../chunks/B0j9Kjiu.js";import{T as et}from"../chunks/DP3j-b_7.js";import{M as it}from"../chunks/CaSjwZ6Z.js";import"../chunks/CKAZmBfe.js";import"../chunks/Cidogj0H.js";import{p as at}from"../chunks/BLVtKp5L.js";/* empty css                */import"../chunks/CmfuKG-C.js";class nt{audioContext;notesInQueue=[];currentBeatInBar;beatsPerBar;currentSubdivision;subdivisionsInBeat;tempo;lookahead;scheduleAheadTime;nextNoteTime;isRunning;intervalID;onBeatStart;onBeatEnd;constructor(t=80){this.audioContext=null,this.notesInQueue=[],this.currentBeatInBar=0,this.currentSubdivision=0,this.subdivisionsInBeat=1,this.beatsPerBar=4,this.tempo=t,this.lookahead=25,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.isRunning=!1,this.intervalID=null}nextNote(){const t=60/this.subdivisionsInBeat/this.tempo;this.nextNoteTime+=t,this.currentSubdivision++,this.currentSubdivision>=this.subdivisionsInBeat&&(this.currentBeatInBar++,this.currentSubdivision=0),this.currentBeatInBar>=this.beatsPerBar&&(this.currentBeatInBar=0)}scheduleNote(t,e,o){if(!this.audioContext)return;this.notesInQueue.push({note:t,time:o});const a=this.audioContext.createOscillator(),s=this.audioContext.createGain(),u=1e3,c=400,h=200;e!==0?a.frequency.value=h:t%this.beatsPerBar===0?a.frequency.value=u:a.frequency.value=c,s.gain.value=1,s.gain.exponentialRampToValueAtTime(1,o+.001),s.gain.exponentialRampToValueAtTime(.001,o+.02),a.connect(s),s.connect(this.audioContext.destination);const n=this.audioContext.createConstantSource();n.onended=()=>{this.onBeatStart?.(t,e),a.start(),a.stop(o+.03),a.onended=()=>{this.onBeatEnd?.()}},n.start(o),n.stop(this.audioContext.currentTime+1e-4)}scheduler(){if(this.audioContext)for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;)this.scheduleNote(this.currentBeatInBar,this.currentSubdivision,this.nextNoteTime),this.nextNote()}start(){this.isRunning||(this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.isRunning=!0,this.currentBeatInBar=0,this.currentSubdivision=0,this.nextNoteTime=this.audioContext.currentTime+.05,this.intervalID=setInterval(()=>this.scheduler(),this.lookahead))}stop(){this.isRunning=!1,this.intervalID&&clearInterval(this.intervalID)}startStop(){this.isRunning?this.stop():this.start()}}var st=S('<div class="controls-container svelte-8u7cmv"><div class="controls-sub-container svelte-8u7cmv"><label for="beatsInBar"><h4>Beats in bar</h4></label> <div class="subdivisions-container svelte-8u7cmv"><button>-1</button> <span style="font-size: large; margin-left: 1em; margin-right: 1em"> </span> <button>+1</button></div></div> <br/> <div class="controls-sub-container svelte-8u7cmv"><label for="subdivisionsInBeat"><h4>Subdivisions in beat</h4></label> <div class="subdivisions-container svelte-8u7cmv"><button aria-label="1 subdivision by beat"><svg width="15" height="15" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 15px; height: auto;"><path d="M 4.3 0 v 9.6 A 2.9 2.9 0 0 0 0 12.1 A 3 3 0 0 0 3 15 c 1.5 0 2.8 -1.3 2.8 -2.9 V 3 V 0 H 4.3 Z"></path></svg></button> <button aria-label="2 subdivision by beat"><svg width="15" height="15" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 15px; height: auto;"><path d="M4.3 0v9.6A2.9 2.9 0 0 0 0 12.1 3 3 0 0 0 3 15c1.5 0 2.8-1.3 2.8-2.9V3h7.7v6.6a2.9 2.9 0 0 0-4.3 2.5 2.9 2.9 0 0 0 5.8 0V0H4.3Z"></path></svg></button> <button aria-label="3 subdivision by beat"><svg width="24" height="21" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 24px; height: auto; top: -3px;"><path clip-rule="evenodd" d="M4.3 15.6V6H24v12.1a3 3 0 0 1-3 2.9 2.9 2.9 0 0 1-2.8-2.9 2.9 2.9 0 0 1 4.3-2.5V9H15v9.1a2.9 2.9 0 0 1-3 2.9 3 3 0 0 1-3-2.9 2.9 2.9 0 0 1 3-2.8c.5 0 1 0 1.3.3V9H5.8v9.1C5.8 19.7 4.5 21 3 21a3 3 0 0 1-3-2.9 2.9 2.9 0 0 1 4.3-2.5Z"></path><path d="M12.6 2.2 13.9.5V0h-3.1v.4h2.5l-1.4 1.7v.4h.4c.9 0 1.3.4 1.3 1s-.4 1-1.2 1c-.7 0-1.3-.3-1.6-.6l-.2.4c.4.4 1 .6 1.8.6 1.1 0 1.7-.6 1.7-1.4 0-.8-.5-1.3-1.5-1.4Z"></path></svg></button> <button aria-label="4 subdivision by beat"><svg width="27" height="13" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 27px; height: auto;"><path clip-rule="evenodd" d="M3.5 0v7.9a2 2 0 0 0-1.1-.3C1 7.6 0 8.6 0 9.9c0 1.3 1 2.4 2.4 2.4 1.3 0 2.3-1 2.3-2.4V3.4H11V8a2 2 0 0 0-1.1-.3 2.3 2.3 0 1 0 0 4.7c1.3 0 2.4-1 2.4-2.4V3.4h6.1V8a2.4 2.4 0 0 0-1-.3c-1.4 0-2.5 1-2.5 2.3 0 1.3 1.1 2.4 2.4 2.4 1.3 0 2.4-1 2.4-2.4V3.4h6.2V8l-1.2-.3c-1.3 0-2.3 1-2.3 2.3a2.3 2.3 0 1 0 4.7 0V0H3.5Zm7.4 2.7H4.7V1.5H11v1.2Zm7.4 0h-6.1V1.5h6.1v1.2Zm1.3 0h6.2V1.5h-6.2v1.2Z"></path></svg></button></div></div></div>');function ot(g,t){P(t,!0);var e=st(),o=r(e),a=v(r(o),2),s=r(a);s.__click=()=>t.onBeatsPerBarUpdate(Math.max(t.beatsPerBar-1,1));var u=v(s,2),c=r(u,!0);l(u);var h=v(u,2);h.__click=()=>t.onBeatsPerBarUpdate(Math.min(t.beatsPerBar+1,10)),l(a),l(o);var n=v(o,4),d=v(r(n),2),p=r(d);p.__click=()=>t.onSubdivisionsInBeatUpdate(1);let B;var _=v(p,2);_.__click=()=>t.onSubdivisionsInBeatUpdate(2);let i;var b=v(_,2);b.__click=()=>t.onSubdivisionsInBeatUpdate(3);let f;var y=v(b,2);y.__click=()=>t.onSubdivisionsInBeatUpdate(4);let I;l(d),l(n),l(e),R(()=>{Q(c,t.beatsPerBar),B=V(p,1,"",null,B,{selected:t.subdivisionsInBeat===1}),i=V(_,1,"",null,i,{selected:t.subdivisionsInBeat===2}),f=V(b,1,"",null,f,{selected:t.subdivisionsInBeat===3}),I=V(y,1,"",null,I,{selected:t.subdivisionsInBeat===4})}),x(g,e),M()}C(["click"]);var rt=S('<div class="tempo-container svelte-gstu11"><div class="tempo-less svelte-gstu11"><button>-5</button> <button>-1</button></div> <div class="tempo-value svelte-gstu11" style="font-size: x-large"><input style="font-size: x-large; margin-right: 0.1em;" type="number" min="1" max="400"/> BPM</div> <div class="tempo-more svelte-gstu11"><button>+1</button> <button>+5</button></div></div>');function lt(g,t){P(t,!0);let e=E(t,"tempo",15);const o=_=>{if(!_||!_.target)return;const i=_.target,b=Number(i.value);!b||b<1||t.onTempoUpdate(b)};var a=rt(),s=r(a),u=r(s);u.__click=()=>t.onTempoUpdate(e()-5);var c=v(u,2);c.__click=()=>t.onTempoUpdate(e()-1),l(s);var h=v(s,2),n=r(h);X(n),n.__change=o,W(),l(h);var d=v(h,2),p=r(d);p.__click=()=>t.onTempoUpdate(e()+1);var B=v(p,2);B.__click=()=>t.onTempoUpdate(e()+5),l(d),l(a),$(n,e),x(g,a),M()}C(["click","change"]);var ut=q('<svg width="20" height="20" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: auto;"><path d="M 0 0 V 20 L 6 20 L 6 0 L 0 0 M 9 0 V 20 H 15 V 0 H 9"></path></svg>'),dt=q('<svg width="20" height="20" fill="blue" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: auto;"><path d="M 0 0 V 20 L 17 10"></path></svg>'),vt=S('<div class="controls-container svelte-vxo2tw"><button style="min-width: 300px"><!></button></div>');function ct(g,t){P(t,!0);const e=()=>{t.metronome.startStop()},o=n=>{const d=" ";if([d].includes(n.key)&&(n.preventDefault(),n.key===d)){e();return}};var a=vt();Y("keydown",O,o);var s=r(a);s.__click=e;var u=r(s);{var c=n=>{var d=ut();x(n,d)},h=n=>{var d=dt();x(n,d)};Z(u,n=>{t.metronome.isRunning?n(c):n(h,!1)})}l(s),l(a),x(g,a),M()}C(["click"]);var ht=S('<div id="canvas-container" class="d-flex justify-content-center"><!></div>');function bt(g,t){P(t,!0);let e=E(t,"metronome",15),o=!1,a=0,s=0;const u=(i,b)=>{o=!0,a=i,s=b},c=()=>{o=!1};let h,n="white",d="white";const p=i=>{i.setup=()=>{h=i,i.createCanvas(600,300),i.textSize(40)},i.draw=()=>{const b=document.getElementById("canvas-container");if(b){const w=b?.clientWidth||600;i.width!==w&&i.resizeCanvas(w,Math.max(w/3,100))}i.clear(),i.stroke(n);const f=Math.min(i.width/e().beatsPerBar,i.height),y=i.height/e().subdivisionsInBeat;for(let w=0;w<e().beatsPerBar;w++){w===a?i.strokeWeight(5):i.strokeWeight(1),i.noFill(),i.circle(w*f+f/2,i.height/2,f*.9),i.strokeWeight(1);for(let k=0;k<e().subdivisionsInBeat;k++)o&&w===a&&k===s?i.fill(n):i.noFill(),i.circle(w*f+f/2,k*y+y/2,f/e().subdivisionsInBeat*.9)}o?i.fill(d):i.fill(n),i.fill(n);const I=(a+1).toString();i.text(I,a*f+f/2-i.textWidth(I)/2,i.height/2+i.textSize()/2)}};L(()=>{const i=getComputedStyle(document.body);n=i.getPropertyValue("--nc-tx-3"),d=i.getPropertyValue("--nc-tx-2"),e(e().onBeatStart=u,!0),e(e().onBeatEnd=c,!0)}),N(()=>{h?.remove()});var B=ht(),_=r(B);tt(_,{sketch:p}),l(B),x(g,B),M()}var mt=S('<div class="controls-container svelte-7ka7d9"><button>Tap</button></div>');function gt(g,t){P(t,!0);let e=new et,o=U(!1);const a=()=>{e.addBeat(),T(o,!0),setTimeout(()=>T(o,!1),100),e.bpm>0&&t.onNewBPM(Math.ceil(e.bpm))};var s=mt(),u=r(s);u.__click=a;let c;l(s),R(()=>c=V(u,1,"svelte-7ka7d9",null,c,{taped:z(o)})),x(g,s),M()}C(["click"]);var ft=S(`<div role="dialog" class="modal svelte-ezojap"><div class="contents svelte-ezojap"><h4 class="title-bar svelte-ezojap">Metronome <button>Close</button></h4> <div>This is a simple metronome: <ul><li>Use the play/pause button or the space bar to start and stop the metronome</li> <li>You can change the tempo by:</li> <ul><li>Entering a number directly in the input</li> <li>Using the -5, -1, +1 and +5 buttons</li> <li>Taping a tempo on the tap button. When taping the tempo each tap counts
                            for a subdivision if subdivisions are enabled. Stop taping for approx. 3
                            seconds to restart the tap counter.</li></ul> <li>The "Beats in bar" setting change the number of beats counted by the
                        metronome. The first beat is accented with a higher frequency tone.</li> <li>The "Subdivisions in beat" setting allow to change how the beats are
                        divided. The subdivisions after the first one are played with a lower
                        frequency tone.</li> <li>The visualization at the bottom follow the beats and their subdivisions.</li></ul></div> <br/> <h5>Bugs</h5> <ul><li>While it goes against my opinion on what the web should look like, this page
                    works better with Chrome-based browsers.</li> <li>For some reason the display of the tempo settings is broken on Firefox, the
                    input doesn't resize properly.</li> <li>The sound doesn't work on Safari on iOS (and maybe on MacOS too).</li></ul></div></div>`);function pt(g,t){var e=K(),o=D(e);{var a=s=>{var u=ft(),c=r(u),h=r(c),n=v(r(h));n.__click=function(...d){t.close?.apply(this,d)},l(h),W(8),l(c),l(u),x(s,u)};Z(o,s=>{t.isOpen&&s(a)})}x(g,e)}C(["click"]);var Bt=S('<!> <div class="main svelte-iy8fh1"><h3>Metronome <span><button aria-label="info"><i class="fa fa-info-circle" aria-hidden="true"></i></button></span></h3> <div><!></div> <div class="section svelte-iy8fh1"><!> <!></div> <div class="section svelte-iy8fh1"><!></div> <div class="section svelte-iy8fh1"><!></div></div>',1);function Wt(g,t){P(t,!0),at.set({name:"Metronome"});let e=new nt(80),o=U(H(e.tempo)),a=U(H(e.beatsPerBar)),s=U(H(e.subdivisionsInBeat));N(()=>{e.stop()});const u=m=>{T(o,m,!0),e.tempo=m},c=m=>{T(a,m,!0),e.beatsPerBar=m},h=m=>{T(s,m,!0),e.subdivisionsInBeat=m};var n=Bt(),d=D(n);it(d,{title:"Metronome",description:"Metronome"});var p=v(d,2),B=r(p),_=v(r(B)),i=r(_);i.__click=()=>J.open(pt),G(i,"",{},{position:"relative"}),l(_),l(B);var b=v(B,2),f=r(b);ct(f,{get metronome(){return e}}),l(b);var y=v(b,2),I=r(y);lt(I,{onTempoUpdate:u,get tempo(){return z(o)},set tempo(m){T(o,m,!0)}});var w=v(I,2);gt(w,{onNewBPM:m=>u(m/e.subdivisionsInBeat)}),l(y);var k=v(y,2),F=r(k);ot(F,{onBeatsPerBarUpdate:c,onSubdivisionsInBeatUpdate:h,get beatsPerBar(){return z(a)},set beatsPerBar(m){T(a,m,!0)},get subdivisionsInBeat(){return z(s)},set subdivisionsInBeat(m){T(s,m,!0)}}),l(k);var A=v(k,2),j=r(A);bt(j,{get metronome(){return e}}),l(A),l(p),x(g,n),M()}C(["click"]);export{Wt as component};
