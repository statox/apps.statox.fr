import"../chunks/NZTpNUN0.js";import{p as ae,e as W,a8 as ye,c as ie,f as R,a as d,d as re,b as f,i as s,s as t,r,g as e,h as M,t as te}from"../chunks/BjuhH6lp.js";import{d as Se,s as ne}from"../chunks/BHQPUIUI.js";import{a as Ae}from"../chunks/m6IlzdLY.js";import{i as q}from"../chunks/Cw8fytvj.js";import{a as oe,s as ce}from"../chunks/u5ZAmcyg.js";import{m as Le}from"../chunks/BqWwabYr.js";import{u as ve}from"../chunks/hGmCBAil.js";import{M as xe}from"../chunks/DaF2b9q9.js";import{r as Ee,a as de,A as Ie,U as Te}from"../chunks/kRNTpZzk.js";import{e as ke,i as Ce}from"../chunks/CLKJSt8A.js";import{r as m,b as qe,e as U,a as He}from"../chunks/DEs50KOR.js";import{b as ee}from"../chunks/BszEGJcu.js";import{t as Ue}from"../chunks/Djhp2DQ4.js";import{M as Ne}from"../chunks/BOggawGR.js";import{c as We}from"../chunks/C8sgD566.js";import{M as Pe}from"../chunks/Cevinnv4.js";import{M as Fe}from"../chunks/oEnuvK4p.js";import{M as Oe}from"../chunks/DlpJvpMR.js";import{a as Be}from"../chunks/DTyfSRsR.js";import"../chunks/DvQ7C2d6.js";import{p as Re}from"../chunks/CVcK5rS6.js";const je=!1,Mt=Object.freeze(Object.defineProperty({__proto__:null,ssr:je},Symbol.toStringTag,{value:"Module"})),ge=async()=>Ee({path:"/webWatcher/getAllWatchers"}),we=async u=>de({path:"/webWatcher/createWatcher",data:u,isUnauthenticatedCall:!0}),ze=async u=>de({path:"/webWatcher/deleteWatcher",data:{id:u},isUnauthenticatedCall:!0}),Ge=async u=>de({path:"/webWatcher/toggleWatcherEnabled",data:u,isUnauthenticatedCall:!0});var Je=f('<label for="css-selector">CSS selector</label> <input type="textarea"/>',1),Ve=f('<button class="form-action svelte-8qhbr8">Submit</button>'),Ke=f('<span class="form-action svelte-8qhbr8">Login to upload an entry</span>'),Qe=f('<div role="dialog" class="modal svelte-8qhbr8"><div class="contents svelte-8qhbr8"><h3 class="title-bar svelte-8qhbr8">Add a new watcher <button>Close</button></h3> <!> <form class="form-content svelte-8qhbr8"><label for="name">Name</label> <input type="text"/> <label for="check-interval">Check interval</label> <!> <label for="notification-message">Notification message (the @mention is automatically added)</label> <input type="textarea"/> <label for="watch-type">Watcher type</label> <select id="watch-type"><option>CSS</option><option>HASH</option></select> <label for="content">URL</label> <input type="textarea"/> <!> <br/> <!></form></div></div>');function Xe(u,a){ae(a,!0);const x=()=>ce(ve,"$user",D),[D,_]=oe();let i=W(ye([])),o=W(""),b=W(""),g=W(""),k=W(""),w=W(0),v=W("CSS");const H=async()=>{M(i,[],!0),e(o)?.length||e(i).push({level:"error",header:"name must be defined"}),e(b)||e(i).push({level:"error",header:"notification message must be defined"}),e(v)==="CSS"&&!e(k)&&e(i).push({level:"error",header:"A CSS watcher must have a css selector defined"}),e(w)<15*60&&e(i).push({level:"error",header:"Check interval too small. Must be >= 15mn"});try{new URL(e(g))}catch{e(i).push({level:"error",header:"The URL is invalid"})}if(!e(i).length)try{e(v)==="CSS"?await we({name:e(o),notificationMessage:e(b),url:e(g),cssSelector:e(k),checkIntervalSeconds:e(w),watchType:e(v)}):e(v)==="HASH"&&await we({name:e(o),notificationMessage:e(b),url:e(g),checkIntervalSeconds:e(w),watchType:e(v)}),a.onUpload(),a.close()}catch(n){let c=n.message;n instanceof Ie&&n.code===401?c="Invalid logged in user":n instanceof Te&&(c="User is logged out");const p=`<strong>Entry not created</strong><br/> ${c}`;Ue.push(p,{theme:{"--toastBarBackground":"#FF0000"}})}};var C=ie(),j=R(C);{var y=n=>{var c=Qe(),p=s(c),S=s(p),z=t(s(S));z.__click=function(...l){a.close?.apply(this,l)},r(S);var G=t(S,2);ke(G,17,()=>e(i),Ce,(l,h)=>{xe(l,{get item(){return e(h)}})});var J=t(G,2),V=t(s(J),2);m(V);var N=t(V,4);Ne(N,{allowedUnits:["minutes","hours","days"],defaultDuration:{value:1,unit:"hours"},get valueInSeconds(){return e(w)},set valueInSeconds(l){M(w,l,!0)}});var P=t(N,4);m(P);var A=t(P,4),L=s(A);L.value=L.__value="CSS";var K=t(L);K.value=K.__value="HASH",r(A);var F=t(A,4);m(F);var O=t(F,2);{var Q=l=>{var h=Je(),B=t(R(h),2);m(B),ee(B,()=>e(k),Z=>M(k,Z)),d(l,h)};q(O,l=>{e(v)==="CSS"&&l(Q)})}var X=t(O,4);{var se=l=>{var h=Ve();h.__click=H,d(l,h)},le=l=>{var h=Ke();d(l,h)};q(X,l=>{x()?l(se):l(le,!1)})}r(J),r(p),r(c),ee(V,()=>e(o),l=>M(o,l)),ee(P,()=>e(b),l=>M(b,l)),qe(A,()=>e(v),l=>M(v,l)),ee(F,()=>e(g),l=>M(g,l)),d(n,c)};q(j,n=>{a.isOpen&&n(y)})}d(u,C),re(),_()}Se(["click"]);var Ye=f('<p class="section-3-item svelte-1e53865"><label for="css-selector">CSS selector <!></label> <input disabled type="textarea" class="svelte-1e53865"/></p>'),Ze=f('<div class="section error-section svelte-1e53865"><p class="section-4-item svelte-1e53865"><label for="last-check">Last error</label> <input disabled type="textarea" class="svelte-1e53865"/></p> <p class="section-4-item svelte-1e53865"><label for="last-update">Last error message</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div>'),$e=f('<div class="item svelte-1e53865"><h3 class="item-title svelte-1e53865"><div class="item-name svelte-1e53865"> </div> <div class="item-actions svelte-1e53865"><!> <!></div></h3> <div class="section svelte-1e53865"><p class="section-1-item svelte-1e53865"><label for="check-interval">Check interval</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <div class="section svelte-1e53865"><p class="section-2-item svelte-1e53865"><label for="notification-message">Notification message</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <div class="section svelte-1e53865"><p class="section-3-item svelte-1e53865"><label for="content">URL</label> <a target="_blank" rel="noopener noreferrer"> </a></p> <!></div> <div class="section svelte-1e53865"><p class="section-4-item svelte-1e53865"><label for="last-check">Last check</label> <input disabled type="textarea" class="svelte-1e53865"/></p> <p class="section-4-item svelte-1e53865"><label for="last-update">Last content change</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <!> <div class="section svelte-1e53865"><p class="section-3-item svelte-1e53865"><label for="last-update">Last content</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div></div>');function et(u,a){ae(a,!0);const x=()=>ce(ve,"$user",D),[D,_]=oe(),i=We(),o=n=>{const c=new Date(n*1e3);return c.toLocaleDateString()+" "+c.toLocaleTimeString()},b=a.watcher.lastCheckDateUnix===0?"Never checked before":o(a.watcher.lastCheckDateUnix),g=a.watcher.lastUpdateDateUnix===0?"Never changed":o(a.watcher.lastUpdateDateUnix),k=Be.fromMillis(a.watcher.checkIntervalSeconds*1e3).rescale().toHuman(),w=async()=>{if(!a.watcher.id){console.error("id must be defined");return}try{await ze(a.watcher.id),i("delete")}catch(n){const c=`<strong>Watcher not deleted</strong><br/> ${n.message}`;Ue.push(c,{theme:{"--toastBarBackground":"#FF0000"}})}},v=async n=>{await Ge({watcherId:a.watcher.id,setToEnabled:n.detail==="on"}),i("update")};let H=a.watcher.archivalDateUnix?"off":"on";var C=ie(),j=R(C);{var y=n=>{var c=$e(),p=s(c),S=s(p),z=s(S,!0);r(S);var G=t(S,2),J=s(G);Oe(J,{get value(){return H},label:"Enabled",design:"slider",$$events:{change:v}});var V=t(J,2);Fe(V,{deleteAction:w}),r(G),r(p);var N=t(p,2),P=s(N),A=t(s(P),2);m(A),r(P),r(N);var L=t(N,2),K=s(L),F=t(s(K),2);m(F),r(K),r(L);var O=t(L,2),Q=s(O),X=t(s(Q),2),se=s(X,!0);r(X),r(Q);var le=t(Q,2);{var l=E=>{var I=Ye(),T=s(I),$=t(s(T));Pe($,{get content(){return a.watcher.cssSelector}}),r(T);var Y=t(T,2);m(Y),r(I),te(()=>U(Y,a.watcher.cssSelector)),d(E,I)};q(le,E=>{a.watcher.watchType==="CSS"&&E(l)})}r(O);var h=t(O,2),B=s(h),Z=t(s(B),2);m(Z),r(B);var ue=t(B,2),he=t(s(ue),2);m(he),r(ue),r(h);var me=t(h,2);{var Me=E=>{var I=Ze(),T=s(I),$=t(s(T),2);m($),r(T);var Y=t(T,2),_e=t(s(Y),2);m(_e),r(Y),r(I),te(De=>{U($,De),U(_e,a.watcher.lastErrorMessage)},[()=>o(a.watcher.lastErrorDateUnix)]),d(E,I)};q(me,E=>{a.watcher.lastErrorDateUnix&&E(Me)})}var pe=t(me,2),fe=s(pe),be=t(s(fe),2);m(be),r(fe),r(pe),r(c),te(()=>{ne(z,a.watcher.name),U(A,k),U(F,a.watcher.notificationMessage),He(X,"href",a.watcher.url),ne(se,a.watcher.url),U(Z,b),U(he,g),U(be,a.watcher.lastContent)}),d(n,c)};q(j,n=>{x()&&n(y)})}d(u,C),re(),_()}var tt=f('<div class="container svelte-ihkiaa"></div>');function at(u,a){ae(a,!0);const x=We(),D=(i,o)=>i.archivalDateUnix===null&&o.archivalDateUnix!==null?-1:i.archivalDateUnix!==null&&o.archivalDateUnix===null?1:o.id-i.id;var _=tt();ke(_,21,()=>a.watchers.sort(D),Ce,(i,o)=>{et(i,{get watcher(){return e(o)},$$events:{delete:()=>x("delete"),update:()=>x("update")}})}),r(_),d(u,_),re()}var rt=f("<p>Something went wrong</p> <p> </p>",1),st=f("<p>Loading data</p>"),lt=f("<h2>Create a new watcher</h2> <button>Add an entry</button> <h2>Watchers</h2> <!>",1);function Dt(u,a){ae(a,!0);const x=()=>ce(ve,"$user",D),[D,_]=oe();Re.set("Web Watchers");let i=W(ye(ge()));const o=()=>M(i,ge(),!0);var b=ie(),g=R(b);{var k=v=>{var H=lt(),C=t(R(H),2);C.__click=()=>Le.open(Xe,{onUpload:o});var j=t(C,4);Ae(j,()=>e(i),y=>{var n=st();d(y,n)},(y,n)=>{at(y,{get watchers(){return e(n)},$$events:{delete:o,update:o}})},(y,n)=>{var c=rt(),p=t(R(c),2),S=s(p,!0);r(p),te(z=>ne(S,z),[()=>JSON.stringify(e(n))]),d(y,c)}),d(v,H)},w=v=>{xe(v,{item:{level:"info",header:"Login to list the watchers"}})};q(g,v=>{x()?v(k):v(w,!1)})}d(u,b),re(),_()}Se(["click"]);export{Dt as component,Mt as universal};
