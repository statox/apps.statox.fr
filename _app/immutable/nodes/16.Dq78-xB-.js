import"../chunks/NZTpNUN0.js";import{p as re,g as b,G as B,h as e,b as F,s as f,i as P,r as _,t as O,a as M,F as he,e as c,d as ae,f as Q,a$ as fe,a_ as X,j as Y,c as ge}from"../chunks/tjCGPzdr.js";import{d as ne,s as W,e as be}from"../chunks/DOKer7p_.js";import{i as D}from"../chunks/BsrVr-Z0.js";import{e as oe,i as se}from"../chunks/An4e5j9g.js";import{r as Z,b as ie}from"../chunks/DKsZ4ghV.js";import{M as _e}from"../chunks/CJFchB7S.js";import{m as G,g as R,c as T,b as S,B as g,d as L,a as ye,n as we,e as Me,i as Ce,f as xe}from"../chunks/CBhOl9Kc.js";import{b as ee}from"../chunks/B25JaP4K.js";import"../chunks/CqiQQVFS.js";import{p as Pe}from"../chunks/JXEUrtDX.js";const Be=a=>{const n=R(a),t=Math.floor(Math.random()*n.length);return n[t]},ke=(a,n)=>{const t=Be(a);return{board:G(a,n,t),move:t}},Se=(a,n,t)=>{const r=Fe(a,n,t.iterations,t.c);return{board:G(a,n,r),move:r}};class le{board;player;move;parent;children=[];visits=0;wins=0;constructor(n,t,r=null,s=null){this.board=n,this.player=t,this.move=r,this.parent=s}isFullyExpanded(){return this.children.length===R(this.board).length}isTerminal(){return S(this.board)!==g.notOver}}function te(a,n,t,r=Math.sqrt(2)){return t===0?1/0:n/t+r*Math.sqrt(Math.log(a)/t)}function Te(a,n){for(;!a.isTerminal();)if(a.isFullyExpanded())a=qe(a,n);else return Ge(a);return a}function Ge(a){const n=a.children.map(m=>m.move),r=R(a.board).filter(m=>!n.includes(m)),s=r[Math.floor(Math.random()*r.length)],p=T(a.board);G(p,a.player,s);const i=new le(p,a.player===1?2:1,s,a);return a.children.push(i),i}function qe(a,n){return a.children.reduce((t,r)=>{const s=te(a.visits,t.wins,t.visits,n);return te(a.visits,r.wins,r.visits,n)>s?r:t})}function Ne(a){const n=T(a.board);let t=a.player;for(;;){const r=S(n);if(r!==g.notOver)return r;const s=R(n),p=s[Math.floor(Math.random()*s.length)];G(n,t,p),t=t===1?2:1}}function Oe(a,n){let t=a;for(;t!==null;)t.visits+=1,n===g.winPlayer1&&t.parent?.player===1||n===g.winPlayer2&&t.parent?.player===2?t.wins+=1:n===g.draw&&(t.wins+=.5),t=t.parent}function Fe(a,n,t=1e3,r=Math.sqrt(2)){const s=new le(T(a),n,null,null);for(let i=0;i<t;i++){const m=Te(s,r),l=Ne(m);Oe(m,l)}return s.children.reduce((i,m)=>i.visits>m.visits?i:m).move}var Re=(a,n,t,r,s)=>{e(n)&&(c(t,e(n).iterations,!0),c(r,e(n).c,!0),s())},Ee=F("<option> </option>"),He=(a,n,t)=>{c(n,null),t()},Ie=(a,n,t)=>{c(n,null),t()},Ue=F(`<div><h4>Monte Carlo Tree Search parameters</h4> <label for="mcts-preset">Preset difficulty</label> <select></select> <br/><br/> <label for="mcts-iterations">Iterations:</label> <input id="mcts-iterations" type="number" min="0"/> <small>Number of simulations MCTS will run before choosing a move. Higher values usually mean
        stronger play but slower decisions.</small> <br/><br/> <label for="mcts-c">C (exploration constant):</label> <input id="mcts-c" type="number" min="0" step="0.1"/> <small>Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
        favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2 ≈
        1.41.</small></div>`);function Ve(a,n){re(n,!0);const t=[{name:"easy",iterations:200,c:2},{name:"medium",iterations:1e3,c:1.41},{name:"hard",iterations:5e3,c:.7}];let r=b(B(t[1])),s=b(B(e(r).iterations)),p=b(B(e(r).c));const i=()=>{n.onUpdate({iterations:e(s),c:e(p)})};var m=Ue(),l=f(P(m),4);l.__change=[Re,r,s,p,i],oe(l,21,()=>t,se,(h,C)=>{var y=Ee(),k=P(y,!0);_(y);var q={};O(()=>{W(k,e(C).name),q!==(q=e(C))&&(y.value=(y.__value=e(C))??"")}),M(h,y)}),_(l);var d=f(l,7);Z(d),d.__change=[He,r,i];var v=f(d,9);Z(v),v.__change=[Ie,r,i],he(2),_(m),ie(l,()=>e(r),h=>c(r,h)),ee(d,()=>e(s),h=>c(s,h)),ee(v,()=>e(p),h=>c(p,h)),M(a,m),ae()}ne(["change"]);var De=F("<option> </option>"),Le=F('<!> <div class="main"><h3>Gravitrip</h3></div> <div>See <a href="https://www.quora.com/What-is-the-winning-strategy-for-the-first-player-in-Connect-Four-games">this quora thread</a> for some tips on the winning strategy</div> <div>Player 2 stategy: <select></select></div> <!> <span><button>New game</button> <button>Cancel move</button> <span style="font-weight: bold"><!></span></span> <!>',1);function et(a,n){re(n,!0),Pe.set("Gravitrip");let t=b(B(L())),r=b(B([])),s=X(()=>S(e(t))),p=X(()=>xe(e(t))),i=b("mcts"),m=b(B({iterations:1e3,c:1.41})),l=b(1),d=1,v=2;const h=()=>{c(t,L(),!0),c(r,[],!0),c(l,1),[d,v]=[v,d],v===e(l)&&E()},C=(o,u)=>{e(r).push({board:T(o),moveByPlayer:u}),c(r,e(r),!0)},y=()=>{if(e(i)==="manual")e(r).pop(),k();else{if(e(r).length===1&&e(r)[e(r).length-1].moveByPlayer===v)return;e(r)[e(r).length-1].moveByPlayer===v&&e(r).pop(),e(r).length&&e(r)[e(r).length-1].moveByPlayer===d&&e(r).pop()}c(r,e(r),!0),e(r).length===0?c(t,L(),!0):c(t,T(e(r)[e(r).length-1].board),!0)},k=()=>c(l,e(l)===1?2:1,!0),q=o=>{if(d!==e(l)&&e(i)!=="manual"||!Ce(e(t),o)||S(e(t))!==g.notOver)return;let u;if(d===e(l))u=d;else if(v===e(l)&&e(i)==="manual")u=v;else return;c(t,G(e(t),u,o),!0),C(e(t),u),k(),setTimeout(()=>E(),200)},E=()=>{if(v!==e(l)||S(e(t))!==g.notOver||e(i)==="manual")return;let o;if(e(i)==="random")o=ke(e(t),e(l));else if(e(i)==="mcts")o=Se(e(t),e(l),e(m));else throw new Error("computer strategy not implemented");const{board:u}=o;c(t,u,!0),C(e(t),v),k()},ue=o=>{switch(o.key){case"r":h();break}};var j=Le();be("keydown",fe,ue);var A=Q(j);_e(A,{title:"Gravitrip",description:"Gravitrip"});var H=f(A,6),N=f(P(H));N.__change=()=>{e(i)!=="manual"&&v===e(l)&&E()},oe(N,20,()=>["mcts","random","manual"],se,(o,u)=>{var w=De(),V=P(w,!0);_(w);var x={};O(()=>{W(V,u),x!==(x=u)&&(w.value=(w.__value=u)??"")}),M(o,w)}),_(N),_(H);var K=f(H,2);{var ce=o=>{Ve(o,{onUpdate:u=>c(m,u,!0)})};D(K,o=>{e(i)==="mcts"&&o(ce)})}var I=f(K,2),$=P(I);$.__click=h;var U=f($,2);U.__click=y;var z=f(U,2),me=P(z);{var ve=o=>{var u=Y("Game Over");M(o,u)},pe=o=>{var u=ge(),w=Q(u);{var V=x=>{var J=Y();O(()=>W(J,`Player ${e(s)??""} wins`)),M(x,J)};D(w,x=>{(e(s)===g.winPlayer1||e(s)===g.winPlayer2)&&x(V)},!0)}M(o,u)};D(me,o=>{e(s)===g.draw?o(ve):o(pe,!1)})}_(z),_(I);var de=f(I,2);ye(de,{get nbColumns(){return Me},get nbRows(){return we},get board(){return e(t)},get winningCells(){return e(p)},onMove:q}),O(()=>U.disabled=e(r).length===0),ie(N,()=>e(i),o=>c(i,o)),M(a,j),ae()}ne(["change","click"]);export{et as component};
