import"../chunks/NZTpNUN0.js";import{a as se}from"../chunks/np3e4Z_M.js";import{p as ie,b as m,f as d,s as o,a as i,d as le,e as G,r as N,g as a,h as b,i as r,c as D,t as j,j as q}from"../chunks/Brv8g2mx.js";import{d as pe,s as V}from"../chunks/BlLNWVag.js";import{i as v}from"../chunks/D2xXzMMK.js";import{r as ve}from"../chunks/CqUsCvuq.js";import{b as _e}from"../chunks/DLiMpzP4.js";import{B as O,a as Y}from"../chunks/BDD5wQ3P.js";import{P as me}from"../chunks/CELBgAxi.js";import{r as ge}from"../chunks/DTRCIxyi.js";import{g as ce}from"../chunks/DPnp5vQ5.js";var ue=m('<button>Start a new game</button> <br/> <input type="string"/> <button>Join Game</button>',1),fe=m("<p>Connecting to the server…</p>"),de=m("<p>Waiting for an opponent to connect…</p>"),be=m("<p> </p> <!>",1),ye=m("<p>Something went wrong. Board is not defined.</p>"),we=m('<p>Game over</p> <button>Restart</button> <span style="font-weight: bold"><!></span> <!>',1),Se=m("<p>Disconnected</p>"),he=m("<h3>Online game <button>Back</button></h3> <!> <!> <!> <!> <!> <!>",1);function Ae(z,F){ie(F,!0);let n,x=b(null),g=b(null),c=b(null),S=b(null),l=b("initial"),h=b("");const H=async()=>{const e=await ge({path:"/gravitrips/getNewGame"});r(h,e.gameId,!0),B()},K=me.replace(/^http?/,"ws");se(()=>{n&&n.close()});const B=()=>{n=new WebSocket(K+"/gravitrips/ws?"+a(h)),r(l,"connecting"),r(g,null),r(c,null),r(S,null),n.onopen=()=>{r(l,"waiting_for_opponent")},n.onclose=e=>{console.log(e.reason),r(l,"disconnected")},n.onmessage=e=>{const t=JSON.parse(e.data);t.type==="game_ready"?(r(l,"playing"),r(x,t.youAre,!0),r(g,t.board,!0)):t.type==="update_board"?(r(g,t.board,!0),r(c,t.boardState,!0),r(S,t.winningCells,!0)):t.type==="waiting_for_opponent"?r(c,null):t.type==="game_over"&&r(l,"game_over")}},I=e=>{if(!n||n.readyState!==WebSocket.OPEN)return;const t=JSON.stringify({type:"move",column:e});n.send(t)},Q=()=>{if(!n||n.readyState!==WebSocket.OPEN)return;const e=JSON.stringify({type:"restart"});n.send(e)};var W=he(),P=d(W),T=o(G(P));T.__click=()=>ce("/gravitrips"),N(P);var A=o(P,2);{var X=e=>{var t=ue(),u=d(t);u.__click=H;var _=o(u,4);ve(_);var y=o(_,2);y.__click=B,_e(_,()=>a(h),p=>r(h,p)),i(e,t)};v(A,e=>{["initial","waiting_for_opponent","game_over","disconnected"].includes(a(l))&&e(X)})}var E=o(A,2);{var Z=e=>{var t=fe();i(e,t)};v(E,e=>{a(l)==="connecting"&&e(Z)})}var J=o(E,2);{var $=e=>{var t=de();i(e,t)};v(J,e=>{a(l)==="waiting_for_opponent"&&e($)})}var L=o(J,2);{var ee=e=>{var t=D(),u=d(t);{var _=p=>{var f=be(),w=d(f),C=G(w);N(w);var s=o(w,2);Y(s,{nbColumns:7,nbRows:6,get board(){return a(g)},get winningCells(){return a(S)},onMove:I}),j(()=>V(C,`You are Player ${a(x)??""}`)),i(p,f)},y=p=>{var f=ye();i(p,f)};v(u,p=>{a(g)!==null?p(_):p(y,!1)})}i(e,t)};v(L,e=>{a(l)==="playing"&&e(ee)})}var M=o(L,2);{var te=e=>{var t=we(),u=o(d(t),2);u.__click=Q;var _=o(u,2),y=G(_);{var p=s=>{var k=q("Game Over");i(s,k)},f=s=>{var k=D(),oe=d(k);{var ne=R=>{var U=q();j(()=>V(U,`Player ${a(c)??""} wins`)),i(R,U)};v(oe,R=>{(a(c)===O.winPlayer1||a(c)===O.winPlayer2)&&R(ne)},!0)}i(s,k)};v(y,s=>{a(c)===O.draw?s(p):s(f,!1)})}N(_);var w=o(_,2);{var C=s=>{Y(s,{nbColumns:7,nbRows:6,get board(){return a(g)},get winningCells(){return a(S)},onMove:I})};v(w,s=>{a(g)!==null&&s(C)})}i(e,t)};v(M,e=>{a(l)==="game_over"&&e(te)})}var ae=o(M,2);{var re=e=>{var t=Se();i(e,t)};v(ae,e=>{a(l)==="disconnected"&&e(re)})}i(z,W),le()}pe(["click"]);export{Ae as component};
