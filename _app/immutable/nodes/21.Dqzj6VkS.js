import"../chunks/disclose-version.Bg9kRutz.js";import{p as se,aH as T,v as B,n as ne,aF as s,w as a,aG as r,g as t,s as I,j as ve,o as Ee,k as J}from"../chunks/index-client.P2VSTy70.js";import{s as Y}from"../chunks/render.CuimXX8P.js";import{a as Me}from"../chunks/await.BBRfMCBx.js";import{i as R}from"../chunks/if.BLbovQwr.js";import{f as de,e as re,a as d,t as S}from"../chunks/template.BIjKHFZg.js";import{p as $}from"../chunks/proxy.BRVrcCMD.js";import{s as ue,a as he}from"../chunks/store.CMwAibpB.js";import{m as Ie}from"../chunks/Modals.3Bh5Qn2I.js";import{u as pe,U as He}from"../chunks/service.BgtfOZlM.js";import{M as Ue}from"../chunks/Main.BfSGu8qz.js";import{r as Ne,a as fe,A as Fe}from"../chunks/index.QXLvoKLm.js";import{e as me,i as _e}from"../chunks/each.AdK2eDBK.js";import{r as A,s as C,a as G}from"../chunks/attributes.BqzvnR1C.js";import{b as ie,c as Pe}from"../chunks/input.DTGvV5zM.js";import{b as Oe}from"../chunks/select.Dwyzusol.js";import{t as De}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.DWq_rmkp.js";import{M as Te,a as Be}from"../chunks/Main.Ce50PR36.js";import{M as Re}from"../chunks/Main.Do2kZ1DC.js";import{p as oe}from"../chunks/props.DfEX3Xsk.js";import{D as qe}from"../chunks/datetime.DT4lGENY.js";import"../chunks/legacy.DJ_L7nYo.js";import{p as Ge}from"../chunks/Main.svelte_svelte_type_style_lang.DciusizA.js";const Je=!1,Pt=Object.freeze(Object.defineProperty({__proto__:null,ssr:Je},Symbol.toStringTag,{value:"Module"})),ze=async()=>Ne({path:"/webWatcher/getAllWatchers"}),Ce=async u=>fe({path:"/webWatcher/createWatcher",data:u}),Ve=async u=>fe({path:"/webWatcher/deleteWatcher",data:{id:u}}),Ke=async u=>fe({path:"/webWatcher/toggleWatcherEnabled",data:u}),Qe=async(u,e,_,g,c,o,n,p,v)=>{var W;I(e,$([])),(W=t(_))!=null&&W.length||t(e).push({level:"error",header:"name must be defined"}),t(g)||t(e).push({level:"error",header:"notification message must be defined"}),t(c)==="CSS"&&!t(o)&&t(e).push({level:"error",header:"A CSS watcher must have a css selector defined"}),t(n)<15*60&&t(e).push({level:"error",header:"Check interval too small. Must be >= 15mn"});try{new URL(t(p))}catch{t(e).push({level:"error",header:"The URL is invalid"})}if(!t(e).length)try{t(c)==="CSS"?await Ce({name:t(_),notificationMessage:t(g),url:t(p),cssSelector:t(o),checkIntervalSeconds:t(n),watchType:t(c)}):t(c)==="HASH"&&await Ce({name:t(_),notificationMessage:t(g),url:t(p),checkIntervalSeconds:t(n),watchType:t(c)}),v.onUpload(),v.close()}catch(b){let h=b.message;b instanceof Fe&&b.code===401?h="Invalid logged in user":b instanceof He&&(h="User is logged out");const E=`<strong>Entry not created</strong><br/> ${h}`;De.push(E,{theme:{"--toastBarBackground":"#FF0000"}})}};var Xe=S('<label for="css-selector">CSS selector</label> <input type="textarea">',1),Ye=S('<button class="form-action svelte-1cixduj">Submit</button>'),Ze=S('<span class="form-action svelte-1cixduj">Login to upload an entry</span>'),$e=S('<div role="dialog" class="modal svelte-1cixduj"><div class="contents svelte-1cixduj"><h3 class="title-bar svelte-1cixduj">Add a new clipboard entry <button>Close</button></h3> <!> <form class="form-content svelte-1cixduj"><label for="name">Name</label> <input type="text"> <label for="check-interval">Check interval</label> <!> <label for="notification-message">Notification message (the @mention is automatically added)</label> <input type="textarea"> <label for="watch-type">Watcher type</label> <select id="watch-type"><option>CSS</option><option>HASH</option></select> <label for="content">URL</label> <input type="textarea"> <!> <br> <!></form></div></div>');function et(u,e){se(e,!0);const[_,g]=ue(),c=()=>he(pe,"$user",_);let o=T($([])),n=T(""),p=T(""),v=T(""),W=T(""),b=T(0),h=T("CSS");var E=re(),H=B(E);{var L=f=>{var l=$e(),m=s(l),y=s(m),j=a(s(y));j.__click=function(...i){var z;(z=e.close)==null||z.apply(this,i)},r(y);var x=a(y,2);me(x,17,()=>t(o),_e,(i,z)=>{Ue(i,{get item(){return t(z)}})});var w=a(x,2),U=a(s(w),2);A(U);var M=a(U,4);Te(M,{allowedUnits:["minutes","hours","days"],defaultDuration:{value:1,unit:"hours"},get valueInSeconds(){return t(b)},set valueInSeconds(i){I(b,$(i))}});var N=a(M,4);A(N);var F=a(N,4),k=s(F);k.value=(k.__value="CSS")==null?"":"CSS";var P=a(k);P.value=(P.__value="HASH")==null?"":"HASH",r(F);var D=a(F,4);A(D);var q=a(D,2);{var O=i=>{var z=Xe(),Z=a(B(z),2);A(Z),ie(Z,()=>t(W),te=>I(W,te)),d(i,z)};R(q,i=>{t(h)==="CSS"&&i(O)})}var V=a(q,4);{var ee=i=>{var z=Ye();z.__click=[Qe,o,n,p,h,W,b,v,e],d(i,z)},ce=i=>{var z=Ze();d(i,z)};R(V,i=>{c()?i(ee):i(ce,!1)})}r(w),r(m),r(l),ie(U,()=>t(n),i=>I(n,i)),ie(N,()=>t(p),i=>I(p,i)),Oe(F,()=>t(h),i=>I(h,i)),ie(D,()=>t(v),i=>I(v,i)),d(f,l)};R(H,f=>{e.isOpen&&f(L)})}d(u,E),ne(),g()}de(["click"]);function We(u,e,_,g){const c=u.target,o=c==null?void 0:c.getAttribute("aria-checked");I(e,$(o!=="true")),_(t(e)===!0?"on":"off"),g("change",_())}var tt=S('<div class="s s--inner svelte-1n7axnp"><span> </span> <button role="switch" class="svelte-1n7axnp"><span class="svelte-1n7axnp">on</span> <span class="svelte-1n7axnp">off</span></button></div>'),at=S('<div class="s s--slider svelte-1n7axnp"><span> </span> <button role="switch" class="svelte-1n7axnp"></button></div>'),rt=S('<input type="radio" class="svelte-1n7axnp"> <label class="svelte-1n7axnp"> </label>',1),st=S('<div class="s s--multi svelte-1n7axnp"><div role="radiogroup" class="group-container svelte-1n7axnp"><div class="legend"> </div> <!></div></div>');function nt(u,e){se(e,!0);const _=[];let g=oe(e,"design",3,"inner label"),c=oe(e,"options",19,()=>[]),o=oe(e,"fontSize",3,16),n=oe(e,"value",15,"on"),p=T(!0);const v=Math.floor(Math.random()*100),W=ve();Ee(()=>{I(p,n()==="on")});var b=re(),h=B(b);{var E=L=>{var f=tt(),l=s(f);C(l,"id",`switch-${v}`);var m=s(l,!0);r(l);var y=a(l,2);C(y,"aria-labelledby",`switch-${v}`),y.__click=[We,p,n,W],r(f),J(()=>{Y(m,e.label),C(y,"aria-checked",t(p))}),d(L,f)},H=L=>{var f=re(),l=B(f);{var m=j=>{var x=at(),w=s(x);C(w,"id",`switch-${v}`);var U=s(w,!0);r(w);var M=a(w,2);C(M,"aria-labelledby",`switch-${v}`),M.__click=[We,p,n,W],r(x),J(()=>{C(x,"style",`font-size:${o()??""}px`),Y(U,e.label),C(M,"aria-checked",t(p))}),d(j,x)},y=j=>{var x=st(),w=s(x);C(w,"aria-labelledby",`label-${v}`),C(w,"id",`group-${v}`);var U=s(w);C(U,"id",`label-${v}`);var M=s(U,!0);r(U);var N=a(U,2);me(N,17,c,_e,(F,k)=>{var P=rt(),D=B(P);A(D);var q,O=a(D,2),V=s(O,!0);r(O),J(()=>{C(D,"id",`${t(k)}-${v}`),q!==(q=t(k))&&(D.value=(D.__value=t(k))==null?"":t(k)),C(O,"for",`${t(k)}-${v}`),Y(V,t(k))}),Pe(_,[],D,()=>(t(k),n()),n),d(F,P)}),r(w),r(x),J(()=>{C(w,"style",`font-size:${o()??""}px`),Y(M,e.label)}),d(j,x)};R(l,j=>{g()=="slider"?j(m):j(y,!1)},!0)}d(L,f)};R(h,L=>{g()=="inner"?L(E):L(H,!1)})}d(u,b),ne()}de(["click"]);var lt=S('<p class="section-3-item svelte-1jnygz9"><label for="css-selector">CSS selector <!></label> <input disabled type="textarea" class="svelte-1jnygz9"></p>'),it=S('<div class="section error-section svelte-1jnygz9"><p class="section-4-item svelte-1jnygz9"><label for="last-check">Last error</label> <input disabled type="textarea" class="svelte-1jnygz9"></p> <p class="section-4-item svelte-1jnygz9"><label for="last-update">Last error message</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div>'),ot=S('<div class="item svelte-1jnygz9"><h3 class="item-title svelte-1jnygz9"><div class="item-name svelte-1jnygz9"> </div> <div class="item-actions svelte-1jnygz9"><!> <!></div></h3> <div class="section svelte-1jnygz9"><p class="section-1-item svelte-1jnygz9"><label for="check-interval">Check interval</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div> <div class="section svelte-1jnygz9"><p class="section-2-item svelte-1jnygz9"><label for="notification-message">Notification message</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div> <div class="section svelte-1jnygz9"><p class="section-3-item svelte-1jnygz9"><label for="content">URL</label> <a target="_blank" rel="noopener noreferrer"> </a></p> <!></div> <div class="section svelte-1jnygz9"><p class="section-4-item svelte-1jnygz9"><label for="last-check">Last check</label> <input disabled type="textarea" class="svelte-1jnygz9"></p> <p class="section-4-item svelte-1jnygz9"><label for="last-update">Last content change</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div> <!> <div class="section svelte-1jnygz9"><p class="section-3-item svelte-1jnygz9"><label for="last-update">Last content</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div></div>');function ct(u,e){se(e,!0);const[_,g]=ue(),c=()=>he(pe,"$user",_),o=ve(),n=l=>{const m=new Date(l*1e3);return m.toLocaleDateString()+" "+m.toLocaleTimeString()},p=e.watcher.lastCheckDateUnix===0?"Never checked before":n(e.watcher.lastCheckDateUnix),v=e.watcher.lastUpdateDateUnix===0?"Never changed":n(e.watcher.lastUpdateDateUnix),W=qe.fromMillis(e.watcher.checkIntervalSeconds*1e3).rescale().toHuman(),b=async()=>{if(!e.watcher.id){console.error("id must be defined");return}try{await Ve(e.watcher.id),o("delete")}catch(l){const m=`<strong>Watcher not deleted</strong><br/> ${l.message}`;De.push(m,{theme:{"--toastBarBackground":"#FF0000"}})}},h=async l=>{await Ke({watcherId:e.watcher.id,setToEnabled:l.detail==="on"}),o("update")};let E=e.watcher.archivalDateUnix?"off":"on";var H=re(),L=B(H);{var f=l=>{var m=ot(),y=s(m),j=s(y),x=s(j,!0);r(j);var w=a(j,2),U=s(w);nt(U,{value:E,label:"Enabled",design:"slider",$$events:{change:h}});var M=a(U,2);Re(M,{deleteAction:b}),r(w),r(y);var N=a(y,2),F=s(N),k=a(s(F),2);A(k),G(k,W),r(F),r(N);var P=a(N,2),D=s(P),q=a(s(D),2);A(q),r(D),r(P);var O=a(P,2),V=s(O),ee=a(s(V),2),ce=s(ee,!0);r(ee),r(V);var i=a(V,2);{var z=K=>{var Q=lt(),X=s(Q),le=a(s(X));Be(le,{get content(){return e.watcher.cssSelector}}),r(X);var ae=a(X,2);A(ae),r(Q),J(()=>G(ae,e.watcher.cssSelector)),d(K,Q)};R(i,K=>{e.watcher.watchType==="CSS"&&K(z)})}r(O);var Z=a(O,2),te=s(Z),ge=a(s(te),2);A(ge),G(ge,p),r(te);var be=a(te,2),ye=a(s(be),2);A(ye),G(ye,v),r(be),r(Z);var we=a(Z,2);{var Ae=K=>{var Q=it(),X=s(Q),le=a(s(X),2);A(le),r(X);var ae=a(X,2),ke=a(s(ae),2);A(ke),r(ae),r(Q),J(Le=>{G(le,Le),G(ke,e.watcher.lastErrorMessage)},[()=>n(e.watcher.lastErrorDateUnix)]),d(K,Q)};R(we,K=>{e.watcher.lastErrorDateUnix&&K(Ae)})}var xe=a(we,2),Se=s(xe),je=a(s(Se),2);A(je),r(Se),r(xe),r(m),J(()=>{Y(x,e.watcher.name),G(q,e.watcher.notificationMessage),C(ee,"href",e.watcher.url),Y(ce,e.watcher.url),G(je,e.watcher.lastContent)}),d(l,m)};R(L,l=>{c()&&l(f)})}d(u,H),ne(),g()}var vt=S('<div class="container svelte-c8nodu"></div>');function dt(u,e){se(e,!0);const _=ve(),g=(o,n)=>o.archivalDateUnix===null&&n.archivalDateUnix!==null?-1:o.archivalDateUnix!==null&&n.archivalDateUnix===null?1:n.id-o.id;var c=vt();me(c,21,()=>e.watchers.sort(g),_e,(o,n)=>{ct(o,{get watcher(){return t(n)},$$events:{delete:()=>_("delete"),update:()=>_("update")}})}),r(c),d(u,c),ne()}var ut=(u,e)=>Ie.open(et,{onUpload:e}),ht=S("<p>Something went wrong</p> <p> </p>",1),pt=S("<p>Loading data</p>"),ft=S("<h2>Create a new watcher</h2> <button>Add an entry</button> <h2>Watchers</h2> <!>",1);function Ot(u,e){se(e,!0);const[_,g]=ue(),c=()=>he(pe,"$user",_);Ge.set("Web Watchers");let o=T($(ze()));const n=()=>I(o,$(ze()));var p=re(),v=B(p);{var W=h=>{var E=ft(),H=a(B(E),2);H.__click=[ut,n];var L=a(H,4);Me(L,()=>t(o),f=>{var l=pt();d(f,l)},(f,l)=>{dt(f,{get watchers(){return t(l)},$$events:{delete:n,update:n}})},(f,l)=>{var m=ht(),y=a(B(m),2),j=s(y,!0);r(y),J(x=>Y(j,x),[()=>JSON.stringify(t(l))]),d(f,m)}),d(h,E)},b=h=>{Ue(h,{item:{level:"info",header:"Login to list the watchers"}})};R(v,h=>{c()?h(W):h(b,!1)})}d(u,p),ne(),g()}de(["click"]);export{Ot as component,Pt as universal};
