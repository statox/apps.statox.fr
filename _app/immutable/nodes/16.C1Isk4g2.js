import"../chunks/NZTpNUN0.js";import{p as he,g as _,G as S,b as E,s as u,i as h,r as f,t as J,h as e,a as M,F as I,e as c,d as fe,f as Y,a$ as Se,a_ as ve,j as ue,c as Te}from"../chunks/tjCGPzdr.js";import{d as be,s as ge,e as Oe}from"../chunks/DOKer7p_.js";import{i as H}from"../chunks/BsrVr-Z0.js";import{c as D,r as de}from"../chunks/DKsZ4ghV.js";import{M as Fe}from"../chunks/CJFchB7S.js";import{m as F,g as U,c as O,b as T,B as b,d as z,a as Ge,n as qe,e as Ne,i as Re,f as He}from"../chunks/CBhOl9Kc.js";import{e as Ie,i as De}from"../chunks/An4e5j9g.js";import{b as me}from"../chunks/B25JaP4K.js";import"../chunks/CqiQQVFS.js";import{p as Ee}from"../chunks/cT_gq_Ce.js";const Ue=r=>{const n=U(r),t=Math.floor(Math.random()*n.length);return n[t]},Ve=(r,n)=>{const t=Ue(r);return{board:F(r,n,t),move:t}},$e=(r,n,t)=>{const a=Ye(r,n,t.iterations,t.c);return{board:F(r,n,a),move:a}};class ye{board;player;move;parent;children=[];visits=0;wins=0;constructor(n,t,a=null,i=null){this.board=n,this.player=t,this.move=a,this.parent=i}isFullyExpanded(){return this.children.length===U(this.board).length}isTerminal(){return T(this.board)!==b.notOver}}function pe(r,n,t,a=Math.sqrt(2)){return t===0?1/0:n/t+a*Math.sqrt(Math.log(r)/t)}function Ae(r,n){for(;!r.isTerminal();)if(r.isFullyExpanded())r=We(r,n);else return Le(r);return r}function Le(r){const n=r.children.map(v=>v.move),a=U(r.board).filter(v=>!n.includes(v)),i=a[Math.floor(Math.random()*a.length)],p=O(r.board);F(p,r.player,i);const o=new ye(p,r.player===1?2:1,i,r);return r.children.push(o),o}function We(r,n){return r.children.reduce((t,a)=>{const i=pe(r.visits,t.wins,t.visits,n);return pe(r.visits,a.wins,a.visits,n)>i?a:t})}function je(r){const n=O(r.board);let t=r.player;for(;;){const a=T(n);if(a!==b.notOver)return a;const i=U(n),p=i[Math.floor(Math.random()*i.length)];F(n,t,p),t=t===1?2:1}}function Ke(r,n){let t=r;for(;t!==null;)t.visits+=1,n===b.winPlayer1&&t.parent?.player===1||n===b.winPlayer2&&t.parent?.player===2?t.wins+=1:n===b.draw&&(t.wins+=.5),t=t.parent}function Ye(r,n,t=1e3,a=Math.sqrt(2)){const i=new ye(O(r),n,null,null);for(let o=0;o<t;o++){const v=Ae(i,a),l=je(v);Ke(v,l)}return i.children.reduce((o,v)=>o.visits>v.visits?o:v).move}var ze=(r,n,t,a,i)=>{c(n,e(t).iterations,!0),c(a,e(t).c,!0),i()},Je=E("<button> </button>"),Qe=E(`<div><h4>Monte Carlo Tree Search parameters</h4> <div class="difficulty-options svelte-130wfia"><label for="mcts-preset">Preset difficulty</label> <!></div> <div><h5>Iterations:</h5> <input id="mcts-iterations" type="number" min="0"/></div> <div>Number of simulations MCTS will run before choosing a move. Higher values usually mean
        stronger play but slower decisions.</div> <div><h5>C (exploration constant):</h5> <input id="mcts-c" type="number" min="0" step="0.1"/></div> <div>Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
        favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2 ≈
        1.41.</div></div>`);function Xe(r,n){he(n,!0);const t=[{name:"easy",iterations:200,c:2},{name:"medium",iterations:1e3,c:1.41},{name:"hard",iterations:5e3,c:.7}],a=t[1];let i=_(S(a.iterations)),p=_(S(a.c));const o=()=>{n.onUpdate({iterations:e(i),c:e(p)})};var v=Qe(),l=u(h(v),2),w=u(h(l),2);Ie(w,17,()=>t,De,(y,C)=>{var g=Je();g.__click=[ze,i,C,p,o];let G;var q=h(g,!0);f(g),J(N=>{G=D(g,1,"svelte-130wfia",null,G,N),ge(q,e(C).name)},[()=>({selected:e(p)===e(C).c&&e(i)===e(C).iterations})]),M(y,g)}),f(l);var d=u(l,2),k=u(h(d),2);de(k),k.__change=o,f(d);var x=u(d,4),B=u(h(x),2);de(B),B.__change=o,f(x),I(2),f(v),me(k,()=>e(i),y=>c(i,y)),me(B,()=>e(p),y=>c(p,y)),M(r,v),fe()}be(["click","change"]);var Ze=(r,n)=>{c(n,"manual")},et=E("Game Over - <!>",1),tt=E(`<!> <div class="page-intro svelte-1bdwycb"><div>Gravitrips (which you might know as <a href="https://en.wikipedia.org/wiki/Connect_Four">Connect Four</a>) is a classic two-player strategy game where players take turns dropping pieces into a
        grid, aiming to align four in a row. On this page, you can challenge a friend on the same
        computer or test your skills against computer opponents with different AI strategies.</div> <br/> <div>See <a href="https://www.quora.com/What-is-the-winning-strategy-for-the-first-player-in-Connect-Four-games">this quora thread</a> for some tips on the winning strategy</div></div> <div class="opponent-choice svelte-1bdwycb"><label for="opponent-options">Choose your opponent:</label> <div class="opponent-options svelte-1bdwycb"><div><button>Human</button> Play with another human on the same computer.</div> <div><button>Random</button> The computer makes completely random moves, no intelligence at all.</div> <div><button>MCTS</button> The computer uses a <a href="https://en.wikipedia.org/wiki/Monte_Carlo_tree_search">Monte Carlo tree search</a> algorithm to make smart moves. You can tweak the difficulty at the bottom of the page.</div></div></div> <div class="game-controls svelte-1bdwycb"><button>New game</button> <button>Cancel move</button></div> <div class="game-results svelte-1bdwycb"><!></div> <!> <div class="computer-settings svelte-1bdwycb"><!></div>`,1);function mt(r,n){he(n,!0),Ee.set("Gravitrips");let t=_(S(z())),a=_(S([])),i=ve(()=>T(e(t))),p=ve(()=>He(e(t))),o=_("mcts"),v=_(S({iterations:1e3,c:1.41})),l=_(1),w=1,d=2;const k=()=>{c(t,z(),!0),c(a,[],!0),c(l,1),[w,d]=[d,w],e(o)!=="manual"&&d===e(l)&&g()},x=(s,m)=>{e(a).push({board:O(s),moveByPlayer:m}),c(a,e(a),!0)},B=()=>{if(e(o)==="manual")e(a).pop(),y();else{if(e(a).length===1&&e(a)[e(a).length-1].moveByPlayer===d)return;e(a)[e(a).length-1].moveByPlayer===d&&e(a).pop(),e(a).length&&e(a)[e(a).length-1].moveByPlayer===w&&e(a).pop()}c(a,e(a),!0),e(a).length===0?c(t,z(),!0):c(t,O(e(a)[e(a).length-1].board),!0)},y=()=>c(l,e(l)===1?2:1,!0),C=s=>{if(w!==e(l)&&e(o)!=="manual"||!Re(e(t),s)||T(e(t))!==b.notOver)return;let m;if(w===e(l))m=w;else if(d===e(l)&&e(o)==="manual")m=d;else return;c(t,F(e(t),m,s),!0),x(e(t),m),y(),e(o)!=="manual"&&setTimeout(()=>g(),200)},g=()=>{if(d!==e(l)||T(e(t))!==b.notOver||e(o)==="manual")return;let s;if(e(o)==="random")s=Ve(e(t),e(l));else if(e(o)==="mcts")s=$e(e(t),e(l),e(v));else throw new Error("computer strategy not implemented");const{board:m}=s;c(t,m,!0),x(e(t),d),y()},G=s=>{switch(s.key){case"r":k();break}};var q=tt();Oe("keydown",Se,G);var N=Y(q);Fe(N,{title:"Gravitrip",description:"Gravitrip",iconPath:"/gravitrips.png"});var V=u(N,4),Q=u(h(V),2),$=h(Q),X=h($);X.__click=[Ze,o];let Z;I(),f($);var A=u($,2),ee=h(A);ee.__click=()=>{c(o,"random"),d===e(l)&&g()};let te;I(),f(A);var ae=u(A,2),re=h(ae);re.__click=()=>{c(o,"mcts"),d===e(l)&&g()};let ne;I(3),f(ae),f(Q),f(V);var L=u(V,2),oe=h(L);oe.__click=k;var ie=u(oe,2);ie.__click=B,f(L);var W=u(L,2),we=h(W);{var _e=s=>{var m=et(),j=u(Y(m));{var Ce=P=>{var R=ue("Draw");M(P,R)},Pe=P=>{var R=Te(),xe=Y(R);{var Be=K=>{var ce=ue();J(()=>ge(ce,`Player ${e(i)??""} wins`)),M(K,ce)};H(xe,K=>{(e(i)===b.winPlayer1||e(i)===b.winPlayer2)&&K(Be)},!0)}M(P,R)};H(j,P=>{e(i)===b.draw?P(Ce):P(Pe,!1)})}M(s,m)};H(we,s=>{e(i)!==b.notOver&&s(_e)})}f(W);var se=u(W,2);Ge(se,{get nbColumns(){return Ne},get nbRows(){return qe},get board(){return e(t)},get winningCells(){return e(p)},onMove:C});var le=u(se,2),Me=h(le);{var ke=s=>{Xe(s,{onUpdate:m=>c(v,m,!0)})};H(Me,s=>{e(o)==="mcts"&&s(ke)})}f(le),J((s,m,j)=>{Z=D(X,1,"svelte-1bdwycb",null,Z,s),te=D(ee,1,"svelte-1bdwycb",null,te,m),ne=D(re,1,"svelte-1bdwycb",null,ne,j),ie.disabled=e(a).length===0},[()=>({selected:e(o)==="manual"}),()=>({selected:e(o)==="random"}),()=>({selected:e(o)==="mcts"})]),M(r,q),fe()}be(["click"]);export{mt as component};
