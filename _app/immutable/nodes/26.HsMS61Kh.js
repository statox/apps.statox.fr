import"../chunks/NZTpNUN0.js";import{p as ae,C as k,E as we,c as le,f as R,a as h,x as re,v as S,G as s,y as a,H as r,i as t,g as C,w as te}from"../chunks/Bq60w86z.js";import{d as Se,s as ne}from"../chunks/D-cnfVwm.js";import{a as De}from"../chunks/khe9oBlH.js";import{i as H}from"../chunks/BNlcmG6b.js";import{s as ie,a as oe}from"../chunks/DFsHvAv5.js";import{m as Ae}from"../chunks/BhpWGYsF.js";import{u as ce,U as Le}from"../chunks/B0VxaKin.js";import{M as xe}from"../chunks/SiFNRS46.js";import{r as Ee,a as ve,A as Me}from"../chunks/7APc-VPb.js";import{e as je,i as ze}from"../chunks/OO6y50zU.js";import{r as g,b as Ie,e as z,a as He}from"../chunks/DS3Hdpot.js";import{b as ee}from"../chunks/CQeCXbUh.js";import{t as ke}from"../chunks/CWtAs67g.js";import{M as Ne}from"../chunks/CHx69mvD.js";import{c as Ce}from"../chunks/BmudpX3i.js";import{M as Pe}from"../chunks/w3kwaUAs.js";import{M as Fe}from"../chunks/CD-7rhbj.js";import{M as Oe}from"../chunks/vliKg-vw.js";import{a as Te}from"../chunks/DTyfSRsR.js";import"../chunks/Bo32xdQq.js";import{p as Be}from"../chunks/CGVYNa7G.js";const Re=!1,Dt=Object.freeze(Object.defineProperty({__proto__:null,ssr:Re},Symbol.toStringTag,{value:"Module"})),be=async()=>Ee({path:"/webWatcher/getAllWatchers"}),ye=async c=>ve({path:"/webWatcher/createWatcher",data:c}),qe=async c=>ve({path:"/webWatcher/deleteWatcher",data:{id:c}}),Ge=async c=>ve({path:"/webWatcher/toggleWatcherEnabled",data:c}),Je=async(c,e,p,_,v,o,l,f,x)=>{C(e,[],!0),t(p)?.length||t(e).push({level:"error",header:"name must be defined"}),t(_)||t(e).push({level:"error",header:"notification message must be defined"}),t(v)==="CSS"&&!t(o)&&t(e).push({level:"error",header:"A CSS watcher must have a css selector defined"}),t(l)<15*60&&t(e).push({level:"error",header:"Check interval too small. Must be >= 15mn"});try{new URL(t(f))}catch{t(e).push({level:"error",header:"The URL is invalid"})}if(!t(e).length)try{t(v)==="CSS"?await ye({name:t(p),notificationMessage:t(_),url:t(f),cssSelector:t(o),checkIntervalSeconds:t(l),watchType:t(v)}):t(v)==="HASH"&&await ye({name:t(p),notificationMessage:t(_),url:t(f),checkIntervalSeconds:t(l),watchType:t(v)}),x.onUpload(),x.close()}catch(m){let b=m.message;m instanceof Me&&m.code===401?b="Invalid logged in user":m instanceof Le&&(b="User is logged out");const d=`<strong>Entry not created</strong><br/> ${b}`;ke.push(d,{theme:{"--toastBarBackground":"#FF0000"}})}};var Ve=S('<label for="css-selector">CSS selector</label> <input type="textarea"/>',1),Ke=S('<button class="form-action svelte-1cixduj">Submit</button>'),Qe=S('<span class="form-action svelte-1cixduj">Login to upload an entry</span>'),Xe=S('<div role="dialog" class="modal svelte-1cixduj"><div class="contents svelte-1cixduj"><h3 class="title-bar svelte-1cixduj">Add a new watcher <button>Close</button></h3> <!> <form class="form-content svelte-1cixduj"><label for="name">Name</label> <input type="text"/> <label for="check-interval">Check interval</label> <!> <label for="notification-message">Notification message (the @mention is automatically added)</label> <input type="textarea"/> <label for="watch-type">Watcher type</label> <select id="watch-type"><option>CSS</option><option>HASH</option></select> <label for="content">URL</label> <input type="textarea"/> <!> <br/> <!></form></div></div>');function Ye(c,e){ae(e,!0);const[p,_]=ie(),v=()=>oe(ce,"$user",p);let o=k(we([])),l=k(""),f=k(""),x=k(""),m=k(""),b=k(0),d=k("CSS");var W=le(),U=R(W);{var q=y=>{var i=Xe(),u=s(i),j=s(u),D=a(s(j));D.__click=function(...n){e.close?.apply(this,n)},r(j);var N=a(j,2);je(N,17,()=>t(o),ze,(n,w)=>{xe(n,{get item(){return t(w)}})});var G=a(N,2),P=a(s(G),2);g(P);var Z=a(P,4);Ne(Z,{allowedUnits:["minutes","hours","days"],defaultDuration:{value:1,unit:"hours"},get valueInSeconds(){return t(b)},set valueInSeconds(n){C(b,n,!0)}});var A=a(Z,4);g(A);var L=a(A,4),F=s(L);F.value=F.__value="CSS";var O=a(F);O.value=O.__value="HASH",r(L);var T=a(L,4);g(T);var J=a(T,2);{var V=n=>{var w=Ve(),B=a(R(w),2);g(B),ee(B,()=>t(m),X=>C(m,X)),h(n,w)};H(J,n=>{t(d)==="CSS"&&n(V)})}var K=a(J,4);{var Q=n=>{var w=Ke();w.__click=[Je,o,l,f,d,m,b,x,e],h(n,w)},se=n=>{var w=Qe();h(n,w)};H(K,n=>{v()?n(Q):n(se,!1)})}r(G),r(u),r(i),ee(P,()=>t(l),n=>C(l,n)),ee(A,()=>t(f),n=>C(f,n)),Ie(L,()=>t(d),n=>C(d,n)),ee(T,()=>t(x),n=>C(x,n)),h(y,i)};H(U,y=>{e.isOpen&&y(q)})}h(c,W),re(),_()}Se(["click"]);var Ze=S('<p class="section-3-item svelte-1jnygz9"><label for="css-selector">CSS selector <!></label> <input disabled type="textarea" class="svelte-1jnygz9"/></p>'),$e=S('<div class="section error-section svelte-1jnygz9"><p class="section-4-item svelte-1jnygz9"><label for="last-check">Last error</label> <input disabled type="textarea" class="svelte-1jnygz9"/></p> <p class="section-4-item svelte-1jnygz9"><label for="last-update">Last error message</label> <input disabled type="textarea" class="svelte-1jnygz9"/></p></div>'),et=S('<div class="item svelte-1jnygz9"><h3 class="item-title svelte-1jnygz9"><div class="item-name svelte-1jnygz9"> </div> <div class="item-actions svelte-1jnygz9"><!> <!></div></h3> <div class="section svelte-1jnygz9"><p class="section-1-item svelte-1jnygz9"><label for="check-interval">Check interval</label> <input disabled type="textarea" class="svelte-1jnygz9"/></p></div> <div class="section svelte-1jnygz9"><p class="section-2-item svelte-1jnygz9"><label for="notification-message">Notification message</label> <input disabled type="textarea" class="svelte-1jnygz9"/></p></div> <div class="section svelte-1jnygz9"><p class="section-3-item svelte-1jnygz9"><label for="content">URL</label> <a target="_blank" rel="noopener noreferrer"> </a></p> <!></div> <div class="section svelte-1jnygz9"><p class="section-4-item svelte-1jnygz9"><label for="last-check">Last check</label> <input disabled type="textarea" class="svelte-1jnygz9"/></p> <p class="section-4-item svelte-1jnygz9"><label for="last-update">Last content change</label> <input disabled type="textarea" class="svelte-1jnygz9"/></p></div> <!> <div class="section svelte-1jnygz9"><p class="section-3-item svelte-1jnygz9"><label for="last-update">Last content</label> <input disabled type="textarea" class="svelte-1jnygz9"/></p></div></div>');function tt(c,e){ae(e,!0);const[p,_]=ie(),v=()=>oe(ce,"$user",p),o=Ce(),l=i=>{const u=new Date(i*1e3);return u.toLocaleDateString()+" "+u.toLocaleTimeString()},f=e.watcher.lastCheckDateUnix===0?"Never checked before":l(e.watcher.lastCheckDateUnix),x=e.watcher.lastUpdateDateUnix===0?"Never changed":l(e.watcher.lastUpdateDateUnix),m=Te.fromMillis(e.watcher.checkIntervalSeconds*1e3).rescale().toHuman(),b=async()=>{if(!e.watcher.id){console.error("id must be defined");return}try{await qe(e.watcher.id),o("delete")}catch(i){const u=`<strong>Watcher not deleted</strong><br/> ${i.message}`;ke.push(u,{theme:{"--toastBarBackground":"#FF0000"}})}},d=async i=>{await Ge({watcherId:e.watcher.id,setToEnabled:i.detail==="on"}),o("update")};let W=e.watcher.archivalDateUnix?"off":"on";var U=le(),q=R(U);{var y=i=>{var u=et(),j=s(u),D=s(j),N=s(D,!0);r(D);var G=a(D,2),P=s(G);Oe(P,{get value(){return W},label:"Enabled",design:"slider",$$events:{change:d}});var Z=a(P,2);Fe(Z,{deleteAction:b}),r(G),r(j);var A=a(j,2),L=s(A),F=a(s(L),2);g(F),r(L),r(A);var O=a(A,2),T=s(O),J=a(s(T),2);g(J),r(T),r(O);var V=a(O,2),K=s(V),Q=a(s(K),2),se=s(Q,!0);r(Q),r(K);var n=a(K,2);{var w=E=>{var M=Ze(),I=s(M),$=a(s(I));Pe($,{get content(){return e.watcher.cssSelector}}),r(I);var Y=a(I,2);g(Y),r(M),te(()=>z(Y,e.watcher.cssSelector)),h(E,M)};H(n,E=>{e.watcher.watchType==="CSS"&&E(w)})}r(V);var B=a(V,2),X=s(B),de=a(s(X),2);g(de),r(X);var ue=a(X,2),he=a(s(ue),2);g(he),r(ue),r(B);var me=a(B,2);{var We=E=>{var M=$e(),I=s(M),$=a(s(I),2);g($),r(I);var Y=a(I,2),_e=a(s(Y),2);g(_e),r(Y),r(M),te(Ue=>{z($,Ue),z(_e,e.watcher.lastErrorMessage)},[()=>l(e.watcher.lastErrorDateUnix)]),h(E,M)};H(me,E=>{e.watcher.lastErrorDateUnix&&E(We)})}var pe=a(me,2),fe=s(pe),ge=a(s(fe),2);g(ge),r(fe),r(pe),r(u),te(()=>{ne(N,e.watcher.name),z(F,m),z(J,e.watcher.notificationMessage),He(Q,"href",e.watcher.url),ne(se,e.watcher.url),z(de,f),z(he,x),z(ge,e.watcher.lastContent)}),h(i,u)};H(q,i=>{v()&&i(y)})}h(c,U),re(),_()}var at=S('<div class="container svelte-c8nodu"></div>');function rt(c,e){ae(e,!0);const p=Ce(),_=(o,l)=>o.archivalDateUnix===null&&l.archivalDateUnix!==null?-1:o.archivalDateUnix!==null&&l.archivalDateUnix===null?1:l.id-o.id;var v=at();je(v,21,()=>e.watchers.sort(_),ze,(o,l)=>{tt(o,{get watcher(){return t(l)},$$events:{delete:()=>p("delete"),update:()=>p("update")}})}),r(v),h(c,v),re()}var st=(c,e)=>Ae.open(Ye,{onUpload:e}),nt=S("<p>Something went wrong</p> <p> </p>",1),lt=S("<p>Loading data</p>"),it=S("<h2>Create a new watcher</h2> <button>Add an entry</button> <h2>Watchers</h2> <!>",1);function At(c,e){ae(e,!0);const[p,_]=ie(),v=()=>oe(ce,"$user",p);Be.set("Web Watchers");let o=k(we(be()));const l=()=>C(o,be(),!0);var f=le(),x=R(f);{var m=d=>{var W=it(),U=a(R(W),2);U.__click=[st,l];var q=a(U,4);De(q,()=>t(o),y=>{var i=lt();h(y,i)},(y,i)=>{rt(y,{get watchers(){return t(i)},$$events:{delete:l,update:l}})},(y,i)=>{var u=nt(),j=a(R(u),2),D=s(j,!0);r(j),te(N=>ne(D,N),[()=>JSON.stringify(t(i))]),h(y,u)}),h(d,W)},b=d=>{xe(d,{item:{level:"info",header:"Login to list the watchers"}})};H(x,d=>{v()?d(m):d(b,!1)})}h(c,f),re(),_()}Se(["click"]);export{At as component,Dt as universal};
