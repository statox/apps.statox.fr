import"../chunks/DsnmJJEf.js";import{p as Y,b as f,f as R,s as i,g as e,aI as ie,r as o,h as S,i as k,a as n,d as Z,U as se,e as s,t as E,C as ae,c as ne,j as le}from"../chunks/BI5tnybL.js";import{d as ee,s as G}from"../chunks/BHBOcJDT.js";import{a as de}from"../chunks/Bd_CJ7Kj.js";import{m as ce}from"../chunks/CorErrAi.js";import{M as re}from"../chunks/CU7smKQC.js";import{M as me}from"../chunks/DZoLVZHK.js";import{P as z}from"../chunks/CELBgAxi.js";import{c as ve}from"../chunks/RZZgkjFT.js";import{s as ue}from"../chunks/C4YFThy0.js";import{i as D}from"../chunks/BcTGm7Fo.js";import{e as K,i as Q}from"../chunks/V4cWF7mx.js";import{r as W,a as j}from"../chunks/Db8wGxCz.js";import{b as X,d as fe}from"../chunks/u1KJTtVJ.js";import{t as oe}from"../chunks/DFOQ394W.js";import{b as pe}from"../chunks/Dsp9gY7N.js";import{A as ge}from"../chunks/CuMzzfZD.js";import"../chunks/DKXeG7-1.js";import{U as _e}from"../chunks/BWptIUEw.js";import{M as be}from"../chunks/D4b6Boo_.js";import{M as he}from"../chunks/CKwsCUeU.js";import"../chunks/CbJJCuUa.js";import"../chunks/BAfo2ktg.js";import{p as ye}from"../chunks/L3zL1n65.js";/* empty css                */const xe=!1,lt=Object.freeze(Object.defineProperty({__proto__:null,ssr:xe},Symbol.toStringTag,{value:"Module"})),te=ve.reactor.getEntriesForPublic,ke=async w=>{const l=z+"/reactor/addEntry";await ue.post(l).withCredentials().field("name",w.name).field("commaSeparatedTags",w.commaSeparatedTags).attach("file",w.file)};var we=f('<span class="tag svelte-noox7t"> </span>'),Me=f('<video class="medium-margin svelte-noox7t" style="max-width: 100%" controls></video>',2),Se=f('<img class="medium-margin svelte-noox7t"/>'),Ue=f('<div><div><b> </b></div> <div class="svelte-noox7t"></div> <div><button class="full-width svelte-noox7t"><i class="fas fa-copy"></i> Copy link</button></div></div> <div><a rel="noopener noreferrer" target="blank"><!></a></div>',1),Ce=f('<button class="full-width medium-margin svelte-noox7t">More...</button>'),Le=f('<input class="full-width medium-margin svelte-noox7t" type="text" placeholder="Search by tags or name"/> <div class="container svelte-noox7t"></div> <!>',1);function Te(w,l){Y(l,!0);const m=10;let p=S(1),g=S("");const M=ie(()=>l.reactions.filter(t=>b(t,e(g))).sort((t,a)=>a.creationDateUnix-t.creationDateUnix).slice(0,e(g).length?void 0:e(p)*m)),b=(t,a)=>{if(!a.length||t.name.toLowerCase().includes(a.toLowerCase()))return!0;for(const L of t.tags)if(L.toLowerCase().includes(a.toLowerCase()))return!0;return!1},h=t=>{navigator.clipboard.writeText(z+t.uri),oe.push('<i class="fas fa-check"></i> Link copied to clipboard',{duration:1e3,theme:{"--toastBarHeight":0}})},F=t=>t.s3PresignedUrl.includes(".mp4");var d=Le(),v=R(d);W(v);var _=i(v,2);K(_,21,()=>e(M),Q,(t,a)=>{var I=Ue(),L=R(I),U=s(L),H=s(U),q=s(H,!0);o(H),o(U);var T=i(U,2);K(T,21,()=>e(a).tags,Q,(y,x)=>{var $=we(),r=s($,!0);o($),E(()=>G(r,e(x))),n(y,$)}),o(T);var O=i(T,2),B=s(O);B.__click=()=>h(e(a)),o(O),o(L);var P=i(L,2),C=s(P),N=s(C);{var V=y=>{var x=Me();E(()=>j(x,"src",z+e(a).uri)),n(y,x)},A=y=>{var x=Se();E(()=>{j(x,"src",z+e(a).uri),j(x,"alt",e(a).name)}),n(y,x)};D(N,y=>{F(e(a))?y(V):y(A,!1)})}o(C),o(P),E(()=>{G(q,e(a).name),j(C,"href",z+e(a).uri),j(C,"download",e(a).name)}),n(t,I)}),o(_);var c=i(_,2);{var u=t=>{var a=Ce();a.__click=()=>se(p),n(t,a)};D(c,t=>{e(g).length===0&&e(p)*m<l.reactions.length&&t(u)})}X(v,()=>e(g),t=>k(g,t)),n(w,d),Z()}ee(["click"]);var Pe=f('<!> <form class="form-content svelte-1kgynly"><label for="name">Name</label> <input type="text"/> <label for="content">Tags</label> <input type="textarea"/> <label for="file">File</label> <span><input class="file-input svelte-1kgynly" type="file"/> <button aria-label="delete file"><i class="fas fa-times-circle"></i></button></span> <br/> <button class="form-action svelte-1kgynly"><!></button></form>',1),Ae=f('<div role="dialog" class="modal svelte-1kgynly"><div class="contents svelte-1kgynly"><h4 class="title-bar svelte-1kgynly">Add a new file <button>Close</button></h4> <!></div></div>');function Ee(w,l){Y(l,!0);let m=S(ae([])),p=S(""),g=S(""),M=S(void 0),b=S(void 0),h=S(!1);const F=async()=>{k(m,[],!0),e(p)?.length||e(m).push({level:"error",header:"name must be defined"});let c;if(e(b)&&e(b).length&&(c=e(b)[0]),c||e(m).push({level:"error",header:"a file must be uploaded"}),!(e(m).length||!c))try{k(h,!0),await ke({name:e(p),commaSeparatedTags:e(g),file:c}),k(h,!1),l.onUpload(),l.close()}catch(u){k(h,!1);let t=u.message;u instanceof ge&&u.code===401?t="Invalid logged in user":u instanceof _e&&(t="User is logged out");const a=`<strong>Entry not created</strong><br/> ${t}`;oe.push(a,{theme:{"--toastBarBackground":"#FF0000"}})}};var d=ne(),v=R(d);{var _=c=>{var u=Ae(),t=s(u),a=s(t),I=i(s(a));I.__click=function(...U){l.close?.apply(this,U)},o(a);var L=i(a,2);re(L,{message:"Login to add an entry",requiredScope:"admin",children:(U,H)=>{var q=Pe(),T=R(q);K(T,17,()=>e(m),Q,(r,J)=>{be(r,{get item(){return e(J)}})});var O=i(T,2),B=i(s(O),2);W(B);var P=i(B,4);W(P);var C=i(P,4),N=s(C);pe(N,r=>k(M,r),()=>e(M));var V=i(N,2);V.__click=()=>{e(M)!==void 0&&(e(M).value="")},o(C);var A=i(C,4);A.__click=F;var y=s(A);{var x=r=>{he(r,{size:.5,unit:"em",durationSeconds:.5})},$=r=>{var J=le("Submit");n(r,J)};D(y,r=>{e(h)?r(x):r($,!1)})}o(A),o(O),E(()=>A.disabled=e(h)),X(B,()=>e(p),r=>k(p,r)),X(P,()=>e(g),r=>k(g,r)),fe(N,()=>e(b),r=>k(b,r)),n(U,q)},$$slots:{default:!0}}),o(t),o(u),n(c,u)};D(v,c=>{l.isOpen&&c(_)})}n(w,d),Z()}ee(["click"]);var Re=f("<button>Add an entry</button>"),Fe=f("<p>Something went wrong</p> <p> </p>",1),Ie=f("<p>Loading data</p>"),Oe=f("<!> <h2>Upload</h2> <!> <h2>Content</h2> <!>",1);function dt(w,l){Y(l,!0);const m={name:"Reactor",description:"My collection of memes",showAuthInHeader:!0};ye.set(m);let p=S(ae(te()));const g=()=>k(p,te(),!0);var M=Oe(),b=R(M);me(b,{get title(){return m.name},get description(){return m.description}});var h=i(b,4);re(h,{message:"Login to add an entry",requiredScope:"admin",children:(d,v)=>{var _=Re();_.__click=()=>ce.open(Ee,{onUpload:g}),n(d,_)},$$slots:{default:!0}});var F=i(h,4);de(F,()=>e(p),d=>{var v=Ie();n(d,v)},(d,v)=>{Te(d,{get reactions(){return e(v)}})},(d,v)=>{var _=Fe(),c=i(R(_),2),u=s(c,!0);o(c),E(t=>G(u,t),[()=>JSON.stringify(e(v))]),n(d,_)}),n(w,M),Z()}ee(["click"]);export{dt as component,lt as universal};
