import"../chunks/DsnmJJEf.js";import{p as ee,h as k,C as pe,c as be,f as B,a as f,d as te,b as g,e as s,s as a,r,g as e,i as U,t as $}from"../chunks/BJRZRhu8.js";import{d as _e,s as oe}from"../chunks/B3kKxc5b.js";import{a as Ue}from"../chunks/ItrR6YhR.js";import{m as We}from"../chunks/D7slEtv1.js";import{c as ae}from"../chunks/RZZgkjFT.js";import{i as K}from"../chunks/Bf4rEyHI.js";import{e as ge,i as we}from"../chunks/CD5Q4Pji.js";import{r as m,a as x,s as Ce}from"../chunks/h256F5ba.js";import{b as Z}from"../chunks/BrzxCuy6.js";import{b as Me}from"../chunks/B0MbDCwi.js";import{A as De}from"../chunks/CuMzzfZD.js";import{u as Ae}from"../chunks/Ds0xSSFg.js";import{U as Le}from"../chunks/BWptIUEw.js";import{t as Se}from"../chunks/DL4ggUP-.js";import{M as Ee}from"../chunks/eIcGAGwT.js";import{M as Ie}from"../chunks/wpzuNzpY.js";import{M as ye}from"../chunks/DpJBG4EJ.js";import{a as He,s as Te}from"../chunks/Elmngvfr.js";import{M as qe}from"../chunks/D8qLQYPx.js";import{M as Ne}from"../chunks/CGMo3KXh.js";import{M as Fe}from"../chunks/DpmHVh-P.js";import{a as Oe}from"../chunks/CkcISRbr.js";import"../chunks/CYMEFg2K.js";import"../chunks/BH7JXOrj.js";import{p as Pe}from"../chunks/DxqDe86E.js";/* empty css                */const Be=!1,At=Object.freeze(Object.defineProperty({__proto__:null,ssr:Be},Symbol.toStringTag,{value:"Module"})),me=ae.webWatcher.getAllWatchers,fe=ae.webWatcher.createWatcher,Re=ae.webWatcher.deleteWatcher,je=ae.webWatcher.toggleWatcherEnabled;var ze=g('<label for="css-selector">CSS selector</label> <input type="textarea"/>',1),Je=g('<!> <form class="form-content svelte-8qhbr8"><label for="name">Name</label> <input type="text"/> <label for="check-interval">Check interval</label> <!> <label for="notification-message">Notification message (the @mention is automatically added)</label> <input type="textarea"/> <label for="watch-type">Watcher type</label> <select id="watch-type"><option>CSS</option><option>HASH</option></select> <label for="content">URL</label> <input type="textarea"/> <!> <br/> <button class="form-action svelte-8qhbr8">Submit</button></form>',1),Ve=g('<div role="dialog" class="modal svelte-8qhbr8"><div class="contents svelte-8qhbr8"><h3 class="title-bar svelte-8qhbr8">Add a new watcher <button>Close</button></h3> <!></div></div>');function Ge(W,t){ee(t,!0);let n=k(pe([])),i=k(""),c=k(""),o=k(""),w=k(""),b=k(0),h=k("CSS");const S=async()=>{U(n,[],!0),e(i)?.length||e(n).push({level:"error",header:"name must be defined"}),e(c)||e(n).push({level:"error",header:"notification message must be defined"}),e(h)==="CSS"&&!e(w)&&e(n).push({level:"error",header:"A CSS watcher must have a css selector defined"}),e(b)<900&&e(n).push({level:"error",header:"Check interval too small. Must be >= 15mn"});try{new URL(e(o))}catch{e(n).push({level:"error",header:"The URL is invalid"})}if(!e(n).length)try{e(h)==="CSS"?await fe({name:e(i),notificationMessage:e(c),url:e(o),cssSelector:e(w),checkIntervalSeconds:e(b),watchType:e(h)}):e(h)==="HASH"&&await fe({name:e(i),notificationMessage:e(c),url:e(o),checkIntervalSeconds:e(b),watchType:e(h)}),t.onUpload(),t.close()}catch(d){let p=d.message;d instanceof De&&d.code===401?p="Invalid logged in user":d instanceof Le&&(p="User is logged out");const v=`<strong>Entry not created</strong><br/> ${p}`;Se.push(v,{theme:{"--toastBarBackground":"#FF0000"}})}};var _=be(),H=B(_);{var C=d=>{var p=Ve(),v=s(p),u=s(v),R=a(s(u));R.__click=function(...z){t.close?.apply(this,z)},r(u);var j=a(u,2);ye(j,{message:"Login to upload an entry",requiredScope:"admin",children:(z,re)=>{var J=Je(),Q=B(J);ge(Q,17,()=>e(n),we,(l,y)=>{Ee(l,{get item(){return e(y)}})});var T=a(Q,2),q=a(s(T),2);m(q);var V=a(q,4);Ie(V,{allowedUnits:["minutes","hours","days"],defaultDuration:{value:1,unit:"hours"},get valueInSeconds(){return e(b)},set valueInSeconds(l){U(b,l,!0)}});var M=a(V,4);m(M);var D=a(M,4),N=s(D);N.value=N.__value="CSS";var F=a(N);F.value=F.__value="HASH",r(D);var A=a(D,4);m(A);var O=a(A,2);{var se=l=>{var y=ze(),P=a(B(y),2);m(P),Z(P,()=>e(w),X=>U(w,X)),f(l,y)};K(O,l=>{e(h)==="CSS"&&l(se)})}var le=a(O,4);le.__click=S,r(T),Z(q,()=>e(i),l=>U(i,l)),Z(M,()=>e(c),l=>U(c,l)),Me(D,()=>e(h),l=>U(h,l)),Z(A,()=>e(o),l=>U(o,l)),f(z,J)},$$slots:{default:!0}}),r(v),r(p),f(d,p)};K(H,d=>{t.isOpen&&d(C)})}f(W,_),te()}_e(["click"]);var Ke=g('<p class="section-3-item svelte-1e53865"><label for="css-selector">CSS selector <!></label> <input disabled type="textarea" class="svelte-1e53865"/></p>'),Qe=g('<div class="section error-section svelte-1e53865"><p class="section-4-item svelte-1e53865"><label for="last-check">Last error</label> <input disabled type="textarea" class="svelte-1e53865"/></p> <p class="section-4-item svelte-1e53865"><label for="last-update">Last error message</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div>'),Xe=g('<div class="item svelte-1e53865"><h3 class="item-title svelte-1e53865"><div class="item-name svelte-1e53865"> </div> <div class="item-actions svelte-1e53865"><!> <!></div></h3> <div class="section svelte-1e53865"><p class="section-1-item svelte-1e53865"><label for="check-interval">Check interval</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <div class="section svelte-1e53865"><p class="section-2-item svelte-1e53865"><label for="notification-message">Notification message</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <div class="section svelte-1e53865"><p class="section-3-item svelte-1e53865"><label for="content">URL</label> <a target="_blank" rel="noopener noreferrer"> </a></p> <!></div> <div class="section svelte-1e53865"><p class="section-4-item svelte-1e53865"><label for="last-check">Last check</label> <input disabled type="textarea" class="svelte-1e53865"/></p> <p class="section-4-item svelte-1e53865"><label for="last-update">Last content change</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <!> <div class="section svelte-1e53865"><p class="section-3-item svelte-1e53865"><label for="last-update">Last content</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div></div>');function Ye(W,t){ee(t,!0);const n=()=>He(Ae,"$user",i),[i,c]=Te(),o=v=>{const u=new Date(v*1e3);return u.toLocaleDateString()+" "+u.toLocaleTimeString()},w=t.watcher.lastCheckDateUnix===0?"Never checked before":o(t.watcher.lastCheckDateUnix||0),b=t.watcher.lastUpdateDateUnix===0?"Never changed":o(t.watcher.lastUpdateDateUnix||0),h=Oe.fromMillis(t.watcher.checkIntervalSeconds*1e3).rescale().toHuman(),S=async()=>{if(!t.watcher.id){console.error("id must be defined");return}try{await Re({id:t.watcher.id}),t.onDelete()}catch(v){const u=`<strong>Watcher not deleted</strong><br/> ${v.message}`;Se.push(u,{theme:{"--toastBarBackground":"#FF0000"}})}},_=async v=>{await je({watcherId:t.watcher.id,setToEnabled:v==="on"}),t.onUpdate()};let H=t.watcher.archivalDateUnix?"off":"on";var C=be(),d=B(C);{var p=v=>{var u=Xe(),R=s(u),j=s(R),z=s(j,!0);r(j);var re=a(j,2),J=s(re);Fe(J,{get value(){return H},label:"Enabled",onchange:_,design:"slider"});var Q=a(J,2);Ne(Q,{deleteAction:S}),r(re),r(R);var T=a(R,2),q=s(T),V=a(s(q),2);m(V),r(q),r(T);var M=a(T,2),D=s(M),N=a(s(D),2);m(N),r(D),r(M);var F=a(M,2),A=s(F),O=a(s(A),2),se=s(O,!0);r(O),r(A);var le=a(A,2);{var l=L=>{var E=Ke(),I=s(E),Y=a(s(I));qe(Y,{get content(){return t.watcher.cssSelector}}),r(I);var G=a(I,2);m(G),r(E),$(()=>x(G,t.watcher.cssSelector)),f(L,E)};K(le,L=>{t.watcher.cssSelector&&L(l)})}r(F);var y=a(F,2),P=s(y),X=a(s(P),2);m(X),r(P);var ne=a(P,2),ie=a(s(ne),2);m(ie),r(ne),r(y);var ce=a(y,2);{var xe=L=>{var E=Qe(),I=s(E),Y=a(s(I),2);m(Y),r(I);var G=a(I,2),ue=a(s(G),2);m(ue),r(G),r(E),$(ke=>{x(Y,ke),x(ue,t.watcher.lastErrorMessage)},[()=>o(t.watcher.lastErrorDateUnix)]),f(L,E)};K(ce,L=>{t.watcher.lastErrorDateUnix&&L(xe)})}var ve=a(ce,2),de=s(ve),he=a(s(de),2);m(he),r(de),r(ve),r(u),$(()=>{oe(z,t.watcher.name),x(V,h),x(N,t.watcher.notificationMessage),Ce(O,"href",t.watcher.url),oe(se,t.watcher.url),x(X,w),x(ie,b),x(he,t.watcher.lastContent)}),f(v,u)};K(d,v=>{n()&&v(p)})}f(W,C),te(),c()}var Ze=g('<div class="container svelte-ihkiaa"></div>');function $e(W,t){ee(t,!0);const n=(c,o)=>c.archivalDateUnix===null&&o.archivalDateUnix!==null?-1:c.archivalDateUnix!==null&&o.archivalDateUnix===null?1:o.id-c.id;var i=Ze();ge(i,21,()=>t.watchers.sort(n),we,(c,o)=>{Ye(c,{get watcher(){return e(o)},get onDelete(){return t.onDelete},get onUpdate(){return t.onUpdate}})}),r(i),f(W,i),te()}var et=g("<p>Something went wrong</p> <p> </p>",1),tt=g("<p>Loading data</p>"),at=g("<h2>Create a new watcher</h2> <button>Add an entry</button> <h2>Watchers</h2> <!>",1);function Lt(W,t){ee(t,!0),Pe.set({name:"Web Watchers",showAuthInHeader:!0});let n=k(pe(me()));const i=()=>U(n,me(),!0);ye(W,{message:"Login to list the watchers",requiredScope:"admin",children:(c,o)=>{var w=at(),b=a(B(w),2);b.__click=()=>We.open(Ge,{onUpload:i});var h=a(b,4);Ue(h,()=>e(n),S=>{var _=tt();f(S,_)},(S,_)=>{$e(S,{get watchers(){return e(_)},onDelete:i,onUpdate:i})},(S,_)=>{var H=et(),C=a(B(H),2),d=s(C,!0);r(C),$(p=>oe(d,p),[()=>JSON.stringify(e(_))]),f(S,H)}),f(c,w)},$$slots:{default:!0}}),te()}_e(["click"]);export{Lt as component,At as universal};
