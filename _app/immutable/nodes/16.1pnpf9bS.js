import"../chunks/NZTpNUN0.js";import{z as xe,A as k,B as N,g as n,p as q,f as Z,F as C,x as E,a as M,E as Ce,v as x,s as m,aZ as ee,G as g,a_ as te,c as re,y as Pe}from"../chunks/Br9SMxIB.js";import{d as ke,e as ne,s as j}from"../chunks/BBzb7ThI.js";import{i as J}from"../chunks/CvXxFVm9.js";import{e as $,i as z}from"../chunks/D1-nhZYT.js";import{b as se,a as Ie,s as Ae,c as le,r as ae}from"../chunks/DWdbj9D8.js";import{b as ie}from"../chunks/C6S4cPPP.js";import{M as Oe}from"../chunks/DKmGubEx.js";var d=(e=>(e[e.notOver=0]="notOver",e[e.winPlayer1=1]="winPlayer1",e[e.winPlayer2=2]="winPlayer2",e[e.draw=3]="draw",e))(d||{});const T=7,I=6,y=4;class Ee extends Error{constructor(r){super("Can't play in column "+r)}}const K=e=>e.map(r=>[...r]),ce=(e,r)=>e[r].length!==I,D=e=>{const r=[];for(let t=0;t<e.length;t++)e[t].length<I&&r.push(t);return r},Te=e=>{const r=T*I,t=e.reduce((l,o)=>l+o.length,0);return r===t},qe=e=>{for(let r=0;r<T;r++)for(let t=0;t<I;t++){if(e[r].length<t||!e[r][t])continue;const l=e[r][t];let o=0,v=0,f=0,c=0;for(let s=0;s<y;s++)t+s<=e[r].length&&e[r][t+s]===l&&o++,r+s<e.length&&e[r+s][t]===l&&v++,r+s<e.length&&t+s<=e[r+s].length&&e[r+s][t+s]===l&&f++,r+s<e.length&&t-s>=0&&e[r+s][t-s]===l&&c++;if(o===y||v===y||f===y||c===y)return l}return null},Fe=e=>{if(A(e)===0)return null;for(let r=0;r<T;r++)for(let t=0;t<I;t++){if(e[r].length<t||!e[r][t])continue;const l=e[r][t],o=[],v=[],f=[],c=[];for(let s=0;s<y;s++)t+s<=e[r].length&&e[r][t+s]===l&&o.push([t+s,r]),r+s<e.length&&e[r+s][t]===l&&v.push([t,r+s]),r+s<e.length&&t+s<=e[r+s].length&&e[r+s][t+s]===l&&f.push([t+s,r+s]),r+s<e.length&&t-s>=0&&e[r+s][t-s]===l&&c.push([t-s,r+s]);if(o.length===y)return o;if(v.length===y)return v;if(f.length===y)return f;if(c.length===y)return c}return null},A=e=>{if(Te(e))return 3;const r=qe(e);return r===1?1:r===2?2:0},F=(e,r,t)=>{if(!ce(e,t))throw new Ee(t);return e[t].push(r),e},Ge=e=>{const r=D(e),t=Math.floor(Math.random()*r.length);return r[t]},Re=(e,r)=>{const t=Ge(e);return{board:F(e,r,t),move:t}},We=(e,r,t)=>{const l=He(e,r,t?.iterations,t?.c);return{board:F(e,r,l),move:l}};class ue{board;player;move;parent;children=[];visits=0;wins=0;constructor(r,t,l=null,o=null){this.board=r,this.player=t,this.move=l,this.parent=o}isFullyExpanded(){return this.children.length===D(this.board).length}isTerminal(){return A(this.board)!==d.notOver}}function oe(e,r,t,l=Math.sqrt(2)){return t===0?1/0:r/t+l*Math.sqrt(Math.log(e)/t)}function Ve(e,r){for(;!e.isTerminal();)if(e.isFullyExpanded())e=$e(e,r);else return Ne(e);return e}function Ne(e){const r=e.children.map(c=>c.move),l=D(e.board).filter(c=>!r.includes(c)),o=l[Math.floor(Math.random()*l.length)],v=K(e.board);F(v,e.player,o);const f=new ue(v,e.player===1?2:1,o,e);return e.children.push(f),f}function $e(e,r){return e.children.reduce((t,l)=>{const o=oe(e.visits,t.wins,t.visits,r);return oe(e.visits,l.wins,l.visits,r)>o?l:t})}function ze(e){const r=K(e.board);let t=e.player;for(;;){const l=A(r);if(l!==d.notOver)return l;const o=D(r),v=o[Math.floor(Math.random()*o.length)];F(r,t,v),t=t===1?2:1}}function De(e,r){let t=e;for(;t!==null;)t.visits+=1,r===d.winPlayer1&&t.parent?.player===1||r===d.winPlayer2&&t.parent?.player===2?t.wins+=1:r===d.draw&&(t.wins+=.5),t=t.parent}function He(e,r,t=1e3,l=Math.sqrt(2)){const o=new ue(K(e),r,null,null);for(let f=0;f<t;f++){const c=Ve(o,l),s=ze(c);De(c,s)}return o.children.reduce((f,c)=>f.visits>c.visits?f:c).move}const Le=(e,r,t)=>{m(r,Array.from({length:7},()=>[]),!0),m(t,1)};var Ue=(e,r,t,l)=>r(n(t),n(l)),Ze=q("<div><button><div></div></button></div>"),je=q("<option> </option>"),Je=(e,r,t,l)=>{n(r)&&(m(t,n(r).iterations,!0),m(l,n(r).c,!0))},Ke=q("<option> </option>"),Qe=(e,r)=>m(r,null),Se=(e,r)=>m(r,null),Xe=q(`<div><h4>Monte Carlo Tree Search parameters</h4> <label for="mcts-preset">Preset difficulty</label> <select></select> <br/><br/> <label for="mcts-iterations">Iterations:</label> <input id="mcts-iterations" type="number" min="0"/> <small>Number of simulations MCTS will run before choosing a move. Higher values usually mean
            stronger play but slower decisions.</small> <br/><br/> <label for="mcts-c">C (exploration constant):</label> <input id="mcts-c" type="number" min="0" step="0.1"/> <small>Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
            favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2
            ≈ 1.41.</small></div>`),Ye=q('<!> <div class="main"><h3>Gravitrip</h3></div> <div>See <a href="https://www.quora.com/What-is-the-winning-strategy-for-the-first-player-in-Connect-Four-games">this quora thread</a> for some tips on the winning strategy</div> <span><button>Restart game</button> <span style="font-weight: bold"><!></span></span> <div class="board svelte-1bdwycb"></div> <div>Computer stategy: <select></select></div> <!>',1);function it(e,r){xe(r,!0);let t=k(N(Array.from({length:7},()=>[]))),l=ee(()=>A(n(t))),o=ee(()=>Fe(n(t))),v=k(null);const f=[{name:"easy",iterations:200,c:2},{name:"medium",iterations:1e3,c:1.41},{name:"hard",iterations:5e3,c:.7}];let c=k(N(f[1])),s=k(N(n(c).iterations)),G=k(N(n(c).c)),O=k("mcts");const ve=Array.from({length:I},(a,i)=>i),fe=Array.from({length:T},(a,i)=>i);let b=k(1);const he=(a,i)=>{n(b)===1&&ce(n(t),a)&&A(n(t))===d.notOver&&(m(t,F(n(t),i,a),!0),m(b,n(b)===1?2:1,!0),me())},me=()=>{if(n(b)!==2||A(n(t))!==d.notOver)return;let a;if(n(O)==="random")a=Re(n(t),n(b));else if(n(O)==="mcts")a=We(n(t),n(b),{iterations:n(s),c:n(G)});else throw new Error("computer strategy not implemented");const{board:i,move:u}=a;m(t,i,!0),m(v,u,!0),m(b,1)},pe=(a,i)=>n(o)===null?!1:n(o).filter(u=>u[0]===a&&u[1]===i).length>0;var Q=Ye(),S=Z(Q);Oe(S,{title:"Gravitrip",description:"Gravitrip"});var H=x(S,6),X=C(H);X.__click=[Le,t,b];var Y=x(X,2),_e=C(Y);{var ge=a=>{var i=te("Game Over");M(a,i)},de=a=>{var i=re(),u=Z(i);{var w=_=>{var h=te();E(()=>j(h,`Player ${n(l)??""} wins`)),M(_,h)};J(u,_=>{(n(l)===d.winPlayer1||n(l)===d.winPlayer2)&&_(w)},!0)}M(a,i)};J(_e,a=>{n(l)===d.draw?a(ge):a(de,!1)})}g(Y),g(H);var R=x(H,2);$(R,21,()=>ve.reverse(),z,(a,i)=>{var u=re(),w=Z(u);$(w,17,()=>fe,z,(_,h)=>{var P=Ze(),p=C(P);let W;p.__click=[Ue,he,h,b];var V=C(p);let B;g(p),g(P),E((be,Me)=>{Ae(p,"aria-label","col-"+n(h)),W=le(p,1,"outer-cell svelte-1bdwycb",null,W,be),B=le(V,1,"cell svelte-1bdwycb",null,B,Me)},[()=>({selected:n(v)===n(h),"winning-cell":pe(n(i),n(h))}),()=>({player1:n(t)[n(h)][n(i)]===1,player2:n(t)[n(h)][n(i)]===2})]),ne("mouseenter",p,()=>m(v,n(h),!0)),ne("mouseleave",p,()=>m(v,null)),M(_,P)}),M(a,u)}),g(R);var L=x(R,2),U=x(C(L));$(U,20,()=>["mcts","random"],z,(a,i)=>{var u=je(),w=C(u,!0);g(u);var _={};E(()=>{j(w,i),_!==(_=i)&&(u.value=(u.__value=i)??"")}),M(a,u)}),g(U),g(L);var we=x(L,2);{var ye=a=>{var i=Xe(),u=x(C(i),4);u.__change=[Je,c,s,G],$(u,21,()=>f,z,(h,P)=>{var p=Ke(),W=C(p,!0);g(p);var V={};E(()=>{j(W,n(P).name),V!==(V=n(P))&&(p.value=(p.__value=n(P))??"")}),M(h,p)}),g(u);var w=x(u,7);ae(w),w.__change=[Qe,c];var _=x(w,9);ae(_),_.__change=[Se,c],Pe(2),g(i),se(u,()=>n(c),h=>m(c,h)),ie(w,()=>n(s),h=>m(s,h)),ie(_,()=>n(G),h=>m(G,h)),M(a,i)};J(we,a=>{n(O)==="mcts"&&a(ye)})}E(()=>Ie(R,`--nb-col: ${T}; --nb-row: ${I}`)),se(U,()=>n(O),a=>m(O,a)),M(e,Q),Ce()}ke(["click","change"]);export{it as component};
