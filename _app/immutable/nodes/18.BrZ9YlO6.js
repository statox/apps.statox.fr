import"../chunks/NZTpNUN0.js";import{o as ne}from"../chunks/DczscSsP.js";import{p as ie,b as m,f as d,s as n,a as s,d as se,e as O,r as x,g as a,h as b,i as r,c as q,t as V,j as Y}from"../chunks/CAng7chV.js";import{d as le,s as z}from"../chunks/B31O6ZDe.js";import{i as v}from"../chunks/D8trZI8D.js";import{r as pe}from"../chunks/h-aEY1xR.js";import{b as ve}from"../chunks/B4T-OeiH.js";import{B,a as F}from"../chunks/DyX4q1w1.js";import{P as _e}from"../chunks/CpX8xF_L.js";import{r as me}from"../chunks/DbZds5bN.js";import{g as ce}from"../chunks/C-Z6awDl.js";const ge=async(I,C,o)=>{const S=await me({path:"/gravitrips/getNewGame"});r(C,S.gameId,!0),o()};var ue=()=>ce("/gravitrips"),fe=m('<button>Start a new game</button> <br/> <input type="string"/> <button>Join Game</button>',1),de=m("<p>Connecting to the server…</p>"),be=m("<p>Waiting for an opponent to connect…</p>"),ye=m("<p> </p> <!>",1),we=m("<p>Something went wrong. Board is not defined.</p>"),Se=m('<p>Game over</p> <button>Restart</button> <span style="font-weight: bold"><!></span> <!>',1),he=m("<p>Disconnected</p>"),ke=m("<h3>Online game <button>Back</button></h3> <!> <!> <!> <!> <!> <!>",1);function Ee(I,C){ie(C,!0);let o,S=b(null),c=b(null),g=b(null),h=b(null),l=b("initial"),k=b("");const H=_e.replace(/^http?/,"ws");ne(()=>{o&&o.close()});const W=()=>{o=new WebSocket(H+"/gravitrips/ws?"+a(k)),r(l,"connecting"),r(c,null),r(g,null),r(h,null),o.onopen=()=>{r(l,"waiting_for_opponent")},o.onclose=e=>{console.log(e.reason),r(l,"disconnected")},o.onmessage=e=>{const t=JSON.parse(e.data);t.type==="game_ready"?(r(l,"playing"),r(S,t.youAre,!0),r(c,t.board,!0)):t.type==="update_board"?(r(c,t.board,!0),r(g,t.boardState,!0),r(h,t.winningCells,!0)):t.type==="waiting_for_opponent"?r(g,null):t.type==="game_over"&&r(l,"game_over")}},A=e=>{if(!o||o.readyState!==WebSocket.OPEN)return;const t=JSON.stringify({type:"move",column:e});o.send(t)},K=()=>{if(!o||o.readyState!==WebSocket.OPEN)return;const e=JSON.stringify({type:"restart"});o.send(e)};var E=ke(),R=d(E),Q=n(O(R));Q.__click=[ue],x(R);var J=n(R,2);{var T=e=>{var t=fe(),u=d(t);u.__click=[ge,k,W];var _=n(u,4);pe(_);var y=n(_,2);y.__click=W,ve(_,()=>a(k),p=>r(k,p)),s(e,t)};v(J,e=>{["initial","waiting_for_opponent","game_over","disconnected"].includes(a(l))&&e(T)})}var L=n(J,2);{var X=e=>{var t=de();s(e,t)};v(L,e=>{a(l)==="connecting"&&e(X)})}var M=n(L,2);{var Z=e=>{var t=be();s(e,t)};v(M,e=>{a(l)==="waiting_for_opponent"&&e(Z)})}var U=n(M,2);{var $=e=>{var t=q(),u=d(t);{var _=p=>{var f=ye(),w=d(f),G=O(w);x(w);var i=n(w,2);F(i,{nbColumns:7,nbRows:6,get board(){return a(c)},get winningCells(){return a(h)},onMove:A}),V(()=>z(G,`You are Player ${a(S)??""}`)),s(p,f)},y=p=>{var f=we();s(p,f)};v(u,p=>{a(c)!==null?p(_):p(y,!1)})}s(e,t)};v(U,e=>{a(l)==="playing"&&e($)})}var D=n(U,2);{var ee=e=>{var t=Se(),u=n(d(t),2);u.__click=K;var _=n(u,2),y=O(_);{var p=i=>{var P=Y("Game Over");s(i,P)},f=i=>{var P=q(),re=d(P);{var oe=N=>{var j=Y();V(()=>z(j,`Player ${a(g)??""} wins`)),s(N,j)};v(re,N=>{(a(g)===B.winPlayer1||a(g)===B.winPlayer2)&&N(oe)},!0)}s(i,P)};v(y,i=>{a(g)===B.draw?i(p):i(f,!1)})}x(_);var w=n(_,2);{var G=i=>{F(i,{nbColumns:7,nbRows:6,get board(){return a(c)},get winningCells(){return a(h)},onMove:A})};v(w,i=>{a(c)!==null&&i(G)})}s(e,t)};v(D,e=>{a(l)==="game_over"&&e(ee)})}var te=n(D,2);{var ae=e=>{var t=he();s(e,t)};v(te,e=>{a(l)==="disconnected"&&e(ae)})}s(I,E),se()}le(["click"]);export{Ee as component};
