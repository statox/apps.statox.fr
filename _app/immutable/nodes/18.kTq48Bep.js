import{g as Vt,u as pt,a as Ut,b as qt}from"../chunks/DMgHhTHB.js";import"../chunks/CWj6FrbW.js";import{p as H,aK as bt,k as O,g as t,n as K,aF as M,s as A,aP as kt,v as E,w as p,aD as d,aE as i,aC as Ft,a2 as tt,o as ht}from"../chunks/Blh4VyvI.js";import{s as F}from"../chunks/B_qPQ7Zq.js";import{e as R,i as P}from"../chunks/DyR1-sIv.js";import{f as ot,t as S,a as b,e as W,j as wt}from"../chunks/8vVwn2F4.js";import{c as Mt}from"../chunks/uCqu9nX0.js";import{b as ut,c as Ct,a as et,s as dt,r as _t}from"../chunks/CPfKleoE.js";import{b as Ot,d as Et}from"../chunks/BFWew6DG.js";import{p as U}from"../chunks/BzpYSpev.js";import{a as ft,s as yt,b as Lt}from"../chunks/BaEUL8ty.js";import{m as jt}from"../chunks/DoZHSm50.js";import{a as xt}from"../chunks/Bo_S-UWD.js";import{M as Nt}from"../chunks/CpZXQHtZ.js";import{M as It}from"../chunks/6L4D3DO1.js";import{i as z}from"../chunks/DB3ygwRk.js";import{k as gt}from"../chunks/DUvsV-_r.js";import{p as vt}from"../chunks/BVzqg3c7.js";import{b as Rt,g as Pt}from"../chunks/h6nPAO3g.js";import{t as Jt}from"../chunks/DDcqXY7S.js";import{A as zt}from"../chunks/BwmPBYWw.js";import{U as Ht,u as Kt}from"../chunks/BZAV2y1m.js";import{b as Gt}from"../chunks/CU5nAuxS.js";import{a as Wt}from"../chunks/OgUPjNJU.js";import"../chunks/DyTJ21-Y.js";import{p as Qt}from"../chunks/adzP3oOU.js";const Xt=!1,Yt=async()=>({chords:await Vt()}),ha=Object.freeze(Object.defineProperty({__proto__:null,load:Yt,ssr:Xt},Symbol.toStringTag,{value:"Module"}));var Zt=S('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" class="svelte-1kbb9q3"><path d="M12 6H0l6-6z"></path></svg> <span class="screen-reader-text svelte-1kbb9q3">Back to top</span></button>');function $t(_,e){H(e,!0);let n=M(0),s=M(!0),f;const D=o=>{o>0?A(s,!1):A(s,!0),f&&clearTimeout(f),f=setTimeout(()=>{A(s,!0)},3e3)},k=()=>{const o=document.documentElement.scrollTop||document.body.scrollTop;o>0&&(window.requestAnimationFrame(k),window.scrollTo(0,o-o/2))};bt(()=>D(t(n)));var r=Zt();let a;r.__click=k,O(o=>a=ut(r,1,"top-link svelte-1kbb9q3",null,a,o),[()=>({hide:t(s)})]),xt("y",()=>t(n),o=>A(n,U(o))),b(_,r),K()}ot(["click"]);const st=kt();let St=[];const mt=localStorage.getItem("failedVisitCounts");if(mt!==null)try{St=JSON.parse(mt)}catch{console.error("Couldnt parse failedVisitCounts from local storage")}const ct=kt(St);ct.subscribe(_=>{localStorage.setItem("failedVisitCounts",JSON.stringify(_))});const Dt=_=>_==="doc"?"fas fa-file-word":_==="pdf"?"fas fa-file-pdf":_==="youtube"?"fa fa-youtube":"fas fa-link",te=async(_,e,n)=>{try{await pt(e.chord.url);const s=Ft(st),f=s.get(e.chord.url)||{count:0,lastAccessDateUnix:0};f.count++,f.lastAccessDateUnix=Date.now()/1e3,s.set(e.chord.url,f),st.set(s)}catch(s){let f=s.message;s instanceof zt&&s.code===401?f="Invalid logged in user":s instanceof Ht&&(f="User is logged out"),Lt(ct,[...n(),e.chord.url]);const D=`<strong>Visit not counted</strong><br/> ${f}`;Jt.push(D,{initial:1,duration:5e3,theme:{"--toastBarBackground":"#FF0000"}})}};var ee=S('<span></span> <span><a target="_blank" rel="noopener noreferrer"></a></span>',1);function nt(_,e){H(e,!0);const[n,s]=yt(),f=()=>ft(ct,"$failedVisitCounts",n);let D=vt(e,"showArtist",3,!1),k=M(void 0);st.subscribe(l=>{if(l&&l.has(e.chord.url)){const c=l.get(e.chord.url),u=new Date(c.lastAccessDateUnix*1e3);A(k,`visits: ${c.count} - last: ${u.toLocaleDateString()}`)}});const r=(D()?e.chord.artist+" - ":"")+e.chord.title,a=l=>l.type==="doc"?`${Rt}/docviewer/${l.url}`:l.url;var o=ee(),h=E(o),m=p(h,2),y=d(m);y.__click=[te,e,f],y.textContent=r,i(m),O((l,c)=>{ut(h,1,l,"svelte-1yqqigs"),et(y,"href",c),et(y,"title",t(k))},[()=>Ct(Dt(e.chord.type)),()=>a(e.chord)]),b(_,o),K(),s()}ot(["click"]);var ae=S('<li class="ul2col-item"><!> <!></li>'),re=S('<ul class="ul2col-container"></ul>');function se(_,e){H(e,!0);let n=vt(e,"chords",15),s=M(void 0);st.subscribe(r=>{r&&(A(s,U(r)),n(n().sort((a,o)=>{const h=r.get(a.url),m=r.get(o.url);return h&&m?m.lastAccessDateUnix-h.lastAccessDateUnix:h?-1:m?1:a.artist!=o.artist?a.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:a.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(r,a,o)=>o[r.type]===!1?!1:a.length===0||r.artist.toLowerCase().match(a.toLowerCase())?!0:r.title.toLowerCase().match(a.toLowerCase());var D=W(),k=E(D);gt(k,n,r=>{var a=re();R(a,21,n,P,(o,h)=>{var m=W();const y=tt(()=>{var u;return(u=t(s))==null?void 0:u.get(t(h).url)});var l=E(m);{var c=u=>{var x=ae(),v=d(x);{var g=L=>{var C=wt();O(()=>F(C,`(${t(y).count??""})`)),b(L,C)};z(v,L=>{t(y)&&L(g)})}var w=p(v,2);nt(w,{get chord(){return t(h)},showArtist:!0}),i(x),b(u,x)};z(l,u=>{f(t(h),e.searchString,e.filters)&&u(c)})}b(o,m)}),i(a),b(r,a)}),b(_,D),K()}const oe=(_,e)=>_<e?-1:_>e?1:0,Tt=(_,e)=>{const n=_.toLowerCase(),s=e.toLowerCase();return oe(n,s)};var ne=S('<li class="navigationBtn svelte-1deg5s8"><a class="navigationLink svelte-1deg5s8"> </a></li>'),le=S('<li class="ul2col-item"><!></li>'),ie=S('<ul class="ul2col-container"></ul>'),ce=S('<tr class="svelte-1deg5s8"><td class="svelte-1deg5s8"> <!></td></tr>'),ue=S('<ol id="indexList" class="navigationBar disable-scrollbars svelte-1deg5s8"></ol> <table id="artistTable"><tbody></tbody></table>',1);function ve(_,e){H(e,!0);let n=vt(e,"searchString",3,"");const s=e.chords.reduce((v,g)=>{const w=g.artist;return v[w]||(v[w]=[]),v[w].push(g),v},{}),f=[],D=Object.keys(s).sort(Tt).map((v,g,w)=>{if(g===0||v[0].toLowerCase()!=w[g-1][0].toLowerCase()){const L="anchor_letter_"+v[0];return f.push({letter:v[0],tag:L}),{name:v,tag:L}}return{name:v}});let k=M(0),r=M(0),a=M(void 0);const o=v=>{if(t(a)){var g=t(a).getBoundingClientRect();if(g.top<20){A(r,20);return}A(r,U(g.top))}};bt(()=>o(t(k)));const h=(v,g,w)=>s[v].sort((C,B)=>C.title<B.title?-1:1).filter(C=>{const B=C.type;return w[B]===!1?!1:g.length===0?!0:!!C.title.toLowerCase().match(g.toLowerCase())}),m=(v,g)=>!!v.toLowerCase().match(g.toLowerCase());var y=ue(),l=E(y);let c;R(l,21,()=>f,P,(v,g)=>{var w=ne(),L=d(w),C=d(L,!0);i(L),i(w),O(B=>{et(L,"href","#"+t(g).tag),F(C,B)},[()=>t(g).letter.toUpperCase()]),b(v,w)}),i(l);var u=p(l,2),x=d(u);R(x,21,()=>D,P,(v,g)=>{var w=W();const L=tt(()=>h(t(g).name,n(),e.filters)),C=tt(()=>m(t(g).name,n()));var B=E(w);{var N=$=>{var G=ce();const at=tt(()=>t(C)?s[t(g).name]:t(L));var J=d(G),Q=d(J),rt=p(Q);gt(rt,n,I=>{var X=ie();R(X,21,()=>t(at),P,(Y,lt)=>{var T=le(),V=d(T);nt(V,{get chord(){return t(lt)}}),i(T),b(Y,T)}),i(X),b(I,X)}),i(J),i(G),O(()=>{et(J,"id",t(g).tag),F(Q,`${t(g).name??""} `)}),b($,G)};z(B,$=>{(t(C)||t(L).length>0)&&$(N)})}b(v,w)}),i(x),i(u),Gt(u,v=>A(a,v),()=>t(a)),O(()=>c=dt(l,"",c,{"--barTop":`${t(r)??""}px`})),xt("y",()=>t(k),v=>A(k,U(v))),b(_,y),K()}var de=S('<li class="ul2col-item"><!></li>'),fe=S('<div><span> </span> <ul class="ul2col-container"></ul></div>');function he(_,e){H(e,!0);const n=k=>k.charAt(0).toUpperCase()+k.slice(1).toLowerCase(),s=U({});for(const k of e.chords)k.tags.forEach(a=>{s[a]||(s[a]=[]),s[a].push(k)});Object.keys(s).forEach(k=>{s[k].sort((r,a)=>{const o=r.artist.toLowerCase(),h=a.artist.toLowerCase(),m=r.title.toLowerCase(),y=a.title.toLowerCase();return o<h?-1:o>h?1:m<y?-1:1})});var f=W(),D=E(f);R(D,17,()=>Object.keys(s).sort(Tt),P,(k,r)=>{var a=W(),o=E(a);{var h=m=>{var y=fe(),l=d(y),c=d(l,!0);i(l);var u=p(l,2);R(u,21,()=>s[t(r)],P,(x,v)=>{var g=W(),w=E(g);{var L=C=>{var B=de(),N=d(B);nt(N,{get chord(){return t(v)},showArtist:!0}),i(B),b(C,B)};z(w,C=>{e.filters[t(v).type]&&C(L)})}b(x,g)}),i(u),i(y),O(x=>F(c,x),[()=>n(t(r))]),b(m,y)};z(o,m=>{(e.searchString.length===0||t(r).toLowerCase().match(e.searchString.toLowerCase()))&&m(h)})}b(k,a)}),b(_,f),K()}var ge=S('<li class="ul2col-item"><!> <!></li>'),_e=S('<ul class="ul2col-container"></ul>');function me(_,e){H(e,!0);let n=vt(e,"chords",15),s=M(void 0);st.subscribe(r=>{r&&(A(s,U(r)),n(n().sort((a,o)=>{const h=r.get(a.url),m=r.get(o.url);return h&&m?h.count!==m.count?m.count-h.count:m.lastAccessDateUnix-h.lastAccessDateUnix:h?-1:m?1:a.artist!=o.artist?a.artist.toLowerCase()<o.artist.toLowerCase()?-1:1:a.title.toLowerCase()<o.title.toLowerCase()?-1:1})))});const f=(r,a,o)=>o[r.type]===!1?!1:a.length===0||r.artist.toLowerCase().match(a.toLowerCase())?!0:r.title.toLowerCase().match(a.toLowerCase());var D=W(),k=E(D);gt(k,n,r=>{var a=_e();R(a,21,n,P,(o,h)=>{var m=W();const y=tt(()=>{var u;return(u=t(s))==null?void 0:u.get(t(h).url)});var l=E(m);{var c=u=>{var x=ge(),v=d(x);{var g=L=>{var C=wt();O(()=>F(C,`(${t(y).count??""})`)),b(L,C)};z(v,L=>{t(y)&&L(g)})}var w=p(v,2);nt(w,{get chord(){return t(h)},showArtist:!0}),i(x),b(u,x)};z(l,u=>{f(t(h),e.searchString,e.filters)&&u(c)})}b(o,m)}),i(a),b(r,a)}),b(_,D),K()}var pe=S('<span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"><a target="_blank" rel="noopener noreferrer"> </a></span> <span class="col svelte-5k8p3l"> </span>',1),be=S('<div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Last Check</span> <span class="col table-head svelte-5k8p3l">Checks</span> <span class="col table-head svelte-5k8p3l">Skipped</span> <span class="col table-head svelte-5k8p3l">Errors</span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span> <span class="col svelte-5k8p3l"> </span></div> <br> <div class="rows svelte-5k8p3l"><span class="col table-head svelte-5k8p3l">Status</span> <span class="col table-head svelte-5k8p3l">Ref</span> <span class="col table-head svelte-5k8p3l">Host</span> <span class="col table-head svelte-5k8p3l">Data</span> <!></div>',1),ke=S('<p style="color: red"> </p>'),we=S("<p>Fetching results...</p>"),Ce=S('<div role="dialog" class="modal svelte-5k8p3l"><div class="contents svelte-5k8p3l"><h3 class="title-bar svelte-5k8p3l">Urls checks <button>Close</button></h3> <!></div></div>');function ye(_,e){H(e,!0);const n=r=>{const a=new Date(r.timestamp);return a.toDateString()+" "+a.toTimeString()},s=r=>r.fails.sort((a,o)=>a.chord.url<o.chord.url?-1:1);var f=W(),D=E(f);{var k=r=>{var a=Ce(),o=d(a),h=d(o),m=p(d(h));m.__click=function(...l){var c;(c=e.close)==null||c.apply(this,l)},i(h);var y=p(h,2);Wt(y,Ut,l=>{var c=we();b(l,c)},(l,c)=>{var u=be();const x=tt(()=>n(t(c))),v=tt(()=>s(t(c)));var g=E(u),w=p(d(g),8),L=d(w,!0);i(w);var C=p(w,2),B=d(C,!0);i(C);var N=p(C,2),$=d(N,!0);i(N);var G=p(N,2),at=d(G,!0);i(G),i(g);var J=p(g,4),Q=p(d(J),8);R(Q,17,()=>t(v),P,(rt,I)=>{var X=pe(),Y=E(X),lt=d(Y,!0);i(Y);var T=p(Y,2),V=d(T);i(T);var q=p(T,2),j=d(q),it=d(j,!0);i(j),i(q);var Z=p(q,2),At=d(Z,!0);i(Z),O(Bt=>{F(lt,t(I).status),F(V,`${t(I).chord.artist??""} - ${t(I).chord.title??""}`),et(j,"href",t(I).chord.url),F(it,new URL(t(I).chord.url).hostname),F(At,Bt)},[()=>t(I).error?JSON.stringify(t(I).error):""]),b(rt,X)}),i(J),O(()=>{F(L,t(x)),F(B,t(c).nbChecks),F($,t(c).nbSkipped),F(at,t(c).nbFails)}),b(l,u)},(l,c)=>{var u=ke(),x=d(u);i(u),O(()=>F(x,`Could not retrieve checks: ${t(c).message??""}`)),b(l,u)}),i(o),i(a),b(r,a)};z(D,r=>{e.isOpen&&r(k)})}b(_,f),K()}ot(["click"]);var Le=(_,e)=>e(),xe=S('<li class="ul2col-separator"> </li>'),Se=S('<!> <li class="ul2col-item"><!></li>',1),De=S('<div><h3>Latest additions <button class="pull-right">More...</button></h3> <ul class="ul2col-container"></ul></div>');function Te(_,e){H(e,!0);const n=Date.now(),s=1e3*3600*24*7,f=s*4,D=[{label:"last week",time:n-s},{label:"one month ago",time:n-f},{label:"two months ago",time:n-2*f},{label:"six months ago",time:n-6*f},{label:"one year ago",time:n-12*f}],k=e.chords.filter(c=>c.creationDate).sort((c,u)=>u.creationDate-c.creationDate).map((c,u,x)=>{const v={...c};if(u>0){const g=x[u-1];for(const{time:w,label:L}of D)g.creationDate>w&&c.creationDate<w&&(v.dateTag=L)}return v});let r=6,a=M(U([]));const o=()=>{r+=4,A(a,U(k.slice(0,r)))};ht(()=>{o()});var h=De(),m=d(h),y=p(d(m));y.__click=[Le,o],i(m);var l=p(m,2);R(l,21,()=>t(a),P,(c,u)=>{var x=Se(),v=E(x);{var g=C=>{var B=xe(),N=d(B,!0);i(B),O(()=>F(N,t(u).dateTag)),b(C,B)};z(v,C=>{t(u).dateTag&&C(g)})}var w=p(v,2),L=d(w);nt(L,{get chord(){return t(u)}}),i(w),b(c,x)}),i(l),i(h),b(_,h),K()}ot(["click"]);const Ae=(_,e,n,s,f)=>{t(e).length<=n||(t(e).splice(t(e).length-n),A(s,U(t(e).slice(t(e).length-n).map(D=>f.chords[D]))))};var Be=S("<button>&nbsp↶&nbsp</button>"),Ve=S('<li class="ul2col-item"><!></li>'),Ue=S('<div><h3>Random song <span class="pull-right"><!> <button>Get more random songs</button></span></h3> <br> <ul class="ul2col-container"></ul></div>');function qe(_,e){H(e,!0);const n=6;let s=M(U([])),f=M(U([]));const D=()=>{t(s).length>=e.chords.length-n&&A(s,U([]));for(let l=0;l<n;l++){let c=-1;for(;c===-1||t(s).includes(c);)c=Math.floor(Math.random()*e.chords.length);t(s).push(c)}A(f,U(t(s).slice(t(s).length-n).map(l=>e.chords[l])))};ht(()=>{D()});var k=Ue(),r=d(k),a=p(d(r)),o=d(a);{var h=l=>{var c=Be();c.__click=[Ae,s,n,f,e],b(l,c)};z(o,l=>{t(s).length>n&&l(h)})}var m=p(o,2);m.__click=D,i(a),i(r);var y=p(r,4);R(y,21,()=>t(f),l=>l.url,(l,c)=>{var u=Ve(),x=d(u);nt(x,{get chord(){return t(c)},showArtist:!0}),i(u),b(l,u)}),i(y),i(k),b(_,k),K()}ot(["click"]);var Fe=()=>jt.open(ye),Me=()=>Pt("/songbook/edit"),Oe=(_,e)=>A(e,""),Ee=(_,e,n)=>{t(e)[t(n)]=!t(e)[t(n)],A(e,U(t(e)))},je=S('<button class="filter-control svelte-1gfqv35"><input type="checkbox"> <span></span></button>'),Ne=(_,e,n)=>A(e,U(t(n))),Ie=S("<button> </button>"),Re=S('<!> <h2><span class="pull-right"><button>Check dead links</button> <button>Edit</button></span></h2> <!> <!> <p> </p> <!> <!> <div><h3>All songs</h3> Search an artist, a title or a tag:<input type="text"> <button aria-label="delete search"><i class="fas fa-times-circle"></i></button> <div class="filter-controls-container svelte-1gfqv35"><h4>Filters</h4> <!></div> <h4>View</h4> <div class="view-controls-container svelte-1gfqv35"></div></div> <!>',1);function ga(_,e){H(e,!0);const[n,s]=yt(),f=()=>ft(ct,"$failedVisitCounts",n),D=()=>ft(Kt,"$user",n);Qt.set("Songbook");const{chords:k}=e.data;let r=M(U([]));const a=T=>{t(r).push(T),A(r,U(t(r))),setTimeout(()=>{t(r).shift(),A(r,U(t(r)))},5e3)};ht(async()=>{try{if(f().length&&D()){a({level:"info",header:"Trying to count missed visits while logged out"});for(const T of f())await pt(T);a({level:"success",header:`Counted ${f().length} missed visits`}),Lt(ct,[])}}catch{a({level:"error",header:"Couldnt upload failed visit counts"})}try{const V=(await qt()).reduce((q,j)=>(q.set(j.url,{...j}),q),new Map);st.set(V)}catch{a({level:"error",header:"Couldnt upload failed visit counts"})}});let o=M("");const h=[{label:"By artist",component:ve},{label:"By tags",component:he},{label:"By frequency",component:me},{label:"By access date",component:se}];let m=M(U(h[0]));const y={pdf:!0,doc:!0,youtube:!0,link:!0};let l=M(U({...y}));const c=Object.keys(y);var u=Re(),x=E(u);Nt(x,{title:"Song Book",description:"My song book",iconPath:"/songbook.png"});var v=p(x,2),g=d(v),w=d(g);w.__click=[Fe],dt(w,"",{},{position:"relative"});var L=p(w,2);L.__click=[Me],dt(L,"",{},{position:"relative"}),i(g),i(v);var C=p(v,2);R(C,17,()=>t(r),P,(T,V)=>{It(T,{get item(){return t(V)}})});var B=p(C,2);$t(B,{});var N=p(B,2),$=d(N);i(N);var G=p(N,2);Te(G,{chords:k});var at=p(G,2);qe(at,{chords:k});var J=p(at,2),Q=p(d(J),2);_t(Q);var rt=p(Q,2);rt.__click=[Oe,o];var I=p(rt,2),X=p(d(I),2);R(X,17,()=>c,P,(T,V)=>{var q=je();q.__click=[Ee,l,V];var j=d(q);_t(j);var it=p(j,2);i(q),O(Z=>{et(q,"aria-label",`filter for ${t(V)??""}`),et(j,"id",t(V)),ut(it,1,Z,"svelte-1gfqv35")},[()=>Ct(Dt(t(V)))]),Et(j,()=>t(l)[t(V)],Z=>t(l)[t(V)]=Z),b(T,q)}),i(I);var Y=p(I,4);R(Y,21,()=>h,P,(T,V)=>{var q=Ie();let j;q.__click=[Ne,m,V];var it=d(q,!0);i(q),O(Z=>{j=ut(q,1,"control svelte-1gfqv35",null,j,Z),F(it,t(V).label)},[()=>({selected:t(m)===t(V)})]),b(T,q)}),i(Y),i(J);var lt=p(J,2);Mt(lt,()=>t(m).component,(T,V)=>{V(T,{chords:k,get searchString(){return t(o)},get filters(){return t(l)}})}),O(()=>F($,`This is a list of ${k.length??""} song chords I have been gathering since I started teaching myself
    the guitar as a teen and that I like to play.`)),Ot(Q,()=>t(o),T=>A(o,T)),b(_,u),K(),s()}ot(["click"]);export{ga as component,ha as universal};
