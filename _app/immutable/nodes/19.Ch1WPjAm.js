import"../chunks/NZTpNUN0.js";import{p as he,h as M,a5 as T,b as I,s as u,e as p,i as c,g as e,r as h,t as z,a as k,n as D,d as fe,f as Y,be as Oe,u as ue,j as ve,c as Ne}from"../chunks/OOCdeaM4.js";import{d as be,s as ge,e as Re}from"../chunks/DBBHR-3t.js";import{i as q}from"../chunks/BMFH8sZT.js";import{s as E}from"../chunks/DazWBkG7.js";import{M as Ge}from"../chunks/C8MJLfl1.js";import{m as N,g as L,c as O,b as S,B as b,d as $,a as He,n as qe,e as De,i as Ee,f as Ie}from"../chunks/H9lSQ-CD.js";import{e as Le,i as Ue}from"../chunks/80iJqotc.js";import{r as me}from"../chunks/C2XHBoXy.js";import{b as de}from"../chunks/CCHh_OeQ.js";import"../chunks/DRxGxY2p.js";import"../chunks/CIg27ASY.js";import{p as Ve}from"../chunks/Zs3ZkE6R.js";/* empty css                */import"../chunks/bMdrnNxv.js";import{g as Fe}from"../chunks/BWy9KHHo.js";const je=r=>{const n=L(r),t=Math.floor(Math.random()*n.length);return n[t]},Ae=(r,n)=>{const t=je(r);return{board:N(r,n,t),move:t}},Ke=(r,n,t)=>{const a=Qe(r,n,t.iterations,t.c);return{board:N(r,n,a),move:a}};class _e{board;player;move;parent;children=[];visits=0;wins=0;constructor(n,t,a=null,i=null){this.board=n,this.player=t,this.move=a,this.parent=i}isFullyExpanded(){return this.children.length===L(this.board).length}isTerminal(){return S(this.board)!==b.notOver}}function pe(r,n,t,a=Math.sqrt(2)){return t===0?1/0:n/t+a*Math.sqrt(Math.log(r)/t)}function We(r,n){for(;!r.isTerminal();)if(r.isFullyExpanded())r=$e(r,n);else return Ye(r);return r}function Ye(r){const n=r.children.map(v=>v.move),a=L(r.board).filter(v=>!n.includes(v)),i=a[Math.floor(Math.random()*a.length)],d=O(r.board);N(d,r.player,i);const o=new _e(d,r.player===1?2:1,i,r);return r.children.push(o),o}function $e(r,n){return r.children.reduce((t,a)=>{const i=pe(r.visits,t.wins,t.visits,n);return pe(r.visits,a.wins,a.visits,n)>i?a:t})}function ze(r){const n=O(r.board);let t=r.player;for(;;){const a=S(n);if(a!==b.notOver)return a;const i=L(n),d=i[Math.floor(Math.random()*i.length)];N(n,t,d),t=t===1?2:1}}function Je(r,n){let t=r;for(;t!==null;)t.visits+=1,n===b.winPlayer1&&t.parent?.player===1||n===b.winPlayer2&&t.parent?.player===2?t.wins+=1:n===b.draw&&(t.wins+=.5),t=t.parent}function Qe(r,n,t=1e3,a=Math.sqrt(2)){const i=new _e(O(r),n,null,null);for(let o=0;o<t;o++){const v=We(i,a),s=ze(v);Je(v,s)}return i.children.reduce((o,v)=>o.visits>v.visits?o:v).move}var Xe=I("<button> </button>"),Ze=I(`<div><h4>Monte Carlo Tree Search parameters</h4> <div class="difficulty-options svelte-90tef"><label for="mcts-preset">Preset difficulty</label> <!></div> <div><h5>Iterations:</h5> <input id="mcts-iterations" type="number" min="0"/></div> <div>Number of simulations MCTS will run before choosing a move. Higher values usually mean
        stronger play but slower decisions.</div> <div><h5>C (exploration constant):</h5> <input id="mcts-c" type="number" min="0" step="0.1"/></div> <div>Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
        favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2 ≈
        1.41.</div></div>`);function et(r,n){he(n,!0);const t=[{name:"easy",iterations:200,c:2},{name:"medium",iterations:1e3,c:1.41},{name:"hard",iterations:5e3,c:.7}],a=t[1];let i=M(T(a.iterations)),d=M(T(a.c));const o=()=>{n.onUpdate({iterations:e(i),c:e(d)})};var v=Ze(),s=u(p(v),2),y=u(p(s),2);Le(y,17,()=>t,Ue,(_,w)=>{var g=Xe();g.__click=()=>{c(i,e(w).iterations,!0),c(d,e(w).c,!0),o()};let R;var G=p(g,!0);h(g),z(()=>{R=E(g,1,"",null,R,{selected:e(d)===e(w).c&&e(i)===e(w).iterations}),ge(G,e(w).name)}),k(_,g)}),h(s);var m=u(s,2),C=u(p(m),2);me(C),C.__change=o,h(m);var x=u(m,4),B=u(p(x),2);me(B),B.__change=o,h(x),D(2),h(v),de(C,()=>e(i),_=>c(i,_)),de(B,()=>e(d),_=>c(d,_)),k(r,v),fe()}be(["click","change"]);var tt=I("Game Over - <!>",1),at=I('<!> <h3>Local game <button>Back</button></h3> <div class="opponent-choice svelte-1m0eka9"><label for="opponent-options">Choose your opponent:</label> <div class="opponent-options svelte-1m0eka9"><div><button>Human</button> Play with another human on the same computer.</div> <div><button>Random</button> The computer makes completely random moves, no intelligence at all.</div> <div><button>MCTS</button> The computer uses a <a href="https://en.wikipedia.org/wiki/Monte_Carlo_tree_search">Monte Carlo tree search</a> algorithm to make smart moves. You can tweak the difficulty at the bottom of the page.</div></div></div> <div class="game-controls svelte-1m0eka9"><button>New game</button> <button>Cancel move</button></div> <div class="game-results svelte-1m0eka9"><!></div> <!> <div class="computer-settings svelte-1m0eka9"><!></div>',1);function _t(r,n){he(n,!0),Ve.set("Gravitrips");let t=M(T($())),a=M(T([])),i=ue(()=>S(e(t))),d=ue(()=>Ie(e(t))),o=M("mcts"),v=M(T({iterations:1e3,c:1.41})),s=M(1),y=1,m=2;const C=()=>{c(t,$(),!0),c(a,[],!0),c(s,1),[y,m]=[m,y],e(o)!=="manual"&&m===e(s)&&g()},x=(l,f)=>{e(a).push({board:O(l),moveByPlayer:f}),c(a,e(a),!0)},B=()=>{if(e(o)==="manual")e(a).pop(),_();else{if(e(a).length===1&&e(a)[e(a).length-1].moveByPlayer===m)return;e(a)[e(a).length-1].moveByPlayer===m&&e(a).pop(),e(a).length&&e(a)[e(a).length-1].moveByPlayer===y&&e(a).pop()}c(a,e(a),!0),e(a).length===0?c(t,$(),!0):c(t,O(e(a)[e(a).length-1].board),!0)},_=()=>c(s,e(s)===1?2:1,!0),w=l=>{if(y!==e(s)&&e(o)!=="manual"||!Ee(e(t),l)||S(e(t))!==b.notOver)return;let f;if(y===e(s))f=y;else if(m===e(s)&&e(o)==="manual")f=m;else return;c(t,N(e(t),f,l),!0),x(e(t),f),_(),e(o)!=="manual"&&setTimeout(()=>g(),200)},g=()=>{if(m!==e(s)||S(e(t))!==b.notOver||e(o)==="manual")return;let l;if(e(o)==="random")l=Ae(e(t),e(s));else if(e(o)==="mcts")l=Ke(e(t),e(s),e(v));else throw new Error("computer strategy not implemented");const{board:f}=l;c(t,f,!0),x(e(t),m),_()},R=l=>{switch(l.key){case"r":C();break}};var G=at();Re("keydown",Oe,R);var J=Y(G);Ge(J,{title:"Gravitrips",description:"Gravitrips",iconPath:"/gravitrips.png"});var U=u(J,2),ye=u(p(U));ye.__click=()=>Fe("/gravitrips"),h(U);var V=u(U,2),Q=u(p(V),2),F=p(Q),X=p(F);X.__click=()=>{c(o,"manual")};let Z;D(),h(F);var j=u(F,2),ee=p(j);ee.__click=()=>{c(o,"random"),m===e(s)&&g()};let te;D(),h(j);var ae=u(j,2),re=p(ae);re.__click=()=>{c(o,"mcts"),m===e(s)&&g()};let ne;D(3),h(ae),h(Q),h(V);var A=u(V,2),oe=p(A);oe.__click=C;var ie=u(oe,2);ie.__click=B,h(A);var K=u(A,2),we=p(K);{var Me=l=>{var f=tt(),Pe=u(Y(f));{var xe=P=>{var H=ve("Draw");k(P,H)},Be=P=>{var H=Ne(),Te=Y(H);{var Se=W=>{var ce=ve();z(()=>ge(ce,`Player ${e(i)??""} wins`)),k(W,ce)};q(Te,W=>{(e(i)===b.winPlayer1||e(i)===b.winPlayer2)&&W(Se)},!0)}k(P,H)};q(Pe,P=>{e(i)===b.draw?P(xe):P(Be,!1)})}k(l,f)};q(we,l=>{e(i)!==b.notOver&&l(Me)})}h(K);var se=u(K,2);He(se,{get nbColumns(){return De},get nbRows(){return qe},get board(){return e(t)},get winningCells(){return e(d)},onMove:w});var le=u(se,2),ke=p(le);{var Ce=l=>{et(l,{onUpdate:f=>c(v,f,!0)})};q(ke,l=>{e(o)==="mcts"&&l(Ce)})}h(le),z(()=>{Z=E(X,1,"",null,Z,{selected:e(o)==="manual"}),te=E(ee,1,"",null,te,{selected:e(o)==="random"}),ne=E(re,1,"",null,ne,{selected:e(o)==="mcts"}),ie.disabled=e(a).length===0}),k(r,G),fe()}be(["click"]);export{_t as component};
