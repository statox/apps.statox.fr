import"../chunks/NZTpNUN0.js";import{p as le,g as _,G as C,h as e,b as R,s as p,i as P,r as x,t as K,a as y,F as Me,e as i,d as ce,f as W,a$ as Ce,a_ as re,j as ne,c as xe}from"../chunks/tjCGPzdr.js";import{d as ue,s as me,e as ke}from"../chunks/DOKer7p_.js";import{i as N}from"../chunks/BsrVr-Z0.js";import{r as se,b as Pe,c as j}from"../chunks/DKsZ4ghV.js";import{M as Be}from"../chunks/CJFchB7S.js";import{m as T,g as F,c as S,b as B,B as f,d as A,a as Se,n as Te,e as Oe,i as qe,f as Ge}from"../chunks/CBhOl9Kc.js";import{e as Ne,i as Re}from"../chunks/An4e5j9g.js";import{b as oe}from"../chunks/B25JaP4K.js";import"../chunks/CqiQQVFS.js";import{p as Fe}from"../chunks/eBli9AFB.js";const He=r=>{const n=F(r),t=Math.floor(Math.random()*n.length);return n[t]},De=(r,n)=>{const t=He(r);return{board:T(r,n,t),move:t}},Ee=(r,n,t)=>{const a=je(r,n,t.iterations,t.c);return{board:T(r,n,a),move:a}};class ve{board;player;move;parent;children=[];visits=0;wins=0;constructor(n,t,a=null,o=null){this.board=n,this.player=t,this.move=a,this.parent=o}isFullyExpanded(){return this.children.length===F(this.board).length}isTerminal(){return B(this.board)!==f.notOver}}function ie(r,n,t,a=Math.sqrt(2)){return t===0?1/0:n/t+a*Math.sqrt(Math.log(r)/t)}function Ie(r,n){for(;!r.isTerminal();)if(r.isFullyExpanded())r=Ve(r,n);else return Ue(r);return r}function Ue(r){const n=r.children.map(u=>u.move),a=F(r.board).filter(u=>!n.includes(u)),o=a[Math.floor(Math.random()*a.length)],d=S(r.board);T(d,r.player,o);const s=new ve(d,r.player===1?2:1,o,r);return r.children.push(s),s}function Ve(r,n){return r.children.reduce((t,a)=>{const o=ie(r.visits,t.wins,t.visits,n);return ie(r.visits,a.wins,a.visits,n)>o?a:t})}function Le(r){const n=S(r.board);let t=r.player;for(;;){const a=B(n);if(a!==f.notOver)return a;const o=F(n),d=o[Math.floor(Math.random()*o.length)];T(n,t,d),t=t===1?2:1}}function We(r,n){let t=r;for(;t!==null;)t.visits+=1,n===f.winPlayer1&&t.parent?.player===1||n===f.winPlayer2&&t.parent?.player===2?t.wins+=1:n===f.draw&&(t.wins+=.5),t=t.parent}function je(r,n,t=1e3,a=Math.sqrt(2)){const o=new ve(S(r),n,null,null);for(let s=0;s<t;s++){const u=Ie(o,a),l=Le(u);We(u,l)}return o.children.reduce((s,u)=>s.visits>u.visits?s:u).move}var Ae=(r,n,t,a,o)=>{e(n)&&(i(t,e(n).iterations,!0),i(a,e(n).c,!0),o())},Ke=R("<option> </option>"),$e=(r,n,t)=>{i(n,null),t()},ze=(r,n,t)=>{i(n,null),t()},Je=R(`<div><h4>Monte Carlo Tree Search parameters</h4> <label for="mcts-preset">Preset difficulty</label> <select></select> <br/><br/> <label for="mcts-iterations">Iterations:</label> <input id="mcts-iterations" type="number" min="0"/> <small>Number of simulations MCTS will run before choosing a move. Higher values usually mean
        stronger play but slower decisions.</small> <br/><br/> <label for="mcts-c">C (exploration constant):</label> <input id="mcts-c" type="number" min="0" step="0.1"/> <small>Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
        favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2 ≈
        1.41.</small></div>`);function Qe(r,n){le(n,!0);const t=[{name:"easy",iterations:200,c:2},{name:"medium",iterations:1e3,c:1.41},{name:"hard",iterations:5e3,c:.7}];let a=_(C(t[1])),o=_(C(e(a).iterations)),d=_(C(e(a).c));const s=()=>{n.onUpdate({iterations:e(o),c:e(d)})};var u=Je(),l=p(P(u),4);l.__change=[Ae,a,o,d,s],Ne(l,21,()=>t,Re,(b,w)=>{var g=Ke(),k=P(g,!0);x(g);var O={};K(()=>{me(k,e(w).name),O!==(O=e(w))&&(g.value=(g.__value=e(w))??"")}),y(b,g)}),x(l);var h=p(l,7);se(h),h.__change=[$e,a,s];var m=p(h,9);se(m),m.__change=[ze,a,s],Me(2),x(u),Pe(l,()=>e(a),b=>i(a,b)),oe(h,()=>e(o),b=>i(o,b)),oe(m,()=>e(d),b=>i(d,b)),y(r,u),ce()}ue(["change"]);var Xe=(r,n)=>{i(n,"manual")},Ye=R("Game Over - <!>",1),Ze=R('<!> <div>See <a href="https://www.quora.com/What-is-the-winning-strategy-for-the-first-player-in-Connect-Four-games">this quora thread</a> for some tips on the winning strategy</div> <div class="opponent-choice svelte-1bdwycb"><span>Play against</span> <button>Human</button> <button>Random</button> <button>MCTS</button></div> <!> <div class="game-controls svelte-1bdwycb"><button>New game</button> <button>Cancel move</button></div> <div class="game-results svelte-1bdwycb"><!></div> <!>',1);function mt(r,n){le(n,!0),Fe.set("Gravitrip");let t=_(C(A())),a=_(C([])),o=re(()=>B(e(t))),d=re(()=>Ge(e(t))),s=_("mcts"),u=_(C({iterations:1e3,c:1.41})),l=_(1),h=1,m=2;const b=()=>{i(t,A(),!0),i(a,[],!0),i(l,1),[h,m]=[m,h],e(s)!=="manual"&&m===e(l)&&q()},w=(c,v)=>{e(a).push({board:S(c),moveByPlayer:v}),i(a,e(a),!0)},g=()=>{if(e(s)==="manual")e(a).pop(),k();else{if(e(a).length===1&&e(a)[e(a).length-1].moveByPlayer===m)return;e(a)[e(a).length-1].moveByPlayer===m&&e(a).pop(),e(a).length&&e(a)[e(a).length-1].moveByPlayer===h&&e(a).pop()}i(a,e(a),!0),e(a).length===0?i(t,A(),!0):i(t,S(e(a)[e(a).length-1].board),!0)},k=()=>i(l,e(l)===1?2:1,!0),O=c=>{if(h!==e(l)&&e(s)!=="manual"||!qe(e(t),c)||B(e(t))!==f.notOver)return;let v;if(h===e(l))v=h;else if(m===e(l)&&e(s)==="manual")v=m;else return;i(t,T(e(t),v,c),!0),w(e(t),v),k(),e(s)!=="manual"&&setTimeout(()=>q(),200)},q=()=>{if(m!==e(l)||B(e(t))!==f.notOver||e(s)==="manual")return;let c;if(e(s)==="random")c=De(e(t),e(l));else if(e(s)==="mcts")c=Ee(e(t),e(l),e(u));else throw new Error("computer strategy not implemented");const{board:v}=c;i(t,v,!0),w(e(t),m),k()},de=c=>{switch(c.key){case"r":b();break}};var $=Ze();ke("keydown",Ce,de);var z=W($);Be(z,{title:"Gravitrip",description:"Gravitrip"});var H=p(z,4),D=p(P(H),2);D.__click=[Xe,s];let J;var E=p(D,2);E.__click=()=>{i(s,"random"),m===e(l)&&q()};let Q;var X=p(E,2);X.__click=()=>{i(s,"mcts"),m===e(l)&&q()};let Y;x(H);var Z=p(H,2);{var pe=c=>{Qe(c,{onUpdate:v=>i(u,v,!0)})};N(Z,c=>{e(s)==="mcts"&&c(pe)})}var I=p(Z,2),ee=P(I);ee.__click=b;var te=p(ee,2);te.__click=g,x(I);var U=p(I,2),he=P(U);{var fe=c=>{var v=Ye(),V=p(W(v));{var _e=M=>{var G=ne("Draw");y(M,G)},ge=M=>{var G=xe(),ye=W(G);{var we=L=>{var ae=ne();K(()=>me(ae,`Player ${e(o)??""} wins`)),y(L,ae)};N(ye,L=>{(e(o)===f.winPlayer1||e(o)===f.winPlayer2)&&L(we)},!0)}y(M,G)};N(V,M=>{e(o)===f.draw?M(_e):M(ge,!1)})}y(c,v)};N(he,c=>{e(o)!==f.notOver&&c(fe)})}x(U);var be=p(U,2);Se(be,{get nbColumns(){return Oe},get nbRows(){return Te},get board(){return e(t)},get winningCells(){return e(d)},onMove:O}),K((c,v,V)=>{J=j(D,1,"svelte-1bdwycb",null,J,c),Q=j(E,1,"svelte-1bdwycb",null,Q,v),Y=j(X,1,"svelte-1bdwycb",null,Y,V),te.disabled=e(a).length===0},[()=>({selected:e(s)==="manual"}),()=>({selected:e(s)==="random"}),()=>({selected:e(s)==="mcts"})]),y(r,$),ce()}ue(["click"]);export{mt as component};
