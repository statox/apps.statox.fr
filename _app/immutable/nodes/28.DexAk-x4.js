import"../chunks/NZTpNUN0.js";import{z as ae,A as C,B as Se,c as ne,f as j,a as h,E as re,p as y,F as s,v as a,G as r,g as t,s as U,x as te}from"../chunks/Br9SMxIB.js";import{d as ye,s as le}from"../chunks/BBzb7ThI.js";import{a as Le}from"../chunks/WbxJrN1C.js";import{i as N}from"../chunks/CvXxFVm9.js";import{s as oe,a as ie}from"../chunks/Bpxd_8Tl.js";import{m as Ee}from"../chunks/B81YP0Pw.js";import{u as ce,U as Me}from"../chunks/BFCzlleA.js";import{M as xe}from"../chunks/BhRFzXHd.js";import{r as Ie,a as ve,A as qe}from"../chunks/Clk8QsMC.js";import{e as ke,i as We}from"../chunks/D1-nhZYT.js";import{r as _,b as He,e as W,s as Ne}from"../chunks/DWdbj9D8.js";import{b as ee}from"../chunks/C6S4cPPP.js";import{t as Ce}from"../chunks/D-rGHmBV.js";import{M as Fe}from"../chunks/Bbh3aJRb.js";import{c as Ue}from"../chunks/SweRCpJo.js";import{M as Pe}from"../chunks/aqTlonbp.js";import{M as Be}from"../chunks/DYRmBDom.js";import{M as Oe}from"../chunks/CrrYs-zO.js";import{a as Te}from"../chunks/DTyfSRsR.js";import"../chunks/BUWzxVIb.js";import{p as Re}from"../chunks/SGVLItwT.js";const je=!1,Lt=Object.freeze(Object.defineProperty({__proto__:null,ssr:je},Symbol.toStringTag,{value:"Module"})),ge=async()=>Ie({path:"/webWatcher/getAllWatchers"}),we=async c=>ve({path:"/webWatcher/createWatcher",data:c}),ze=async c=>ve({path:"/webWatcher/deleteWatcher",data:{id:c}}),Ge=async c=>ve({path:"/webWatcher/toggleWatcherEnabled",data:c}),Je=async(c,e,p,b,v,i,n,f,x)=>{U(e,[],!0),t(p)?.length||t(e).push({level:"error",header:"name must be defined"}),t(b)||t(e).push({level:"error",header:"notification message must be defined"}),t(v)==="CSS"&&!t(i)&&t(e).push({level:"error",header:"A CSS watcher must have a css selector defined"}),t(n)<15*60&&t(e).push({level:"error",header:"Check interval too small. Must be >= 15mn"});try{new URL(t(f))}catch{t(e).push({level:"error",header:"The URL is invalid"})}if(!t(e).length)try{t(v)==="CSS"?await we({name:t(p),notificationMessage:t(b),url:t(f),cssSelector:t(i),checkIntervalSeconds:t(n),watchType:t(v)}):t(v)==="HASH"&&await we({name:t(p),notificationMessage:t(b),url:t(f),checkIntervalSeconds:t(n),watchType:t(v)}),x.onUpload(),x.close()}catch(m){let g=m.message;m instanceof qe&&m.code===401?g="Invalid logged in user":m instanceof Me&&(g="User is logged out");const d=`<strong>Entry not created</strong><br/> ${g}`;Ce.push(d,{theme:{"--toastBarBackground":"#FF0000"}})}};var Ve=y('<label for="css-selector">CSS selector</label> <input type="textarea"/>',1),Ke=y('<button class="form-action svelte-8qhbr8">Submit</button>'),Qe=y('<span class="form-action svelte-8qhbr8">Login to upload an entry</span>'),Xe=y('<div role="dialog" class="modal svelte-8qhbr8"><div class="contents svelte-8qhbr8"><h3 class="title-bar svelte-8qhbr8">Add a new watcher <button>Close</button></h3> <!> <form class="form-content svelte-8qhbr8"><label for="name">Name</label> <input type="text"/> <label for="check-interval">Check interval</label> <!> <label for="notification-message">Notification message (the @mention is automatically added)</label> <input type="textarea"/> <label for="watch-type">Watcher type</label> <select id="watch-type"><option>CSS</option><option>HASH</option></select> <label for="content">URL</label> <input type="textarea"/> <!> <br/> <!></form></div></div>');function Ye(c,e){ae(e,!0);const p=()=>ie(ce,"$user",b),[b,v]=oe();let i=C(Se([])),n=C(""),f=C(""),x=C(""),m=C(""),g=C(0),d=C("CSS");var D=ne(),A=j(D);{var z=w=>{var o=Xe(),u=s(o),k=s(u),L=a(s(k));L.__click=function(...l){e.close?.apply(this,l)},r(k);var F=a(k,2);ke(F,17,()=>t(i),We,(l,S)=>{xe(l,{get item(){return t(S)}})});var G=a(F,2),P=a(s(G),2);_(P);var Z=a(P,4);Fe(Z,{allowedUnits:["minutes","hours","days"],defaultDuration:{value:1,unit:"hours"},get valueInSeconds(){return t(g)},set valueInSeconds(l){U(g,l,!0)}});var E=a(Z,4);_(E);var M=a(E,4),B=s(M);B.value=B.__value="CSS";var O=a(B);O.value=O.__value="HASH",r(M);var T=a(M,4);_(T);var J=a(T,2);{var V=l=>{var S=Ve(),R=a(j(S),2);_(R),ee(R,()=>t(m),X=>U(m,X)),h(l,S)};N(J,l=>{t(d)==="CSS"&&l(V)})}var K=a(J,4);{var Q=l=>{var S=Ke();S.__click=[Je,i,n,f,d,m,g,x,e],h(l,S)},se=l=>{var S=Qe();h(l,S)};N(K,l=>{p()?l(Q):l(se,!1)})}r(G),r(u),r(o),ee(P,()=>t(n),l=>U(n,l)),ee(E,()=>t(f),l=>U(f,l)),He(M,()=>t(d),l=>U(d,l)),ee(T,()=>t(x),l=>U(x,l)),h(w,o)};N(A,w=>{e.isOpen&&w(z)})}h(c,D),re(),v()}ye(["click"]);var Ze=y('<p class="section-3-item svelte-1e53865"><label for="css-selector">CSS selector <!></label> <input disabled type="textarea" class="svelte-1e53865"/></p>'),$e=y('<div class="section error-section svelte-1e53865"><p class="section-4-item svelte-1e53865"><label for="last-check">Last error</label> <input disabled type="textarea" class="svelte-1e53865"/></p> <p class="section-4-item svelte-1e53865"><label for="last-update">Last error message</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div>'),et=y('<div class="item svelte-1e53865"><h3 class="item-title svelte-1e53865"><div class="item-name svelte-1e53865"> </div> <div class="item-actions svelte-1e53865"><!> <!></div></h3> <div class="section svelte-1e53865"><p class="section-1-item svelte-1e53865"><label for="check-interval">Check interval</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <div class="section svelte-1e53865"><p class="section-2-item svelte-1e53865"><label for="notification-message">Notification message</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <div class="section svelte-1e53865"><p class="section-3-item svelte-1e53865"><label for="content">URL</label> <a target="_blank" rel="noopener noreferrer"> </a></p> <!></div> <div class="section svelte-1e53865"><p class="section-4-item svelte-1e53865"><label for="last-check">Last check</label> <input disabled type="textarea" class="svelte-1e53865"/></p> <p class="section-4-item svelte-1e53865"><label for="last-update">Last content change</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div> <!> <div class="section svelte-1e53865"><p class="section-3-item svelte-1e53865"><label for="last-update">Last content</label> <input disabled type="textarea" class="svelte-1e53865"/></p></div></div>');function tt(c,e){ae(e,!0);const p=()=>ie(ce,"$user",b),[b,v]=oe(),i=Ue(),n=o=>{const u=new Date(o*1e3);return u.toLocaleDateString()+" "+u.toLocaleTimeString()},f=e.watcher.lastCheckDateUnix===0?"Never checked before":n(e.watcher.lastCheckDateUnix),x=e.watcher.lastUpdateDateUnix===0?"Never changed":n(e.watcher.lastUpdateDateUnix),m=Te.fromMillis(e.watcher.checkIntervalSeconds*1e3).rescale().toHuman(),g=async()=>{if(!e.watcher.id){console.error("id must be defined");return}try{await ze(e.watcher.id),i("delete")}catch(o){const u=`<strong>Watcher not deleted</strong><br/> ${o.message}`;Ce.push(u,{theme:{"--toastBarBackground":"#FF0000"}})}},d=async o=>{await Ge({watcherId:e.watcher.id,setToEnabled:o.detail==="on"}),i("update")};let D=e.watcher.archivalDateUnix?"off":"on";var A=ne(),z=j(A);{var w=o=>{var u=et(),k=s(u),L=s(k),F=s(L,!0);r(L);var G=a(L,2),P=s(G);Oe(P,{get value(){return D},label:"Enabled",design:"slider",$$events:{change:d}});var Z=a(P,2);Be(Z,{deleteAction:g}),r(G),r(k);var E=a(k,2),M=s(E),B=a(s(M),2);_(B),r(M),r(E);var O=a(E,2),T=s(O),J=a(s(T),2);_(J),r(T),r(O);var V=a(O,2),K=s(V),Q=a(s(K),2),se=s(Q,!0);r(Q),r(K);var l=a(K,2);{var S=I=>{var q=Ze(),H=s(q),$=a(s(H));Pe($,{get content(){return e.watcher.cssSelector}}),r(H);var Y=a(H,2);_(Y),r(q),te(()=>W(Y,e.watcher.cssSelector)),h(I,q)};N(l,I=>{e.watcher.watchType==="CSS"&&I(S)})}r(V);var R=a(V,2),X=s(R),de=a(s(X),2);_(de),r(X);var ue=a(X,2),he=a(s(ue),2);_(he),r(ue),r(R);var me=a(R,2);{var De=I=>{var q=$e(),H=s(q),$=a(s(H),2);_($),r(H);var Y=a(H,2),be=a(s(Y),2);_(be),r(Y),r(q),te(Ae=>{W($,Ae),W(be,e.watcher.lastErrorMessage)},[()=>n(e.watcher.lastErrorDateUnix)]),h(I,q)};N(me,I=>{e.watcher.lastErrorDateUnix&&I(De)})}var pe=a(me,2),fe=s(pe),_e=a(s(fe),2);_(_e),r(fe),r(pe),r(u),te(()=>{le(F,e.watcher.name),W(B,m),W(J,e.watcher.notificationMessage),Ne(Q,"href",e.watcher.url),le(se,e.watcher.url),W(de,f),W(he,x),W(_e,e.watcher.lastContent)}),h(o,u)};N(z,o=>{p()&&o(w)})}h(c,A),re(),v()}var at=y('<div class="container svelte-ihkiaa"></div>');function rt(c,e){ae(e,!0);const p=Ue(),b=(i,n)=>i.archivalDateUnix===null&&n.archivalDateUnix!==null?-1:i.archivalDateUnix!==null&&n.archivalDateUnix===null?1:n.id-i.id;var v=at();ke(v,21,()=>e.watchers.sort(b),We,(i,n)=>{tt(i,{get watcher(){return t(n)},$$events:{delete:()=>p("delete"),update:()=>p("update")}})}),r(v),h(c,v),re()}var st=(c,e)=>Ee.open(Ye,{onUpload:e}),lt=y("<p>Something went wrong</p> <p> </p>",1),nt=y("<p>Loading data</p>"),ot=y("<h2>Create a new watcher</h2> <button>Add an entry</button> <h2>Watchers</h2> <!>",1);function Et(c,e){ae(e,!0);const p=()=>ie(ce,"$user",b),[b,v]=oe();Re.set("Web Watchers");let i=C(Se(ge()));const n=()=>U(i,ge(),!0);var f=ne(),x=j(f);{var m=d=>{var D=ot(),A=a(j(D),2);A.__click=[st,n];var z=a(A,4);Le(z,()=>t(i),w=>{var o=nt();h(w,o)},(w,o)=>{rt(w,{get watchers(){return t(o)},$$events:{delete:n,update:n}})},(w,o)=>{var u=lt(),k=a(j(u),2),L=s(k,!0);r(k),te(F=>le(L,F),[()=>JSON.stringify(t(o))]),h(w,u)}),h(d,D)},g=d=>{xe(d,{item:{level:"info",header:"Login to list the watchers"}})};N(x,d=>{p()?d(m):d(g,!1)})}h(c,f),re(),v()}ye(["click"]);export{Et as component,Lt as universal};
