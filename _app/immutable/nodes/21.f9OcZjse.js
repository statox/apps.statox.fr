import"../chunks/NZTpNUN0.js";import{o as K}from"../chunks/BlCreX5I.js";import{z as B,A as I,B as Q,c as F,f as A,a as d,E as C,p as x,F as u,v as m,G as f,g as e,s as L,aZ as G,x as R}from"../chunks/R2JDhSNG.js";import{d as O,s as M}from"../chunks/C3Q0-X8e.js";import{i as T}from"../chunks/4u1zq58c.js";import{s as P,a as S}from"../chunks/Ct-TLQDZ.js";import{m as X}from"../chunks/AseJjqf2.js";import{u as V,U as Y}from"../chunks/C54_DghZ.js";import{M as q}from"../chunks/FElWoEaI.js";import{e as N,i as W}from"../chunks/UCjBP_y5.js";import{r as ee}from"../chunks/DmNmkrrX.js";import{b as te}from"../chunks/CpZDNLuF.js";import{r as re,a as ae,A as oe}from"../chunks/UCu7ArvF.js";import{t as se}from"../chunks/Csd1YvgP.js";import{D as Z}from"../chunks/DTyfSRsR.js";import{a as ne}from"../chunks/D7viMnSX.js";const ie=async n=>ae({path:"/personalTracker/upload",data:{event:n}}),H=async()=>{const{events:n}=await re({path:"/personalTracker/getAll",authorize:!0});return n},ve=async(n,t,i,p)=>{if(L(t,[],!0),e(i)!==Number(e(i).toFixed(1))&&e(t).push({level:"error",header:"Value have at most 1 number after the comma"}),(e(i)<80||e(i)>110)&&e(t).push({level:"error",header:"Value must be in kg"}),e(t).length)return;const g=Z.now().toUTC().toUnixInteger();try{await ie({timestampUTC:g,type:"weight",value:Math.floor(e(i)*100)}),p.onUpload(),p.close()}catch(o){let v=o.message;o instanceof oe&&o.code===401?v="Invalid logged in user":o instanceof Y&&(v="User is logged out");const c=`<strong>Entry not created</strong><br/> ${v}`;se.push(c,{theme:{"--toastBarBackground":"#FF0000"}})}};var le=x('<button class="form-action svelte-1cixduj">Submit</button>'),de=x('<span class="form-action svelte-1cixduj">Login to upload an entry</span>'),ce=x('<div role="dialog" class="modal svelte-1cixduj"><div class="contents svelte-1cixduj"><h4 class="title-bar svelte-1cixduj">Add a new event <button>Close</button></h4> <!> <form class="form-content svelte-1cixduj"><label for="weight">Weight</label> <input type="number" step="0.1"/> <br/> <!></form></div></div>');function me(n,t){B(t,!0);const[i,p]=P(),g=()=>S(V,"$user",i);let o=I(Q([])),v=I(0);var c=F(),h=A(c);{var y=b=>{var r=ce(),l=u(r),s=u(l),U=m(u(s));U.__click=function(...a){t.close?.apply(this,a)},f(s);var k=m(s,2);N(k,17,()=>e(o),W,(a,_)=>{q(a,{get item(){return e(_)}})});var w=m(k,2),E=m(u(w),2);ee(E);var j=m(E,4);{var D=a=>{var _=le();_.__click=[ve,o,v,t],d(a,_)},$=a=>{var _=de();d(a,_)};T(j,a=>{g()?a(D):a($,!1)})}f(w),f(l),f(r),te(E,()=>e(v),a=>L(v,a)),d(b,r)};T(h,b=>{t.isOpen&&b(y)})}d(n,c),C(),p()}O(["click"]);var ue=x('<div class="event svelte-1lfnev1"><div class="event-date"> </div> <div class="event-type"> </div> <div class="event-value"> </div></div>'),fe=x('<div class="event svelte-1lfnev1"><div>Date</div> <div>Type</div> <div>Value</div></div> <!>',1),pe=x("<p>Loading events</p>");function _e(n,t){B(t,!0);const[i,p]=P(),g=()=>S(V,"$user",i);var o=F(),v=A(o);{var c=h=>{var y=F(),b=A(y);ne(b,()=>t.events,r=>{var l=pe();d(r,l)},(r,l)=>{var s=fe(),U=m(A(s),2);N(U,17,()=>e(l),W,(k,w)=>{const E=G(()=>Z.fromSeconds(e(w).eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm"));var j=ue(),D=u(j),$=u(D,!0);f(D);var a=m(D,2),_=u(a,!0);f(a);var z=m(a,2),J=u(z,!0);f(z),f(j),R(()=>{M($,e(E)),M(_,e(w).type),M(J,e(w).value)}),d(k,j)}),d(r,s)},(r,l)=>{{let s=G(()=>({level:"error",header:"Something went wrong getting events",message:e(l)}));q(r,{get item(){return e(s)}})}}),d(h,y)};T(v,h=>{g()&&t.events&&h(c)})}d(n,o),C(),p()}var ge=(n,t)=>X.open(me,{onUpload:t}),he=x("<div><button>Add an entry</button></div> <!>",1);function Be(n,t){B(t,!0);const[i,p]=P(),g=()=>S(V,"$user",i);let o=I(void 0);const v=()=>L(o,H(),!0);K(()=>L(o,H(),!0));var c=F(),h=A(c);{var y=r=>{var l=he(),s=A(l),U=u(s);U.__click=[ge,v],f(s);var k=m(s,2);_e(k,{get events(){return e(o)}}),d(r,l)},b=r=>{q(r,{item:{level:"info",header:"Login to add an entry or see events"}})};T(h,r=>{g()?r(y):r(b,!1)})}d(n,c),C(),p()}O(["click"]);export{Be as component};
