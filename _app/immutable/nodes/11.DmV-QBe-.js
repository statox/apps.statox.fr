import"../chunks/disclose-version.Bg9kRutz.js";import{p as H,aH as C,v as A,n as P,aF as f,w as u,aG as p,g as e,s as D,aa as O,k as R,o as X}from"../chunks/index-client.CwKaIs20.js";import{m as N,e as F,a as m,t as x}from"../chunks/template.O5anSWHx.js";import{i as L}from"../chunks/if.Bi_20hhT.js";import{p as T}from"../chunks/proxy.CJQ3oePJ.js";import{s as S,a as V}from"../chunks/store.ChaSGJXD.js";import{m as Y}from"../chunks/Modals.BuE7KsA1.js";import{u as q,U as Z}from"../chunks/service.C6Mx57nS.js";import{M as B}from"../chunks/Main.Dt21oYa4.js";import{e as W,i as J}from"../chunks/each.DKzLuYBh.js";import{r as ee}from"../chunks/attributes.CgIpNMpF.js";import{b as te}from"../chunks/input.DZqTlelX.js";import{r as ae,a as re,A as oe}from"../chunks/index.H8X5eY6d.js";import{t as se}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.Bj-rr4aY.js";import{D as K}from"../chunks/datetime.CJSQP4eG.js";import{s as I}from"../chunks/render.Bco1UJTE.js";import{a as ne}from"../chunks/await.BSmIMP7F.js";const ie=async n=>re({path:"/personalTracker/upload",data:{event:n}}),z=async()=>{const{events:n}=await ae({path:"/personalTracker/getAll",authorize:!0});return n},ve=async(n,t,i,g)=>{if(D(t,T([])),e(i)!==Number(e(i).toFixed(1))&&e(t).push({level:"error",header:"Value have at most 1 number after the comma"}),(e(i)<80||e(i)>110)&&e(t).push({level:"error",header:"Value must be in kg"}),e(t).length)return;const _=K.now().toUTC().toUnixInteger();try{await ie({timestampUTC:_,type:"weight",value:Math.floor(e(i)*100)}),g.onUpload(),g.close()}catch(o){let v=o.message;o instanceof oe&&o.code===401?v="Invalid logged in user":o instanceof Z&&(v="User is logged out");const c=`<strong>Entry not created</strong><br/> ${v}`;se.push(c,{theme:{"--toastBarBackground":"#FF0000"}})}};var le=x('<button class="form-action svelte-1cixduj">Submit</button>'),de=x('<span class="form-action svelte-1cixduj">Login to upload an entry</span>'),me=x('<div role="dialog" class="modal svelte-1cixduj"><div class="contents svelte-1cixduj"><h4 class="title-bar svelte-1cixduj">Add a new event <button>Close</button></h4> <!> <form class="form-content svelte-1cixduj"><label for="weight">Weight</label> <input type="number" step="0.1"> <br> <!></form></div></div>');function ce(n,t){H(t,!0);const[i,g]=S(),_=()=>V(q,"$user",i);let o=C(T([])),v=C(0);var c=F(),h=A(c);{var k=b=>{var a=me(),l=f(a),s=f(l),E=u(f(s));E.__click=function(...r){var d;(d=t.close)==null||d.apply(this,r)},p(s);var w=u(s,2);W(w,17,()=>e(o),J,(r,d)=>{B(r,{get item(){return e(d)}})});var U=u(w,2),y=u(f(U),2);ee(y);var M=u(y,4);{var j=r=>{var d=le();d.__click=[ve,o,v,t],m(r,d)},$=r=>{var d=de();m(r,d)};L(M,r=>{_()?r(j):r($,!1)})}p(U),p(l),p(a),te(y,()=>e(v),r=>D(v,r)),m(b,a)};L(h,b=>{t.isOpen&&b(k)})}m(n,c),P(),g()}N(["click"]);var ue=x('<div class="event svelte-1lfnev1"><div class="event-date"> </div> <div class="event-type"> </div> <div class="event-value"> </div></div>'),fe=x('<div class="event svelte-1lfnev1"><div>Date</div> <div>Type</div> <div>Value</div></div> <!>',1),pe=x("<p>Loading events</p>");function ge(n,t){H(t,!0);const[i,g]=S(),_=()=>V(q,"$user",i);var o=F(),v=A(o);{var c=h=>{var k=F(),b=A(k);ne(b,()=>t.events,a=>{var l=pe();m(a,l)},(a,l)=>{var s=fe(),E=u(A(s),2);W(E,17,()=>e(l),J,(w,U)=>{var y=ue();const M=O(()=>K.fromSeconds(e(U).eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm"));var j=f(y),$=f(j,!0);p(j);var r=u(j,2),d=f(r,!0);p(r);var G=u(r,2),Q=f(G,!0);p(G),p(y),R(()=>{I($,e(M)),I(d,e(U).type),I(Q,e(U).value)}),m(w,y)}),m(a,s)},(a,l)=>{var s=O(()=>({level:"error",header:"Something went wrong getting events",message:e(l)}));B(a,{get item(){return e(s)}})}),m(h,k)};L(v,h=>{_()&&t.events&&h(c)})}m(n,o),P(),g()}var _e=(n,t)=>Y.open(ce,{onUpload:t}),he=x("<div><button>Add an entry</button></div> <!>",1);function He(n,t){H(t,!0);const[i,g]=S(),_=()=>V(q,"$user",i);let o=C(void 0);const v=()=>D(o,T(z()));X(()=>D(o,T(z())));var c=F(),h=A(c);{var k=a=>{var l=he(),s=A(l),E=f(s);E.__click=[_e,v],p(s);var w=u(s,2);ge(w,{get events(){return e(o)}}),m(a,l)},b=a=>{B(a,{item:{level:"info",header:"Login to add an entry or see events"}})};L(h,a=>{_()?a(k):a(b,!1)})}m(n,c),P(),g()}N(["click"]);export{He as component};
