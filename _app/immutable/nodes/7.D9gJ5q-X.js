import"../chunks/DsnmJJEf.js";import{p as T,b as y,a as f,d as F,e as t,s as n,r as o,t as H,g as r,h as _,n as O,i as m,aI as R}from"../chunks/BI5tnybL.js";import{s as Y,e as Z}from"../chunks/BHBOcJDT.js";import{i as j}from"../chunks/BcTGm7Fo.js";import{r as $}from"../chunks/Db8wGxCz.js";import{b as x}from"../chunks/u1KJTtVJ.js";import{s as z,a as B}from"../chunks/fB5nFxe2.js";import{a as C,g as G}from"../chunks/DaC0mKj1.js";import{u as J,b as K,c as Q}from"../chunks/DKXeG7-1.js";import{s as E}from"../chunks/L3zL1n65.js";import{M as V}from"../chunks/D4b6Boo_.js";var W=y('<p class="svelte-1my11jv"> </p>'),X=y('<form><div class="input-group svelte-1my11jv"><label for="username" class="svelte-1my11jv">Username:</label> <input id="username" name="username" type="text" autocomplete="username" placeholder="Enter your username" required class="svelte-1my11jv"/></div> <div class="input-group svelte-1my11jv"><label for="current-password" class="svelte-1my11jv">Password:</label> <input id="current-password" name="password" type="password" autocomplete="current-password" placeholder="Enter your password" required class="svelte-1my11jv"/></div> <!> <button type="submit" class="svelte-1my11jv">Sign in</button></form>'),ee=y('<div class="login-container svelte-1my11jv"><div class="login-card svelte-1my11jv"><h2 class="svelte-1my11jv">Login</h2> <!></div></div>');function pe(I,L){T(L,!0);const u=()=>B(J,"$user",S),[S,U]=z();let v=_(""),p=_(""),i=_(void 0),d="/";C(({from:e})=>{e?.url.pathname!=="/auth/login"&&(d=e?.url.pathname||d)});const k=async e=>{e.preventDefault();try{await K(r(v),r(p)),await Q(),u()?.status=="logged_in"?(E.set(!0),setTimeout(()=>E.set(!1),2500),G(d)):m(i,new Error("Invalid password or username"),!0)}catch(s){if(s?.message==='{"message":"UNAUTHORIZED"}'){m(i,"Invalid password or username");return}m(i,s,!0)}};var c=ee(),h=t(c),q=n(t(h),2);{var A=e=>{var s=W(),l=t(s);o(s),H(()=>Y(l,`You are already logged in as ${u()?.user.username??""}`)),f(e,s)},D=e=>{var s=X(),l=t(s),b=n(t(l),2);$(b),o(l);var g=n(l,2),w=n(t(g),2);$(w),o(g);var M=n(g,2);{var N=a=>{{let P=R(()=>({level:"error",header:"Failed auth",message:r(i).toString()}));V(a,{get item(){return r(P)}})}};j(M,a=>{r(i)&&a(N)})}O(2),o(s),Z("submit",s,k),x(b,()=>r(v),a=>m(v,a)),x(w,()=>r(p),a=>m(p,a)),f(e,s)};j(q,e=>{u()?.status=="logged_in"?e(A):e(D,!1)})}o(h),o(c),f(I,c),F(),U()}export{pe as component};
