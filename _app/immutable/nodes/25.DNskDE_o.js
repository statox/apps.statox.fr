import"../chunks/NZTpNUN0.js";import{o as Q}from"../chunks/np3e4Z_M.js";import{p as C,h as S,a8 as R,c as L,f as x,a as v,d as V,b as _,e as u,s as c,r as f,g as e,i as $,u as O,t as X}from"../chunks/Brv8g2mx.js";import{d as W,s as P}from"../chunks/BlLNWVag.js";import{i as F}from"../chunks/D2xXzMMK.js";import{s as q,a as B}from"../chunks/DgiLbMs0.js";import{m as Y}from"../chunks/DhJDjgwN.js";import{u as H}from"../chunks/IiVyZCMq.js";import{M as N}from"../chunks/D0GvDZuH.js";import{e as j,i as z}from"../chunks/CjXiWo-Z.js";import{r as Z}from"../chunks/CqUsCvuq.js";import{b as ee}from"../chunks/DLiMpzP4.js";import{r as te,a as re,A as ae}from"../chunks/DTRCIxyi.js";import{U as oe}from"../chunks/BWptIUEw.js";import{t as se}from"../chunks/CNpLp5dR.js";import{D as J}from"../chunks/DTyfSRsR.js";import{a as ne}from"../chunks/VNWGfoUl.js";import"../chunks/DxsUBIQY.js";import"../chunks/CQlwxdfc.js";import{p as ie}from"../chunks/DWDG2EIs.js";const ve=async l=>re({path:"/personalTracker/upload",data:{event:l}}),G=async()=>{const{events:l}=await te({path:"/personalTracker/getAll"});return l};var le=_('<button class="form-action svelte-3t0xi3">Submit</button>'),me=_('<span class="form-action svelte-3t0xi3">Login to upload an entry</span>'),de=_('<div role="dialog" class="modal svelte-3t0xi3"><div class="contents svelte-3t0xi3"><h4 class="title-bar svelte-3t0xi3">Add a new event <button>Close</button></h4> <!> <form class="form-content svelte-3t0xi3"><label for="weight">Weight</label> <input type="number" step="0.1"/> <br/> <!></form></div></div>');function ce(l,n){C(n,!0);const k=()=>B(H,"$user",w),[w,U]=q();let s=S(R([])),i=S(0);const h=async()=>{if($(s,[],!0),e(i)!==Number(e(i).toFixed(1))&&e(s).push({level:"error",header:"Value have at most 1 number after the comma"}),(e(i)<80||e(i)>110)&&e(s).push({level:"error",header:"Value must be in kg"}),e(s).length)return;const t=J.now().toUTC().toUnixInteger();try{await ve({timestampUTC:t,type:"weight",value:Math.floor(e(i)*100)}),n.onUpload(),n.close()}catch(r){let a=r.message;r instanceof ae&&r.code===401?a="Invalid logged in user":r instanceof oe&&(a="User is logged out");const m=`<strong>Entry not created</strong><br/> ${a}`;se.push(m,{theme:{"--toastBarBackground":"#FF0000"}})}};var p=L(),b=x(p);{var A=t=>{var r=de(),a=u(r),m=u(a),M=c(u(m));M.__click=function(...o){n.close?.apply(this,o)},f(m);var y=c(m,2);j(y,17,()=>e(s),z,(o,d)=>{N(o,{get item(){return e(d)}})});var D=c(y,2),g=c(u(D),2);Z(g);var E=c(g,4);{var I=o=>{var d=le();d.__click=h,v(o,d)},T=o=>{var d=me();v(o,d)};F(E,o=>{k()?o(I):o(T,!1)})}f(D),f(a),f(r),ee(g,()=>e(i),o=>$(i,o)),v(t,r)};F(b,t=>{n.isOpen&&t(A)})}v(l,p),V(),U()}W(["click"]);var ue=_('<div class="event svelte-cyscl8"><div class="event-date"> </div> <div class="event-type"> </div> <div class="event-value"> </div></div>'),fe=_('<div class="event svelte-cyscl8"><div>Date</div> <div>Type</div> <div>Value</div></div> <!>',1),pe=_("<p>Loading events</p>");function ge(l,n){C(n,!0);const k=()=>B(H,"$user",w),[w,U]=q();var s=L(),i=x(s);{var h=p=>{var b=L(),A=x(b);ne(A,()=>n.events,t=>{var r=pe();v(t,r)},(t,r)=>{var a=fe(),m=c(x(a),2);j(m,17,()=>e(r),z,(M,y)=>{const D=O(()=>J.fromSeconds(e(y).eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm"));var g=ue(),E=u(g),I=u(E,!0);f(E);var T=c(E,2),o=u(T,!0);f(T);var d=c(T,2),K=u(d,!0);f(d),f(g),X(()=>{P(I,e(D)),P(o,e(y).type),P(K,e(y).value)}),v(M,g)}),v(t,a)},(t,r)=>{{let a=O(()=>({level:"error",header:"Something went wrong getting events",message:e(r)}));N(t,{get item(){return e(a)}})}}),v(p,b)};F(i,p=>{k()&&n.events&&p(h)})}v(l,s),V(),U()}var _e=_("<div><button>Add an entry</button></div> <!>",1);function qe(l,n){C(n,!0);const k=()=>B(H,"$user",w),[w,U]=q();let s=S(void 0);ie.set("Personal Tracker");const i=()=>$(s,G(),!0);Q(()=>$(s,G(),!0));var h=L(),p=x(h);{var b=t=>{var r=_e(),a=x(r),m=u(a);m.__click=()=>Y.open(ce,{onUpload:i}),f(a);var M=c(a,2);ge(M,{get events(){return e(s)}}),v(t,r)},A=t=>{N(t,{item:{level:"info",header:"Login to add an entry or see events"}})};F(p,t=>{k()?t(b):t(A,!1)})}v(l,h),V(),U()}W(["click"]);export{qe as component};
