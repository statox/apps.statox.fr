import"../chunks/disclose-version.Bg9kRutz.js";import{i as ne}from"../chunks/legacy.EqIdVoM0.js";import{m as le,y as R,x as ie,ae as r,z as t,af as a,g as e,s as T,w as N,aX as Ae,ag as F,o as fe,v as Le}from"../chunks/index-client.S3REcJgE.js";import{s as ee}from"../chunks/render.CF6uZz0T.js";import{a as Ie}from"../chunks/await.BGm15oIX.js";import{i as q}from"../chunks/if.BYsj_AMu.js";import{c as se,a as c,e as re,t as S}from"../chunks/template.B5pchg3w.js";import{s as he,a as me}from"../chunks/store.BAWuPd1l.js";import{c as $e,o as Ee}from"../chunks/store.DF07ihmy.js";import{M as We,u as ge,U as He}from"../chunks/Main.Bhdrm3q8.js";import{r as Te,a as be,A as Ne}from"../chunks/index.D6U8kpiJ.js";import{e as _e,i as ye}from"../chunks/each.Nz7c8l4p.js";import{r as U,s as j,a as V}from"../chunks/attributes.BZLGEmLx.js";import{b as ve,c as Oe}from"../chunks/input.DW_zkP8F.js";import{b as Pe}from"../chunks/select.BE3p5t0V.js";import{p as B}from"../chunks/props.C2aoZBXh.js";import{t as Me}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.NDn5vnUv.js";import{M as Fe,a as Be,b as Re}from"../chunks/Main.DaJSgWY9.js";import{a as qe}from"../chunks/datetime.CJSQP4eG.js";import"../chunks/entry.WFWrpjgv.js";import{p as Ge}from"../chunks/Main.svelte_svelte_type_style_lang.CsTDB6ng.js";const Je=!1,Et=Object.freeze(Object.defineProperty({__proto__:null,ssr:Je},Symbol.toStringTag,{value:"Module"})),Ce=async()=>Te({path:"/webWatcher/getAllWatchers"}),Ue=async y=>be({path:"/webWatcher/createWatcher",data:y}),Ve=async y=>be({path:"/webWatcher/deleteWatcher",data:{id:y}}),Xe=async y=>be({path:"/webWatcher/toggleWatcherEnabled",data:y});var Ke=S('<label for="css-selector">CSS selector</label> <input type="textarea">',1),Qe=S('<button class="form-action svelte-1cixduj">Submit</button>'),Ye=S('<span class="form-action svelte-1cixduj">Login to upload an entry</span>'),Ze=S('<div role="dialog" class="modal svelte-1cixduj"><div class="contents svelte-1cixduj"><h3 class="title-bar svelte-1cixduj">Add a new clipboard entry <button>Close</button></h3> <!> <form class="form-content svelte-1cixduj"><label for="name">Name</label> <input type="text"> <label for="check-interval">Check interval</label> <!> <label for="notification-message">Notification message (the @mention is automatically added)</label> <input type="textarea"> <label for="watch-type">Watcher type</label> <select id="watch-type"><option>CSS</option><option>HASH</option></select> <label for="content">URL</label> <input type="textarea"> <!> <br> <!></form></div></div>');function et(y,u){le(u,!1);const[O,W]=he(),I=()=>me(ge,"$user",O);let z=B(u,"isOpen",8),s=B(u,"onUpload",8),l=F([]),x=F(),v=F(),A=F(),f=F(),k=F(),h=F();const G=async()=>{var i;T(l,[]),(i=e(x))!=null&&i.length||e(l).push({level:"error",header:"name must be defined"}),e(v)||e(l).push({level:"error",header:"notification message must be defined"}),e(h)==="CSS"&&!e(f)&&e(l).push({level:"error",header:"A CSS watcher must have a css selector defined"}),e(k)<15*60&&e(l).push({level:"error",header:"Check interval too small. Must be >= 15mn"});try{new URL(e(A))}catch{e(l).push({level:"error",header:"The URL is invalid"})}if(!e(l).length)try{e(h)==="CSS"?await Ue({name:e(x),notificationMessage:e(v),url:e(A),cssSelector:e(f),checkIntervalSeconds:e(k),watchType:e(h)}):e(h)==="HASH"&&await Ue({name:e(x),notificationMessage:e(v),url:e(A),checkIntervalSeconds:e(k),watchType:e(h)}),s()(),$e()}catch(d){let m=d.message;d instanceof Ne&&d.code===401?m="Invalid logged in user":d instanceof He&&(m="User is logged out");const w=`<strong>Entry not created</strong><br/> ${m}`;Me.push(w,{theme:{"--toastBarBackground":"#FF0000"}})}};ne();var M=se(),p=R(M);{var o=i=>{var d=Ze(),m=r(d),w=r(m),$=t(r(w));a(w);var g=t(w,2);_e(g,1,()=>e(l),ye,(n,_)=>{We(n,{get item(){return e(_)}})});var L=t(g,2),C=t(r(L),2);U(C);var X=t(C,4);Fe(X,{allowedUnits:["minutes","hours","days"],defaultDuration:{value:1,unit:"hours"},get valueInSeconds(){return e(k)},set valueInSeconds(n){T(k,n)},$$legacy:!0});var J=t(X,4);U(J);var b=t(J,4);N(()=>{e(h),Ae(()=>{})});var P=r(b);P.value=(P.__value="CSS")==null?"":"CSS";var D=t(P);D.value=(D.__value="HASH")==null?"":"HASH",a(b);var E=t(b,4);U(E);var H=t(E,2);{var K=n=>{var _=Ke(),te=t(R(_),2);U(te),ve(te,()=>e(f),oe=>T(f,oe)),c(n,_)};q(H,n=>{e(h)==="CSS"&&n(K)})}var de=t(H,4);{var ue=n=>{var _=Qe();re("click",_,G),c(n,_)},pe=n=>{var _=Ye();c(n,_)};q(de,n=>{I()?n(ue):n(pe,!1)})}a(L),a(m),a(d),re("click",$,function(...n){var _;(_=$e)==null||_.apply(this,n)}),ve(C,()=>e(x),n=>T(x,n)),ve(J,()=>e(v),n=>T(v,n)),Pe(b,()=>e(h),n=>T(h,n)),ve(E,()=>e(A),n=>T(A,n)),c(i,d)};q(p,i=>{z()&&i(o)})}c(y,M),ie(),W()}var tt=S('<div class="s s--inner svelte-1n7axnp"><span> </span> <button role="switch" class="svelte-1n7axnp"><span class="svelte-1n7axnp">on</span> <span class="svelte-1n7axnp">off</span></button></div>'),at=S('<div class="s s--slider svelte-1n7axnp"><span> </span> <button role="switch" class="svelte-1n7axnp"></button></div>'),st=S('<input type="radio" class="svelte-1n7axnp"> <label class="svelte-1n7axnp"> </label>',1),rt=S('<div class="s s--multi svelte-1n7axnp"><div role="radiogroup" class="group-container svelte-1n7axnp"><div class="legend"> </div> <!></div></div>');function nt(y,u){le(u,!1);const O=[];let W=B(u,"label",8),I=B(u,"design",8,"inner label"),z=B(u,"options",24,()=>[]),s=B(u,"fontSize",8,16),l=B(u,"value",12,"on"),x=F(!0);const v=Math.floor(Math.random()*100),A=fe();function f(p){const o=p.target,i=o==null?void 0:o.getAttribute("aria-checked");T(x,i!=="true"),l(e(x)===!0?"on":"off"),A("change",l())}Le(()=>{T(x,l()==="on")}),ne();var k=se(),h=R(k);{var G=p=>{var o=tt(),i=r(o);j(i,"id",`switch-${v}`);var d=r(i,!0);a(i);var m=t(i,2);j(m,"aria-labelledby",`switch-${v}`),a(o),N(()=>{ee(d,W()),j(m,"aria-checked",e(x))}),re("click",m,f),c(p,o)},M=p=>{var o=se(),i=R(o);{var d=w=>{var $=at(),g=r($);j(g,"id",`switch-${v}`);var L=r(g,!0);a(g);var C=t(g,2);j(C,"aria-labelledby",`switch-${v}`),a($),N(()=>{j($,"style",`font-size:${s()??""}px`),ee(L,W()),j(C,"aria-checked",e(x))}),re("click",C,f),c(w,$)},m=w=>{var $=rt(),g=r($);j(g,"aria-labelledby",`label-${v}`),j(g,"id",`group-${v}`);var L=r(g);j(L,"id",`label-${v}`);var C=r(L,!0);a(L);var X=t(L,2);_e(X,1,z,ye,(J,b)=>{var P=st(),D=R(P);U(D);var E,H=t(D,2),K=r(H,!0);a(H),N(()=>{j(D,"id",`${e(b)}-${v}`),E!==(E=e(b))&&(D.value=(D.__value=e(b))==null?"":e(b)),j(H,"for",`${e(b)}-${v}`),ee(K,e(b))}),Oe(O,[],D,()=>(e(b),l()),l),c(J,P)}),a(g),a($),N(()=>{j(g,"style",`font-size:${s()??""}px`),ee(C,W())}),c(w,$)};q(i,w=>{I()=="slider"?w(d):w(m,!1)},!0)}c(p,o)};q(h,p=>{I()=="inner"?p(G):p(M,!1)})}c(y,k),ie()}var lt=S('<p class="section-3-item svelte-1jnygz9"><label for="css-selector">CSS selector <!></label> <input disabled type="textarea" class="svelte-1jnygz9"></p>'),it=S('<div class="section error-section svelte-1jnygz9"><p class="section-4-item svelte-1jnygz9"><label for="last-check">Last error</label> <input disabled type="textarea" class="svelte-1jnygz9"></p> <p class="section-4-item svelte-1jnygz9"><label for="last-update">Last error message</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div>'),ot=S('<div class="item svelte-1jnygz9"><h3 class="item-title svelte-1jnygz9"><div class="item-name svelte-1jnygz9"> </div> <div class="item-actions svelte-1jnygz9"><!> <!></div></h3> <div class="section svelte-1jnygz9"><p class="section-1-item svelte-1jnygz9"><label for="check-interval">Check interval</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div> <div class="section svelte-1jnygz9"><p class="section-2-item svelte-1jnygz9"><label for="notification-message">Notification message</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div> <div class="section svelte-1jnygz9"><p class="section-3-item svelte-1jnygz9"><label for="content">URL</label> <a target="_blank" rel="noopener noreferrer"> </a></p> <!></div> <div class="section svelte-1jnygz9"><p class="section-4-item svelte-1jnygz9"><label for="last-check">Last check</label> <input disabled type="textarea" class="svelte-1jnygz9"></p> <p class="section-4-item svelte-1jnygz9"><label for="last-update">Last content change</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div> <!> <div class="section svelte-1jnygz9"><p class="section-3-item svelte-1jnygz9"><label for="last-update">Last content</label> <input disabled type="textarea" class="svelte-1jnygz9"></p></div></div>');function ct(y,u){le(u,!1);const[O,W]=he(),I=()=>me(ge,"$user",O),z=fe();let s=B(u,"watcher",8);const l=o=>{const i=new Date(o*1e3);return i.toLocaleDateString()+" "+i.toLocaleTimeString()},x=s().lastCheckDateUnix===0?"Never checked before":l(s().lastCheckDateUnix),v=s().lastUpdateDateUnix===0?"Never changed":l(s().lastUpdateDateUnix),A=qe.fromMillis(s().checkIntervalSeconds*1e3).rescale().toHuman(),f=async()=>{if(!s().id){console.error("id must be defined");return}try{await Ve(s().id),z("delete")}catch(o){const i=`<strong>Watcher not deleted</strong><br/> ${o.message}`;Me.push(i,{theme:{"--toastBarBackground":"#FF0000"}})}},k=async o=>{await Xe({watcherId:s().id,setToEnabled:o.detail==="on"}),z("update")};let h=s().archivalDateUnix?"off":"on";ne();var G=se(),M=R(G);{var p=o=>{var i=ot(),d=r(i),m=r(d),w=r(m,!0);a(m);var $=t(m,2),g=r($);nt(g,{value:h,label:"Enabled",design:"slider",$$events:{change:k}});var L=t(g,2);Be(L,{$$events:{delete:f}}),a($),a(d);var C=t(d,2),X=r(C),J=t(r(X),2);U(J),V(J,A),a(X),a(C);var b=t(C,2),P=r(b),D=t(r(P),2);U(D),a(P),a(b);var E=t(b,2),H=r(E),K=t(r(H),2),de=r(K,!0);a(K),a(H);var ue=t(H,2);{var pe=Q=>{var Y=lt(),Z=r(Y),ce=t(r(Z));Re(ce,{get content(){return s().cssSelector}}),a(Z);var ae=t(Z,2);U(ae),a(Y),N(()=>V(ae,s().cssSelector)),c(Q,Y)};q(ue,Q=>{s().watchType==="CSS"&&Q(pe)})}a(E);var n=t(E,2),_=r(n),te=t(r(_),2);U(te),V(te,x),a(_);var oe=t(_,2),xe=t(r(oe),2);U(xe),V(xe,v),a(oe),a(n);var Se=t(n,2);{var De=Q=>{var Y=it(),Z=r(Y),ce=t(r(Z),2);U(ce),N(()=>V(ce,l(s().lastErrorDateUnix))),a(Z);var ae=t(Z,2),ke=t(r(ae),2);U(ke),a(ae),a(Y),N(()=>V(ke,s().lastErrorMessage)),c(Q,Y)};q(Se,Q=>{s().lastErrorDateUnix&&Q(De)})}var we=t(Se,2),je=r(we),ze=t(r(je),2);U(ze),a(je),a(we),a(i),N(()=>{ee(w,s().name),V(D,s().notificationMessage),j(K,"href",s().url),ee(de,s().url),V(ze,s().lastContent)}),c(o,i)};q(M,o=>{I()&&o(p)})}c(y,G),ie(),W()}var vt=S('<div class="container svelte-c8nodu"></div>');function dt(y,u){le(u,!1);let O=B(u,"watchers",8);const W=fe(),I=(s,l)=>s.archivalDateUnix===null&&l.archivalDateUnix!==null?-1:s.archivalDateUnix!==null&&l.archivalDateUnix===null?1:l.id-s.id;ne();var z=vt();_e(z,5,()=>O().sort(I),ye,(s,l)=>{ct(s,{get watcher(){return e(l)},$$events:{delete:()=>W("delete"),update:()=>W("update")}})}),a(z),c(y,z),ie()}var ut=S("<p>Something went wrong</p> <p> </p>",1),pt=S("<p>Loading data</p>"),ft=S("<h2>Create a new watcher</h2> <button>Add an entry</button> <h2>Watchers</h2> <!>",1);function Ht(y,u){le(u,!1);const[O,W]=he(),I=()=>me(ge,"$user",O);Ge.set("Web Watchers");let z=F(Ce());const s=()=>T(z,Ce());ne();var l=se(),x=R(l);{var v=f=>{var k=ft(),h=t(R(k),2),G=t(h,4);Ie(G,()=>e(z),M=>{var p=pt();c(M,p)},(M,p)=>{dt(M,{get watchers(){return e(p)},$$events:{delete:s,update:s}})},(M,p)=>{var o=ut(),i=t(R(o),2),d=r(i,!0);N(()=>ee(d,JSON.stringify(e(p)))),a(i),c(M,o)}),re("click",h,()=>Ee(et,{onUpload:s})),c(f,k)},A=f=>{We(f,{item:{level:"info",header:"Login to list the watchers"}})};q(x,f=>{I()?f(v):f(A,!1)})}c(y,l),ie(),W()}export{Ht as component,Et as universal};
