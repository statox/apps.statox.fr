import{s as ee,A,i as w,f as h,k as te,e as v,t as H,a as I,c as g,b as N,d as q,z as B,g as M,l as y,h as _,N as ie,E as z,O as ve,B as ge,y as Ce,n as V,j as Z,p as ye}from"../chunks/scheduler.DD29IDFH.js";import{S as ne,i as le,a as $,g as G,t as U,c as W,b as J,d as K,m as Q,e as X}from"../chunks/index.DdAIetyJ.js";import{c as be,o as we}from"../chunks/store.CA0gqAJR.js";import{u as re,M as oe,U as Ee}from"../chunks/Main.DE0GsWw4.js";import{e as R}from"../chunks/each.BVF7ijxy.js";import{r as Ue,a as Te,A as De}from"../chunks/index.D68wnC6W.js";import{t as Ie}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.B_SaEqtJ.js";import{D as ke}from"../chunks/datetime.nQE3q1jc.js";import{h as ce,u as Me}from"../chunks/await_block.CPkDFjTD.js";const Ae=async o=>Te({path:"/personalTracker/upload",data:{event:o}}),ue=async()=>{const{events:o}=await Ue({path:"/personalTracker/getAll",authorize:!0});return o};function fe(o,t,l){const e=o.slice();return e[7]=t[l],e}function de(o){let t,l,e,n,r,a="Close",i,c,s,u,k="Weight",T,C,E,b,j,L,P,se,O=R(o[1]),m=[];for(let f=0;f<O.length;f+=1)m[f]=me(fe(o,O,f));const $e=f=>U(m[f],1,1,()=>{m[f]=null});function ae(f,p){return f[3]?xe:Ne}let F=ae(o),D=F(o);return{c(){t=v("div"),l=v("div"),e=v("h4"),n=H(`Add a new event
                `),r=v("button"),r.textContent=a,i=I();for(let f=0;f<m.length;f+=1)m[f].c();c=I(),s=v("form"),u=v("label"),u.textContent=k,T=I(),C=v("input"),E=I(),b=v("br"),j=I(),D.c(),this.h()},l(f){t=g(f,"DIV",{role:!0,class:!0});var p=N(t);l=g(p,"DIV",{class:!0});var d=N(l);e=g(d,"H4",{class:!0});var S=N(e);n=q(S,`Add a new event
                `),r=g(S,"BUTTON",{"data-svelte-h":!0}),B(r)!=="svelte-2m9p61"&&(r.textContent=a),S.forEach(h),i=M(d);for(let Y=0;Y<m.length;Y+=1)m[Y].l(d);c=M(d),s=g(d,"FORM",{class:!0});var x=N(s);u=g(x,"LABEL",{for:!0,"data-svelte-h":!0}),B(u)!=="svelte-1wni8ci"&&(u.textContent=k),T=M(x),C=g(x,"INPUT",{type:!0,step:!0}),E=M(x),b=g(x,"BR",{}),j=M(x),D.l(x),x.forEach(h),d.forEach(h),p.forEach(h),this.h()},h(){y(e,"class","title-bar svelte-1cixduj"),y(u,"for","weight"),y(C,"type","number"),y(C,"step","0.1"),y(s,"class","form-content svelte-1cixduj"),y(l,"class","contents svelte-1cixduj"),y(t,"role","dialog"),y(t,"class","modal svelte-1cixduj")},m(f,p){w(f,t,p),_(t,l),_(l,e),_(e,n),_(e,r),_(l,i);for(let d=0;d<m.length;d+=1)m[d]&&m[d].m(l,null);_(l,c),_(l,s),_(s,u),_(s,T),_(s,C),ie(C,o[2]),_(s,E),_(s,b),_(s,j),D.m(s,null),L=!0,P||(se=[z(r,"click",be),z(C,"input",o[6])],P=!0)},p(f,p){if(p&2){O=R(f[1]);let d;for(d=0;d<O.length;d+=1){const S=fe(f,O,d);m[d]?(m[d].p(S,p),$(m[d],1)):(m[d]=me(S),m[d].c(),$(m[d],1),m[d].m(l,c))}for(G(),d=O.length;d<m.length;d+=1)$e(d);W()}p&4&&ve(C.value)!==f[2]&&ie(C,f[2]),F===(F=ae(f))&&D?D.p(f,p):(D.d(1),D=F(f),D&&(D.c(),D.m(s,null)))},i(f){if(!L){for(let p=0;p<O.length;p+=1)$(m[p]);L=!0}},o(f){m=m.filter(Boolean);for(let p=0;p<m.length;p+=1)U(m[p]);L=!1},d(f){f&&h(t),ge(m,f),D.d(),P=!1,Ce(se)}}}function me(o){let t,l;return t=new oe({props:{item:o[7]}}),{c(){J(t.$$.fragment)},l(e){K(t.$$.fragment,e)},m(e,n){Q(t,e,n),l=!0},p(e,n){const r={};n&2&&(r.item=e[7]),t.$set(r)},i(e){l||($(t.$$.fragment,e),l=!0)},o(e){U(t.$$.fragment,e),l=!1},d(e){X(t,e)}}}function Ne(o){let t,l="Login to upload an entry";return{c(){t=v("span"),t.textContent=l,this.h()},l(e){t=g(e,"SPAN",{class:!0,"data-svelte-h":!0}),B(t)!=="svelte-4ab4io"&&(t.textContent=l),this.h()},h(){y(t,"class","form-action svelte-1cixduj")},m(e,n){w(e,t,n)},p:V,d(e){e&&h(t)}}}function xe(o){let t,l="Submit",e,n;return{c(){t=v("button"),t.textContent=l,this.h()},l(r){t=g(r,"BUTTON",{class:!0,"data-svelte-h":!0}),B(t)!=="svelte-1nfv1d"&&(t.textContent=l),this.h()},h(){y(t,"class","form-action svelte-1cixduj")},m(r,a){w(r,t,a),e||(n=z(t,"click",o[4]),e=!0)},p:V,d(r){r&&h(t),e=!1,n()}}}function Ve(o){let t,l,e=o[0]&&de(o);return{c(){e&&e.c(),t=A()},l(n){e&&e.l(n),t=A()},m(n,r){e&&e.m(n,r),w(n,t,r),l=!0},p(n,[r]){n[0]?e?(e.p(n,r),r&1&&$(e,1)):(e=de(n),e.c(),$(e,1),e.m(t.parentNode,t)):e&&(G(),U(e,1,1,()=>{e=null}),W())},i(n){l||($(e),l=!0)},o(n){U(e),l=!1},d(n){n&&h(t),e&&e.d(n)}}}function Le(o,t,l){let e;te(o,re,u=>l(3,e=u));let{isOpen:n}=t,{onUpload:r}=t,a=[],i;const c=async()=>{if(l(1,a=[]),i!==Number(i.toFixed(1))&&a.push({level:"error",header:"Value have at most 1 number after the comma"}),(i<80||i>110)&&a.push({level:"error",header:"Value must be in kg"}),a.length)return;const u=ke.now().toUTC().toUnixInteger();try{await Ae({timestampUTC:u,type:"weight",value:Math.floor(i*100)}),r(),be()}catch(k){let T=k.message;k instanceof De&&k.code===401?T="Invalid logged in user":k instanceof Ee&&(T="User is logged out");const C=`<strong>Entry not created</strong><br/> ${T}`;Ie.push(C,{theme:{"--toastBarBackground":"#FF0000"}})}};function s(){i=ve(this.value),l(2,i)}return o.$$set=u=>{"isOpen"in u&&l(0,n=u.isOpen),"onUpload"in u&&l(5,r=u.onUpload)},[n,a,i,e,c,r,s]}class Oe extends ne{constructor(t){super(),le(this,t,Le,Ve,ee,{isOpen:0,onUpload:5})}}function _e(o,t,l){const e=o.slice();e[2]=t[l];const n=ke.fromSeconds(e[2].eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm");return e[3]=n,e}function he(o){let t,l,e,n={ctx:o,current:null,token:null,hasCatch:!0,pending:Pe,then:je,catch:Be,value:0,error:6,blocks:[,,,]};return ce(l=o[0],n),{c(){t=A(),n.block.c()},l(r){t=A(),n.block.l(r)},m(r,a){w(r,t,a),n.block.m(r,n.anchor=a),n.mount=()=>t.parentNode,n.anchor=t,e=!0},p(r,a){o=r,n.ctx=o,a&1&&l!==(l=o[0])&&ce(l,n)||Me(n,o,a)},i(r){e||($(n.block),e=!0)},o(r){for(let a=0;a<3;a+=1){const i=n.blocks[a];U(i)}e=!1},d(r){r&&h(t),n.block.d(r),n.token=null,n=null}}}function Be(o){let t,l;return t=new oe({props:{item:{level:"error",header:"Something went wrong getting events",message:o[6]}}}),{c(){J(t.$$.fragment)},l(e){K(t.$$.fragment,e)},m(e,n){Q(t,e,n),l=!0},p(e,n){const r={};n&1&&(r.item={level:"error",header:"Something went wrong getting events",message:e[6]}),t.$set(r)},i(e){l||($(t.$$.fragment,e),l=!0)},o(e){U(t.$$.fragment,e),l=!1},d(e){X(t,e)}}}function je(o){let t,l="<div>Date</div> <div>Type</div> <div>Value</div>",e,n,r=R(o[0]),a=[];for(let i=0;i<r.length;i+=1)a[i]=pe(_e(o,r,i));return{c(){t=v("div"),t.innerHTML=l,e=I();for(let i=0;i<a.length;i+=1)a[i].c();n=A(),this.h()},l(i){t=g(i,"DIV",{class:!0,"data-svelte-h":!0}),B(t)!=="svelte-cv599z"&&(t.innerHTML=l),e=M(i);for(let c=0;c<a.length;c+=1)a[c].l(i);n=A(),this.h()},h(){y(t,"class","event svelte-1lfnev1")},m(i,c){w(i,t,c),w(i,e,c);for(let s=0;s<a.length;s+=1)a[s]&&a[s].m(i,c);w(i,n,c)},p(i,c){if(c&1){r=R(i[0]);let s;for(s=0;s<r.length;s+=1){const u=_e(i,r,s);a[s]?a[s].p(u,c):(a[s]=pe(u),a[s].c(),a[s].m(n.parentNode,n))}for(;s<a.length;s+=1)a[s].d(1);a.length=r.length}},i:V,o:V,d(i){i&&(h(t),h(e),h(n)),ge(a,i)}}}function pe(o){let t,l,e=o[3]+"",n,r,a,i=o[2].type+"",c,s,u,k=o[2].value+"",T,C;return{c(){t=v("div"),l=v("div"),n=H(e),r=I(),a=v("div"),c=H(i),s=I(),u=v("div"),T=H(k),C=I(),this.h()},l(E){t=g(E,"DIV",{class:!0});var b=N(t);l=g(b,"DIV",{class:!0});var j=N(l);n=q(j,e),j.forEach(h),r=M(b),a=g(b,"DIV",{class:!0});var L=N(a);c=q(L,i),L.forEach(h),s=M(b),u=g(b,"DIV",{class:!0});var P=N(u);T=q(P,k),P.forEach(h),C=M(b),b.forEach(h),this.h()},h(){y(l,"class","event-date"),y(a,"class","event-type"),y(u,"class","event-value"),y(t,"class","event svelte-1lfnev1")},m(E,b){w(E,t,b),_(t,l),_(l,n),_(t,r),_(t,a),_(a,c),_(t,s),_(t,u),_(u,T),_(t,C)},p(E,b){b&1&&e!==(e=E[3]+"")&&Z(n,e),b&1&&i!==(i=E[2].type+"")&&Z(c,i),b&1&&k!==(k=E[2].value+"")&&Z(T,k)},d(E){E&&h(t)}}}function Pe(o){let t,l="Loading events";return{c(){t=v("p"),t.textContent=l},l(e){t=g(e,"P",{"data-svelte-h":!0}),B(t)!=="svelte-aa2awf"&&(t.textContent=l)},m(e,n){w(e,t,n)},p:V,i:V,o:V,d(e){e&&h(t)}}}function Se(o){let t,l,e=o[1]&&o[0]&&he(o);return{c(){e&&e.c(),t=A()},l(n){e&&e.l(n),t=A()},m(n,r){e&&e.m(n,r),w(n,t,r),l=!0},p(n,[r]){n[1]&&n[0]?e?(e.p(n,r),r&3&&$(e,1)):(e=he(n),e.c(),$(e,1),e.m(t.parentNode,t)):e&&(G(),U(e,1,1,()=>{e=null}),W())},i(n){l||($(e),l=!0)},o(n){U(e),l=!1},d(n){n&&h(t),e&&e.d(n)}}}function Fe(o,t,l){let e;te(o,re,r=>l(1,e=r));let{events:n}=t;return o.$$set=r=>{"events"in r&&l(0,n=r.events)},[n,e]}class He extends ne{constructor(t){super(),le(this,t,Fe,Se,ee,{events:0})}}function qe(o){let t,l;return t=new oe({props:{item:{level:"info",header:"Login to add an entry or see events"}}}),{c(){J(t.$$.fragment)},l(e){K(t.$$.fragment,e)},m(e,n){Q(t,e,n),l=!0},p:V,i(e){l||($(t.$$.fragment,e),l=!0)},o(e){U(t.$$.fragment,e),l=!1},d(e){X(t,e)}}}function ze(o){let t,l,e="Add an entry",n,r,a,i,c;return r=new He({props:{events:o[0]}}),{c(){t=v("div"),l=v("button"),l.textContent=e,n=I(),J(r.$$.fragment)},l(s){t=g(s,"DIV",{});var u=N(t);l=g(u,"BUTTON",{"data-svelte-h":!0}),B(l)!=="svelte-nj8k01"&&(l.textContent=e),u.forEach(h),n=M(s),K(r.$$.fragment,s)},m(s,u){w(s,t,u),_(t,l),w(s,n,u),Q(r,s,u),a=!0,i||(c=z(l,"click",o[3]),i=!0)},p(s,u){const k={};u&1&&(k.events=s[0]),r.$set(k)},i(s){a||($(r.$$.fragment,s),a=!0)},o(s){U(r.$$.fragment,s),a=!1},d(s){s&&(h(t),h(n)),X(r,s),i=!1,c()}}}function Re(o){let t,l,e,n;const r=[ze,qe],a=[];function i(c,s){return c[1]?0:1}return t=i(o),l=a[t]=r[t](o),{c(){l.c(),e=A()},l(c){l.l(c),e=A()},m(c,s){a[t].m(c,s),w(c,e,s),n=!0},p(c,[s]){let u=t;t=i(c),t===u?a[t].p(c,s):(G(),U(a[u],1,1,()=>{a[u]=null}),W(),l=a[t],l?l.p(c,s):(l=a[t]=r[t](c),l.c()),$(l,1),l.m(e.parentNode,e))},i(c){n||($(l),n=!0)},o(c){U(l),n=!1},d(c){c&&h(e),a[t].d(c)}}}function Ge(o,t,l){let e;te(o,re,i=>l(1,e=i));let n;const r=()=>l(0,n=ue());return ye(()=>l(0,n=ue())),[n,e,r,()=>we(Oe,{onUpload:r})]}class nt extends ne{constructor(t){super(),le(this,t,Ge,Re,ee,{})}}export{nt as component};
