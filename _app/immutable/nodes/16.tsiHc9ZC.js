import"../chunks/NZTpNUN0.js";import{z as we,A as P,B as D,p as se,f as G,F as k,x as W,g as l,a as _,E as ye,v as b,s as m,aZ as J,G as M,y as de,a_ as K,c as Q}from"../chunks/Br9SMxIB.js";import{d as _e,e as X,s as be}from"../chunks/BBzb7ThI.js";import{i as Y}from"../chunks/CvXxFVm9.js";import{e as S,i as B}from"../chunks/D1-nhZYT.js";import{r as ee,a as Me,s as Ce,c as te}from"../chunks/DWdbj9D8.js";import{b as re}from"../chunks/C6S4cPPP.js";import{M as xe}from"../chunks/DKmGubEx.js";var f=(e=>(e[e.notOver=0]="notOver",e[e.winPlayer1=1]="winPlayer1",e[e.winPlayer2=2]="winPlayer2",e[e.draw=3]="draw",e))(f||{});const A=7,d=6,p=4;class Pe extends Error{constructor(r){super("Can't play in column "+r)}}const N=e=>e.map(r=>[...r]),le=(e,r)=>e[r].length!==d,V=e=>{const r=[];for(let t=0;t<e.length;t++)e[t].length<d&&r.push(t);return r},ke=e=>{const r=A*d,t=e.reduce((s,i)=>s+i.length,0);return r===t},Ae=e=>{for(let r=0;r<A;r++)for(let t=0;t<d;t++){if(e[r].length<t||!e[r][t])continue;const s=e[r][t];let i=0,c=0,o=0,a=0;for(let n=0;n<p;n++)t+n<=e[r].length&&e[r][t+n]===s&&i++,r+n<e.length&&e[r+n][t]===s&&c++,r+n<e.length&&t+n<=e[r+n].length&&e[r+n][t+n]===s&&o++,r+n<e.length&&t-n>=0&&e[r+n][t-n]===s&&a++;if(i===p||c===p||o===p||a===p)return s}return null},Ie=e=>{if(C(e)===0)return null;for(let r=0;r<A;r++)for(let t=0;t<d;t++){if(e[r].length<t||!e[r][t])continue;const s=e[r][t],i=[],c=[],o=[],a=[];for(let n=0;n<p;n++)t+n<=e[r].length&&e[r][t+n]===s&&i.push([t+n,r]),r+n<e.length&&e[r+n][t]===s&&c.push([t,r+n]),r+n<e.length&&t+n<=e[r+n].length&&e[r+n][t+n]===s&&o.push([t+n,r+n]),r+n<e.length&&t-n>=0&&e[r+n][t-n]===s&&a.push([t-n,r+n]);if(i.length===p)return i;if(c.length===p)return c;if(o.length===p)return o;if(a.length===p)return a}return null},C=e=>{if(ke(e))return 3;const r=Ae(e);return r===1?1:r===2?2:0},O=(e,r,t)=>{if(!le(e,t))throw new Pe(t);return e[t].push(r),e},Oe=(e,r,t)=>{const s=We(e,r,t?.iterations,t?.c);return O(e,r,s)};class ie{board;player;move;parent;children=[];visits=0;wins=0;constructor(r,t,s=null,i=null){this.board=r,this.player=t,this.move=s,this.parent=i}isFullyExpanded(){return this.children.length===V(this.board).length}isTerminal(){return C(this.board)!==f.notOver}}function ne(e,r,t,s=Math.sqrt(2)){return t===0?1/0:r/t+s*Math.sqrt(Math.log(e)/t)}function Te(e,r){for(;!e.isTerminal();)if(e.isFullyExpanded())e=Fe(e,r);else return qe(e);return e}function qe(e){const r=e.children.map(a=>a.move),s=V(e.board).filter(a=>!r.includes(a)),i=s[Math.floor(Math.random()*s.length)],c=N(e.board);O(c,e.player,i);const o=new ie(c,e.player===1?2:1,i,e);return e.children.push(o),o}function Fe(e,r){return e.children.reduce((t,s)=>{const i=ne(e.visits,t.wins,t.visits,r);return ne(e.visits,s.wins,s.visits,r)>i?s:t})}function Ee(e){const r=N(e.board);let t=e.player;for(;;){const s=C(r);if(s!==f.notOver)return s;const i=V(r),c=i[Math.floor(Math.random()*i.length)];O(r,t,c),t=t===1?2:1}}function Ge(e,r){let t=e;for(;t!==null;)t.visits+=1,r===f.winPlayer1&&t.parent?.player===1||r===f.winPlayer2&&t.parent?.player===2?t.wins+=1:r===f.draw&&(t.wins+=.5),t=t.parent}function We(e,r,t=1e3,s=Math.sqrt(2)){const i=new ie(N(e),r,null,null);for(let o=0;o<t;o++){const a=Te(i,s),n=Ee(a);Ge(a,n)}return i.children.reduce((o,a)=>o.visits>a.visits?o:a).move}const Ne=(e,r,t)=>{m(r,Array.from({length:7},()=>[]),!0),m(t,1)};var Ve=(e,r,t,s)=>r(l(t),l(s)),Re=se("<div><button><div></div></button></div>"),$e=se(`<!> <div class="main"><h3>Gravitrip</h3></div> <div>See <a href="https://www.quora.com/What-is-the-winning-strategy-for-the-first-player-in-Connect-Four-games">this quora thread</a> for some tips on the winning strategy</div> <span><button>Restart game</button> <span style="font-weight: bold"><!></span></span> <div class="board svelte-1bdwycb"></div> <div><h4>Monte Carlo Tree Search parameters</h4> <label for="mcts-iterations">Iterations:</label> <input id="mcts-iterations" type="number" min="0"/> <small>Number of simulations MCTS will run before choosing a move. Higher values usually mean
        stronger play but slower decisions.</small> <br/><br/> <label for="mcts-c">C (exploration constant):</label> <input id="mcts-c" type="number" min="0" step="0.1"/> <small>Controls the balance between exploration and exploitation. Lower values (e.g. 0.5, 0.7)
        favor tested moves, higher values (e.g. 2.0, 5.0) explore more. A typical default is √2 ≈
        1.41.</small></div>`,1);function Ke(e,r){we(r,!0);let t=P(D(Array.from({length:7},()=>[]))),s=J(()=>C(l(t))),i=J(()=>Ie(l(t))),c=P(null),o=P(1e3),a=P(D(Number(Math.sqrt(2).toFixed(3))));const n=Array.from({length:d},(u,v)=>v),ae=Array.from({length:A},(u,v)=>v);let g=P(1);const oe=(u,v)=>{l(g)===1&&le(l(t),u)&&C(l(t))===f.notOver&&(m(t,O(l(t),v,u),!0),m(g,l(g)===1?2:1,!0),setTimeout(()=>ue(),300))},ue=()=>{l(g)===2&&C(l(t))===f.notOver&&(m(t,Oe(l(t),l(g),{iterations:l(o),c:l(a)}),!0),m(g,l(g)===1?2:1,!0))},ce=(u,v)=>l(i)===null?!1:l(i).filter(w=>w[0]===u&&w[1]===v).length>0;var R=$e(),$=G(R);xe($,{title:"Gravitrip",description:"Gravitrip"});var T=b($,6),z=k(T);z.__click=[Ne,t,g];var H=b(z,2),ve=k(H);{var fe=u=>{var v=K("Game Over");_(u,v)},he=u=>{var v=Q(),w=G(v);{var F=x=>{var h=K();W(()=>be(h,`Player ${l(s)??""} wins`)),_(x,h)};Y(w,x=>{(l(s)===f.winPlayer1||l(s)===f.winPlayer2)&&x(F)},!0)}_(u,v)};Y(ve,u=>{l(s)===f.draw?u(fe):u(he,!1)})}M(H),M(T);var I=b(T,2);S(I,21,()=>n.reverse(),B,(u,v)=>{var w=Q(),F=G(w);S(F,17,()=>ae,B,(x,h)=>{var E=Re(),y=k(E);let Z;y.__click=[Ve,oe,h,g];var me=k(y);let j;M(y),M(E),W((pe,ge)=>{Ce(y,"aria-label","col-"+l(h)),Z=te(y,1,"outer-cell svelte-1bdwycb",null,Z,pe),j=te(me,1,"cell svelte-1bdwycb",null,j,ge)},[()=>({selected:l(c)===l(h),"winning-cell":ce(l(v),l(h))}),()=>({player1:l(t)[l(h)][l(v)]===1,player2:l(t)[l(h)][l(v)]===2})]),X("mouseenter",y,()=>m(c,l(h),!0)),X("mouseleave",y,()=>m(c,null)),_(x,E)}),_(u,w)}),M(I);var L=b(I,2),q=b(k(L),4);ee(q);var U=b(q,9);ee(U),de(2),M(L),W(()=>Me(I,`--nb-col: ${A}; --nb-row: ${d}`)),re(q,()=>l(o),u=>m(o,u)),re(U,()=>l(a),u=>m(a,u)),_(e,R),ye()}_e(["click"]);export{Ke as component};
