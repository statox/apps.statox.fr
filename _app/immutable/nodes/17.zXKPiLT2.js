import"../chunks/CWj6FrbW.js";import{p as B,A as I,B as Q,v as U,n as C,E as f,w as u,F as p,g as e,s as j,aF as O,k as R,o as X}from"../chunks/I8Oq6K5_.js";import{f as G,e as D,a as c,t as y}from"../chunks/CtuybYrQ.js";import{i as L}from"../chunks/CLIFNVQM.js";import{s as P,a as S}from"../chunks/CiomvxOc.js";import{m as Y}from"../chunks/H83gRMsy.js";import{u as V,U as Z}from"../chunks/BpkFy5xv.js";import{M as q}from"../chunks/O6TwAV7d.js";import{e as N,i as W}from"../chunks/ChwFfUuF.js";import{r as ee}from"../chunks/BKam2jIy.js";import{b as te}from"../chunks/BcNfVtUj.js";import{r as re,a as ae,A as oe}from"../chunks/vqBQ2vTX.js";import{t as se}from"../chunks/DT_vBX7t.js";import{D as J}from"../chunks/CW5DvOmo.js";import{s as $}from"../chunks/DRU8cbEw.js";import{a as ne}from"../chunks/UpbhdZy1.js";const ie=async n=>ae({path:"/personalTracker/upload",data:{event:n}}),z=async()=>{const{events:n}=await re({path:"/personalTracker/getAll",authorize:!0});return n},ve=async(n,t,i,_)=>{if(j(t,[],!0),e(i)!==Number(e(i).toFixed(1))&&e(t).push({level:"error",header:"Value have at most 1 number after the comma"}),(e(i)<80||e(i)>110)&&e(t).push({level:"error",header:"Value must be in kg"}),e(t).length)return;const g=J.now().toUTC().toUnixInteger();try{await ie({timestampUTC:g,type:"weight",value:Math.floor(e(i)*100)}),_.onUpload(),_.close()}catch(o){let v=o.message;o instanceof oe&&o.code===401?v="Invalid logged in user":o instanceof Z&&(v="User is logged out");const m=`<strong>Entry not created</strong><br/> ${v}`;se.push(m,{theme:{"--toastBarBackground":"#FF0000"}})}};var le=y('<button class="form-action svelte-1cixduj">Submit</button>'),de=y('<span class="form-action svelte-1cixduj">Login to upload an entry</span>'),ce=y('<div role="dialog" class="modal svelte-1cixduj"><div class="contents svelte-1cixduj"><h4 class="title-bar svelte-1cixduj">Add a new event <button>Close</button></h4> <!> <form class="form-content svelte-1cixduj"><label for="weight">Weight</label> <input type="number" step="0.1"> <br> <!></form></div></div>');function me(n,t){B(t,!0);const[i,_]=P(),g=()=>S(V,"$user",i);let o=I(Q([])),v=I(0);var m=D(),h=U(m);{var k=b=>{var r=ce(),l=f(r),s=f(l),E=u(f(s));E.__click=function(...a){var d;(d=t.close)==null||d.apply(this,a)},p(s);var w=u(s,2);N(w,17,()=>e(o),W,(a,d)=>{q(a,{get item(){return e(d)}})});var A=u(w,2),x=u(f(A),2);ee(x);var T=u(x,4);{var F=a=>{var d=le();d.__click=[ve,o,v,t],c(a,d)},M=a=>{var d=de();c(a,d)};L(T,a=>{g()?a(F):a(M,!1)})}p(A),p(l),p(r),te(x,()=>e(v),a=>j(v,a)),c(b,r)};L(h,b=>{t.isOpen&&b(k)})}c(n,m),C(),_()}G(["click"]);var ue=y('<div class="event svelte-1lfnev1"><div class="event-date"> </div> <div class="event-type"> </div> <div class="event-value"> </div></div>'),fe=y('<div class="event svelte-1lfnev1"><div>Date</div> <div>Type</div> <div>Value</div></div> <!>',1),pe=y("<p>Loading events</p>");function _e(n,t){B(t,!0);const[i,_]=P(),g=()=>S(V,"$user",i);var o=D(),v=U(o);{var m=h=>{var k=D(),b=U(k);ne(b,()=>t.events,r=>{var l=pe();c(r,l)},(r,l)=>{var s=fe(),E=u(U(s),2);N(E,17,()=>e(l),W,(w,A)=>{var x=ue();const T=O(()=>J.fromSeconds(e(A).eventDateUnix).toLocal().toFormat("dd/MM/yy HH:mm"));var F=f(x),M=f(F,!0);p(F);var a=u(F,2),d=f(a,!0);p(a);var H=u(a,2),K=f(H,!0);p(H),p(x),R(()=>{$(M,e(T)),$(d,e(A).type),$(K,e(A).value)}),c(w,x)}),c(r,s)},(r,l)=>{const s=O(()=>({level:"error",header:"Something went wrong getting events",message:e(l)}));q(r,{get item(){return e(s)}})}),c(h,k)};L(v,h=>{g()&&t.events&&h(m)})}c(n,o),C(),_()}var ge=(n,t)=>Y.open(me,{onUpload:t}),he=y("<div><button>Add an entry</button></div> <!>",1);function Be(n,t){B(t,!0);const[i,_]=P(),g=()=>S(V,"$user",i);let o=I(void 0);const v=()=>j(o,z(),!0);X(()=>j(o,z(),!0));var m=D(),h=U(m);{var k=r=>{var l=he(),s=U(l),E=f(s);E.__click=[ge,v],p(s);var w=u(s,2);_e(w,{get events(){return e(o)}}),c(r,l)},b=r=>{q(r,{item:{level:"info",header:"Login to add an entry or see events"}})};L(h,r=>{g()?r(k):r(b,!1)})}c(n,m),C(),_()}G(["click"]);export{Be as component};
