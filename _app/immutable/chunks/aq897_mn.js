var $=Object.defineProperty;var H=s=>{throw TypeError(s)};var tt=(s,t,e)=>t in s?$(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var o=(s,t,e)=>tt(s,typeof t!="symbol"?t+"":t,e),et=(s,t,e)=>t.has(s)||H("Cannot "+e);var h=(s,t,e)=>(et(s,t,"read from private field"),e?e.call(s):t.get(s)),k=(s,t,e)=>t.has(s)?H("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e);import"./CWj6FrbW.js";import{y as j,g as n,s as B,aF as st,z as rt,p as Q,f as l,n as U,aS as nt,o as at,a1 as J}from"./B4E0qFrQ.js";import{c as m,a as c,f as ot}from"./TaMh_RKI.js";import{s as w}from"./Da-Gd9Sz.js";import{a as it}from"./Dd-Fqcjd.js";import{i as L}from"./DihUjPeT.js";import{e as lt}from"./CXYg42bG.js";import{c as K}from"./CsG1USCJ.js";import{s as N}from"./BZUyvf6Q.js";var O,M;const D=class D extends EventTarget{constructor(e,{id:r,component:a,props:d}){super();o(this,"_props");o(this,"result",ct());o(this,"id");o(this,"component");o(this,"modals");k(this,O,j(!1));k(this,M,st(()=>this.modals.stack.length===0?!1:this.modals.stack[this.modals.stack.length-1].id===this.id&&!this.modals.transitioning));o(this,"close",(...e)=>{var a;if(((a=this.onBeforeClose)==null?void 0:a.call(this))===!1)return!1;const r=e[0];return this.dispatchEvent(new CustomEvent("close",{detail:r})),this.result.resolve(r),!0});o(this,"onBeforeClose");this.id=r||(D._idCounter++).toString(),this.component=a,this._props=d??{},this.modals=e}get exitBeforeEnter(){return n(h(this,O))}set exitBeforeEnter(e){B(h(this,O),e,!0)}get isOpen(){return n(h(this,M))}set isOpen(e){B(h(this,M),e)}get index(){return this.modals.stack.indexOf(this)}get props(){return{...this._props,id:this.id,index:this.index,isOpen:this.isOpen,close:this.close}}get promise(){return this.result.promise}};O=new WeakMap,M=new WeakMap,o(D,"_idCounter",0);let q=D;function ct(){let s,t;return{promise:new Promise((r,a)=>{s=r,t=a}),resolve:s,reject:t}}var P,S,z;class dt{constructor(){k(this,P,j(rt([])));k(this,S,j(null));k(this,z,j(!1));o(this,"open",async(t,e,r)=>{var A;if(this.transitioning)return;if(r!=null&&r.replace&&!((A=this.stack[this.stack.length-1])==null?void 0:A.close()))throw new Error("Current modal prevented closing");this.action="push";const a=this.stack[this.stack.length-1];a!=null&&a.exitBeforeEnter&&(this.transitioning=!0);const d=new q(this,{id:r==null?void 0:r.id,component:t,props:e});return this.stack.push(d),d.addEventListener("close",()=>{d.exitBeforeEnter&&(this.transitioning=!0),this.stack.indexOf(d)>-1&&this.stack.splice(this.stack.indexOf(d),1),this.action="pop"},{once:!0}),d.promise});o(this,"close",(t=1)=>{if(typeof t!="number"||t<1)throw new Error(`amount must be a number greater than 0. Received ${t}`);const e=this.stack.slice(this.stack.length-t).reverse();let r=0;for(const a of e){if(!a.close())break;r++}return t===r});o(this,"closeById",t=>{const e=this.stack.find(r=>r.id===t);return e?e.close():!1});o(this,"closeAll",()=>this.close(this.stack.length))}get stack(){return n(h(this,P))}set stack(t){B(h(this,P),t,!0)}get action(){return n(h(this,S))}set action(t){B(h(this,S),t,!0)}get transitioning(){return n(h(this,z))}set transitioning(t){B(h(this,z),t,!0)}}P=new WeakMap,S=new WeakMap,z=new WeakMap;const ft=Symbol("modal");function ht(s){nt(ft,s)}function mt(s,t){Q(t,!0),ht(t.modal);var e=m(),r=l(e);w(r,()=>t.children),c(s,e),U()}const x=new dt;var ut=ot("<!> <!>",1);function Bt(s,t){Q(t,!0);function e(u){return typeof u.prototype>"u"}var r=ut(),a=l(r);{var d=u=>{var i=m(),F=l(i);w(F,()=>t.backdrop??J,()=>x),c(u,i)};L(a,u=>{x.stack.length>0&&u(d)})}var A=at(a,2);lt(A,19,()=>x.stack,u=>u.id,(u,i)=>{mt(u,{get modal(){return n(i)},children:(F,pt)=>{var G=m(),V=l(G);{var W=_=>{var E=m(),I=l(E);it(I,()=>n(i).component(),y=>{var v=m(),f=l(v);w(f,()=>t.loading??J,()=>x),c(y,v)},(y,v)=>{var f=m(),g=l(f);{var C=p=>{var b=m(),T=l(b);w(T,()=>t.modal,()=>({component:n(v).default,props:n(i).props}),()=>x),c(p,b)},R=p=>{var b=m(),T=l(b);K(T,()=>n(v).default,(Y,Z)=>{Z(Y,N(()=>n(i).props))}),c(p,b)};L(g,p=>{t.modal?p(C):p(R,!1)})}c(y,f)}),c(_,E)},X=_=>{var E=m(),I=l(E);{var y=f=>{var g=m(),C=l(g);w(C,()=>t.modal,()=>({component:n(i).component,props:n(i).props}),()=>x),c(f,g)},v=f=>{var g=m(),C=l(g);K(C,()=>n(i).component,(R,p)=>{p(R,N(()=>n(i).props))}),c(f,g)};L(I,f=>{t.modal?f(y):f(v,!1)})}c(_,E)};L(V,_=>{e(n(i).component)?_(W):_(X,!1)})}c(F,G)},$$slots:{default:!0}})}),c(s,r),U()}export{Bt as M,x as m};
