var $=Object.defineProperty;var U=s=>{throw TypeError(s)};var ee=(s,e,t)=>e in s?$(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var o=(s,e,t)=>ee(s,typeof e!="symbol"?e+"":e,t),te=(s,e,t)=>e.has(s)||U("Cannot "+t);var h=(s,e,t)=>(te(s,e,"read from private field"),t?t.call(s):e.get(s)),k=(s,e,t)=>e.has(s)?U("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t);import"./CWj6FrbW.js";import{U as se,a8 as re,a1 as ae,aE as H,aB as ne,h as ie,K as oe,A as F,g as i,s as B,aH as ce,B as le,p as J,v as l,n as Q,aT as de,w as fe}from"./DzPn16lH.js";import{e as m,a as d,f as he}from"./DeWgRYsc.js";import{a as me}from"./CxcmexvO.js";import{i as S}from"./KWIcU4kR.js";import{e as ue}from"./BoNBqYmx.js";import{c as q}from"./BRqMzVlt.js";import{s as G}from"./8VJmz0n2.js";function w(s,e,...t){var r=s,a=H,n;se(()=>{a!==(a=e())&&(n&&(ne(n),n=null),n=ae(()=>a(r,...t)))},re),ie&&(r=oe)}var O,A;const L=class L extends EventTarget{constructor(t,{id:r,component:a,props:n}){super();o(this,"_props");o(this,"result",pe());o(this,"id");o(this,"component");o(this,"modals");k(this,O,F(!1));k(this,A,ce(()=>this.modals.stack.length===0?!1:this.modals.stack[this.modals.stack.length-1].id===this.id&&!this.modals.transitioning));o(this,"close",(...t)=>{var a;if(((a=this.onBeforeClose)==null?void 0:a.call(this))===!1)return!1;const r=t[0];return this.dispatchEvent(new CustomEvent("close",{detail:r})),this.result.resolve(r),!0});o(this,"onBeforeClose");this.id=r||(L._idCounter++).toString(),this.component=a,this._props=n??{},this.modals=t}get exitBeforeEnter(){return i(h(this,O))}set exitBeforeEnter(t){B(h(this,O),t,!0)}get isOpen(){return i(h(this,A))}set isOpen(t){B(h(this,A),t)}get index(){return this.modals.stack.indexOf(this)}get props(){return{...this._props,id:this.id,index:this.index,isOpen:this.isOpen,close:this.close}}get promise(){return this.result.promise}};O=new WeakMap,A=new WeakMap,o(L,"_idCounter",0);let I=L;function pe(){let s,e;return{promise:new Promise((r,a)=>{s=r,e=a}),resolve:s,reject:e}}var T,M,P;class ve{constructor(){k(this,T,F(le([])));k(this,M,F(null));k(this,P,F(!1));o(this,"open",async(e,t,r)=>{var R;if(this.transitioning)return;if(r!=null&&r.replace&&!((R=this.stack[this.stack.length-1])==null?void 0:R.close()))throw new Error("Current modal prevented closing");this.action="push";const a=this.stack[this.stack.length-1];a!=null&&a.exitBeforeEnter&&(this.transitioning=!0);const n=new I(this,{id:r==null?void 0:r.id,component:e,props:t});return this.stack.push(n),n.addEventListener("close",()=>{n.exitBeforeEnter&&(this.transitioning=!0),this.stack.indexOf(n)>-1&&this.stack.splice(this.stack.indexOf(n),1),this.action="pop"},{once:!0}),n.promise});o(this,"close",(e=1)=>{if(typeof e!="number"||e<1)throw new Error(`amount must be a number greater than 0. Received ${e}`);const t=this.stack.slice(this.stack.length-e).reverse();let r=0;for(const a of t){if(!a.close())break;r++}return e===r});o(this,"closeById",e=>{const t=this.stack.find(r=>r.id===e);return t?t.close():!1});o(this,"closeAll",()=>this.close(this.stack.length))}get stack(){return i(h(this,T))}set stack(e){B(h(this,T),e,!0)}get action(){return i(h(this,M))}set action(e){B(h(this,M),e,!0)}get transitioning(){return i(h(this,P))}set transitioning(e){B(h(this,P),e,!0)}}T=new WeakMap,M=new WeakMap,P=new WeakMap;const ge=Symbol("modal");function _e(s){de(ge,s)}function ke(s,e){J(e,!0),_e(e.modal);var t=m(),r=l(t);w(r,()=>e.children),d(s,t),Q()}const x=new ve;var xe=he("<!> <!>",1);function Pe(s,e){J(e,!0);function t(u){return typeof u.prototype>"u"}var r=xe(),a=l(r);{var n=u=>{var c=m(),N=l(c);w(N,()=>e.backdrop??H,()=>x),d(u,c)};S(a,u=>{x.stack.length>0&&u(n)})}var R=fe(a,2);ue(R,19,()=>x.stack,u=>u.id,(u,c)=>{ke(u,{get modal(){return i(c)},children:(N,Ee)=>{var K=m(),V=l(K);{var W=_=>{var E=m(),j=l(E);me(j,()=>i(c).component(),y=>{var v=m(),f=l(v);w(f,()=>e.loading??H,()=>x),d(y,v)},(y,v)=>{var f=m(),g=l(f);{var b=p=>{var C=m(),D=l(C);w(D,()=>e.modal,()=>({component:i(v).default,props:i(c).props}),()=>x),d(p,C)},z=p=>{var C=m(),D=l(C);q(D,()=>i(v).default,(Y,Z)=>{Z(Y,G(()=>i(c).props))}),d(p,C)};S(g,p=>{e.modal?p(b):p(z,!1)})}d(y,f)}),d(_,E)},X=_=>{var E=m(),j=l(E);{var y=f=>{var g=m(),b=l(g);w(b,()=>e.modal,()=>({component:i(c).component,props:i(c).props}),()=>x),d(f,g)},v=f=>{var g=m(),b=l(g);q(b,()=>i(c).component,(z,p)=>{p(z,G(()=>i(c).props))}),d(f,g)};S(j,f=>{e.modal?f(y):f(v,!1)})}d(_,E)};S(V,_=>{t(i(c).component)?_(W):_(X,!1)})}d(N,K)},$$slots:{default:!0}})}),d(s,r),Q()}export{Pe as M,x as m,w as s};
