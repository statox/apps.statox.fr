import"./NZTpNUN0.js";import{b as y,g as r,c as C,e as H,W as J,p as I,f as n,a as R,bi as K,s as N,ag as j}from"./yfIaCavW.js";import{c as l,a,f as Q}from"./_u8npTyQ.js";import{s as E}from"./CWc3oWDu.js";import{a as U}from"./Gplxatyx.js";import{i as w}from"./DvWUsNSo.js";import{e as V}from"./CjLfmKGv.js";import{c as z}from"./CRwTh88B.js";import{s as D}from"./DibrhvKt.js";class P extends EventTarget{static _idCounter=0;_props;result=X();id;component;modals;#t=y(!1);get exitBeforeEnter(){return r(this.#t)}set exitBeforeEnter(t){C(this.#t,t,!0)}constructor(t,{id:e,component:s,props:d}){super(),this.id=e||(P._idCounter++).toString(),this.component=s,this._props=d??{},this.modals=t}#e=H(()=>this.modals.stack.length===0?!1:this.modals.stack[this.modals.stack.length-1].id===this.id&&!this.modals.transitioning);get isOpen(){return r(this.#e)}set isOpen(t){C(this.#e,t)}get index(){return this.modals.stack.indexOf(this)}get props(){return{...this._props,id:this.id,index:this.index,isOpen:this.isOpen,close:this.close}}close=(...t)=>{if(this.onBeforeClose?.()===!1)return!1;const e=t[0];return this.dispatchEvent(new CustomEvent("close",{detail:e})),this.result.resolve(e),!0};get promise(){return this.result.promise}onBeforeClose}function X(){let c,t;return{promise:new Promise((s,d)=>{c=s,t=d}),resolve:c,reject:t}}class Y{#t=y(J([]));get stack(){return r(this.#t)}set stack(t){C(this.#t,t,!0)}#e=y(null);get action(){return r(this.#e)}set action(t){C(this.#e,t,!0)}#s=y(!1);get transitioning(){return r(this.#s)}set transitioning(t){C(this.#s,t,!0)}open=async(t,e,s)=>{if(this.transitioning)return;if(s?.replace&&!this.stack[this.stack.length-1]?.close())throw new Error("Current modal prevented closing");this.action="push",this.stack[this.stack.length-1]?.exitBeforeEnter&&(this.transitioning=!0);const f=new P(this,{id:s?.id,component:t,props:e});return this.stack.push(f),f.addEventListener("close",()=>{f.exitBeforeEnter&&(this.transitioning=!0),this.stack.indexOf(f)>-1&&this.stack.splice(this.stack.indexOf(f),1),this.action="pop"},{once:!0}),f.promise};close=(t=1)=>{if(typeof t!="number"||t<1)throw new Error(`amount must be a number greater than 0. Received ${t}`);const e=this.stack.slice(this.stack.length-t).reverse();let s=0;for(const d of e){if(!d.close())break;s++}return t===s};closeById=t=>{const e=this.stack.find(s=>s.id===t);return e?e.close():!1};closeAll=()=>this.close(this.stack.length)}const Z=Symbol("modal");function $(c){K(Z,c)}function tt(c,t){I(t,!0),$(t.modal);var e=l(),s=n(e);E(s,()=>t.children),a(c,e),R()}const v=new Y;var et=Q("<!> <!>",1);function ht(c,t){I(t,!0);function e(h){return typeof h.prototype>"u"}var s=et(),d=n(s);{var f=h=>{var o=l(),M=n(o);E(M,()=>t.backdrop??j,()=>v),a(h,o)};w(d,h=>{v.stack.length>0&&h(f)})}var A=N(d,2);V(A,19,()=>v.stack,h=>h.id,(h,o)=>{tt(h,{get modal(){return r(o)},children:(M,st)=>{var L=l(),T=n(L);{var W=g=>{var _=l(),B=n(_);U(B,()=>r(o).component(),k=>{var u=l(),i=n(u);E(i,()=>t.loading??j,()=>v),a(k,u)},(k,u)=>{var i=l(),p=n(i);{var x=m=>{var b=l(),S=n(b);E(S,()=>t.modal,()=>({component:r(u).default,props:r(o).props}),()=>v),a(m,b)},O=m=>{var b=l(),S=n(b);z(S,()=>r(u).default,(F,G)=>{G(F,D(()=>r(o).props))}),a(m,b)};w(p,m=>{t.modal?m(x):m(O,!1)})}a(k,i)}),a(g,_)},q=g=>{var _=l(),B=n(_);{var k=i=>{var p=l(),x=n(p);E(x,()=>t.modal,()=>({component:r(o).component,props:r(o).props}),()=>v),a(i,p)},u=i=>{var p=l(),x=n(p);z(x,()=>r(o).component,(O,m)=>{m(O,D(()=>r(o).props))}),a(i,p)};w(B,i=>{t.modal?i(k):i(u,!1)})}a(g,_)};w(T,g=>{e(r(o).component)?g(W):g(q,!1)})}a(M,L)},$$slots:{default:!0}})}),a(c,s),R()}export{ht as M,v as m};
